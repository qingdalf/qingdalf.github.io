<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="https://scaven.site">
  <title>倚楼听雨</title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    
    <!-- <meta name="keywords" content="">
    <meta name="description" content="倚楼听风雨，淡看江湖路。"> -->
  
  <meta name="description" content="倚楼听风雨，淡看江湖路。">
<meta property="og:type" content="website">
<meta property="og:title" content="倚楼听雨">
<meta property="og:url" content="https://scaven.site/index.html">
<meta property="og:site_name" content="倚楼听雨">
<meta property="og:description" content="倚楼听风雨，淡看江湖路。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="qingdalf">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="倚楼听雨" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.ico">
  
  
    <link rel="apple-touch-icon" href="/apple-touch-icon-180x180.png">
  
  <link rel="stylesheet" type="text/css" href="/./main.a5fda8.css">
  <style type="text/css">
    
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

  
  


  
    <script src="/lib/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">
  

</head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      


<div class="overlay" style="background: #4d4d4d;"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="/img/avatar.webp" class="js-avatar">
		</a>
		<hgroup>
			<h1 class="header-author"><a href="/">qingdalf</a></h1>
		</hgroup>
		
		<p class="header-subtitle">welcome to my blog.</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/2021-04/20-welcome/" >Home</a></li>
			
				<li><a href="/tags/linux" >Linux</a></li>
			
				<li><a href="/2021-04/21-PythonContents/" >python</a></li>
			
				<li><a href="/tags/kubernets" >kubernets</a></li>
			
				<li><a href="/tags/DevOps" >DevOps</a></li>
			
				<li><a href="/2021-04/20-aboutme/" >AboutMe</a></li>
			
			</ul>
		</nav>
		<nav class="header-smart-menu">
			
				
			
				
			
				
			
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					
						<a class="github" target="_blank" rel="noopener" href="https://github.com/qingdalf" 
												title="GitHub" ><i class="icon-github"></i></a>
					
				
					
						<a class="gitee" target="_blank" rel="noopener" href="https://gitee.com/qingdalf" 
												title="码云" ><i class="icon-gitee"></i></a>
					
				
					
						<a class="weibo" target="_blank" rel="noopener" href="https://weibo.com/qingdalf" 
												title="微博" ><i class="icon-weibo"></i></a>
					
				
			</div>
		
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
      
      <a class="forkMe" style="position:absolute;z-index:999;top:0;right:0.5em;" 
        href="https://github.com/qingdalf/" target="_blank">
        <img src="/img/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
      
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<a href="/">
					<img src="/img/avatar.webp" class="js-avatar">
				</a>
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">qingdalf</h1>
			</hgroup>
			
			<p class="header-subtitle"><i class="icon icon-quo-left"></i>welcome to my blog.<i class="icon icon-quo-right"></i></p>
			
			
			
				
			
				
			
				
			
				
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						
						<a class="github" target="_blank" 
							href="https://github.com/qingdalf" title="GitHub"><i class="icon-github"></i></a>
						
					
						
						<a class="gitee" target="_blank" 
							href="https://gitee.com/qingdalf" title="码云"><i class="icon-gitee"></i></a>
						
					
						
						<a class="weibo" target="_blank" 
							href="https://weibo.com/qingdalf" title="微博"><i class="icon-weibo"></i></a>
						
					
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 70%">
				
				
					<li style="width: 16.666666666666668%"><a href="/2021-04/20-welcome/">Home</a></li>
		        
					<li style="width: 16.666666666666668%"><a href="/tags/linux">Linux</a></li>
		        
					<li style="width: 16.666666666666668%"><a href="/2021-04/21-PythonContents/">python</a></li>
		        
					<li style="width: 16.666666666666668%"><a href="/tags/kubernets">kubernets</a></li>
		        
					<li style="width: 16.666666666666668%"><a href="/tags/DevOps">DevOps</a></li>
		        
					<li style="width: 16.666666666666668%"><a href="/2021-04/20-aboutme/">AboutMe</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1"
              class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            
  
    <script src="/lib/oauthcallback.browser.js"></script>
  
  <script>
    Oauthcallback();
  </script>


  
    <article id="post-PythonIf" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2021-04/25-PythonIf/">PythonIf</a>
	
    </h1>
  


  
  
<a href="/2021-04/25-PythonIf/" class="archive-article-date">
        <time datetime="2021-04-25T14:59:25.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-25</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <p>f语句</p>
<p>​        编程时经常需要检查一系列条件，并据此决定采取什么措施。在Python中，if语句让你能够检查程序的当前状态，并据此采取相应的措施。</p>
<h2 id="1-格式"><a href="#1-格式" class="headerlink" title="1. 格式"></a>1. 格式</h2><h3 id="1-1-单分支结构"><a href="#1-1-单分支结构" class="headerlink" title="1.1 单分支结构"></a>1.1 单分支结构</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 条件为真:</span><br><span class="line">   执行的代码块</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li>每个条件后面要使用冒号 **:**，表示接下来是满足条件后要执行的语句块。</li>
<li>使用缩进来划分语句块，相同缩进数的语句在一起组成一个语句块。</li>
</ul>
<h3 id="1-2-双分支结构"><a href="#1-2-双分支结构" class="headerlink" title="1.2 双分支结构"></a>1.2 双分支结构</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 条件为真:</span><br><span class="line">   执行的代码块</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span>为假时，执行的代码块</span><br></pre></td></tr></table></figure>

<h3 id="1-3-多分支结构"><a href="#1-3-多分支结构" class="headerlink" title="1.3 多分支结构"></a>1.3 多分支结构</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> 条件为真时:</span><br><span class="line">   执行的代码块</span><br><span class="line"><span class="keyword">elif</span> 上面条件为假，此条件为真时:</span><br><span class="line">    执行的代码块</span><br><span class="line"><span class="keyword">elif</span> 上面条件都为假，此条件为真时:</span><br><span class="line">    执行的代码块</span><br><span class="line"><span class="keyword">elif</span> 上面条件都为假，此条件为真时:</span><br><span class="line">    执行的代码块</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span>和<span class="keyword">elif</span>都为假时，执行的代码块</span><br></pre></td></tr></table></figure>

<h2 id="2-案例"><a href="#2-案例" class="headerlink" title="2. 案例"></a>2. 案例</h2><h3 id="2-1-案例1：判断正负数"><a href="#2-1-案例1：判断正负数" class="headerlink" title="2.1 案例1：判断正负数"></a>2.1 <strong>案例1：判断正负数</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var = <span class="number">2</span> </span><br><span class="line"><span class="keyword">if</span> var &lt; <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;var是一个负数&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;var是一个正数&quot;</span>)</span><br></pre></td></tr></table></figure>



<h3 id="2-2-案例2：判断用户输入的年龄"><a href="#2-2-案例2：判断用户输入的年龄" class="headerlink" title="2.2 案例2：判断用户输入的年龄"></a>2.2 <strong>案例2：判断用户输入的年龄</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Age = <span class="built_in">input</span>(<span class="string">&quot;请输入您的年龄： &quot;</span>)</span><br><span class="line"><span class="keyword">if</span> Age.isdigit():</span><br><span class="line">    age = <span class="built_in">int</span>(Age)</span><br><span class="line">    <span class="keyword">if</span> age &lt;= <span class="number">20</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;您好，您是一个年轻人&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> age &lt;= <span class="number">45</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;您好，您是一个中年人 &quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> age &gt; <span class="number">45</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;您好，您是一个老年人&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;您好，您是一个长寿的人&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;您的输入不正确，请输入数字！&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>需要注意的几点：</p>
<ul>
<li> 同类型做比较才有意义：input()函数的输入结果是一个字符串类型，在本案例中需要将其转换成数字类型，然后做比较</li>
<li> 不要相信用户的输入，年龄是个数字，但是总会有人不按套路出牌，比如输入字母、汉字、符号等</li>
<li> 上面的案例中我们使用了嵌套<code>if-else</code></li>
</ul>
<h2 id="3-else这个脚踏多只船的家伙"><a href="#3-else这个脚踏多只船的家伙" class="headerlink" title="3 else这个脚踏多只船的家伙"></a>3 else这个脚踏多只船的家伙</h2><p>​        <code>else</code>不仅能跟<code>if</code>搭档，还能跟<code>for</code>和<code>while</code>搭档，只有当for或<code>while</code>循环被break中断后，才会跳过<code>else</code>语句</p>
<h3 id="3-1-for…else"><a href="#3-1-for…else" class="headerlink" title="3.1 for…else"></a>3.1 for…else</h3><p><strong>案例：获取 100 以内的质数</strong></p>
<p>​        质数：<em>质数</em>是指在大于1的自然数中，除了1和它本身以外不再有其他因数的自然数，这是百度的定义，说简单点就是只能除1和本身时得到的商是整数，如：2、3、5、7、11、13、17、19</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">num = []</span><br><span class="line">i=<span class="number">2</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">100</span>):</span><br><span class="line">   j=<span class="number">2</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, i):</span><br><span class="line">      <span class="keyword">if</span>(i % j == <span class="number">0</span>):</span><br><span class="line">         <span class="keyword">break</span></span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">      num.append(i)</span><br><span class="line"><span class="built_in">print</span>(num)</span><br></pre></td></tr></table></figure>

<h3 id="3-2-while…else"><a href="#3-2-while…else" class="headerlink" title="3.2 while…else"></a>3.2 while…else</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">0</span></span><br><span class="line">num = []</span><br><span class="line"><span class="keyword">while</span> i &lt; <span class="number">10</span>:</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        num.append(i)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(num)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 运行结果为：此时没有运行结果，因此没有执行到print()函数，也就不能将print(num)输出的屏幕上</span></span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">num = []</span><br><span class="line"><span class="keyword">while</span> i &lt; <span class="number">10</span>:</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        num.append(i)</span><br><span class="line">        <span class="built_in">print</span>(i)   <span class="comment"># 为了方便查看执行结果，再此处添加一个print()函数，打印i的值</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(num)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 执行结果为：</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">python</a>
        		</li>
      		
		</ul>
	</div>

    
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/python//" class="article-tag-list-link color2">python</a>
        		</li>
      		
		</ul>
	</div>


    
    <p class="article-more-link">
      <a class="article-more-a" href="/2021-04/25-PythonIf/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-PythonTuple" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2021-04/24-PythonTuple/">PythonTuple</a>
	
    </h1>
  


  
  
<a href="/2021-04/24-PythonTuple/" class="archive-article-date">
        <time datetime="2021-04-24T03:18:59.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-24</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h1 id="第四章-元组"><a href="#第四章-元组" class="headerlink" title="第四章 元组"></a>第四章 元组</h1><h2 id="1-认识元组"><a href="#1-认识元组" class="headerlink" title="1 认识元组"></a>1 认识元组</h2><h3 id="1-1-元组是什么"><a href="#1-1-元组是什么" class="headerlink" title="1.1 元组是什么"></a>1.1 元组是什么</h3><p>​        Python 的元组与列表类似，不同之处在于元组的元素不能修改(元组是可信任的)。元组使用小括号 **( )**，列表使用方括号 **[ ]**。元组创建很简单，只需要在括号中添加元素，并使用逗号隔开即可。</p>
<h3 id="1-2-如何定义元组"><a href="#1-2-如何定义元组" class="headerlink" title="1.2 如何定义元组"></a>1.2 如何定义元组</h3><ul>
<li>直接通过变量定义</li>
<li>通过tuple()函数定义</li>
</ul>
<p><strong>(1) 直接定义</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.定义一个空元组</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = ()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(t)</span><br><span class="line">()           <span class="comment"># 输出了一个空元组</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(t)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">tuple</span>&#x27;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"># 2.定义一个含有整型、浮点型、字符串、列表类型元素的元组</span></span><br><span class="line">&gt;&gt;&gt; T = (1, &quot;2&quot;, 1.2, [&quot;Hello&quot;])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(T)</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;2&#x27;</span>, <span class="number">1.2</span>, [<span class="string">&#x27;Hello&#x27;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(T)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">tuple</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        值得注意的是，当元组只有一个元素时，需要在元素后面加一个逗号。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.我们定义一个不加逗号的情况</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = (<span class="number">1</span>)           <span class="comment"># 当元组只有一个元素时，此种定义方法是错误的</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(t)</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(t)           <span class="comment"># 通过type()函数进行检测，发现是一个整型，并不是一个元组</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">int</span>&#x27;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"># 2.按照元组的定义要求进行定义并查看类型</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">print</span>(<span class="params">t</span>)</span></span><br><span class="line"><span class="class">(<span class="params"><span class="number">1</span>,</span>)</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">type</span>(<span class="params">t</span>)</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">tuple</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>(2) 通过tuple()函数定义</strong> </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">tuple</span>(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">tuple</span>(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">(<span class="string">&#x27;1&#x27;</span>,)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将列表转换成元组</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="number">1</span>, <span class="string">&quot;Hello&quot;</span>, [<span class="string">&quot;张三&quot;</span>, <span class="number">9</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = <span class="built_in">tuple</span>(L)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(t)</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;Hello&#x27;</span>, [<span class="string">&#x27;张三&#x27;</span>, <span class="number">9</span>])</span><br></pre></td></tr></table></figure>

<h2 id="2-元组的常用操作"><a href="#2-元组的常用操作" class="headerlink" title="2 元组的常用操作"></a>2 元组的常用操作</h2><p>​        元组跟列表类似，列表的常用操作元组也适用，除了修改元组的值(包括修改、增加、删除元组的元素)。</p>
<h3 id="2-1-遍历元组中的所有值"><a href="#2-1-遍历元组中的所有值" class="headerlink" title="2.1 遍历元组中的所有值"></a>2.1 遍历元组中的所有值</h3><p>​        跟列表一样，元组中的元素也可以通过for循环进行遍历</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="number">1</span>, <span class="string">&quot;Hello&quot;</span>, [<span class="string">&quot;张三&quot;</span>, <span class="number">9</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>T = <span class="built_in">tuple</span>(L)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> t <span class="keyword">in</span> T:</span><br><span class="line">      <span class="built_in">print</span>(t)</span><br><span class="line">        </span><br><span class="line"><span class="number">1</span></span><br><span class="line">Hello</span><br><span class="line">[<span class="string">&#x27;张三&#x27;</span>, <span class="number">9</span>] </span><br></pre></td></tr></table></figure>

<h3 id="2-2-元组的索引"><a href="#2-2-元组的索引" class="headerlink" title="2.2 元组的索引"></a>2.2 元组的索引</h3><p>​        元组的索引同字符串、类别一样，当然也可以通过索引对元组进行切片操作。</p>
<h4 id="2-2-1-通过索引获取元组的元素"><a href="#2-2-1-通过索引获取元组的元素" class="headerlink" title="2.2.1 通过索引获取元组的元素"></a>2.2.1 通过索引获取元组的元素</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>T = (<span class="number">1</span>, <span class="string">&quot;Hello&quot;</span>, [<span class="string">&quot;张三&quot;</span>, <span class="number">9</span>], <span class="number">1.2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>T[<span class="number">0</span>]</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>T[<span class="number">1</span>]</span><br><span class="line"><span class="string">&#x27;Hello&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>T[-<span class="number">1</span>]</span><br><span class="line"><span class="number">1.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取元组中嵌套列表的元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>T[<span class="number">2</span>]</span><br><span class="line">[<span class="string">&#x27;张三&#x27;</span>, <span class="number">9</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>T[<span class="number">2</span>][<span class="number">0</span>]</span><br><span class="line"><span class="string">&#x27;张三&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>T[<span class="number">2</span>][<span class="number">1</span>]</span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure>

<p>​        索引图如下：</p>
<img src="./image-20210427092322338.png" alt="image-20210427092322338" style="zoom:67%;" />

<h4 id="2-2-2-通过索引对元组切片"><a href="#2-2-2-通过索引对元组切片" class="headerlink" title="2.2.2 通过索引对元组切片"></a>2.2.2 通过索引对元组切片</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取前三个元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>T[:<span class="number">3</span>]</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;Hello&#x27;</span>, [<span class="string">&#x27;张三&#x27;</span>, <span class="number">9</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取第三个元素和之后的所有元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>T[<span class="number">2</span>:]</span><br><span class="line">([<span class="string">&#x27;张三&#x27;</span>, <span class="number">9</span>], <span class="number">1.2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将元组的元素排反序</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>T[::-<span class="number">1</span>]</span><br><span class="line">(<span class="number">1.2</span>, [<span class="string">&#x27;张三&#x27;</span>, <span class="number">9</span>], <span class="string">&#x27;Hello&#x27;</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h3 id="2-3-元组的拼接"><a href="#2-3-元组的拼接" class="headerlink" title="2.3 元组的拼接"></a>2.3 元组的拼接</h3><p>​        元组虽然不能进行元素的修改，但是我们可以将两个元组进行拼接形成一个大元组</p>
<p><strong>(1) 通过加号将多个元组进行拼接</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义元组t1并检查内存地址</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t1 = (<span class="number">1</span>, <span class="string">&quot;Hello&quot;</span>,)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(t1)</span><br><span class="line"><span class="number">2383109449664</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义元组t2并检查内存地址</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t2 = ([<span class="string">&quot;张三&quot;</span>, <span class="number">9</span>], <span class="number">1.2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(t2)</span><br><span class="line"><span class="number">2383109981440</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对t1和t2进行拼接</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>T = t1 + t2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拼接过后的t1还是t1，t2还是t2，并没有发生变化</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(t1)</span><br><span class="line"><span class="number">2383109449664</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(t2)</span><br><span class="line"><span class="number">2383109981440</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(T)</span><br><span class="line"><span class="number">2383109666352</span></span><br></pre></td></tr></table></figure>

<p><strong>(2) 元组与整型的乘积</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义元组t1，并查看内存地址</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t1 = (<span class="number">1</span>, <span class="string">&quot;Hello&quot;</span>,)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过乘法扩展元组的元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t1 * <span class="number">2</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;Hello&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;Hello&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="2-4-元组的删除"><a href="#2-4-元组的删除" class="headerlink" title="2.4 元组的删除"></a>2.4 元组的删除</h3><p>​        元组中的元素虽然不能被修改，但是并不妨碍我们删除元组。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(T)</span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;Hello&#x27;</span>, [<span class="string">&#x27;张三&#x27;</span>, <span class="number">9</span>], <span class="number">1.2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除元组T后再次打印T，显示T未被定义</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> T</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(T)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;pyshell#67&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="built_in">print</span>(T)</span><br><span class="line">NameError: name <span class="string">&#x27;T&#x27;</span> <span class="keyword">is</span> <span class="keyword">not</span> defined</span><br></pre></td></tr></table></figure>

<h3 id="2-5-元组的其他一些操作"><a href="#2-5-元组的其他一些操作" class="headerlink" title="2.5 元组的其他一些操作"></a>2.5 元组的其他一些操作</h3><p>​        元组适用序列的一般性操作，如<code>in</code>、<code>not in</code>、最大值、最小值、长度、元素和等</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>T = (<span class="number">1</span>, <span class="string">&#x27;Hello&#x27;</span>, [<span class="string">&#x27;张三&#x27;</span>, <span class="number">9</span>], <span class="number">1.2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看指定元素是否包含于元组中</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1</span> <span class="keyword">in</span> T</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">1.2</span> <span class="keyword">not</span> <span class="keyword">in</span> T</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(T)</span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>​        获取元素全为数字的元组的最值，只适用于元组的元素全为数值的情况。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>t =  <span class="built_in">tuple</span>(<span class="built_in">range</span>(<span class="number">101</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">max</span>(t)</span><br><span class="line"><span class="number">100</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">min</span>(t)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">sum</span>(t)</span><br><span class="line"><span class="number">5050</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(t)</span><br><span class="line"><span class="number">101</span></span><br></pre></td></tr></table></figure>

<h2 id="3-关于-不-可变"><a href="#3-关于-不-可变" class="headerlink" title="3 关于(不)可变"></a>3 关于(不)可变</h2><p>​        不可变是指内存地址的变化，比如列表，可以修改元素值，修改元素值之后列表的内存地址并没有变化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="number">1</span>, <span class="string">&#x27;Hello&#x27;</span>, [<span class="string">&#x27;张三&#x27;</span>, <span class="number">9</span>], <span class="number">1.2</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(L)</span><br><span class="line"><span class="number">2383109707456</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(L[<span class="number">0</span>])</span><br><span class="line"><span class="number">140736779327136</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改列表第一个元素的值</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L[<span class="number">0</span>] = <span class="string">&quot;China&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(L)</span><br><span class="line"><span class="number">2383109707456</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(L[<span class="number">0</span>])</span><br><span class="line"><span class="number">2383109618544</span></span><br></pre></td></tr></table></figure>

<p>​        通过上面的例子，我们可以发现，修改列表元素前后，列表L的内存地址(2383109707456)并没有变化，变化的是修改的元素的内存地址(即列表值的内存地址)，这就是说我们修改了列表的值，列表还是原先的列表(L的内存地址没有变化)，但是列表的元素已经发生了变化。</p>
<p><img src="./image-20210427101204300.png" alt="image-20210427101204300"></p>
<p>​        在未对列表元素进行修改时的内存地址和指向</p>
<img src="./image-20210427102341664.png" alt="image-20210427102341664" style="zoom:67%;" />

<p>执行修改操作<code>L[0] = &quot;China&quot;</code>后，列表内存地址和指向的变化，列表L的内存地址并没有变化(仍然是<code>2383109707456</code>)，但是L内存地址(<code>2383109707456</code>)中的第一个内存地址却发生了变化，即L[0]的内存地址由<code>140736779327136</code>变成了<code>2383109618544</code>，这表示L[0]的指向变化了。</p>
<p>​        举一个简单的例子来说，公司”销售部一组”(组名，相当于L的内存地址)有5个员工，其中员工编号为”1234”(相当于id(L[0])名字叫”张三”(相当于L[0]的值)的员工离职了，新招聘了一个叫”Tony”的员工，员工编号为”4567”，会影响公司”销售一组”的组名吗？这里的”销售一组”等同于L的内存地址，员工”张三”好比内存地址为”1234”指向的元素值，员工”Tony”好比内存地址为”4567”指向的元素值，”张三”离职和Tony入职，内存地址从”1234”修改成了”4567”，指向也随即发生了变化，但是并不会影响”销售一组”的组名。</p>
<img src="./image-20210427102855904.png" alt="image-20210427102855904" style="zoom:67%;" />

<p>​        元组的元素不能被修改，修改后(只能通过重新定义)就变成了另一个元组了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>T = (<span class="number">1</span>, <span class="string">&#x27;Hello&#x27;</span>, [<span class="string">&#x27;张三&#x27;</span>, <span class="number">9</span>], <span class="number">1.2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(T)</span><br><span class="line"><span class="number">2383109991136</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当我们强行修改元组的元素时，直接报错</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>T[<span class="number">0</span>] = <span class="number">8888</span>   </span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;pyshell#143&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    T[<span class="number">0</span>] = <span class="number">8888</span></span><br><span class="line">TypeError: <span class="string">&#x27;tuple&#x27;</span> <span class="built_in">object</span> does <span class="keyword">not</span> support item assignment</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 通过重新定义修改元组元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>T = (<span class="number">8888</span>, <span class="string">&#x27;Hello&#x27;</span>, [<span class="string">&#x27;张三&#x27;</span>, <span class="number">9</span>], <span class="number">1.2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(T)</span><br><span class="line"><span class="number">2383109990976</span></span><br></pre></td></tr></table></figure>

<p>​        元组元素不可变是元组内存地址指向的引用地址不能变化，引用地址不能变化，那么引用地址指向的值也不能变化，要改变应用地址只能重新定义元组。</p>
<img src="./image-20210427111534244.png" alt="image-20210427111534244" style="zoom:67%;" />

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">python</a>
        		</li>
      		
		</ul>
	</div>

    
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/python//" class="article-tag-list-link color2">python</a>
        		</li>
      		
		</ul>
	</div>


    
    <p class="article-more-link">
      <a class="article-more-a" href="/2021-04/24-PythonTuple/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-PythonList" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2021-04/23-PythonList/">PythonList</a>
	
    </h1>
  


  
  
<a href="/2021-04/23-PythonList/" class="archive-article-date">
        <time datetime="2021-04-23T11:49:44.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-23</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h1 id="第三章-列表简介和列表操作"><a href="#第三章-列表简介和列表操作" class="headerlink" title="第三章 列表简介和列表操作"></a>第三章 列表简介和列表操作</h1><h2 id="1-认识列表"><a href="#1-认识列表" class="headerlink" title="1. 认识列表"></a>1. 认识列表</h2><h3 id="1-1-列表是什么？"><a href="#1-1-列表是什么？" class="headerlink" title="1.1 列表是什么？"></a>1.1 列表是什么？</h3><p>​        列表是由一系列按特定顺序排列的不相关的元素组成且可以更改的集合。在Python中，用方括号（[]）来表示列表，并用逗号来分隔其中的元素。从描述中，我们可以知道：</p>
<ul>
<li>列表中的元素是有顺序的，因此可以通过位置(索引)来访问</li>
<li>列表中的元素可以被更改</li>
<li>列表是一个集合，可以包含不定个数的元素</li>
</ul>
<h3 id="1-2-如何定义列表？"><a href="#1-2-如何定义列表？" class="headerlink" title="1.2 如何定义列表？"></a>1.2 如何定义列表？</h3><p><strong>方法1：直接定义</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>, <span class="string">&quot;西安&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L)</span><br><span class="line">[<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;天津&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;重庆&#x27;</span>, <span class="string">&#x27;西安&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看变量L的类型</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(L)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">list</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>方法2：通过list()函数定义</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>var = <span class="string">&quot;I love Python!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">list</span>(var))</span><br><span class="line">[<span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;!&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">type</span>(<span class="built_in">list</span>(var))</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">list</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-访问列表的元素"><a href="#2-访问列表的元素" class="headerlink" title="2 访问列表的元素"></a>2 访问列表的元素</h2><h3 id="2-1-通过索引访问列表的元素"><a href="#2-1-通过索引访问列表的元素" class="headerlink" title="2.1 通过索引访问列表的元素"></a>2.1 通过索引访问列表的元素</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>, <span class="string">&quot;西安&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>​        上面定义的列表变量<code>L</code>的正向和反向索引如下，和字符串一样，访问列表也是通过索引。</p>
<p><img src="image-20210425191901360.png" alt="image-20210425191901360"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 正向取值</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L[<span class="number">0</span>])</span><br><span class="line">北京</span><br><span class="line"></span><br><span class="line"><span class="comment"># 反向取值</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L[-<span class="number">6</span>])</span><br><span class="line">北京</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对列表进行切片</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L[:<span class="number">4</span>])</span><br><span class="line">[<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;天津&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>]</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 指定步长</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L[::<span class="number">2</span>])</span><br><span class="line">[<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;重庆&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将列表排反序，即将列表的元素倒过来</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L[::-<span class="number">1</span>])   </span><br><span class="line">[<span class="string">&#x27;西安&#x27;</span>, <span class="string">&#x27;重庆&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;天津&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="2-2-使用列表中的元素"><a href="#2-2-使用列表中的元素" class="headerlink" title="2.2 使用列表中的元素"></a>2.2 使用列表中的元素</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&quot;我来自&quot;</span> + L[<span class="number">0</span>] + <span class="string">&quot;,&quot;</span> + <span class="string">&quot;我在&quot;</span> + L[-<span class="number">4</span>] + <span class="string">&quot;工作。&quot;</span> + <span class="string">&quot;我想去&quot;</span> + L[<span class="number">4</span>] + <span class="string">&quot;或&quot;</span> + L[<span class="number">5</span>] + <span class="string">&quot;旅游。&quot;</span>)</span><br><span class="line">我来自北京,我在上海工作。我想去重庆或西安旅游。</span><br></pre></td></tr></table></figure>

<h2 id="3-修改、添加和删除元素"><a href="#3-修改、添加和删除元素" class="headerlink" title="3 修改、添加和删除元素"></a>3 修改、添加和删除元素</h2><p>​        列表中的元素是可以被修改、添加和删除。</p>
<h3 id="3-1-修改列表的元素"><a href="#3-1-修改列表的元素" class="headerlink" title="3.1 修改列表的元素"></a>3.1 修改列表的元素</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>, <span class="string">&quot;西安&quot;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(L)</span><br><span class="line"><span class="number">1843256916608</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将列表中的第3个元素(索引为2)&quot;上海&quot;修改成&quot;成都&quot;，此时列表的元素已经发生了变化，但是列表的内存地址并未变化</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L[<span class="number">2</span>] = <span class="string">&quot;成都&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L)</span><br><span class="line">[<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;天津&#x27;</span>, <span class="string">&#x27;成都&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;重庆&#x27;</span>, <span class="string">&#x27;西安&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(L)</span><br><span class="line"><span class="number">1843256916608</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-在列表中添加元素"><a href="#3-2-在列表中添加元素" class="headerlink" title="3.2 在列表中添加元素"></a>3.2 在列表中添加元素</h3><h4 id="3-2-1-在列表末尾追加元素"><a href="#3-2-1-在列表末尾追加元素" class="headerlink" title="3.2.1 在列表末尾追加元素"></a>3.2.1 在列表末尾追加元素</h4><p>​        格式：<code>L.append(&quot;添加的列表元素&quot;)</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>, <span class="string">&quot;西安&quot;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L.append(<span class="string">&quot;乌鲁木齐&quot;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L)</span><br><span class="line">[<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;天津&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;重庆&#x27;</span>, <span class="string">&#x27;西安&#x27;</span>, <span class="string">&#x27;乌鲁木齐&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-在指定位置插入元素"><a href="#3-2-2-在指定位置插入元素" class="headerlink" title="3.2.2 在指定位置插入元素"></a>3.2.2 在指定位置插入元素</h4><p>​        格式：L.insert(“插入的元素”, 索引值)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>, <span class="string">&quot;西安&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从索引为3的地方插入一个元素&quot;乌鲁木齐&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L.insert(<span class="number">3</span>, <span class="string">&quot;乌鲁木齐&quot;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L)</span><br><span class="line">[<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;天津&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;乌鲁木齐&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;重庆&#x27;</span>, <span class="string">&#x27;西安&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从索引为0的位置插入</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>, <span class="string">&quot;西安&quot;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L.insert(<span class="number">0</span>, <span class="string">&quot;杭州&quot;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L)</span><br><span class="line">[<span class="string">&#x27;杭州&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;天津&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;重庆&#x27;</span>, <span class="string">&#x27;西安&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-从列表中删除元素"><a href="#3-2-3-从列表中删除元素" class="headerlink" title="3.2.3 从列表中删除元素"></a>3.2.3 从列表中删除元素</h4><p>删除列表元素的两种方法：</p>
<ul>
<li>del L[index]：删除指定位置的元素</li>
<li>L.pop()：默认删除最后一个元素，也可以删除指定位置的元素</li>
<li>L.remove(“元素”)：移除列表中某个元素的第一个匹配项</li>
<li>使用场景：如果要从列表中删除一个元素，且不再以任何方式使用它，就使用del语句；如果要在删除元素后还能继续使用它，就使用方法pop()。</li>
</ul>
<p><strong>(1).del L[index]</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>, <span class="string">&quot;西安&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除索引为0的元素</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> L[<span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L)</span><br><span class="line">[<span class="string">&#x27;天津&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;重庆&#x27;</span>, <span class="string">&#x27;西安&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p><strong>(2). L.pop()的用法</strong></p>
<ul>
<li>删除最后一个元素</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过pop()方法删除元素有返回值，这种方法对于要获取删除值的场景很有用</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L.pop()     <span class="comment"># 返回的是一个字符串类型</span></span><br><span class="line"><span class="string">&#x27;重庆&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L)</span><br><span class="line">[<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;天津&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>删除指定位置的元素，pop()方法可以删除指定位置的元素，只需要将索引告诉pop()即可</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L.pop(<span class="number">2</span>)</span><br><span class="line"><span class="string">&#x27;上海&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L)</span><br><span class="line">[<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;天津&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;重庆&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p><strong>(3). L.remove(“元素”)</strong></p>
<p>​        方法remove()只删除第一个指定的值。如果要删除的值可能在列表中出现多次，就需要使用循环来判断是否删除了所有这样的值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>, <span class="string">&quot;上海&quot;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L.remove(<span class="string">&quot;上海&quot;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L)</span><br><span class="line">[<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;天津&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;重庆&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="3-3-组织列表"><a href="#3-3-组织列表" class="headerlink" title="3.3 组织列表"></a>3.3 组织列表</h3><p>​        在你创建的列表中，元素的排列顺序常常是无法预测的，因为你并非总能控制用户提供数据的顺序。这虽然在大多数情况下都是不可避免的，但你经常需要以特定的顺序呈现信息。有时候，你希望保留列表元素最初的排列顺序，而有时候又需要调整排列顺序。Python提供了很多组织列表的方式，可根据具体情况选用。</p>
<h4 id="3-3-1-使用方法-sort-对列表进行永久性排序"><a href="#3-3-1-使用方法-sort-对列表进行永久性排序" class="headerlink" title="3.3.1 使用方法 sort()对列表进行永久性排序"></a>3.3.1 使用方法 sort()对列表进行永久性排序</h4><p><strong>(1). 正序</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>cars = [<span class="string">&#x27;bmw&#x27;</span>, <span class="string">&#x27;audi&#x27;</span>, <span class="string">&#x27;toyota&#x27;</span>, <span class="string">&#x27;subaru&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对列表进行排序</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cars.sort()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表cars发生了变化，一般性的做饭是，先对原先列表进行备份，然后再进行排序</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(cars)               </span><br><span class="line">[<span class="string">&#x27;audi&#x27;</span>, <span class="string">&#x27;bmw&#x27;</span>, <span class="string">&#x27;subaru&#x27;</span>, <span class="string">&#x27;toyota&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p><strong>(2). 反序</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>cars = [<span class="string">&#x27;bmw&#x27;</span>, <span class="string">&#x27;audi&#x27;</span>, <span class="string">&#x27;toyota&#x27;</span>, <span class="string">&#x27;subaru&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cars.sort(reverse=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(cars)</span><br><span class="line">[<span class="string">&#x27;toyota&#x27;</span>, <span class="string">&#x27;subaru&#x27;</span>, <span class="string">&#x27;bmw&#x27;</span>, <span class="string">&#x27;audi&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="3-3-2-使用函数-sorted-对列表进行临时排序"><a href="#3-3-2-使用函数-sorted-对列表进行临时排序" class="headerlink" title="3.3.2 使用函数 sorted()对列表进行临时排序"></a>3.3.2 使用函数 sorted()对列表进行临时排序</h4><p>​        要保留列表元素原来的排列顺序，同时以特定的顺序呈现它们，可使用函数sorted()。函数sorted()让你能够按特定顺序显示列表元素，同时不影响它们在列表中的原始排列顺序。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>cars = [<span class="string">&#x27;bmw&#x27;</span>, <span class="string">&#x27;audi&#x27;</span>, <span class="string">&#x27;toyota&#x27;</span>, <span class="string">&#x27;subaru&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">sorted</span>(cars)</span><br><span class="line">[<span class="string">&#x27;audi&#x27;</span>, <span class="string">&#x27;bmw&#x27;</span>, <span class="string">&#x27;subaru&#x27;</span>, <span class="string">&#x27;toyota&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表cars并未发生变化</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(cars)</span><br><span class="line">[<span class="string">&#x27;bmw&#x27;</span>, <span class="string">&#x27;audi&#x27;</span>, <span class="string">&#x27;toyota&#x27;</span>, <span class="string">&#x27;subaru&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="3-3-3-反向打印列表"><a href="#3-3-3-反向打印列表" class="headerlink" title="3.3.3 反向打印列表"></a>3.3.3 反向打印列表</h4><p><strong>(1). 使用索引</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>cars = [<span class="string">&#x27;bmw&#x27;</span>, <span class="string">&#x27;audi&#x27;</span>, <span class="string">&#x27;toyota&#x27;</span>, <span class="string">&#x27;subaru&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(cars[::-<span class="number">1</span>])</span><br><span class="line">[<span class="string">&#x27;subaru&#x27;</span>, <span class="string">&#x27;toyota&#x27;</span>, <span class="string">&#x27;audi&#x27;</span>, <span class="string">&#x27;bmw&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p><strong>(2). 使用reverse()方法</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>cars = [<span class="string">&#x27;bmw&#x27;</span>, <span class="string">&#x27;audi&#x27;</span>, <span class="string">&#x27;toyota&#x27;</span>, <span class="string">&#x27;subaru&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cars.reverse()</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(cars)     <span class="comment"># 列表cars发生了变化</span></span><br><span class="line">[<span class="string">&#x27;subaru&#x27;</span>, <span class="string">&#x27;toyota&#x27;</span>, <span class="string">&#x27;audi&#x27;</span>, <span class="string">&#x27;bmw&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p><strong>(2). 使用reversed()函数</strong></p>
<p>​        reversed()函数的作用是返回一个反转的迭代器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>cars = [<span class="string">&#x27;bmw&#x27;</span>, <span class="string">&#x27;audi&#x27;</span>, <span class="string">&#x27;toyota&#x27;</span>, <span class="string">&#x27;subaru&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">reversed</span>(cars)</span><br><span class="line">&lt;list_reverseiterator <span class="built_in">object</span> at <span class="number">0x000001D03871A580</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">list</span>(<span class="built_in">reversed</span>(cars)))</span><br><span class="line">[<span class="string">&#x27;subaru&#x27;</span>, <span class="string">&#x27;toyota&#x27;</span>, <span class="string">&#x27;audi&#x27;</span>, <span class="string">&#x27;bmw&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="3-3-4-列表的长度–len"><a href="#3-3-4-列表的长度–len" class="headerlink" title="3.3.4 列表的长度–len()"></a>3.3.4 列表的长度–len()</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>cars = [<span class="string">&#x27;bmw&#x27;</span>, <span class="string">&#x27;audi&#x27;</span>, <span class="string">&#x27;toyota&#x27;</span>, <span class="string">&#x27;subaru&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">len</span>(cars))</span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>

<h4 id="3-3-5-统计某个元素在列表中出现的次数–count"><a href="#3-3-5-统计某个元素在列表中出现的次数–count" class="headerlink" title="3.3.5 统计某个元素在列表中出现的次数–count()"></a>3.3.5 统计某个元素在列表中出现的次数–count()</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>, <span class="string">&quot;上海&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L.count(<span class="string">&quot;上海&quot;</span>))</span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>

<h4 id="3-3-6-获取列表中某元素第一次出现的索引值"><a href="#3-3-6-获取列表中某元素第一次出现的索引值" class="headerlink" title="3.3.6 获取列表中某元素第一次出现的索引值"></a>3.3.6 获取列表中某元素第一次出现的索引值</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>, <span class="string">&quot;上海&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L.index(<span class="string">&quot;上海&quot;</span>))</span><br><span class="line"><span class="number">2</span>      <span class="comment"># 注意这里的2是指索引，是第三个元素</span></span><br></pre></td></tr></table></figure>

<h4 id="3-3-7-清空列表和删除列表"><a href="#3-3-7-清空列表和删除列表" class="headerlink" title="3.3.7 清空列表和删除列表"></a>3.3.7 清空列表和删除列表</h4><ul>
<li>清空列表：是指列表中的元素个数为0，列表还存在</li>
<li>删除列表：列表被删除，内存空间被回收，列表不存在</li>
</ul>
<p><strong>(1). 清空列表</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>, <span class="string">&quot;上海&quot;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(L)         <span class="comment"># 清空列表前，列表的内存值</span></span><br><span class="line"><span class="number">1993811645504</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L.clear()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L)</span><br><span class="line">[]             <span class="comment"># 表示一个空列表，列表长度为0的列表</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(L)     <span class="comment"># 列表长度为0，即列表中不存在元素</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(L)     <span class="comment"># 列表的内存值未发生变化</span></span><br><span class="line"><span class="number">1993811645504</span></span><br></pre></td></tr></table></figure>

<p><strong>(2). 删除列表</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>, <span class="string">&quot;上海&quot;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(L)</span><br><span class="line"><span class="number">1993808982720</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> L</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L)    <span class="comment"># 提示列表L未被定义，即不存在列表L</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;pyshell#86&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="built_in">print</span>(L)</span><br><span class="line">NameError: name <span class="string">&#x27;L&#x27;</span> <span class="keyword">is</span> <span class="keyword">not</span> defined</span><br><span class="line">    </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(L)    <span class="comment"># 提示列表L未被定义，即不存在列表L</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;pyshell#87&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="built_in">len</span>(L)</span><br><span class="line">NameError: name <span class="string">&#x27;L&#x27;</span> <span class="keyword">is</span> <span class="keyword">not</span> defined</span><br><span class="line">    </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(L)    <span class="comment"># 提示列表L未被定义，即不存在列表L</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;pyshell#88&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="built_in">id</span>(L)</span><br><span class="line">NameError: name <span class="string">&#x27;L&#x27;</span> <span class="keyword">is</span> <span class="keyword">not</span> defined</span><br></pre></td></tr></table></figure>

<h4 id="3-3-8-复制列表"><a href="#3-3-8-复制列表" class="headerlink" title="3.3.8 复制列表"></a>3.3.8 复制列表</h4><p><strong>(1). 通过L.copy()方法复制列表</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>, <span class="string">&quot;上海&quot;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(L)</span><br><span class="line"><span class="number">1993811792448</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>NEW = L.copy()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(NEW)</span><br><span class="line">[<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;天津&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;重庆&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(NEW)    <span class="comment"># 复制后的列表NEW和复制前的列表内存值不一样，说明不是同一个列表</span></span><br><span class="line"><span class="number">1993811791936</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对列表NEW进行修改，看看是否会影响原列表</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> NEW[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(NEW)</span><br><span class="line">[<span class="string">&#x27;天津&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;重庆&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L)             <span class="comment"># 删除复制后列表的元素，原列表未变化</span></span><br><span class="line">[<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;天津&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;重庆&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>复制前后的内存地址变化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列表L和列表L中元素的内存地址</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(L)</span><br><span class="line"><span class="number">2788859105152</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(L[<span class="number">0</span>])</span><br><span class="line"><span class="number">2788859139152</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(L[<span class="number">1</span>])</span><br><span class="line"><span class="number">2788859139056</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(L[<span class="number">2</span>])</span><br><span class="line"><span class="number">2788859139248</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(L[<span class="number">3</span>])</span><br><span class="line"><span class="number">2788859139344</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(L[<span class="number">4</span>])</span><br><span class="line"><span class="number">2788859139440</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(NEW)</span><br><span class="line"><span class="number">2788859097216</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查L和NEW两个列表中元素的内存地址是否一样，结果为True表示内存地址一样</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L[<span class="number">0</span>] <span class="keyword">is</span> NEW[<span class="number">0</span>] <span class="keyword">and</span> L[<span class="number">1</span>] <span class="keyword">is</span> NEW[<span class="number">1</span>] <span class="keyword">and</span> L[<span class="number">2</span>] <span class="keyword">is</span> NEW[<span class="number">2</span>] <span class="keyword">and</span> L[<span class="number">3</span>] <span class="keyword">is</span> NEW[<span class="number">3</span>] <span class="keyword">and</span> L[<span class="number">4</span>] <span class="keyword">is</span> NEW[<span class="number">4</span>]</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>内存地址和元素的关联关系如下图所示：</p>
<img src="image-20210426151953676.png" alt="image-20210426151953676" style="zoom:67%;" />



<p><strong>(2). 通过变量赋值的方式复制列表</strong></p>
<p>​        本质是创建一个指向被拷贝列表的引用，他们使用的是同一块内存区域，因为无论更改其中任何一个变量,我们被拷贝的变量也会跟着改变。简单的来说,赋值拷贝,无论把列表赋值给多少个变量,这些变量指向的都是同一个列表</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(L)</span><br><span class="line"><span class="number">1993812065152</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>NEW = L     <span class="comment"># 两个列表的内存地址一样，说明是同一个列表，对其中的一个修改会影响另一个的值</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">id</span>(NEW)</span><br><span class="line"><span class="number">1993812065152</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">del</span> NEW[<span class="number">0</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L)</span><br><span class="line">[<span class="string">&#x27;天津&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;重庆&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(NEW)</span><br><span class="line">[<span class="string">&#x27;天津&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;重庆&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>内存地址和元素关联关系如下图：</p>
<img src="image-20210426154410461.png" alt="image-20210426154410461" style="zoom:67%;" />

<p>深浅复制的问题：</p>
<p>​        在python中，如果列表中不嵌套列表，则对<code>L.copy()</code>方法复制前后的两个列表进行操作将不会影响另一个列表，但是如果存在嵌套列表，则将发生变化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;boy&quot;</span>, [<span class="number">111</span>, <span class="string">&quot;222&quot;</span>], <span class="string">&quot;girl&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>NEW = L.copy()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(NEW)</span><br><span class="line">[<span class="string">&#x27;boy&#x27;</span>, [<span class="number">111</span>, <span class="string">&#x27;222&#x27;</span>], <span class="string">&#x27;girl&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看列表L和列表NEW中相对应的每个元素的内存地址是否一致，输出结果为True，说明L和NEW列表的内容id一样</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L[<span class="number">0</span>] <span class="keyword">is</span> NEW[<span class="number">0</span>] <span class="keyword">and</span> L[<span class="number">1</span>] <span class="keyword">is</span> NEW[<span class="number">1</span>] <span class="keyword">and</span> L[<span class="number">2</span>] <span class="keyword">is</span> NEW[<span class="number">2</span>]</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改列表L的第二个元素(即嵌套列表)中的值</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L[<span class="number">1</span>][<span class="number">0</span>] = <span class="string">&quot;Hello&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 两个列表的值都发生了变化</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L)</span><br><span class="line">[<span class="string">&#x27;boy&#x27;</span>, [<span class="string">&#x27;Hello&#x27;</span>, <span class="string">&#x27;222&#x27;</span>], <span class="string">&#x27;girl&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(NEW)</span><br><span class="line">[<span class="string">&#x27;boy&#x27;</span>, [<span class="string">&#x27;Hello&#x27;</span>, <span class="string">&#x27;222&#x27;</span>], <span class="string">&#x27;girl&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>​        执行代码<code>NEW = L.copy()</code>时，内存地址指向如下图，也就是说浅复制的时候，只复制了第一层内存地址，对于如嵌套这样的第二层地址并没有被复制，因此当我们修改嵌套列表的值时，复制前后的列表的值都发生了变化。</p>
<img src="image-20210426161707148.png" alt="image-20210426161707148" style="zoom:67%;" />

<p>​        执行代码<code>L[1][0] = &quot;Hello&quot;</code>时，内存中的整数<code>111</code>的指向丢失，等待被内存回收，重新指向了定义的值<code>&quot;Hello&quot;</code>,内存地址指向如下图：</p>
<img src="image-20210426162220761.png" alt="image-20210426162220761" style="zoom:67%;" />

<p>​        对于这种嵌套列表的情况，我们应该使用深拷贝。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;boy&quot;</span>, [<span class="number">111</span>, <span class="string">&quot;222&quot;</span>], <span class="string">&quot;girl&quot;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L)</span><br><span class="line">[<span class="string">&#x27;boy&#x27;</span>, [<span class="number">111</span>, <span class="string">&#x27;222&#x27;</span>], <span class="string">&#x27;girl&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>NEW = copy.deepcopy(L)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(NEW)</span><br><span class="line">[<span class="string">&#x27;boy&#x27;</span>, [<span class="number">111</span>, <span class="string">&#x27;222&#x27;</span>], <span class="string">&#x27;girl&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改列表L的第二个元素(即嵌套列表)中的值</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L[<span class="number">1</span>][<span class="number">0</span>] = <span class="string">&quot;Hello&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表L的元素被修改了</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L)</span><br><span class="line">[<span class="string">&#x27;boy&#x27;</span>, [<span class="string">&#x27;Hello&#x27;</span>, <span class="string">&#x27;222&#x27;</span>], <span class="string">&#x27;girl&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制过后的列表NEW的元素没有被修改了</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(NEW)</span><br><span class="line">[<span class="string">&#x27;boy&#x27;</span>, [<span class="number">111</span>, <span class="string">&#x27;222&#x27;</span>], <span class="string">&#x27;girl&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>深拷贝如下图所示：</p>
<img src="image-20210426164206901.png" alt="image-20210426164206901" style="zoom:67%;" />



<h4 id="3-3-9-在列表末尾一次性追加另一个序列中的多个值（用新列表扩展原来的列表）"><a href="#3-3-9-在列表末尾一次性追加另一个序列中的多个值（用新列表扩展原来的列表）" class="headerlink" title="3.3.9 在列表末尾一次性追加另一个序列中的多个值（用新列表扩展原来的列表）"></a>3.3.9 在列表末尾一次性追加另一个序列中的多个值（用新列表扩展原来的列表）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L1 = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;上海&quot;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L2 = [<span class="string">&quot;西安&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将列表L2的元素扩展到列表L1中，此时列表L1中将按顺序加入L2的元素，列表L2不变化，L1将发生变化</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>L1.extend(L2)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L1)     <span class="comment"># 列表L1发生了变化</span></span><br><span class="line">[<span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;天津&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;西安&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;重庆&#x27;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(L2)    <span class="comment"># 列表L2未发生变化</span></span><br><span class="line">[<span class="string">&#x27;西安&#x27;</span>, <span class="string">&#x27;广州&#x27;</span>, <span class="string">&#x27;重庆&#x27;</span>]</span><br></pre></td></tr></table></figure>



<h2 id="4-遍历整个列表"><a href="#4-遍历整个列表" class="headerlink" title="4 遍历整个列表"></a>4 遍历整个列表</h2><p>​        如何快速的取出列表中的元素？当然如果是取出列表中的一些元素，我们肯定会使用索引。但，如果我们想取出列表中的所有元素，使用索引的方式将浪费大量的时间，这里我们可以使用for循环进行遍历整个列表，然后将列表的元素一一取出。</p>
<p>​        for循环格式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> [var] <span class="keyword">in</span> L:   <span class="comment"># 表示当[var]在L中，</span></span><br><span class="line">    <span class="keyword">pass</span>          <span class="comment">#  这里是要执行的代码，需要缩进四个空格，这里将从L中取出每个元素，分别执行代码，直到L中没有元素为止</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;for循环结束了&quot;</span>)  <span class="comment"># 这里的print()代码，由于跟for循环是同一个缩进，因此将在所有的for循环执行完成后被执行</span></span><br></pre></td></tr></table></figure>

<p>案例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>, <span class="string">&quot;西安&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> L:</span><br><span class="line">      <span class="built_in">print</span>(i)</span><br><span class="line">        </span><br><span class="line">北京</span><br><span class="line">天津</span><br><span class="line">上海</span><br><span class="line">广州</span><br><span class="line">重庆</span><br><span class="line">西安</span><br></pre></td></tr></table></figure>

<p>​        <code>for i in L</code>这行代码让Python获取列表<code>L</code>中的第一个元素（<code>&quot;北京&quot;</code>），并将其存储到变量<code>i</code>中，然后执行下一行代码<code>print(L)</code>，这样就打印出了<code>&quot;北京&quot;</code>。依次循环往复，分别将列表中的元素赋值给变量<code>i</code>，然后通过<code>print(i)</code>打印出来。</p>
<h3 id="4-1-在for循环中执行更多的操作"><a href="#4-1-在for循环中执行更多的操作" class="headerlink" title="4.1 在for循环中执行更多的操作"></a>4.1 在for循环中执行更多的操作</h3><p>​        上面的案例中，我们只是取出来了列表L中的所有元素，但是取出元素并不是我们的最终目的，使用这些元素才是我们的目的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>L = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>, <span class="string">&quot;西安&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> L:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;是一座美丽的城市&quot;</span>.<span class="built_in">format</span>(i))</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">北京是一座美丽的城市</span><br><span class="line">天津是一座美丽的城市</span><br><span class="line">上海是一座美丽的城市</span><br><span class="line">广州是一座美丽的城市</span><br><span class="line">重庆是一座美丽的城市</span><br><span class="line">西安是一座美丽的城市</span><br></pre></td></tr></table></figure>

<h3 id="4-2-在-for-循环结束后执行一些操作"><a href="#4-2-在-for-循环结束后执行一些操作" class="headerlink" title="4.2 在 for 循环结束后执行一些操作"></a>4.2 在 for 循环结束后执行一些操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">L = [<span class="string">&quot;北京&quot;</span>, <span class="string">&quot;天津&quot;</span>, <span class="string">&quot;上海&quot;</span>, <span class="string">&quot;广州&quot;</span>, <span class="string">&quot;重庆&quot;</span>, <span class="string">&quot;西安&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> L:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;是一座美丽的城市&quot;</span>.<span class="built_in">format</span>(i))   <span class="comment"># 每循环一次，该代码将被执行一次</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面的print()函数跟for循环同一个缩进层级，因此将在for循环执行完成后被执行</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;我非常喜欢这些城市，并想去每个城市旅游！&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>执行结果如下：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">北京是一座美丽的城市</span><br><span class="line">天津是一座美丽的城市</span><br><span class="line">上海是一座美丽的城市</span><br><span class="line">广州是一座美丽的城市</span><br><span class="line">重庆是一座美丽的城市</span><br><span class="line">西安是一座美丽的城市</span><br><span class="line">我非常喜欢这些城市，并想去每个城市旅游！</span><br></pre></td></tr></table></figure>

<h2 id="5-创建数值列表"><a href="#5-创建数值列表" class="headerlink" title="5 创建数值列表"></a>5 创建数值列表</h2><p>​        列表非常适合用于存储数字集合，而Python提供了很多工具，可帮助你高效地处理数字列表。</p>
<h3 id="5-1-使用函数-range"><a href="#5-1-使用函数-range" class="headerlink" title="5.1 使用函数 range()"></a>5.1 使用函数 range()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">5</span>):</span><br><span class="line">	<span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>​        通过range()函数，我们可以求出1-100这100个数相加的和</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">sum</span>(<span class="built_in">range</span>(<span class="number">0</span>,<span class="number">101</span>))</span><br><span class="line"><span class="number">5050</span></span><br></pre></td></tr></table></figure>

<h3 id="5-2-使用-range-创建数字列表"><a href="#5-2-使用-range-创建数字列表" class="headerlink" title="5.2 使用 range()创建数字列表"></a>5.2 使用 range()创建数字列表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">0</span>,<span class="number">5</span>))</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">0</span>,<span class="number">10</span>,<span class="number">2</span>))</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br></pre></td></tr></table></figure>

<h3 id="5-3-对数字列表执行简单的统计计算"><a href="#5-3-对数字列表执行简单的统计计算" class="headerlink" title="5.3 对数字列表执行简单的统计计算"></a>5.3 对数字列表执行简单的统计计算</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">0</span>,<span class="number">100</span>,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(d)</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">20</span>, <span class="number">22</span>, <span class="number">24</span>, <span class="number">26</span>, <span class="number">28</span>, <span class="number">30</span>, <span class="number">32</span>, <span class="number">34</span>, <span class="number">36</span>, <span class="number">38</span>, <span class="number">40</span>, <span class="number">42</span>, <span class="number">44</span>, <span class="number">46</span>, <span class="number">48</span>, <span class="number">50</span>, <span class="number">52</span>, <span class="number">54</span>, <span class="number">56</span>, <span class="number">58</span>, <span class="number">60</span>, <span class="number">62</span>, <span class="number">64</span>, <span class="number">66</span>, <span class="number">68</span>, <span class="number">70</span>, <span class="number">72</span>, <span class="number">74</span>, <span class="number">76</span>, <span class="number">78</span>, <span class="number">80</span>, <span class="number">82</span>, <span class="number">84</span>, <span class="number">86</span>, <span class="number">88</span>, <span class="number">90</span>, <span class="number">92</span>, <span class="number">94</span>, <span class="number">96</span>, <span class="number">98</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">max</span>(d)</span><br><span class="line"><span class="number">98</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">min</span>(d)</span><br><span class="line"><span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">sum</span>(d)</span><br><span class="line"><span class="number">2450</span></span><br></pre></td></tr></table></figure>



<h3 id="5-4-列表解析式"><a href="#5-4-列表解析式" class="headerlink" title="5.4 列表解析式"></a>5.4 列表解析式</h3><p>​        列表解析将for循环和创建新元素的代码合并成一行，并自动附加新元素。</p>
<p>​        例如，现在我们要得到一<code>个0-10</code>中偶数与自身乘积的列表，按照平常的操作，我们可能会写一个<code>for循环</code>，如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">0</span>,<span class="number">10</span>,<span class="number">2</span>))</span><br><span class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>]</span><br><span class="line">l = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">0</span>,<span class="number">10</span>,<span class="number">2</span>)):</span><br><span class="line">    i = i * i</span><br><span class="line">    l.append(i)</span><br><span class="line"><span class="built_in">print</span>(l)  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果如下：</span></span><br><span class="line">[<span class="number">0</span>, <span class="number">4</span>, <span class="number">16</span>, <span class="number">36</span>, <span class="number">64</span>]</span><br></pre></td></tr></table></figure>

<p>​        这样的写法，确实能达到达到效果，但是在python中，我们可以使用列表解析式完成。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>var = [i * i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">10</span>, <span class="number">2</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(var)</span><br><span class="line">[<span class="number">0</span>, <span class="number">4</span>, <span class="number">16</span>, <span class="number">36</span>, <span class="number">64</span>]</span><br></pre></td></tr></table></figure>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">python</a>
        		</li>
      		
		</ul>
	</div>

    
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/python//" class="article-tag-list-link color2">python</a>
        		</li>
      		
		</ul>
	</div>


    
    <p class="article-more-link">
      <a class="article-more-a" href="/2021-04/23-PythonList/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-PythonVarString" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2021-04/22-PythonVarString/">PythonVarString</a>
	
    </h1>
  


  
  
<a href="/2021-04/22-PythonVarString/" class="archive-article-date">
        <time datetime="2021-04-22T06:16:03.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-22</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h1 id="第二章-变量和简单数据类型"><a href="#第二章-变量和简单数据类型" class="headerlink" title="第二章 变量和简单数据类型"></a>第二章 变量和简单数据类型</h1><p>Q：运行hello_world.py 时发生的情况</p>
<p>​        现在我们有一个hello_world.py的python文件，文件内容如下，当我们执行这个文件时，发生了什么呢？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;hello world&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>​        我们在cmd中执行hello_world.py文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>phython3 hello_world.py</span><br><span class="line">hello world    <span class="comment"># 输出结果</span></span><br></pre></td></tr></table></figure>

<p>​        运行文件hello_world.py时，末尾的**.py指出这是一个Python程序，因此编辑器将使用Python解释器来运行它<strong>。</strong>Python解释器读取整个程序，确定其中每个单词的含义**。例如，看到单词print时，解释器就会将括号中的内容打印到屏幕，而不会管括号中的内容是什么。</p>
<h2 id="1-变量"><a href="#1-变量" class="headerlink" title="1.变量"></a>1.变量</h2><h3 id="1-1-格式"><a href="#1-1-格式" class="headerlink" title="1.1 格式"></a>1.1 格式</h3><p><strong><code>变量名=&quot;变量值&quot;</code></strong></p>
<p>值得注意的几点：</p>
<ul>
<li>格式只能是**<code>变量名=&quot;变量值&quot;</code>**，如<code>name=&quot;张三&quot;</code></li>
<li>格式不能是**<code>变量名=变量值</code><strong>，这种变量赋值的方法初学者很容易犯，在python中，</strong><code>变量名=变量值</code>**这种写法会被python解释等号两边是两个变量，定义变量的时候，等号后面的变量值一定是被引号包围起来的</li>
<li>等号两边可以有空格，变量值中的引号可以是单引号或多引号，尤其是当变量值中本来就包含引号时，为了避免歧义就会使用多引号或转义符<code>\</code></li>
<li>变量一定是先定义，后使用，没有定义的变量，不能被引用，python将抛出错误</li>
</ul>
<h3 id="1-2-变量的命名和使用"><a href="#1-2-变量的命名和使用" class="headerlink" title="1.2 变量的命名和使用"></a>1.2 变量的命名和使用</h3><p>​        在Python中使用变量时，需要遵守下面的命名规范。</p>
<ul>
<li><p><strong>变量名只能包含字母、数字和下划线，但不能以数字打头</strong>，此处的字母并不局限于 26 个英文字母，可以包含中文字符、日文字符等。例如，可将变量命名为message_1，但不能将其命名为1_message。</p>
</li>
<li><p><strong>变量名不能包含空格，但可使用下划线来分隔其中的单词</strong>。例如，变量名greeting_message可行，但变量名greeting message会引发错误。</p>
</li>
<li><p><strong>不要将Python关键字和函数名用作变量名</strong>，即不要使用Python保留用于特殊用途的单词，如print（请参见附录A.4）。</p>
</li>
<li><p><strong>变量名应既简短又具有描述性</strong>。例如，name比n好，student_name比s_n好，name_length<br>比length_of_persons_name好。</p>
</li>
<li><p><strong>慎用容易引起歧义的字母</strong>，如小写字母l和大写字母O，因为它们可能被人错看成数字1和0。</p>
</li>
</ul>
<p>python关键字：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> keyword</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(keyword.kwlist)</span><br><span class="line">[<span class="string">&#x27;False&#x27;</span>, <span class="string">&#x27;None&#x27;</span>, <span class="string">&#x27;True&#x27;</span>, <span class="string">&#x27;and&#x27;</span>, <span class="string">&#x27;as&#x27;</span>, <span class="string">&#x27;assert&#x27;</span>, <span class="string">&#x27;async&#x27;</span>, <span class="string">&#x27;await&#x27;</span>, <span class="string">&#x27;break&#x27;</span>, <span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;continue&#x27;</span>, <span class="string">&#x27;def&#x27;</span>, <span class="string">&#x27;del&#x27;</span>, <span class="string">&#x27;elif&#x27;</span>, <span class="string">&#x27;else&#x27;</span>, <span class="string">&#x27;except&#x27;</span>, <span class="string">&#x27;finally&#x27;</span>, <span class="string">&#x27;for&#x27;</span>, <span class="string">&#x27;from&#x27;</span>, <span class="string">&#x27;global&#x27;</span>, <span class="string">&#x27;if&#x27;</span>, <span class="string">&#x27;import&#x27;</span>, <span class="string">&#x27;in&#x27;</span>, <span class="string">&#x27;is&#x27;</span>, <span class="string">&#x27;lambda&#x27;</span>, <span class="string">&#x27;nonlocal&#x27;</span>, <span class="string">&#x27;not&#x27;</span>, <span class="string">&#x27;or&#x27;</span>, <span class="string">&#x27;pass&#x27;</span>, <span class="string">&#x27;raise&#x27;</span>, <span class="string">&#x27;return&#x27;</span>, <span class="string">&#x27;try&#x27;</span>, <span class="string">&#x27;while&#x27;</span>, <span class="string">&#x27;with&#x27;</span>, <span class="string">&#x27;yield&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="1-3-推荐使用的命令方法"><a href="#1-3-推荐使用的命令方法" class="headerlink" title="1.3 推荐使用的命令方法"></a>1.3 推荐使用的命令方法</h3><ul>
<li>驼峰命名法：<ul>
<li>大驼峰命名法：每个单词的首字母都大写，如StudentName</li>
<li>小驼峰命名法：头一个单词首字母小写，其余单词首字母大写，如studentName</li>
</ul>
</li>
<li>下划线连接符命名法，如student_name</li>
</ul>
<h3 id="1-4-python赋值的方法"><a href="#1-4-python赋值的方法" class="headerlink" title="1.4 python赋值的方法"></a>1.4 python赋值的方法</h3><ul>
<li>常规赋值：<code>a = 100</code></li>
<li>链式赋值：<code> a = b = 100</code>，表示<code>a=100</code>，<code>b=100</code></li>
<li>序列解包赋值： <code>a,b = 100,&quot;zhangsan&quot;</code>，等同于<code>a=100</code>，<code>b=&quot;zhangsan&quot;</code>，此种赋值方法中，等号两边的个数必须相等，否则python将抛出错误</li>
<li>增量赋值： a+=1，等同于<code>a=a+1</code></li>
</ul>
<p>案例：</p>
<p>1.使用汉字作为变量(不推荐)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>名字=<span class="string">&quot;zhangsan&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(名字)</span><br><span class="line">zhangsan</span><br></pre></td></tr></table></figure>

<p>2.变量值包含引号</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>message = <span class="string">&quot;This&#x27;s an apple&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(message)</span><br><span class="line">This<span class="string">&#x27;s an apple</span></span><br></pre></td></tr></table></figure>

<p>案例中This’s an apple中包含单引号，如果再使用单引号，则将引起歧义，python将抛出错误</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>message = <span class="string">&#x27;This&#x27;</span>s an apple<span class="string">&#x27;</span></span><br><span class="line"><span class="string">&gt;&gt;&gt; print(message)</span></span><br><span class="line"><span class="string">## 执行后结果如下：</span></span><br><span class="line"><span class="string">  File &quot;test.py&quot;, line 4</span></span><br><span class="line"><span class="string">    message = &#x27;</span>This<span class="string">&#x27;s an apple&#x27;</span>  <span class="comment"># python将&#x27;This&#x27;当成了一个整体，&#x27;This&#x27;后面的字符串就搞蒙了python，因此抛出错误</span></span><br><span class="line">                    ^</span><br><span class="line">SyntaxError: invalid syntax   <span class="comment"># 提示语法错误</span></span><br></pre></td></tr></table></figure>

<p>3.定义变量时，等号后边不含引号</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>n = zhangsan</span><br></pre></td></tr></table></figure>

<p>​        这种情况下，python会认为等号两边都是变量，即将变量<code>zhangsan</code>的值赋给变量<code>n</code>，这种情况需要分两种情况说明：</p>
<ul>
<li>如果上文中定义了<code>zhangsan</code>的值，即<code>zhangsan</code>是原本就是一个变量名，那么等式成立</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>zhangsan = <span class="number">28</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>n = zhangsan   <span class="comment"># 等同于n = zhangsan = 28，即先定义变量zhangsan，再将变量zhangsan的值赋给了n</span></span><br></pre></td></tr></table></figure>

<ul>
<li>如果上文没有定义<code>zhangsan</code>，那么python将抛出错误，即<strong>变量一定是先定义，后使用</strong>，此时我们重新打开cmd</li>
</ul>
<p><img src="image-20210421111639194.png" alt="image-20210421111639194"></p>
<h2 id="2-注释"><a href="#2-注释" class="headerlink" title="2 注释"></a>2 注释</h2><p>​        python中使用井号（”#”）进行注释，被注释的行将不会被执行。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输入用户名</span></span><br><span class="line">name = <span class="built_in">input</span>(<span class="string">&quot;please, enter your name: &quot;</span>)</span><br></pre></td></tr></table></figure>

<p>关于注释需要注意的几点：</p>
<ul>
<li>一定要养成写注释的习惯，认真写注释不仅是对自己也是对阅读代码的人的尊重</li>
<li>注释一定要简明扼要的阐述代码的目的</li>
<li>注释一定要规范，此处要求的规范可以是大多数人的习惯，也可以是公司对代码注释的规定</li>
</ul>
<h2 id="3-字符串"><a href="#3-字符串" class="headerlink" title="3.字符串"></a>3.字符串</h2><p>字符串常见操作官方文档：<a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.9/library/string.html?highlight=%E5%AD%97%E7%AC%A6%E4%B8%B2">https://docs.python.org/zh-cn/3.9/library/string.html?highlight=字符串</a></p>
<p>​        大多数程序都定义并收集某种数据，然后使用它们来做些有意义的事情。鉴于此，对数据进行分类大有裨益。其中字符串就是一个基础的数据类型。</p>
<h3 id="3-1-字符串的定义"><a href="#3-1-字符串的定义" class="headerlink" title="3.1 字符串的定义"></a>3.1 字符串的定义</h3><p>​        在 Python 中处理文本数据是使用 <a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.9/library/stdtypes.html#str"><code>str</code></a> 对象，也称为 <em>字符串</em>。 字符串是由 Unicode 码位构成的不可变 <a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.9/library/stdtypes.html#typesseq">序列</a>。 字符串字面值有多种不同的写法：</p>
<ul>
<li><p>单引号: <code>&#39;允许包含有 &quot;双&quot; 引号&#39;</code></p>
</li>
<li><p>双引号: <code>&quot;允许包含有 &#39;单&#39; 引号&quot;</code>。</p>
</li>
<li><p>三重引号: <code>&#39;&#39;&#39;三重单引号&#39;&#39;&#39;</code>, <code>&quot;&quot;&quot;三重双引号&quot;&quot;&quot;</code></p>
<p>​    使用三重引号的字符串可以跨越多行 —— 其中所有的空白字符都将包含在该字符串字面值中。</p>
</li>
</ul>
<p><strong>字符串中本身不含引号的情况</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>var1 = <span class="string">&quot;This is a string.&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>var2 = <span class="string">&#x27;This is also a string.&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>字符串中本身含有引号的情况</strong>：如果字符串中包含某种引号(如单引号)，则在定义字符串的时候应该使用另外的两种引号</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>var3 = <span class="string">&#x27;I told my friend, &quot;Python is my favorite language!&quot;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>var4 = <span class="string">&quot;The language &#x27;Python&#x27; is named after Monty Python, not the snake.&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>var5 = <span class="string">&quot;One of Python&#x27;s strengths is its diverse and supportive community.&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>三字符串</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">str</span> = <span class="string">&quot;&quot;&quot;登鹳雀楼</span></span><br><span class="line"><span class="string">唐 王之涣 </span></span><br><span class="line"><span class="string">白日依山尽，</span></span><br><span class="line"><span class="string">黄河入海流。</span></span><br><span class="line"><span class="string">欲穷千里目，</span></span><br><span class="line"><span class="string">更上一层楼。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">str</span>)</span><br><span class="line">登鹳雀楼</span><br><span class="line">唐 王之涣 </span><br><span class="line">白日依山尽，</span><br><span class="line">黄河入海流。</span><br><span class="line">欲穷千里目，</span><br><span class="line">更上一层楼。</span><br></pre></td></tr></table></figure>

<h3 id="3-2-字符串的转义"><a href="#3-2-字符串的转义" class="headerlink" title="3.2 字符串的转义"></a>3.2 字符串的转义</h3><p>​        在字符串的定义中，可能会使用到一些特殊字符，如制表符<code>\t</code>、换行符<code>\n</code>，这写字符具有特殊含义，将被python识别成指定的格式，如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">str</span> = <span class="string">&quot;&quot;&quot;登鹳雀楼\n唐 王之涣\n白日依山尽，\n黄河入海流。\n欲穷千里目，\n更上一层楼。&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">str</span>)</span><br><span class="line">登鹳雀楼</span><br><span class="line">唐 王之涣</span><br><span class="line">白日依山尽，</span><br><span class="line">黄河入海流。</span><br><span class="line">欲穷千里目，</span><br><span class="line">更上一层楼。</span><br></pre></td></tr></table></figure>

<p>​        在python中，使用<code>\</code>对特殊字符进行转义，比如我们想要上面的变量<code>str</code>的值换行输出，但是我们仍然想要输出的结果中包含<code>\n</code>是，我们可以通过<code>\</code>对<code>\n</code>进行转义(即<code>\\n</code>)。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">str</span> = <span class="string">&quot;&quot;&quot;登鹳雀楼\\n唐 王之涣\\n白日依山尽，\\n黄河入海流。\\n欲穷千里目，\\n更上一层楼。&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">str</span>)</span><br><span class="line">登鹳雀楼\n唐 王之涣\n白日依山尽，\n黄河入海流。\n欲穷千里目，\n更上一层楼。</span><br></pre></td></tr></table></figure>

<p>我们也可以通过在字符串前加一个<code>r</code>进行转义</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">str</span> = <span class="string">r&quot;&quot;&quot;登鹳雀楼\n唐 王之涣\n白日依山尽，\n黄河入海流。\n欲穷千里目，\n更上一层楼。&quot;&quot;&quot;</span></span><br><span class="line">上一层楼。<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>print(str)</span></span><br><span class="line"><span class="string">登鹳雀楼\n唐 王之涣\n白日依山尽，\n黄河入海流。\n欲穷千里目，\n更上一层楼。</span></span><br></pre></td></tr></table></figure>





<h3 id="3-3-字符串的常用方法"><a href="#3-3-字符串的常用方法" class="headerlink" title="3.3 字符串的常用方法"></a>3.3 字符串的常用方法</h3><p>​        对于字符串的操作，通常有修改字符串的大小写、拼接字符串、切割、等待。</p>
<h4 id="3-3-1-修改字符串的大小写"><a href="#3-3-1-修改字符串的大小写" class="headerlink" title="3.3.1 修改字符串的大小写"></a>3.3.1 修改字符串的大小写</h4><p>​        我们可以通过字符串的指定方法修改字符串的大小写，如将字母全部为小写的字符串修改成大写字母，反义亦然；将全部为字符的字符串的首字母大写等。</p>
<p>(1).<strong>首字母大写</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = <span class="string">&quot;ada lovelace&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name.title())</span><br><span class="line">Ada Lovelace</span><br></pre></td></tr></table></figure>

<p>​        在这个示例中，小写的字符串”ada lovelace”存储到了变量name中。在print()语句中，方法title()出现在这个变量的后面。<strong>方法是Python可对数据执行的操作</strong>。<strong>在name.title()中，name后面的句点（.）让Python对变量name执行方法title()指定的操作。每个方法后面都跟着一对括号，这是因为方法通常需要额外的信息来完成其工作。这种信息是在括号内提供的。</strong>函数title()不需要额外的信息，因此它后面的括号是空的。title()以首字母大写的方式显示每个单词，即将每个单词的首字母都改为大写。这很有用，因为你经常需要将名字视为信息。例如，你可能希望程序将值Ada、ADA和ada视为同一个名字，并将它们都显示为Ada。</p>
<p>(2).<strong>全部大写</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name.upper())</span><br><span class="line">ADA LOVELACE</span><br></pre></td></tr></table></figure>

<p>(3).<strong>全部小写</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name.lower())</span><br><span class="line">ada lovelace</span><br></pre></td></tr></table></figure>

<p>​        存储数据时，方法lower()很有用。很多时候，你无法依靠用户来提供正确的大小写，因此需要将字符串先转换为小写，再存储它们。以后需要显示这些信息时，再将其转换为最合适的大小写方式。</p>
<p>(4).<strong>将大小写转换</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = <span class="string">&quot;ZhangSan&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name.swapcase())</span><br><span class="line">zHANGsAN</span><br></pre></td></tr></table></figure>



<h4 id="3-3-2-合并（拼接）字符串"><a href="#3-3-2-合并（拼接）字符串" class="headerlink" title="3.3.2 合并（拼接）字符串"></a>3.3.2 合并（拼接）字符串</h4><p>​        合并(拼接)字符串是指将两个字符串进行合并(拼接)起来，以便按照我们想要的方式一起输出或存储。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>first_name = <span class="string">&quot;ada&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>last_name = <span class="string">&quot;lovelace&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>full_name = first_name + <span class="string">&quot; &quot;</span> + last_name</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(full_name)</span><br><span class="line">ada lovelace</span><br></pre></td></tr></table></figure>

<p>​        对于上面的案例，我们可以不定义<code>full_name</code>这个变量也能达到合并输出的效果，这两种方式在本质上都是一样的，只不过上面的方法是将合并(拼接)的结果存储在了变量<code>full_name</code>中，下面的方式是直接进行字符串的拼接并通过<code>print()</code>函数输出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(first_name + <span class="string">&quot; &quot;</span> + last_name)</span><br><span class="line">ada lovelace</span><br></pre></td></tr></table></figure>

<p>​        通过字符串的合并(拼接)功能，我们可以输出一些有意义的表达式，如当用户登陆的时候，我们可以跟用户打招呼。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = <span class="built_in">input</span>(<span class="string">&quot;please, input your username: &quot;</span>)</span><br><span class="line">please, <span class="built_in">input</span> your username: zhangsan</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&quot;Hello, &quot;</span> + name.title() + <span class="string">&quot;!&quot;</span> + <span class="string">&quot; welcome login.&quot;</span>)</span><br><span class="line">Hello, Zhangsan! welcome login.</span><br></pre></td></tr></table></figure>

<p>​        其实，print()函数本身提供了字符串合并(拼接)的功能，当然这是print()函数的功能，并不是字符串的功能。</p>
<p><strong>print()函数默认以空格为分隔符将字符串输出</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&quot;apples&quot;</span>, <span class="string">&quot;oranges&quot;</span>, <span class="string">&quot;bananas&quot;</span>)</span><br><span class="line">apples oranges bananas</span><br></pre></td></tr></table></figure>

<p><strong>指定print()函数的分隔符</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以逗号(&quot;,&quot;)为分隔符输出</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&quot;apples&quot;</span>, <span class="string">&quot;oranges&quot;</span>, <span class="string">&quot;bananas&quot;</span>, sep=<span class="string">&quot;,&quot;</span>)</span><br><span class="line">apples,oranges,bananas</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以横杠(&quot;-&quot;)为分隔符输出</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&quot;apples&quot;</span>, <span class="string">&quot;oranges&quot;</span>, <span class="string">&quot;bananas&quot;</span>, sep=<span class="string">&quot;-&quot;</span>)</span><br><span class="line">apples-oranges-bananas</span><br></pre></td></tr></table></figure>

<h4 id="3-3-3-使用制表符或换行符来添加空白"><a href="#3-3-3-使用制表符或换行符来添加空白" class="headerlink" title="3.3.3 使用制表符或换行符来添加空白"></a>3.3.3 使用制表符或换行符来添加空白</h4><p>​        <strong>在编程中，空白泛指任何非打印字符，如空格、制表符和换行符</strong>。你可使用空白来组织输出，以使其更易读。要在字符串中添加制表符，可使用字符组合<code>\t</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&quot;Hello, Python&quot;</span>)</span><br><span class="line">Hello, Python</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&quot;\tHello, Python&quot;</span>)</span><br><span class="line">	Hello, Python            <span class="comment"># 此处的输出中Hello, Python前面有四个空格(\t制表符的输出结果)</span></span><br></pre></td></tr></table></figure>

<p>​        要在字符串中添加换行符，可使用<code>\n</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&quot;Languages:\nPython\nC\nJavaScript&quot;</span>)</span><br><span class="line">Languages:</span><br><span class="line">Python</span><br><span class="line">C</span><br><span class="line">JavaScript</span><br></pre></td></tr></table></figure>

<p>​        为了更加美观和已读，我们可以混用换行符<code>\n</code>和制表符<code>\t</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">&quot;Languages:\n\tPython\n\tC\n\tJavaScript&quot;</span>)</span><br><span class="line">Languages:</span><br><span class="line">	Python</span><br><span class="line">	C</span><br><span class="line">	JavaScript</span><br></pre></td></tr></table></figure>

<h4 id="3-3-4-删除空白"><a href="#3-3-4-删除空白" class="headerlink" title="3.3.4 删除空白"></a>3.3.4 删除空白</h4><p>​        在程序中，额外的空白可能令人迷惑。对程序员来说，’python’和’python ‘看起来几乎没什么两样，但对程序来说，它们却是两个不同的字符串。Python能够发现’python ‘中额外的空白，并认为它是有意义的——除非你告诉它不是这样的。<br>​        空白很重要，因为你经常需要比较两个字符串是否相同。例如，一个重要的示例是，在用户登录网站时检查其用户名。但在一些简单得多的情形下，额外的空格也可能令人迷惑。所幸在Python中，删除用户输入的数据中的多余的空白易如反掌。</p>
<p>​        Python能够找出字符串开头和末尾多余的空白。在python中，可以使用rstrip()删除字符串末尾的空白，使用lstrip()删除字符串前方的空白，使用strip()删除字符串前后的空白。</p>
<p>​        下面的案例中，我在输入用户名的时候，分别在<code>zhangsan</code>前面和后面各加了两个和一个空格</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = <span class="built_in">input</span>(<span class="string">&quot;please, input your username: &quot;</span>)</span><br><span class="line">please, <span class="built_in">input</span> your username:   zhangsan    </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name)   <span class="comment"># 直接输出&quot;zhangsan&quot;我们很难分辨出字符串前后的空格</span></span><br><span class="line">  zhangsan </span><br></pre></td></tr></table></figure>

<p>如何分辨我输出的空格呢？</p>
<p><strong>方法1：</strong>通过len()函数比较两个字符串的长度</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">len</span>(<span class="string">&quot;zhangsan&quot;</span>))    <span class="comment"># 字符串&quot;zhangsan&quot;的长度是8</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">len</span>(name))     <span class="comment"># 变量name的长度为11，则证明name前后必然有空格，但是前后空格的个数，我们不知道</span></span><br><span class="line"><span class="number">11</span></span><br></pre></td></tr></table></figure>

<p><strong>方法2：</strong>除了比较长度外，我们也可以通过下面的方法比较两个字符串是否是同一个字符串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name == <span class="string">&quot;zhangsan&quot;</span>)</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p><strong>方法3：</strong>通过字符串的替换功能，将空格替换成易识别的其他字符</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;-&quot;</span>)  <span class="comment"># 将空格替换成横杠&quot;-&quot;</span></span><br><span class="line"><span class="string">&#x27;--zhangsan-&#x27;</span></span><br></pre></td></tr></table></figure>

<h5 id="3-3-4-1-删除字符串末尾的空白"><a href="#3-3-4-1-删除字符串末尾的空白" class="headerlink" title="3.3.4.1 删除字符串末尾的空白"></a>3.3.4.1 删除字符串末尾的空白</h5><p>​        为了方便查看删除效果，我们使用字符串的替换功能进行检验</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name.rstrip())</span><br><span class="line">  zhangsan</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name.rstrip().replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;-&quot;</span>))</span><br><span class="line">--zhangsan</span><br></pre></td></tr></table></figure>

<h5 id="3-3-4-2-删除字符串左边的空白"><a href="#3-3-4-2-删除字符串左边的空白" class="headerlink" title="3.3.4.2 删除字符串左边的空白"></a>3.3.4.2 删除字符串左边的空白</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name.lstrip())</span><br><span class="line">zhangsan </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name.lstrip().replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;-&quot;</span>))</span><br><span class="line">zhangsan-</span><br></pre></td></tr></table></figure>

<h5 id="3-2-4-3-删除字符串首未的空白"><a href="#3-2-4-3-删除字符串首未的空白" class="headerlink" title="3.2.4.3 删除字符串首未的空白"></a>3.2.4.3 删除字符串首未的空白</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name.strip())   <span class="comment"># 默认删除空格</span></span><br><span class="line">zhangsan</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name.strip().replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;-&quot;</span>))   <span class="comment"># 没有空格，将不能进行替换</span></span><br><span class="line">zhangsan</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">len</span>(name.strip()))   <span class="comment"># 查看长度，删除字符串首尾的空格后，字符串的长度跟字符串&quot;zhangsan&quot;的长度一样</span></span><br><span class="line"><span class="number">8</span></span><br></pre></td></tr></table></figure>

<h5 id="3-2-4-4-删除字符串首尾的指定字符串"><a href="#3-2-4-4-删除字符串首尾的指定字符串" class="headerlink" title="3.2.4.4 删除字符串首尾的指定字符串"></a>3.2.4.4 删除字符串首尾的指定字符串</h5><p>​        strip()方法不仅仅可以删除字符串首尾的空格(默认情况下，strip()是删除字符串首尾的空格)，我们还可以删除指定的字符。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># 删除字符串首尾的空格、字母z、字母n、字母b</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name.strip(<span class="string">&quot; znb&quot;</span>)) </span><br><span class="line">hangsa</span><br></pre></td></tr></table></figure>

<h4 id="3-3-5-替换字符串"><a href="#3-3-5-替换字符串" class="headerlink" title="3.3.5 替换字符串"></a>3.3.5 替换字符串</h4><p>​        将字符串中的某些字符替换成其他字符，格式：<code>str.replace(old,new[,max])</code>，其中<code>max</code>为可选参数，默认都替换，<code>max</code>可以指定替换此处</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name.replace(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;A&quot;</span>))   <span class="comment"># 不指定max参数时，默认全部替换</span></span><br><span class="line">zhAngsAn</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = <span class="string">&quot;Zhang san&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name)</span><br><span class="line">Zhang san</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;+++++&quot;</span>))</span><br><span class="line">Zhang+++++san</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name.replace(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;A&quot;</span>,<span class="number">1</span>))   <span class="comment"># 指定替换次数，此处将只替换第一a,第二个a将保持不变</span></span><br><span class="line">zhAngsan</span><br></pre></td></tr></table></figure>

<h4 id="3-3-6-字符串的截取"><a href="#3-3-6-字符串的截取" class="headerlink" title="3.3.6 字符串的截取"></a>3.3.6 字符串的截取</h4><p>​        Python 访问子字符串，可以使用方括号<code> []</code> 来截取字符串，字符串的截取的语法格式如下：<code>变量[头下标:尾下标]</code></p>
<p>​        首先我们了解下索引，索引主要包括以下几点：</p>
<ul>
<li><p>索引包括正向索引和反向作用，正向作用从左到右，从0开始计数；反向索引从右到左，从-1开始计数；</p>
</li>
<li><p>索引是<code>前包后不包</code>，str[m,n]用数学表示为[m,n)，其中m&lt;n；</p>
</li>
<li><p>如果从第一个字符或最后一个字符进行截取，可以使用<code>:</code>，而不用标注<code>0</code>或者<code>-1</code>；</p>
</li>
<li><p>可以连续截取，也可以指定步长，如str[m,n,2]表示，从m开始直到n(不包括n)，步长为2进行截取；</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">str</span> = <span class="string">&quot;I love Python&quot;</span></span><br></pre></td></tr></table></figure>

<p>​        字符串<code>&quot;I love Python&quot;</code>的正向和反向索引如下：</p>
<p><img src="image-20210425091117807.png" alt="image-20210425091117807"></p>
<p>​        通过变量<code>str</code>获取<code>love</code>，通过上面的图片可以知道<code>love</code>的索引是从<code>2-5</code>，共<code>4</code>个字符，但是索引是包含<code>2</code>，不包含<code>5</code>，因此要取到<code>e</code>，末尾的索引值应该是<code>6</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">str</span>[<span class="number">2</span>:<span class="number">6</span>])</span><br><span class="line"> love</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">len</span>(<span class="built_in">str</span>[<span class="number">2</span>:<span class="number">6</span>]))</span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>​        通过变量str获取python</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">str</span>[<span class="number">7</span>:<span class="number">13</span>])</span><br><span class="line">Python</span><br><span class="line"></span><br><span class="line"><span class="comment"># 由于pyhton后面已经没有字符了，因此可以使用str[m:]进行截取</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">str</span>[<span class="number">7</span>:])</span><br><span class="line">Python</span><br></pre></td></tr></table></figure>

<p>​        设置步长进行截取，如从头到尾设置步长为2进行截取，即获取所有索引为偶数的字符</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">str</span>[::<span class="number">2</span>])</span><br><span class="line">Ilv yhn</span><br></pre></td></tr></table></figure>

<h4 id="3-3-7-对字符串进行切片"><a href="#3-3-7-对字符串进行切片" class="headerlink" title="3.3.7 对字符串进行切片"></a>3.3.7 对字符串进行切片</h4><p>​        格式：<code>str.split(st=&quot;&quot;,num=string.count(str))</code>,其中st代表分隔符，默认为空格；num表示分割的次数，返回的结果为分割后的新字符串</p>
<p><strong>(1). 以空格对字符串进行切片</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">str</span>.split())     <span class="comment"># 默认以空格做分隔符</span></span><br><span class="line">[<span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;love&#x27;</span>, <span class="string">&#x27;Python&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">str</span>.split(<span class="string">&quot; &quot;</span>))  <span class="comment"># 上面的代码等同于</span></span><br><span class="line">[<span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;love&#x27;</span>, <span class="string">&#x27;Python&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>​        通过上面的结果可以看出，得到的结果是一个列表，并别<code>split()</code>方法指定的分隔符(即空格)被丢弃</p>
<p><strong>(2). 以字母o对字符串进行切片</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">str</span>.split(<span class="string">&quot;o&quot;</span>))</span><br><span class="line">[<span class="string">&#x27;I l&#x27;</span>, <span class="string">&#x27;ve Pyth&#x27;</span>, <span class="string">&#x27;n&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p><strong>(3). 以字母o对字符串进行切片1次</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">str</span>.split(<span class="string">&quot;o&quot;</span>,<span class="number">1</span>))  <span class="comment"># 指定切割的次数</span></span><br><span class="line">[<span class="string">&#x27;I l&#x27;</span>, <span class="string">&#x27;ve Python&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h4 id="3-3-8-查找字符串中是否存在某字符"><a href="#3-3-8-查找字符串中是否存在某字符" class="headerlink" title="3.3.8 查找字符串中是否存在某字符"></a>3.3.8 查找字符串中是否存在某字符</h4><p>​        在python中，有时我们需要检查一个字符串中是否包含某个字符(单个或多个字符)，可以使用find()方法，格式：<code>str.find(str,查询开始的索引值,查询结束的索引值)</code>，如果查找的字符存在与字符串中，就返回字符在字符串中的第一个索引的值，否则返回-1</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找a字符在name中的位置，如果有多个，则只返回第一个a的索引</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name.find(<span class="string">&quot;a&quot;</span>))  </span><br><span class="line"><span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找san字符在name中的位置，返回san第一个字符的索引</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name.find(<span class="string">&quot;san&quot;</span>))  </span><br><span class="line"><span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找san字符在name中的位置，sn不存在与字符串name中，因此返回-1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name.find(<span class="string">&quot;sn&quot;</span>))  </span><br><span class="line">-<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从指定位置开始查找字符串a，索引3-6表示字符串name中的&quot;ngs&quot;，不存在a字符，因此返回-1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name.find(<span class="string">&quot;a&quot;</span>,<span class="number">3</span>,<span class="number">6</span>))  </span><br><span class="line">-<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从指定位置开始查找字符串a，索引3-7表示字符串name中的&quot;ngsa&quot;，存在a字符，因此返回a字符在name中此处ngsa中a的索引</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(name.find(<span class="string">&quot;a&quot;</span>,<span class="number">3</span>,<span class="number">7</span>))</span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure>

<h4 id="3-3-9-连接字符串"><a href="#3-3-9-连接字符串" class="headerlink" title="3.3.9 连接字符串"></a>3.3.9 连接字符串</h4><p>​        <code>join()</code>方法用于将序列中的元素以指定字符连接成一个新字符串，格式：<code>str.join(sequence)</code>，sequence代表要连接的元素序列，返回结果为生成的新字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = [<span class="string">&quot;zhangsan&quot;</span>, <span class="string">&quot;lisi&quot;</span>, <span class="string">&quot;wangwu&quot;</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&quot; &quot;</span>.join(name)</span><br><span class="line"><span class="string">&#x27;zhangsan lisi wangwu&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = (<span class="string">&quot;zhangsan&quot;</span>, <span class="string">&quot;lisi&quot;</span>, <span class="string">&quot;wangwu&quot;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&quot;-&quot;</span>.join(name)</span><br><span class="line"><span class="string">&#x27;zhangsan-lisi-wangwu&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-3-10-查询开头结尾的特定字符串"><a href="#3-3-10-查询开头结尾的特定字符串" class="headerlink" title="3.3.10 查询开头结尾的特定字符串"></a>3.3.10 查询开头结尾的特定字符串</h4><p><strong>(1).startswith()：</strong>表示以什么开头，如果以指定字符结尾则返回True，否则返回False</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>var = <span class="string">&quot;I love python!&quot;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>var.startswith(<span class="string">&quot;I&quot;</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>var.startswith(<span class="string">&quot;I lo&quot;</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>var.startswith(<span class="string">&quot;i&quot;</span>)</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p><strong>(2).endswith()：</strong>表示以什么开头，如果以指定字符结尾则返回True，否则返回False</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>var.endswith(<span class="string">&quot;python!&quot;</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>var.endswith(<span class="string">&quot;on!&quot;</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>var.endswith(<span class="string">&quot;on&quot;</span>)</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>



<h2 id="4-数字"><a href="#4-数字" class="headerlink" title="4 数字"></a>4 数字</h2><p>​        在编程中，经常使用数字来记录游戏得分、表示可视化数据、存储Web应用信息等。Python根据数字的用法以不同的方式处理它们。鉴于整数使用起来最简单，下面就先来看看Python是如何管理它们的。</p>
<h3 id="4-1-整数"><a href="#4-1-整数" class="headerlink" title="4.1 整数"></a>4.1 整数</h3><p>​        <strong>在Python中，可对整数进行加（+）减（-）乘（*）除（/）四则运算</strong>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">10</span> + <span class="number">22</span>   <span class="comment"># 加</span></span><br><span class="line"><span class="number">32</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">10</span> - <span class="number">22</span>   <span class="comment"># 减</span></span><br><span class="line">-<span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">10</span> * <span class="number">22</span>  <span class="comment"># 乘</span></span><br><span class="line"><span class="number">220</span> </span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">10</span> / <span class="number">22</span>   <span class="comment"># 除，无论是否可以整除，得到的结果都是是浮点数</span></span><br><span class="line"><span class="number">0.45454545454545453</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">23</span> // <span class="number">10</span>    <span class="comment"># 地板除，返回除数的整数部分</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">23</span> % <span class="number">10</span>     <span class="comment"># 取余，返回除数的余数部分</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">2</span> ** <span class="number">10</span>     <span class="comment"># 乘方</span></span><br><span class="line"><span class="number">1024</span></span><br></pre></td></tr></table></figure>

<p>​        <strong>Python还支持运算次序</strong>，因此你可在同一个表达式中使用多种运算。你还可以使用括号来修改运算次序，让Python按你指定的次序执行运算。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">2</span> + <span class="number">3</span>*<span class="number">4</span></span><br><span class="line"><span class="number">14</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>( <span class="number">2</span> + <span class="number">3</span>) * <span class="number">4</span></span><br><span class="line"><span class="number">20</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-浮点数"><a href="#4-2-浮点数" class="headerlink" title="4.2 浮点数"></a>4.2 浮点数</h3><p>​        <strong>Python将带小数点的数字都称为浮点数</strong>。大多数编程语言都使用了这个术语，它指出了这样一个事实：小数点可出现在数字的任何位置。每种编程语言都须细心设计，以妥善地处理浮点数，确保不管小数点出现在什么位置，数字的行为都是正常的。从很大程度上说，使用浮点数时都无需考虑其行为。你只需输入要使用的数字，Python通常都会按你期望的方式处理它们：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0.2</span> + <span class="number">0.2</span></span><br><span class="line"><span class="number">0.4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">2</span> * <span class="number">0.2</span></span><br><span class="line"><span class="number">0.4</span></span><br></pre></td></tr></table></figure>

<p>​        但需要注意的是，结果包含的小数位数可能是不确定时，结果可能会出现误差，如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0.1</span> + <span class="number">0.1</span></span><br><span class="line"><span class="number">0.2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0.1</span> + <span class="number">0.1</span> + <span class="number">0.1</span></span><br><span class="line"><span class="number">0.30000000000000004</span></span><br></pre></td></tr></table></figure>

<p>​        在计算机的世界中，一个普遍存在的问题是浮点数并不能准确地表示为十进制，因此就出现了这种精度问题，那么如何精准的计算呢？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(Decimal(<span class="string">&quot;0.1&quot;</span>) + Decimal(<span class="string">&quot;0.1&quot;</span>) + Decimal(<span class="string">&quot;0.1&quot;</span>))</span><br><span class="line"><span class="number">0.3</span></span><br></pre></td></tr></table></figure>

<h2 id="5-python之禅"><a href="#5-python之禅" class="headerlink" title="5. python之禅"></a>5. python之禅</h2><p>​        python之禅阐述了python的编码的原则和设计理念。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> this</span><br><span class="line">The Zen of Python, by Tim Peters</span><br><span class="line"></span><br><span class="line">Beautiful <span class="keyword">is</span> better than ugly.</span><br><span class="line">Explicit <span class="keyword">is</span> better than implicit.</span><br><span class="line">Simple <span class="keyword">is</span> better than <span class="built_in">complex</span>.</span><br><span class="line">Complex <span class="keyword">is</span> better than complicated.</span><br><span class="line">Flat <span class="keyword">is</span> better than nested.</span><br><span class="line">Sparse <span class="keyword">is</span> better than dense.</span><br><span class="line">Readability counts.</span><br><span class="line">Special cases aren<span class="string">&#x27;t special enough to break the rules.</span></span><br><span class="line"><span class="string">Although practicality beats purity.</span></span><br><span class="line"><span class="string">Errors should never pass silently.</span></span><br><span class="line"><span class="string">Unless explicitly silenced.</span></span><br><span class="line"><span class="string">In the face of ambiguity, refuse the temptation to guess.</span></span><br><span class="line"><span class="string">There should be one-- and preferably only one --obvious way to do it.</span></span><br><span class="line"><span class="string">Although that way may not be obvious at first unless you&#x27;</span>re Dutch.</span><br><span class="line">Now <span class="keyword">is</span> better than never.</span><br><span class="line">Although never <span class="keyword">is</span> often better than *right* now.</span><br><span class="line">If the implementation <span class="keyword">is</span> hard to explain, it<span class="string">&#x27;s a bad idea.</span></span><br><span class="line"><span class="string">If the implementation is easy to explain, it may be a good idea.</span></span><br><span class="line"><span class="string">Namespaces are one honking great idea -- let&#x27;</span>s do more of those!</span><br></pre></td></tr></table></figure>

<p>翻译如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Python之禅 by Tim Peters</span><br><span class="line"> </span><br><span class="line">优美胜于丑陋（Python 以编写优美的代码为目标）</span><br><span class="line">明了胜于晦涩（优美的代码应当是明了的，命名规范，风格相似）</span><br><span class="line">简洁胜于复杂（优美的代码应当是简洁的，不要有复杂的内部实现）</span><br><span class="line">复杂胜于凌乱（如果复杂不可避免，那代码间也不能有难懂的关系，要保持接口简洁）</span><br><span class="line">扁平胜于嵌套（优美的代码应当是扁平的，不能有太多的嵌套）</span><br><span class="line">间隔胜于紧凑（优美的代码有适当的间隔，不要奢望一行代码解决问题）</span><br><span class="line">可读性很重要（优美的代码是可读的）</span><br><span class="line">即便假借特例的实用性之名，也不可违背这些规则（这些规则至高无上）</span><br><span class="line">不要包容所有错误，除非你确定需要这样做（精准地捕获异常，不写 <span class="keyword">except</span>:<span class="keyword">pass</span> 风格的代码）</span><br><span class="line">当存在多种可能，不要尝试去猜测</span><br><span class="line">而是尽量找一种，最好是唯一一种明显的解决方案（如果不确定，就用穷举法）</span><br><span class="line">虽然这并不容易，因为你不是 Python 之父（这里的 Dutch 是指 Guido ）</span><br><span class="line">做也许好过不做，但不假思索就动手还不如不做（动手之前要细思量）</span><br><span class="line">如果你无法向人描述你的方案，那肯定不是一个好方案；反之亦然（方案测评标准）</span><br><span class="line">命名空间是一种绝妙的理念，我们应当多加利用（倡导与号召）</span><br></pre></td></tr></table></figure>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">python</a>
        		</li>
      		
		</ul>
	</div>

    
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/python//" class="article-tag-list-link color2">python</a>
        		</li>
      		
		</ul>
	</div>


    
    <p class="article-more-link">
      <a class="article-more-a" href="/2021-04/22-PythonVarString/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-PythonContents" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2021-04/21-PythonContents/">PythonContents</a>
	
    </h1>
  


  
  
<a href="/2021-04/21-PythonContents/" class="archive-article-date">
        <time datetime="2021-04-21T06:23:40.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-21</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h2 id="python入门知识："><a href="#python入门知识：" class="headerlink" title="python入门知识："></a>python入门知识：</h2><ul>
<li>安装python：<a href="https://scaven.site/2021-04/21-PythonInstall/">https://scaven.site/2021-04/21-PythonInstall/</a></li>
<li>python基础知识–变量和字符串：<a href="https://scaven.site/2021-04/22-PythonVarString/">https://scaven.site/2021-04/22-PythonVarString/</a></li>
<li>python基础知识–列表：<a href="https://scaven.site/2021-04/23-PythonList/">https://scaven.site/2021-04/23-PythonList/</a></li>
<li>python基础知识–元组：<a href="https://scaven.site/2021-04/24-PythonTuple/">https://scaven.site/2021-04/24-PythonTuple/</a></li>
<li>python基础知识–if语句：<a href="https://scaven.site/2021-04/25-PythonIf/">https://scaven.site/2021-04/25-PythonIf/</a></li>
</ul>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2021-04/21-PythonContents/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-PythonInstall" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2021-04/21-PythonInstall/">安装python</a>
	
    </h1>
  


  
  
<a href="/2021-04/21-PythonInstall/" class="archive-article-date">
        <time datetime="2021-04-21T06:16:03.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-21</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h1 id="第一章-起步–安装python"><a href="#第一章-起步–安装python" class="headerlink" title="第一章 起步–安装python"></a>第一章 起步–安装python</h1><p>​        python的安装可参考python官方给出的文档，官方文档从unix、windows和mac系统都给出了安装python的方法</p>
<p>官方python安装文档地址：<a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.9/using/index.html">https://docs.python.org/zh-cn/3.9/using/index.html</a></p>
<img src="image-20210421100658310.png" alt="image-20210421100658310" style="zoom:50%;" />

<p>​        当然，除了参考官方文档外，也可以参考本文安装教程，本篇python安装教程是之前在博客园写的笔记，此处直接使用博客园的笔记。</p>
<p>博客园笔记地址：</p>
<ul>
<li>windows系统安装python：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/scaven-01/p/11397965.html">https://www.cnblogs.com/scaven-01/p/11397965.html</a> </li>
<li>Linux系统安装python：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/scaven-01/p/11395816.html">https://www.cnblogs.com/scaven-01/p/11395816.html</a></li>
</ul>
<h2 id="1-在win10中安装python3-6-6"><a href="#1-在win10中安装python3-6-6" class="headerlink" title="1.在win10中安装python3.6.6"></a>1.在win10中安装python3.6.6</h2><h3 id="1-1-登录到官网下载指定python版本"><a href="#1-1-登录到官网下载指定python版本" class="headerlink" title="1.1 登录到官网下载指定python版本"></a>1.1 登录到官网下载指定python版本</h3><p>(1).登录到python官网：<a target="_blank" rel="noopener" href="https://www.python.org/%EF%BC%8C%E7%82%B9%E5%87%BBDownloads">https://www.python.org/，点击Downloads</a></p>
<p> <img src="1493126-20190823085201841-539482177.png" alt="img"></p>
<p>(2).选择需要下载的版本，点击版本后的Download</p>
<p> <img src="1493126-20190823085214581-1096043229.png" alt="img"></p>
<p>(3).选择操作系统为Windows的exe文件进行下载</p>
<p> <img src="1493126-20190823085235124-1088341642.png" alt="img"></p>
<p>(4).下载到桌面后，查看文件属性，如下图：</p>
<p> <img src="1493126-20190823085244876-845671619.png" alt="img"></p>
<h3 id="1-2-在win10中安装python3-6-6"><a href="#1-2-在win10中安装python3-6-6" class="headerlink" title="1.2.在win10中安装python3.6.6"></a>1.2.在win10中安装python3.6.6</h3><p>(1).双击python-3.6.6-amd64.exe文件，进入安装界面，选择Customize installation进行下一步安装，</p>
<p> <img src="1493126-20190823085255779-1637204751.png" alt="img"></p>
<p>(2).选择需要安装的功能，根据业务需求进行选择安装，完成后点击Next</p>
<p> <img src="1493126-20190823085304554-802882196.png" alt="img"></p>
<p>(3).选择需要安装的高级功能选项，根据业务需求进行选择安装，并设定安装路径，完成后点击Install进行安装</p>
<p> <img src="1493126-20190823085314581-1496139347.png" alt="img"></p>
<p>(4).配置完成进行安装</p>
<p> <img src="1493126-20190823085324093-1341623617.png" alt="img"></p>
<p>(5).安装成功：</p>
<p> <img src="1493126-20190823085334605-579079025.png" alt="img"></p>
<p>(6).验证安装，在windows系统的cmd命令提示符中输入python -V查看python版本信息，能查看到版本信息，则证明安装没有问题（如下图），若查询不到版本信息，请重新安装：</p>
<p> <img src="1493126-20190823085343346-747313297.png" alt="img"></p>
<p>备注：服务能正常跑起来才能证明服务没有问题，并不是安装完成没有任何报错就成功了，严谨的态度是安装完成后应该验证安装的结果。</p>
<h3 id="1-3-windows系统中运行python的几种方法"><a href="#1-3-windows系统中运行python的几种方法" class="headerlink" title="1.3.windows系统中运行python的几种方法"></a>1.3.windows系统中运行python的几种方法</h3><p>(1).点击电脑桌面上的windows图标，找到刚刚安装的Python3.6文件夹，点击IDLE或者Python3.6</p>
<p> <img src="1493126-20190823085355999-1461123636.png" alt="img"></p>
<p>(2).打开windows系统的cmd命令提示符，输入python进入，退出python的方法有两种–ctrl+z或者输入exit()</p>
<p> <img src="1493126-20190823085407627-741364019.png" alt="img"></p>
<p>(3).在window10的搜索框里输入IDLE，点击回车进入IDLE，如下图：</p>
<p><img src="1493126-20190823085417093-31418666.png" alt="img"></p>
<p>点击回车后，界面如下</p>
<p> <img src="1493126-20190823085427222-1951102661.png" alt="img"></p>
<h2 id="2-在linux系统中安装python"><a href="#2-在linux系统中安装python" class="headerlink" title="2.在linux系统中安装python"></a>2.在linux系统中安装python</h2><p>​        下面在Linux系统(此处以CentOS7为例)安装python的方法，使用其中一个就行。</p>
<h3 id="2-1-方法1–通过yum的方式安装"><a href="#2-1-方法1–通过yum的方式安装" class="headerlink" title="2.1 方法1–通过yum的方式安装"></a>2.1 方法1–通过yum的方式安装</h3><p>​        linux系统中默认安装了python2.7，python2已经不再维护，因此我们需要学习python3，在Linux系统中python2和python3可以共存，因此我们直接通过yum的方式安装python3</p>
<blockquote>
<p>Unix 系统中，为了不与同时安装的 Python 2.x 冲突，Python 3.x 解释器默认安装的执行文件名不是 <code>python</code></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> yum -y install python3</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 安装完成后检查python版本，能检查出python版本说明安装成功</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> python -V     <span class="comment"># 默认的python版本是2.7.5</span></span></span><br><span class="line">Python 2.7.5</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> python3 -V</span></span><br><span class="line">Python 3.6.8</span><br></pre></td></tr></table></figure>

<h3 id="2-2-方法2–源码安装python"><a href="#2-2-方法2–源码安装python" class="headerlink" title="2.2 方法2–源码安装python"></a>2.2 方法2–源码安装python</h3><h4 id="2-2-1-登录到官网下载指定python版本"><a href="#2-2-1-登录到官网下载指定python版本" class="headerlink" title="2.2.1.登录到官网下载指定python版本"></a>2.2.1.登录到官网下载指定python版本</h4><p>(1).登录到Python官网：<a target="_blank" rel="noopener" href="https://www.python.org/">https://www.python.org/</a></p>
<p> <img src="1493126-20190822174013786-573554072.png" alt="img"></p>
<p>(2).选择指定版本的软件包进行下载：</p>
<p> <img src="1493126-20190822174029342-564773510.png" alt="img"></p>
<h4 id="2-2-2-在CentOS7中源码安装python3-6-6并验证安装结果"><a href="#2-2-2-在CentOS7中源码安装python3-6-6并验证安装结果" class="headerlink" title="2.2.2.在CentOS7中源码安装python3.6.6并验证安装结果"></a>2.2.2.在CentOS7中源码安装python3.6.6并验证安装结果</h4><p>(1).环境准备–安装依赖包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">配置yum源，以便安装依赖软件包</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum clean all &amp;&amp; yum repolist</span>   </span><br></pre></td></tr></table></figure>

<p> <img src="1493126-20190822174057592-421901418.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装依赖，其中readline-devel包是防止在新安装的环境中不能使用方向键的问题</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel libffi-devel gcc gcc-c++</span> </span><br></pre></td></tr></table></figure>

<p> <img src="1493126-20190822174117652-1163712718.png" alt="img"></p>
<p>(2).如果不愿意在Windows系统中下载python并上传到CentOS7系统中，可在CentOS7中使用wget命令直接下载python源码包，并进行源码编译安装python</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#下载指定版本的python源码包</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> wget https://www.python.org/ftp/python/3.6.6/Python-3.6.6.tar.xz</span>  </span><br><span class="line"><span class="meta">#</span><span class="bash"> tar xvf Python-3.6.6.tar.xz</span>  </span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> Python-3.6.6/</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> ./configure --prefix=/usr/<span class="built_in">local</span>/python3 <span class="comment"># 安装到指定目录中/usr/local/python3</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make &amp;&amp; make install</span> </span><br></pre></td></tr></table></figure>

<p> <img src="1493126-20190822174139426-547736435.png" alt="img"></p>
<p> <img src="1493126-20190822174152668-1085946048.png" alt="img"></p>
<p>(3).将python3和pip添加到环境变量中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ln -s /usr/<span class="built_in">local</span>/python3/bin/python3 /usr/<span class="built_in">local</span>/bin/python3</span> </span><br></pre></td></tr></table></figure>

<p> <img src="1493126-20190822174206672-79634810.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将pip也添加到环境变量</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ln -s /usr/<span class="built_in">local</span>/python3/bin/pip3 /usr/<span class="built_in">local</span>/bin/pip3</span></span><br></pre></td></tr></table></figure>

<p> <img src="1493126-20190822174221566-882959078.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看pip的版本号</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pip3 -V</span></span><br></pre></td></tr></table></figure>

<p> <img src="1493126-20190822174232019-133160215.png" alt="img"></p>
<h4 id="2-2-3-常见安装问题"><a href="#2-2-3-常见安装问题" class="headerlink" title="2.2.3.常见安装问题"></a>2.2.3.常见安装问题</h4><p>​        当我们为安装成功Python3而开心兴奋之时，我们发现我们的方向键无法使用了，如下图所示，解决方案是安装readline-devel软件包.</p>
<p><img src="1493126-20190822174243300-872303349.png" alt="img"> </p>
<h2 id="3-在mac中安装python"><a href="#3-在mac中安装python" class="headerlink" title="3. 在mac中安装python"></a>3. 在mac中安装python</h2><p>​        在mac笔记本中安装python请参考官网教程，官网地址：<a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/using/mac.html">https://docs.python.org/zh-cn/3/using/mac.html</a></p>
<h2 id="4-选择一个好用的编辑器"><a href="#4-选择一个好用的编辑器" class="headerlink" title="4.选择一个好用的编辑器"></a>4.选择一个好用的编辑器</h2><p>​        工欲善其事，必先利其器。选择一个好用的python编辑器将达到事半功倍的效果，我选择的python编辑器是vscode，免费和扩展插件多是我选择的主要原因，安装教程可自行百度，此处不在赘述。</p>
<p>​        此处附上vscode官网下载和安装教程，可供参考。</p>
<p>vscode下载地址：<a target="_blank" rel="noopener" href="https://code.visualstudio.com/">https://code.visualstudio.com/</a></p>
<p>vscode官方安装教程：<a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/setup/setup-overview">https://code.visualstudio.com/docs/setup/setup-overview</a></p>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">python</a>
        		</li>
      		
		</ul>
	</div>

    
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/python//" class="article-tag-list-link color2">python</a>
        		</li>
      		
		</ul>
	</div>


    
    <p class="article-more-link">
      <a class="article-more-a" href="/2021-04/21-PythonInstall/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-k8s-service" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2021-04/21-k8s-service/">k8s-service</a>
	
    </h1>
  


  
  
<a href="/2021-04/21-k8s-service/" class="archive-article-date">
        <time datetime="2021-04-20T16:00:06.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-21</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h1 id="第七章-Service对外暴露应用"><a href="#第七章-Service对外暴露应用" class="headerlink" title="第七章 Service对外暴露应用"></a>第七章 Service对外暴露应用</h1><h2 id="1-Service是什么"><a href="#1-Service是什么" class="headerlink" title="1. Service是什么"></a>1. Service是什么</h2><p>Q1:如何让前端连接后端？</p>
<p>​        物理服务器/虚拟机都是通过IP地址相互访问的，IP地址是固定的，那么为啥kubernets不能通过ip访问呢</p>
<ul>
<li>Pod的IP地址是随机分配的</li>
<li>Pod的IP随着Pod的启动而变化</li>
</ul>
<p>​        容器的IP地址是临时的(随着容器的启动随机进行分配)，且多个pod有多个IP地址，因此我们不能通过IP地址进行连接，我们需要使用一个统一的访问入口，这个统一的访问入口就等同于一个负载均衡器，这时Service就排上了用场。</p>
<p>Q2：后端程序多个Pod如何同时提供服务？</p>
<p>​        通过<strong>统一的访问入口</strong>，让Service统一将请求分发(<strong>负载均衡</strong>)到后端程序提供服务，并且Service拥有动态感知Pod的能力，Pod的IP发生变化或者有新的Pod加入，Service能自动将流量分发到这些变化和新加入的Pod上</p>
<p>总结：</p>
<p>​         前端用户(user)–连接LB的IP地址，LB将用户流量分发到后端pod，并随时感知pod的状态变化，自动更新负载策略(如，pod故障就不转发流量到故障pod上；又新加入的pod，自动将podip加入负载策略中)</p>
<h2 id="2-Service存在的意义"><a href="#2-Service存在的意义" class="headerlink" title="2. Service存在的意义"></a>2. Service存在的意义</h2><p>Service引入主要是解决了Pod的动态变化，提供统一的访问入口：</p>
<ul>
<li>防止Pod失联，准备找到提供同一个服务器的Pod(服务发现)</li>
<li>定义一组Pod的访问策略(负载均衡)</li>
</ul>
<p>Pod与Service的关系：</p>
<ul>
<li>Service通过标签关联Pod</li>
<li>Service使用iptables或者ipvs为一组Pod提供负载均衡能力</li>
</ul>
<p><img src="image-20210420151118927.png" alt="image-20210420151118927"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> kubectl  get pod --show-labels   <span class="comment"># 通过--show-labels查看标签</span></span></span><br><span class="line">NAME                        READY STATUS    RESTARTS  AGE  LABELS</span><br><span class="line">java-demo-56d54df448-7mhg8  1/1   Running   0         11h  app=java-demo,pod-template-hash=56d54df448</span><br><span class="line">java-demo-56d54df448-dx767  1/1   Running   0         11h  app=java-demo,pod-template-hash=56d54df448</span><br><span class="line">java-demo-56d54df448-flh48  1/1   Running   0         11h  app=java-demo,pod-template-hash=56d54df448</span><br><span class="line">nginx-6799fc88d8-825ps      1/1   Running   0         34h  app=nginx,pod-template-hash=6799fc88d8</span><br><span class="line">web-86cd4d65b9-554kq        1/1   Running   0         11h  app=web,pod-template-hash=86cd4d65b9</span><br><span class="line">web-86cd4d65b9-65nkq        1/1   Running   0         11h  app=web,pod-template-hash=86cd4d65b9</span><br><span class="line">web-86cd4d65b9-7zml9        1/1   Running   0         11h  app=web,pod-template-hash=86cd4d65b9</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl  get pod -l app=web    <span class="comment"># 通过-l过滤标签</span></span></span><br><span class="line">NAME                   READY   STATUS    RESTARTS   AGE</span><br><span class="line">web-86cd4d65b9-554kq   1/1     Running   0          11h</span><br><span class="line">web-86cd4d65b9-65nkq   1/1     Running   0          11h</span><br><span class="line">web-86cd4d65b9-7zml9   1/1     Running   0          11h</span><br></pre></td></tr></table></figure>

<h2 id="3-Service的定义与创建"><a href="#3-Service的定义与创建" class="headerlink" title="3. Service的定义与创建"></a>3. Service的定义与创建</h2><h3 id="3-1-命令行创建"><a href="#3-1-命令行创建" class="headerlink" title="3.1 命令行创建"></a>3.1 命令行创建</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 此处我们不做创建，只做检查</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl expose deployment web --port=80 --target-port=80 --dry-run=client</span></span><br><span class="line">service/web exposed (dry run)</span><br></pre></td></tr></table></figure>

<h3 id="3-2-yaml文件创建"><a href="#3-2-yaml文件创建" class="headerlink" title="3.2 yaml文件创建"></a>3.2 yaml文件创建</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 如果不会写yaml，我们仍然可以通过--dry-run=client -o yaml将yaml文件导出</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl expose deployment web --port=80 --target-port=80 --dry-run=client -o yaml &gt; web_service.yaml</span></span><br></pre></td></tr></table></figure>

<h2 id="4-Service的三种类型"><a href="#4-Service的三种类型" class="headerlink" title="4.Service的三种类型"></a>4.Service的三种类型</h2><h3 id="4-1-ClusterIP"><a href="#4-1-ClusterIP" class="headerlink" title="4.1  ClusterIP"></a>4.1  ClusterIP</h3><p>​        默认，分配一个稳定的IP地址，即VIP，<strong>只能在集群内部访问</strong>。用户不能直接访问，只是解决了如何在集群内部访问，即node和pod，pod和pod之间的访问。</p>
<img src="image-20210420153150362.png" alt="image-20210420153150362" style="zoom:67%;" />

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat web_service.yaml   # 通过是上面的命令生成的yaml文件。默认类型为clusterIP</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="literal">null</span>         <span class="comment"># 删除创建时间戳</span></span><br><span class="line">  <span class="attr">labels:</span>                  <span class="comment"># svc的标签</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web</span>                <span class="comment"># svc的名称</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span>           <span class="comment"># Service暴露的端口</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span>     <span class="comment"># 容器使用的端口，即将容器的80端口与Service的80端口做关联</span></span><br><span class="line">  <span class="attr">selector:</span> <span class="comment"># 关联后端的Pod的标签，即通过这个标签去找到对应的pod，跟资源(如pod,deploy)类型中的metadata.labels一致</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">status:</span>                <span class="comment"># 删除该字段</span></span><br><span class="line">  <span class="attr">loadBalancer:</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-NodePort"><a href="#4-2-NodePort" class="headerlink" title="4.2 NodePort"></a>4.2 NodePort</h3><p>​        在<strong>每个节点上启用一个端口来暴露服务</strong>，可以在<strong>集群外部访问</strong>，但也会创建一个稳定的ClusterIP，端口在30000-32767(端口可指定，默认自动分配)之间，访问地址为&lt;任意NodeIP&gt;:<NodePort>，这样会在每台Node上监听端口接收用户流量，在实际情况下，对用户暴露的只会有一个IP和端口，那这么多台用哪台让用户访问呢？一般的做法是加一个公网负载均衡器，让项目提供统一的访问入口</p>
<img src="image-20210420153303109.png" alt="image-20210420153303109" style="zoom:67%;" />

<p>企业常见用法：</p>
<img src="image-20210420154944811.png" alt="image-20210420154944811" style="zoom:67%;" />

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat web_service.yaml   # 指定端口和类型</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="literal">null</span>         <span class="comment"># 删除创建时间戳</span></span><br><span class="line">  <span class="attr">labels:</span>                </span><br><span class="line">    <span class="attr">app:</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web</span>               </span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span>      <span class="comment"># 指定类型为NodePort,可在集群外访问</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span>           </span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span>    </span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">30023</span>    <span class="comment"># 如果想指定端口，可添加该字段，不指定端口则自动分配，范围在30000-32767</span></span><br><span class="line">  <span class="attr">selector:</span> </span><br><span class="line">    <span class="attr">app:</span> <span class="string">web</span></span><br><span class="line"><span class="attr">status:</span>                <span class="comment"># 删除该字段</span></span><br><span class="line">  <span class="attr">loadBalancer:</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-LoadBalancer-LB"><a href="#4-3-LoadBalancer-LB" class="headerlink" title="4.3 LoadBalancer (LB)"></a>4.3 LoadBalancer (LB)</h3><p>​        与NodePort类似，<strong>适用于公有云</strong>，在每个节点启用一个端口来暴露服务，除此之外，<strong>k8s会请求底层云平台(如阿里云，aws等)上的负载均衡器</strong>，<strong>自动将每个Node</strong>(&lt;任意NodeIP&gt;:<NodePort>)作为后端添加进去，可查阅云厂商相关文档</p>
<img src="image-20210420155108729.png" alt="image-20210420155108729" style="zoom:67%;" />


<h2 id="5-Service代理模式"><a href="#5-Service代理模式" class="headerlink" title="5. Service代理模式"></a>5. Service代理模式</h2><ul>
<li>iptables(默认规则)<ul>
<li>灵活，功能强大</li>
<li>规则遍历匹配和更新，呈线性时延，不适用于大集群(建议service小于100，pod副本数跟service比例在1:3-5可使用iptables)</li>
<li>查看iptables规则：iptables-save |grep <SERVICE-NAME></li>
</ul>
</li>
</ul>
<img src="image-20210420155534541.png" alt="image-20210420155534541" style="zoom: 50%;" />

<p>查看规则的方法：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 通过kube-proxy的配置文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 通过kube-proxy的日志，我们是通过容器启动的，因此就通过该方法查看</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl get pods -n kube-system | grep proxy</span></span><br><span class="line">kube-proxy-bzhts                           1/1     Running   1          11d</span><br><span class="line">kube-proxy-fd5q2                           1/1     Running   1          11d</span><br><span class="line">kube-proxy-p6hmt                           1/1     Running   1          11d</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl logs kube-proxy-p6hmt -n kube-system  <span class="comment"># 查看任意一个proxy Pod的日志</span></span></span><br><span class="line">I0420 06:35:30.109968       1 node.go:172] Successfully retrieved node IP: 10.138.3.61</span><br><span class="line">I0420 06:35:30.110014       1 server_others.go:142] kube-proxy node IP is an IPv4 address (10.138.3.61), assume IPv4 operation</span><br><span class="line">W0420 06:35:30.134968       1 server_others.go:578] Unknown proxy mode &quot;&quot;, assuming iptables proxy</span><br><span class="line"><span class="meta">#</span><span class="bash"> 此处的<span class="string">&quot;proxy mode &quot;</span><span class="string">&quot;, assuming iptables proxy&quot;</span>表示，如果模式为空，则使用iptables规则</span></span><br><span class="line">I0420 06:35:30.135048       1 server_others.go:185] Using iptables Proxier.</span><br><span class="line">I0420 06:35:30.135559       1 server.go:650] Version: v1.20.0</span><br><span class="line">I0420 06:35:30.135919       1 conntrack.go:100] Set sysctl &#x27;net/netfilter/nf_conntrack_max&#x27; to 131072</span><br><span class="line">····</span><br></pre></td></tr></table></figure>

<ul>
<li>ipvs<ul>
<li>工作在内核，有更好的性能，适合于大集群，建议使用</li>
<li>调度算法丰富：rr，wrr，lc，wlc，ip hash···</li>
<li>查看ipvs规则：ipvsadm -L -n</li>
</ul>
</li>
</ul>
<img src="image-20210420155545734.png" alt="image-20210420155545734" style="zoom: 50%;" />


<h3 id="5-1-iptables"><a href="#5-1-iptables" class="headerlink" title="5.1 iptables"></a>5.1 iptables</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 获取容器IP，iptables规则一定会将流量转发到容器IP</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl get pods -o wide | grep nginx   <span class="comment"># 记住容器IP，iptables规则一定会将流量转发到容器IP</span></span></span><br><span class="line">nginx-6799fc88d8-825ps   1/1     Running   1   10d   10.244.154.198   k8s-node-01   &lt;none&gt;  &lt;none&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取svc IP，svc IP一定会去关联后端的容器IP，才能让用户访问到应用信息</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl get svc -o wide | grep nginx</span>  </span><br><span class="line">nginx        NodePort    10.103.247.121   &lt;none&gt;        80:32561/TCP   11d   app=nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 端点信息</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl get ep  | grep nginx</span></span><br><span class="line">nginx        10.244.154.198:80   11d</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ss -lntp | grep proxy</span></span><br><span class="line">LISTEN     0      128    127.0.0.1:10249       *:*   users:((&quot;kube-proxy&quot;,pid=2994,fd=18))</span><br><span class="line">LISTEN     0      128          *:32561         *:*   users:((&quot;kube-proxy&quot;,pid=2994,fd=13))</span><br><span class="line">LISTEN     0      128          *:30001         *:*   users:((&quot;kube-proxy&quot;,pid=2994,fd=10))</span><br><span class="line">LISTEN     0      128       [::]:10256      [::]:*   users:((&quot;kube-proxy&quot;,pid=2994,fd=19))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> iptables规则</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> iptables-save  | grep nginx   <span class="comment"># 此处的nginx是service的名称</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 1.访问nodePort，端口是32561时，将流量转发到KUBE-SVC-2CMXP7HKUVJN7L6M链</span></span></span><br><span class="line">-A KUBE-NODEPORTS -p tcp -m comment --comment &quot;default/nginx&quot; -m tcp --dport 32561 -j KUBE-MARK-MASQ</span><br><span class="line">-A KUBE-NODEPORTS -p tcp -m comment --comment &quot;default/nginx&quot; -m tcp --dport 32561 -j KUBE-SVC-2CMXP7HKUVJN7L6M   </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 3.将来自KUBE-SEP-FIC36SCPQQINK7HE链的规则，通过DNAT(目标地址转换)转发到10.244.154.198:80(容器IP和端口)容器中</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 如果有多个容器，会添加多条相同的规则和负载规则策略，只是--to-destination的IP地址不同</span></span></span><br><span class="line">-A KUBE-SEP-FIC36SCPQQINK7HE -s 10.244.154.198/32 -m comment --comment &quot;default/nginx&quot; -j KUBE-MARK-MASQ</span><br><span class="line">-A KUBE-SEP-FIC36SCPQQINK7HE -p tcp -m comment --comment &quot;default/nginx&quot; -m tcp -j DNAT --to-destination 10.244.154.198:80</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-A KUBE-SERVICES ! -s 10.244.0.0/16 -d 10.103.247.121/32 -p tcp -m comment --comment &quot;default/nginx cluster IP&quot; -m tcp --dport 80 -j KUBE-MARK-MASQ</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 1.访问clusterIP的转发，目标地址是10.103.247.121/32(svc地址)，目标端口是80 ，协议是tcp的流量，转发到KUBE-SVC-2CMXP7HKUVJN7L6M链中</span></span></span><br><span class="line">-A KUBE-SERVICES -d 10.103.247.121/32 -p tcp -m comment --comment &quot;default/nginx cluster IP&quot; -m tcp --dport 80 -j KUBE-SVC-2CMXP7HKUVJN7L6M</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 2.从nodeport和clusterIP两种类型来的流量，都来匹配这条规则</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 含义是：把所有从KUBE-SVC-2CMXP7HKUVJN7L6M链来的规则都交给KUBE-SEP-FIC36SCPQQINK7HE链去处理</span></span></span><br><span class="line">-A KUBE-SVC-2CMXP7HKUVJN7L6M -m comment --comment &quot;default/nginx&quot; -j KUBE-SEP-FIC36SCPQQINK7HE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 我们将集群nginx容器扩容到3个pod</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl scale deployment nginx --replicas=3</span> </span><br><span class="line">deployment.apps/nginx scaled</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 等待创建完所有pod</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl get ep  | grep nginx   <span class="comment"># 这里是所有nginx容器的IP地址和端口</span></span></span><br><span class="line">nginx     10.244.154.198:80,10.244.44.209:80,10.244.44.210:80   11d</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 我们再次来查看iptables规则</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> iptables-save  | grep nginx</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 1. 从nodeport来的流量</span></span></span><br><span class="line">-A KUBE-NODEPORTS -p tcp -m comment --comment &quot;default/nginx&quot; -m tcp --dport 32561 -j KUBE-MARK-MASQ</span><br><span class="line">-A KUBE-NODEPORTS -p tcp -m comment --comment &quot;default/nginx&quot; -m tcp --dport 32561 -j KUBE-SVC-2CMXP7HKUVJN7L6M</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.上文中存在的转发规则</span></span><br><span class="line">-A KUBE-SEP-FIC36SCPQQINK7HE -s 10.244.154.198/32 -m comment --comment &quot;default/nginx&quot; -j KUBE-MARK-MASQ</span><br><span class="line">-A KUBE-SEP-FIC36SCPQQINK7HE -p tcp -m comment --comment &quot;default/nginx&quot; -m tcp -j DNAT --to-destination 10.244.154.198:80</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 3.多出来的第一个规则，转发到第二个pod</span></span></span><br><span class="line">-A KUBE-SEP-FU7B2O7TL4BNEJXI -s 10.244.44.210/32 -m comment --comment &quot;default/nginx&quot; -j KUBE-MARK-MASQ</span><br><span class="line">-A KUBE-SEP-FU7B2O7TL4BNEJXI -p tcp -m comment --comment &quot;default/nginx&quot; -m tcp -j DNAT --to-destination 10.244.44.210:80</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.多出来的第二个规则，转发到第三个pod</span></span><br><span class="line">-A KUBE-SEP-HJU6P624NH7ZFLEO -s 10.244.44.209/32 -m comment --comment &quot;default/nginx&quot; -j KUBE-MARK-MASQ</span><br><span class="line">-A KUBE-SEP-HJU6P624NH7ZFLEO -p tcp -m comment --comment &quot;default/nginx&quot; -m tcp -j DNAT --to-destination 10.244.44.209:80</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1.从clusterIP来的流量</span></span><br><span class="line">-A KUBE-SERVICES ! -s 10.244.0.0/16 -d 10.103.247.121/32 -p tcp -m comment --comment &quot;default/nginx cluster IP&quot; -m tcp --dport 80 -j KUBE-MARK-MASQ</span><br><span class="line">-A KUBE-SERVICES -d 10.103.247.121/32 -p tcp -m comment --comment &quot;default/nginx cluster IP&quot; -m tcp --dport 80 -j KUBE-SVC-2CMXP7HKUVJN7L6M</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 下面的三条策略，从上倒下匹配--Iptables使用概率来保障pod负载均衡分配</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 多出来的转发策略--</span></span><br><span class="line">-A KUBE-SVC-2CMXP7HKUVJN7L6M -m comment --comment &quot;default/nginx&quot; -m statistic --mode random --probability 0.33333333349 -j KUBE-SEP-FIC36SCPQQINK7HE</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 多出来的转发策略--</span></span><br><span class="line">-A KUBE-SVC-2CMXP7HKUVJN7L6M -m comment --comment &quot;default/nginx&quot; -m statistic --mode random --probability 0.50000000000 -j KUBE-SEP-HJU6P624NH7ZFLEO</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认的匹配(转发)规则--</span></span><br><span class="line">-A KUBE-SVC-2CMXP7HKUVJN7L6M -m comment --comment &quot;default/nginx&quot; -j KUBE-SEP-FU7B2O7TL4BNEJXI</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>根据上面的iptables规则可以知道，只是入口不一样(nodeport或clusterip)，入口后的规则都是一样的，因此一般情况下数据包准发流程如下：</p>
<ul>
<li>通过访问clusterIP来访问pod(集群内)，即user–&gt;clusterIP–&gt;PodIP(多个IP)</li>
<li>通过访问nodeIP来访问pod(集群外)，即user–&gt;NodePort(多个集群IP)–&gt;PodIP(多个IP)</li>
</ul>
<h3 id="5-2-ipvs"><a href="#5-2-ipvs" class="headerlink" title="5.2 ipvs"></a>5.2 ipvs</h3><p>​        通过上文，我们已经知道了默认模式是iptables，如果我们想使用ipvs规则，需要进行模式的修改。</p>
<p>修改方式：</p>
<ul>
<li>二进制部署，通过配置文件kube-proxy-config.yml修改，修改imode，然后重启kube-proxy服务</li>
<li>容器部署，通过kubeadm的方式修改，此处采用该方式</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> kubectl edit configmap kube-proxy -n kube-system</span></span><br><span class="line">configmap/kube-proxy edited</span><br></pre></td></tr></table></figure>

<p>如下图：</p>
<img src="image-20210420170843998.png" alt="image-20210420170843998" style="zoom: 80%;" />

<p>重置容器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> k8s中没有容器Pod的概念，因此此处直接删除pod，让其重建pod</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl get pods -n kube-system  -o wide | grep proxy</span> </span><br><span class="line">kube-proxy-bzhts  1/1     Running   1     11d   10.138.3.62      k8s-node-01   &lt;none&gt;    &lt;none&gt;</span><br><span class="line">kube-proxy-fd5q2  1/1     Running   1     11d   10.138.3.63      k8s-node-02   &lt;none&gt;    &lt;none&gt;</span><br><span class="line">kube-proxy-p6hmt  1/1     Running   1     11d   10.138.3.61      k8s-master    &lt;none&gt;    &lt;none&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 先删除其中一个(k8s-node-01)，然后验证合法后，再进行其他两台的操作</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl delete pod kube-proxy-bzhts  -n kube-system</span></span><br><span class="line">pod &quot;kube-proxy-bzhts&quot; deleted</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl get pods -n kube-system  -o wide | grep proxy</span> </span><br><span class="line">kube-proxy-fd5q2  1/1     Running   1     11d   10.138.3.63      k8s-node-02   &lt;none&gt;    &lt;none&gt;</span><br><span class="line">kube-proxy-lndks  1/1     Running   0     8s    10.138.3.62      k8s-node-01   &lt;none&gt;    &lt;none&gt;</span><br><span class="line">kube-proxy-p6hmt  1/1     Running   1     11d   10.138.3.61      k8s-master    &lt;none&gt;    &lt;none&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl get svc -o wide | grep nginx</span></span><br><span class="line">nginx  NodePort    10.103.247.121   &lt;none&gt;    80:32561/TCP   11d   app=nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 验证(在k8s-node-01验证)：安装ipvs，并查看规则</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum -y install ipvsadm</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ipvsadm -Ln</span></span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> RemoteAddress:Port           Forward Weight ActiveConn InActConn</span></span><br><span class="line">TCP  10.96.0.1:443 rr   # 默认规则就是rr</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.138.3.61:6443             Masq    1      0          0</span>         </span><br><span class="line">TCP  10.96.0.10:53 rr</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.235.196:53            Masq    1      0          0</span>         </span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.235.197:53            Masq    1      0          0</span>         </span><br><span class="line">TCP  10.96.0.10:9153 rr</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.235.196:9153          Masq    1      0          0</span>         </span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.235.197:9153          Masq    1      0          0</span>         </span><br><span class="line">TCP  10.99.141.98:8000 rr</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.44.208:8000           Masq    1      0          0</span>         </span><br><span class="line">TCP  10.100.90.183:443 rr</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.154.197:8443          Masq    1      0          0</span>         </span><br><span class="line">TCP  10.103.247.121:80 rr         # svc的IP地址：10.103.247.121，通过svc地址(clusterIP)访问的流量转发</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.44.209:80             Masq    1      0          0</span>         </span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.44.210:80             Masq    1      0          0</span>         </span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.154.198:80            Masq    1      0          0</span>         </span><br><span class="line">TCP  10.138.3.62:30001 rr</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.154.197:8443          Masq    1      0          0</span>         </span><br><span class="line">TCP  10.138.3.62:32561 rr        # 宿主机IP地址：10.138.3.62，通过nodeport访问的流量转发</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.44.209:80             Masq    1      0          0</span>         </span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.44.210:80             Masq    1      0          0</span>         </span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.154.198:80            Masq    1      0          0</span>         </span><br><span class="line">TCP  10.244.154.192:30001 rr</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.154.197:8443          Masq    1      0          0</span>         </span><br><span class="line">TCP  10.244.154.192:32561 rr    # 通过网卡tunl0@NONE访问，网卡信息看下文</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.44.209:80             Masq    1      0          0</span>         </span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.44.210:80             Masq    1      0          0</span>         </span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.154.198:80            Masq    1      0          0</span>         </span><br><span class="line">TCP  127.0.0.1:30001 rr</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.154.197:8443          Masq    1      0          0</span>         </span><br><span class="line">TCP  127.0.0.1:32561 rr       # 通过lo:32561访问nginx容器(NodePort)</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.44.209:80             Masq    1      0          0</span>         </span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.44.210:80             Masq    1      0          0</span>         </span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.154.198:80            Masq    1      0          0</span>         </span><br><span class="line">TCP  172.17.0.1:30001 rr</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.154.197:8443          Masq    1      0          0</span>         </span><br><span class="line">TCP  172.17.0.1:32561 rr     # 172.17.0.1 docker0的IP地址</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.44.209:80             Masq    1      0          0</span>         </span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.44.210:80             Masq    1      0          0</span>         </span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.154.198:80            Masq    1      0          0</span>         </span><br><span class="line">UDP  10.96.0.10:53 rr</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.235.196:53            Masq    1      0          0</span>         </span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.235.197:53            Masq    1      0          0</span>  </span><br><span class="line">  </span><br><span class="line"><span class="meta">#</span><span class="bash"> ip a   <span class="comment"># 网卡信息发生了变化</span></span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:f8:4c:a3 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.138.3.62/24 brd 10.138.3.255 scope global noprefixroute ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::edf4:6c5f:a090:110/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:b9:85:b5:e8 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">4: tunl0@NONE: &lt;NOARP,UP,LOWER_UP&gt; mtu 1480 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/ipip 0.0.0.0 brd 0.0.0.0     # 不知道干啥的？？？？</span><br><span class="line">    inet 10.244.154.192/32 scope global tunl0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">5: cali76d2c4cb462@if4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1480 qdisc noqueue state UP group default </span><br><span class="line">    link/ether ee:ee:ee:ee:ee:ee brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::ecee:eeff:feee:eeee/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">6: cali2941b9a4026@if4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1480 qdisc noqueue state UP group default </span><br><span class="line">    link/ether ee:ee:ee:ee:ee:ee brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">    inet6 fe80::ecee:eeff:feee:eeee/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">7: dummy0: &lt;BROADCAST,NOARP&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span><br><span class="line">    link/ether 02:a3:b5:68:00:72 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">8: kube-ipvs0: &lt;BROADCAST,NOARP&gt; mtu 1500 qdisc noop state DOWN group default # 新出现的网卡</span><br><span class="line">    link/ether ae:50:d0:2b:72:2b brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.96.0.1/32 scope global kube-ipvs0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 10.103.247.121/32 scope global kube-ipvs0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 10.96.0.10/32 scope global kube-ipvs0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 10.99.141.98/32 scope global kube-ipvs0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 10.100.90.183/32 scope global kube-ipvs0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除其他两个proxy pod</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl get pods -o wide -n kube-system |grep proxy</span></span><br><span class="line">\kube-proxy-fd5q2  1/1     Running   1  11d   10.138.3.63      k8s-node-02   &lt;none&gt;  &lt;none&gt;</span><br><span class="line">kube-proxy-lndks   1/1     Running   0  39m   10.138.3.62      k8s-node-01   &lt;none&gt;  &lt;none&gt;</span><br><span class="line">kube-proxy-p6hmt   1/1     Running   1   11d   10.138.3.61      k8s-master    &lt;none&gt;  &lt;none&gt; </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl delete pod kube-proxy-fd5q2  -n kube-system</span></span><br><span class="line">pod &quot;kube-proxy-fd5q2&quot; deleted</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl delete pod kube-proxy-p6hmt  -n kube-system</span></span><br><span class="line">pod &quot;kube-proxy-p6hmt&quot; deleted</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 完成如下：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl get pods -o wide -n kube-system |grep proxy</span></span><br><span class="line">kube-proxy-7xhzn 1/1     Running   0    10s   10.138.3.61      k8s-master    &lt;none&gt;   &lt;none&gt;</span><br><span class="line">kube-proxy-hr7ht 1/1     Running   0    91s   10.138.3.63      k8s-node-02   &lt;none&gt;   &lt;none&gt;</span><br><span class="line">kube-proxy-lndks 1/1     Running   0    41m   10.138.3.62      k8s-node-01   &lt;none&gt;   &lt;none&gt;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-工作模式"><a href="#5-3-工作模式" class="headerlink" title="5.3 工作模式"></a>5.3 工作模式</h3><p><img src="image-20210420175854241.png" alt="image-20210420175854241"></p>
<h2 id="6-Service-DNS名称"><a href="#6-Service-DNS名称" class="headerlink" title="6. Service DNS名称"></a>6. Service DNS名称</h2><p>​        CoreDNS是一个DNS服务器，k8s默认采用，以Pod部署在集群中，CoreDNS服务监视K8S API，为<strong>每个Servicd创建DNS记录用于域名解析</strong>。</p>
<p>​        ClusterIP A记录格式：<servicename>.<namespace>.svc.cluster.local，如果查询不到要么是svc不存在，要么没有指定命名空间。</p>
<p><img src="image-20210420185422423.png" alt="image-20210420185422423"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> kubectl get svc| grep nginx</span> </span><br><span class="line">nginx        NodePort    10.103.247.121   &lt;none&gt;        80:32561/TCP   11d</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl get svc -o wide -n kube-system   <span class="comment"># 名叫kube-dns的svc，这个就是dns的IP</span></span></span><br><span class="line">NAME       TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)                  AGE   SELECTOR</span><br><span class="line">kube-dns   ClusterIP   10.96.0.10   &lt;none&gt;        53/UDP,53/TCP,9153/TCP   11d   k8s-app=kube-dns</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">  kubectl run -it --image=busybox:1.28.4 -- sh</span></span><br><span class="line">/ # nslookup nginx   # 查看nginx的解析信息</span><br><span class="line">Server:    10.96.0.10</span><br><span class="line">Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local</span><br><span class="line"></span><br><span class="line">Name:      nginx</span><br><span class="line">Address 1: 10.103.247.121 nginx.default.svc.cluster.local</span><br><span class="line"></span><br><span class="line">/ # cat /etc/resolv.conf </span><br><span class="line">search default.svc.cluster.local svc.cluster.local cluster.local</span><br><span class="line">nameserver 10.96.0.10</span><br><span class="line">options ndots:5</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 在其他node上删除nginx这个svc,再次查询nginx的解析信息</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl delete svc nginx</span></span><br><span class="line">service &quot;nginx&quot; deleted</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在次查询Nginx的解析信息</span></span><br><span class="line">/ # nslookup nginx</span><br><span class="line">Server:    10.96.0.10</span><br><span class="line">Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local</span><br><span class="line"></span><br><span class="line">nslookup: can&#x27;t resolve &#x27;nginx&#x27;   # 查询失败</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 在其他节点上，新建nginx的svc后，在查看解析信息</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl expose deployment nginx --target-port=80 --port=80 --<span class="built_in">type</span>=NodePort</span></span><br><span class="line">service/nginx exposed</span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl get svc |grep nginx</span></span><br><span class="line">nginx        NodePort    10.99.5.83   &lt;none&gt;        80:31031/TCP   20s  # nginx的IP地址已经发生了变化</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 再一次解析</span></span><br><span class="line">/ # nslookup nginx</span><br><span class="line">Server:    10.96.0.10</span><br><span class="line">Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local</span><br><span class="line"></span><br><span class="line">Name:      nginx</span><br><span class="line">Address 1: 10.99.5.83 nginx.default.svc.cluster.local  # 解析成功</span><br><span class="line"></span><br></pre></td></tr></table></figure>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">kubernets</a>
        		</li>
      		
		</ul>
	</div>

    
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/docker//" class="article-tag-list-link color2">docker</a>
        		</li>
      		
		</ul>
	</div>


    
    <p class="article-more-link">
      <a class="article-more-a" href="/2021-04/21-k8s-service/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-aboutme" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2021-04/20-aboutme/">aboutme</a>
	
    </h1>
  


  
  
<a href="/2021-04/20-aboutme/" class="archive-article-date">
        <time datetime="2021-04-20T04:14:50.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-20</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <hr>
<hr>

<center>
    <p>贺新郎·甚矣吾衰矣</p>
</center>

<center>
    <p>【作者】辛弃疾 【朝代】宋</p>
</center>

<p>邑中园亭，仆皆为赋此词。一日，独坐停云，水声山色，竞来相娱。意溪山欲援例者，遂作数语，庶几仿佛渊明思亲友之意云。</p><br>

<p>甚矣吾衰矣。怅平生、交游零落，只今余几！白发空垂三千丈，一笑人间万事。问何物、能令公喜？我见青山多妩媚，料青山见我应如是。情与貌，略相似。</p><br>

<p>一尊搔首东窗里。想渊明、停云诗就，此时风味。江左沉酣求名者，岂识浊醪妙理。回首叫、云飞风起。不恨古人吾不见，恨古人、不见吾狂耳。知我者，二三子。</p><br>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">AboutMe</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2021-04/20-aboutme/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-docker" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2021-04/20-docker/">docker</a>
	
    </h1>
  


  
  
<a href="/2021-04/20-docker/" class="archive-article-date">
        <time datetime="2021-04-20T04:02:58.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-20</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <p>docker基础知识</p>
<h2 id="开篇"><a href="#开篇" class="headerlink" title="开篇"></a>开篇</h2><h3 id="1-1什么是容器？"><a href="#1-1什么是容器？" class="headerlink" title="1.1什么是容器？"></a>1.1什么是容器？</h3><p>​        容器技术是一种<strong>虚拟化的方案</strong>。容器虚拟化也就是操作系统级别的虚拟化，只能运行相同或相似内核的操作系统。Docker使用的容器技术依赖于Linux内核的<strong>Namespaces</strong>和<strong>Cgroups</strong>，这两个技术就是为了让操作系统<strong>资源被区隔成独立区间</strong>。</p>
<p>​        Docker能够将开发的应用程序<strong>自动部署</strong>到容器。</p>
<p>Docker依赖的<strong>Linux内核特性</strong>：</p>
<ul>
<li>Namespaces 命名空间</li>
<li>Controller groups（cgroups）控制组</li>
</ul>
<h4 id="1-1-1-NameSpace"><a href="#1-1-1-NameSpace" class="headerlink" title="1.1.1 NameSpace"></a>1.1.1 <strong>NameSpace</strong></h4><p>​        为确保提供的是<strong>轻量级虚拟化服务</strong>，Docker使用了NameSpace。命名空间提供了系统资源的隔离，资源包括进程、网络、文件系统等。</p>
<p>​        在同一个Namespace下的进程可以<strong>感知彼此的变化</strong>，而对其他的Namespace一无所知。让容器置身于独立的系统环境中。</p>
<p>Namespace的种类 ：</p>
<ul>
<li>PID（Process ID） 进程隔离</li>
<li>NET（Network） 管理网络接口</li>
<li>IPC（InterProcess Communication） 管理跨进程通信的访问</li>
<li>MNT（Mount） 管理挂载点</li>
<li>UTS（Unix Timesharing System） 隔离内核和版本标识</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@docker20 ~]# ll  /proc/$$/ns   # $$表示当前进程的id，即1，systemd进程</span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar 31 22:48 ipc -&gt; ipc:[4026531839]</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar 31 22:48 mnt -&gt; mnt:[4026531840]</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar 31 22:48 net -&gt; net:[4026531956]</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar 31 22:48 pid -&gt; pid:[4026531836]</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar 31 22:48 user -&gt; user:[4026531837]</span><br><span class="line">lrwxrwxrwx 1 root root 0 Mar 31 22:48 uts -&gt; uts:[4026531838]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="1-1-2-Controller-groups"><a href="#1-1-2-Controller-groups" class="headerlink" title="1.1.2 Controller groups"></a>1.1.2 <strong>Controller groups</strong></h4><p>​        cgroups是一种Linux提供用于限制、控制、管理资源的机制，所有的任务就是运行再系统中的一个进程，而Cgroups以某种标准将一组进程为目标进行资源分配和控制，例如cpu、内存、带宽等，并且可以动态配置。</p>
<p>cgroups的主要功能：</p>
<ul>
<li>资源限制(Resource limitation)：可以为进程组设定资源使用上限。</li>
<li>优先级设定(Prioritization)：哪些进程组使用更多的资源，可以为进程组分配特定的CPU、磁盘IO吞吐量等。</li>
<li>资源计量(Accounting)：记录进程组使用资源的数量–统计。</li>
<li>进程组控制(Control)：能够将进程组挂起和恢复。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ll  /sys/fs/cgroup/   <span class="comment"># cgroup执行的资源限制</span></span></span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x 4 root root  0 Apr  1 10:59 blkio     # 对块设备的io进行限制</span><br><span class="line">lrwxrwxrwx 1 root root 11 Apr  1 10:59 cpu -&gt; cpu,cpuacct   # 限制cpu时间片的分配，与cpuacct挂载同一目录</span><br><span class="line">lrwxrwxrwx 1 root root 11 Apr  1 10:59 cpuacct -&gt; cpu,cpuacct   </span><br><span class="line"><span class="meta">#</span><span class="bash"> 生产cgroup中的任务占用cou资源的报告，与cpu挂载同一目录</span></span><br><span class="line">drwxr-xr-x 4 root root  0 Apr  1 10:59 cpu,cpuacct   </span><br><span class="line">drwxr-xr-x 2 root root  0 Apr  1 10:59 cpuset    # 给cgroup的任务分配独立的cpu和内存节点</span><br><span class="line">drwxr-xr-x 4 root root  0 Apr  1 10:59 devices   # 允许或者拒绝cgroup中的任务访问设备</span><br><span class="line">drwxr-xr-x 2 root root  0 Apr  1 10:59 freezer   # 暂停/恢复cgroup中的任务</span><br><span class="line">drwxr-xr-x 2 root root  0 Apr  1 10:59 hugetlb   # 限制使用的内存页数量</span><br><span class="line">drwxr-xr-x 4 root root  0 Apr  1 10:59 memory    # 对cgroup中人物的额可用内存进行限制，并自动生产资源占用报告</span><br><span class="line">lrwxrwxrwx 1 root root 16 Apr  1 10:59 net_cls -&gt; net_cls,net_prio   # 使用等级识别符(classid)标记网络数据包，这让Linux流量控制程序(tc)可以识别来自特定从cgroup任务的数据包，并进行网络限制</span><br><span class="line">drwxr-xr-x 2 root root  0 Apr  1 10:59 net_cls,net_prio  </span><br><span class="line">lrwxrwxrwx 1 root root 16 Apr  1 10:59 net_prio -&gt; net_cls,net_prio  # 允许基于cgroup设置网络流量的优先级</span><br><span class="line">drwxr-xr-x 2 root root  0 Apr  1 10:59 perf_event   # 运行使用perf工具来监控cgroup</span><br><span class="line">drwxr-xr-x 4 root root  0 Apr  1 10:59 pids    # 限制任务的数量</span><br><span class="line">drwxr-xr-x 4 root root  0 Apr  1 10:59 systemd</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>容器实际资源限制位置：/sys/fs/cgroup/&lt;资源名&gt;/docker/&lt;容器id&gt;</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker container ls</span> </span><br><span class="line">CONTAINER ID   IMAGE  COMMAND                  CREATED        STATUS              PORTS     NAMES</span><br><span class="line">dc6d2297d670   nginx  &quot;/docker-entrypoint.…&quot;   15 hours ago   Up About a minute   80/tcp vibrant_hawking</span><br><span class="line">60ffca766bde   f1cb7c7d58b7   &quot;bash&quot;                   6 weeks ago    Up About a minute             c1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 为每个容器都创建了相应的限制目录，直接修改容器目录中的资源限制类型就能达到限制容器使用资源的目标</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cpu目录下的资源限制文件，跟/sys/fs/cgroup/cpu/下的内容大同小异</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls /sys/fs/cgroup/cpu/docker/   <span class="comment"># 下面的dc6d2297d670和60ffca766bde就是容器资源，启动容器后才会出现</span></span></span><br><span class="line">60ffca766bdea3ba772bc8fff9e15a5b569d213d06980f1cb56b0d50a66315cf  cpuacct.usage_percpu  cpu.stat</span><br><span class="line">cgroup.clone_children                                             cpu.cfs_period_us     dc6d2297d670ff91bc2dc1fe0e1f7c38563d6f0279a26e4664d7c87ec96ea86b</span><br><span class="line">cgroup.event_control                                              cpu.cfs_quota_us      notify_on_release</span><br><span class="line">cgroup.procs                                                      cpu.rt_period_us      tasks</span><br><span class="line">cpuacct.stat                                                      cpu.rt_runtime_us</span><br><span class="line">cpuacct.usage                                                     cpu.shares</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls   /sys/fs/cgroup/cpu/docker/dc6d2297d670ff91bc2dc1fe0e1f7c38563d6f0279a26e4664d7c87ec96ea86b/</span></span><br><span class="line">cgroup.clone_children  cgroup.procs  cpuacct.usage         cpu.cfs_period_us  cpu.rt_period_us   cpu.shares  notify_on_release</span><br><span class="line">cgroup.event_control   cpuacct.stat  cpuacct.usage_percpu  cpu.cfs_quota_us   cpu.rt_runtime_us  cpu.stat    tasks</span><br><span class="line"><span class="meta">#</span><span class="bash"> cat    /sys/fs/cgroup/cpu/docker/dc6d2297d670ff91bc2dc1fe0e1f7c38563d6f0279a26e4664d7c87ec96ea86b/tasks</span> </span><br><span class="line">19652    # nginx的父进程master进程</span><br><span class="line">19700    # nginx的子进程worker进程</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ps -ef | grep [1]9652</span></span><br><span class="line">root      19652  19623  0 13:46 ?        00:00:00 nginx: master process nginx -g daemon off;</span><br><span class="line">101       19700  19652  0 13:46 ?        00:00:00 nginx: worker process</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ps -ef | grep [1]9700</span></span><br><span class="line">101       19700  19652  0 13:46 ?        00:00:00 nginx: worker process</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> memory下的资源限制目录，跟/sys/fs/cgroup/memory/下的内容大同小异</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls   /sys/fs/cgroup/memory/docker/dc6d2297d670ff91bc2dc1fe0e1f7c38563d6f0279a26e4664d7c87ec96ea86b/</span></span><br><span class="line">cgroup.clone_children       memory.kmem.max_usage_in_bytes      memory.limit_in_bytes            memory.numa_stat            memory.use_hierarchy</span><br><span class="line">cgroup.event_control        memory.kmem.slabinfo                memory.max_usage_in_bytes        memory.oom_control          notify_on_release</span><br><span class="line">cgroup.procs                memory.kmem.tcp.failcnt             memory.memsw.failcnt             memory.pressure_level       tasks</span><br><span class="line">memory.failcnt              memory.kmem.tcp.limit_in_bytes      memory.memsw.limit_in_bytes      memory.soft_limit_in_bytes</span><br><span class="line">memory.force_empty          memory.kmem.tcp.max_usage_in_bytes  memory.memsw.max_usage_in_bytes  memory.stat</span><br><span class="line">memory.kmem.failcnt         memory.kmem.tcp.usage_in_bytes      memory.memsw.usage_in_bytes      memory.swappiness</span><br><span class="line">memory.kmem.limit_in_bytes  memory.kmem.usage_in_bytes          memory.move_charge_at_immigrate  memory.usage_in_bytes</span><br><span class="line"><span class="meta">#</span><span class="bash"> cat    /sys/fs/cgroup/memory/docker/dc6d2297d670ff91bc2dc1fe0e1f7c38563d6f0279a26e4664d7c87ec96ea86b/tasks</span> </span><br><span class="line">19652</span><br><span class="line">19700 </span><br><span class="line"><span class="meta">#</span><span class="bash"> ps -ef | grep [1]9700</span></span><br><span class="line">101       19700  19652  0 13:46 ?        00:00:00 nginx: worker process</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ps -ef | grep [1]9652</span></span><br><span class="line">root      19652  19623  0 13:46 ?        00:00:00 nginx: master process nginx -g daemon off;</span><br><span class="line">101       19700  19652  0 13:46 ?        00:00:00 nginx: worker process</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> cat    /sys/fs/cgroup/memory/docker/dc6d2297d670ff91bc2dc1fe0e1f7c38563d6f0279a26e4664d7c87ec96ea86b/memory.limit_in_bytes</span> </span><br><span class="line">1073741824     # 显示现在分配的内存是1073741824 / 1024 / 1024 /1024 = 1g  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker stats dc6d2297d670ff91bc2dc1fe0e1f7c38563d6f0279a26e4664d7c87ec96ea86b</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看该容器的资源限制情况，显示内存限制是1G</span></span><br><span class="line">CONTAINER ID   NAME              CPU %     MEM USAGE / LIMIT   MEM %     NET I/O      BLOCK I/O     PIDS</span><br><span class="line">dc6d2297d670   vibrant_hawking   0.00%     2.531MiB / 1GiB     0.25%     1.01kB / 0B  22.3MB / 0B   2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;200M&quot;</span> &gt;  /sys/fs/cgroup/memory/docker/dc6d2297d670ff91bc2dc1fe0e1f7c38563d6f0279a26e4664d7c87ec96ea86b/memory.limit_in_bytes   <span class="comment"># 需要注意的是，修改的内存值大于限制值时将修改失败，机可以改小，不能改大</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> cat    /sys/fs/cgroup/memory/docker/dc6d2297d670ff91bc2dc1fe0e1f7c38563d6f0279a26e4664d7c87ec96ea86b/memory.limit_in_bytes</span> </span><br><span class="line">209715200    # 209715200 / 1024 / 1024 = 200M</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker stats dc6d2297d670ff91bc2dc1fe0e1f7c38563d6f0279a26e4664d7c87ec96ea86b</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 内存值已经变成了200m</span></span><br><span class="line">CONTAINER ID   NAME              CPU %     MEM USAGE / LIMIT   MEM %     NET I/O     BLOCK I/O     PIDS</span><br><span class="line">dc6d2297d670   vibrant_hawking   0.00%     2.531MiB / 200MiB   1.27%     1.01kB / 0B 22.3MB / 0B   2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker update --<span class="built_in">help</span>   <span class="comment"># docker资源限制主要是下面的几个类型</span></span></span><br><span class="line"></span><br><span class="line">Usage:  docker update [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line"></span><br><span class="line">Update configuration of one or more containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --blkio-weight uint16        Block IO (relative weight), between 10 and 1000, or 0 to disable (default 0)</span><br><span class="line">      --cpu-period int             Limit CPU CFS (Completely Fair Scheduler) period</span><br><span class="line">      --cpu-quota int              Limit CPU CFS (Completely Fair Scheduler) quota</span><br><span class="line">      --cpu-rt-period int          Limit the CPU real-time period in microseconds</span><br><span class="line">      --cpu-rt-runtime int         Limit the CPU real-time runtime in microseconds</span><br><span class="line">  -c, --cpu-shares int             CPU shares (relative weight)</span><br><span class="line">      --cpus decimal               Number of CPUs</span><br><span class="line">      --cpuset-cpus string         CPUs in which to allow execution (0-3, 0,1)</span><br><span class="line">      --cpuset-mems string         MEMs in which to allow execution (0-3, 0,1)</span><br><span class="line">      --kernel-memory bytes        Kernel memory limit</span><br><span class="line">  -m, --memory bytes               Memory limit</span><br><span class="line">      --memory-reservation bytes   Memory soft limit</span><br><span class="line">      --memory-swap bytes          Swap limit equal to memory plus swap: &#x27;-1&#x27; to enable unlimited swap</span><br><span class="line">      --pids-limit int             Tune container pids limit (set -1 for unlimited)</span><br><span class="line">      --restart string             Restart policy to apply when a container exits</span><br></pre></td></tr></table></figure>



<p><strong>1.2 虚拟化技术</strong></p>
<p>​        虚拟化技术就是一种计算机资源管理技术，将内存，网络，CPU等资源进行抽象，让硬件透明，目的是让用户合理地使用操作系统资源。</p>
<p>容器与虚拟化</p>
<p><img src="/image-20200715143707656.png" alt="image-20200715143707656"></p>
<p>​        <strong>容器</strong>是应用程序层的抽象，将代码和依赖项打包在一起。<strong>多个容器可以在同一台计算机上运行，并与其他容器共享OS内核，每个容器在用户空间中作为隔离的进程运行</strong>。<strong>容器占用的空间少于VM</strong>（容器映像的大小通常为几十MB），可以处理更多的应用程序，并且需要的VM和操作系统更少。</p>
<p>​        <strong>虚拟机（VM）</strong>是将一台服务器转变为多台服务器的物理硬件的抽象。系统管理程序允许多个VM在单台计算机上运行。每个VM都包含<strong>操作系统，应用程序，必要的二进制文件和库的完整副本</strong>-占用数十GB。VM也可能启动缓慢</p>
<p>​       <strong>虚拟机和容器都有优势和劣势</strong>，如何选择取决于具体的需求，但有些规则可以参考。</p>
<ul>
<li>VM非常适合当应用运行时<strong>需要所有OS资源和功能的场景</strong>，如果需要运行多个这样的应该，可以使用VMs</li>
<li>容器适合在更少的server上运行更多的应用。</li>
</ul>
<p>服务器好比运输码头：拥有场地和各种设备（服务器硬件资源）</p>
<p>服务器虚拟化好比作码头上的仓库：拥有独立的空间堆放各种货物或集装箱</p>
<p>(仓库之间完全独立，独立的应用系统和操作系统）</p>
<p>Docker比作集装箱：各种货物的打包</p>
<p>(将各种应用程序和他们所依赖的运行环境打包成标准的容器,容器之间隔离)</p>
<p>​        Docker有着小巧、迁移部署快速、运行高效等特点，但隔离性比服务器虚拟化差：不同的集装箱属于不同的运单（Docker上运行不同的应用实例），相互独立（隔离）。但由同一个库管人员管理（主机操作系统内核），因此通过库管人员可以看到所有集装箱的相关信息（因为共享操作系统内核，因此相关信息会共享）。</p>
<p>​       服务器虚拟化就好比在码头上（物理主机及虚拟化层），建立了多个独立的“小码头”—仓库（虚拟机）。其拥有完全独立（隔离）的空间，属于不同的客户（虚拟机所有者）。每个仓库有各自的库管人员（当前虚拟机的操作系统内核），无法管理其它仓库。不存在信息共享的情况</p>
<p>​       因此，我们需要根据不同的应用场景和需求采用不同的方式使用Docker技术或使用服务器虚拟化技术。例如一个典型的Docker应用场景是当主机上的Docker实例属于单一用户的情况下，在保证安全的同时可以充分发挥Docker的技术优势。对于隔离要求较高的环境如混合用户环境，就可以使用服务器虚拟化技术。正则科技提供了丰富的Docker应用实例，满足您的各种应用需求，并且支持在已经安装了自在（Isvara）服务器虚拟化软件的主机上同时使用服务器虚拟化技术和Docker技术提供不同技术场景。</p>
<h2 id="一．Docker简介"><a href="#一．Docker简介" class="headerlink" title="一．Docker简介"></a>一．Docker简介</h2><h3 id="1-1-docker介绍"><a href="#1-1-docker介绍" class="headerlink" title="1.1 docker介绍"></a>1.1 docker介绍</h3><p>​        docker是<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/PaaS">PaaS</a>提供商dotCloud开源的一个基于<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/LXC">LXC</a>的高级容器引擎，源代码托管在<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Github">Github</a>上，基于<a target="_blank" rel="noopener" href="https://www.runoob.com/go/go-tutorial.html">Go 语言</a>并遵从 Apache2.0 协议开源，docker是容器的一个管理工具，并不是容器。</p>
<p>​       docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制（沙箱就是一个限制应用程序对系统资源的访问的运行环境），相互之间不会有任何接口（类似 iPhone 的 app）,更重要的是容器性能开销极低。</p>
<p>​        docker从17.03版本之后分为CE（Community Edition: 社区版）和EE（Enterprise Edition: 企业版），我们用社区版就可以了。</p>
<p>​        Docker自2013年以来非常火热，无论是从github上的代码活跃度，还是<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Redhat">Redhat</a>在RHEL6.5中集成对Docker的支持, 就连Google的Compute Engine也支持docker在其之上运行。</p>
<ul>
<li><p>环境管理复杂 - 从各种OS到各种中间件到各种app, 一款产品能够成功作为开发者需要关心的东西太多，且难于管理，这个问题几乎在所有现代IT相关行业都需要面对。</p>
</li>
<li><p>云计算时代的到来 - AWS的成功, 引导开发者将应用转移到 cloud 上, 解决了硬件管理的问题，然而中间件相关的问题依然存在 (所以openstack HEAT和 AWS cloudformation 都着力解决这个问题)。开发者思路变化提供了可能性。</p>
</li>
<li><p>虚拟化手段的变化 - cloud 时代采用标配硬件来降低成本，采用虚拟化手段来满足用户按需使用的需求以及保证可用性和隔离性。然而无论是KVM还是Xen在 docker 看来,都在浪费资源，因为用户需要的是高效运行环境而非OS, GuestOS既浪费资源又难于管理, 更加轻量级的LXC更加灵活和快速</p>
</li>
<li><p>LXC的移动性 - LXC在 linux 2.6 的 kernel 里就已经存在了，但是其设计之初并非为云计算考虑的，缺少标准化的描述手段和容器的可迁移性，决定其构建出的环境难于迁移和标准化管理(相对于KVM之类image和snapshot的概念)。docker 就在这个问题上做出实质性的革新。这是docker最独特的地方。</p>
</li>
</ul>
<p>​       面对上述几个问题，docker设想是交付运行环境如同海运，OS如同一个货轮，每一个在OS基础上的软件都如同一个集装箱，用户可以通过标准化手段自由组装运行环境，同时集装箱的内容可以由用户自定义，也可以由专业人员制造。这样，交付一个软件，就是一系列标准化组件的集合的交付，如同乐高积木，用户只需要选择合适的积木组合，并且在最顶端署上自己的名字(最后一个标准化组件是用户的app)。这也就是基于docker的PaaS产品的原型。</p>
<h3 id="1-2-Docker-架构"><a href="#1-2-Docker-架构" class="headerlink" title="1.2 Docker 架构"></a>1.2 Docker 架构</h3><p>​        Docker使用客户端-服务器 (C/S) 架构模式，使用远程API来管理和创建Docker容器。Docker容器通过Docker镜像来创建。容器与镜像的关系类似于面向对象编程中的对象与类，可以理解为程序和进程的关系，镜像是静态的，容器是动态的有生命周期的。</p>
<table>
<thead>
<tr>
<th>docker</th>
<th>面向对象</th>
</tr>
</thead>
<tbody><tr>
<td>容器</td>
<td>对象</td>
</tr>
<tr>
<td>镜像</td>
<td>类</td>
</tr>
</tbody></table>
<img src="/clip_image002.png" alt="img" style="zoom:67%;" />



<center>架构图一</center>

<p>​        Docker采用C/S架构，<code>Docker daemon</code> 作为服务端接受来自客户的请求，并处理这些请求（创建、运行、分发容器）。 客户端和服务端既可以运行在一个机器上，也可通过 socket 或者RESTful API 来进行通信。</p>
<p>​        <code>Docker daemon</code>一般在宿主主机后台运行，等待接收来自客户端的消息。 Docker 客户端则为用户提供一系列可执行命令，用户用这些命令实现跟<code>Docker daemon</code>交互。</p>
<img src="/image-20200717170409141.png" alt="image-20200717170409141" style="zoom:67%;" />

<center>架构图二</center>

<p>​        不难发现，docker由内到外是docker daemon（守护进程），docker client（客户端），container（容器），image（镜像），network（网络），data volumes（数据卷）</p>
<p><strong>Docker的基本组成有：</strong></p>
<ul>
<li>Docker Client：客户端，Docker客户端通过命令行或者其他工具使用Docker SDK与Docker的守护进程通信</li>
<li>Docker Daemon：守护进程，</li>
<li>Docker Image：镜像，Docker镜像是用于创建Docker容器的模板。</li>
<li>Docker Container：容器，容器是独立运行的一个或一组应用</li>
<li>Docker Registry：仓库，Docker仓库用来保存镜像，可以理解为代码控制中的代码仓库。  Docker Hub(<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com</a>) 提供了庞大的镜像集合供使用。用户可创建自己的私有仓库。默认使用https协议进行访问。  拥有两层功能，提供镜像存储的仓库，提供用户获取镜像时的认证</li>
<li>Docker Host：docker运行的主机，一个物理或者虚拟的机器用于执行Docker守护进程和容器。</li>
<li>Containerd：是一个简单的守护进程，向上给Docker Daemon提供接口，向下通过containerd-shim结合runC管理容器</li>
<li>runC：一个命令行工具，它根据OCI标准来创建和运行容器。</li>
</ul>
<img src="/image-20210401142134762.png" alt="image-20210401142134762" style="zoom:67%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ps ajxf   <span class="comment"># 执行结果如下，他们之间的pid存在相互关联的关系</span></span></span><br></pre></td></tr></table></figure>

<p><img src="/image-20210401143510994.png" alt="image-20210401143510994"></p>
<h3 id="1-3-docker的优缺点"><a href="#1-3-docker的优缺点" class="headerlink" title="1.3 docker的优缺点"></a>1.3 docker的优缺点</h3><h4 id="1-3-1-docker优点"><a href="#1-3-1-docker优点" class="headerlink" title="1.3.1 docker优点"></a>1.3.1 docker优点</h4><p>​        Docker 是一个用于开发，交付和运行应用程序的开放平台。Docker 使您能够将应用程序与基础架构分开，从而可以快速交付软件。借助 Docker，您可以与管理应用程序相同的方式来管理基础架构。通过利用 Docker 的方法来快速交付，测试和部署代码，您可以大大减少编写代码和在生产环境中运行代码之间的延迟。</p>
<ul>
<li><strong>快速，一致地交付您的应用程序</strong></li>
</ul>
<p>​        Docker 允许开发人员使用您提供的应用程序或服务的本地容器在标准化环境中工作，从而简化了开发的生命周期。</p>
<p>​       容器非常适合持续集成和持续交付（CI / CD）工作流程，请考虑以下示例方案：</p>
<p>​       您的开发人员在本地编写代码，并使用 Docker 容器与同事共享他们的工作。</p>
<p>​       他们使用 Docker 将其应用程序推送到测试环境中，并执行自动或手动测试。</p>
<p>​      当开发人员发现错误时，他们可以在开发环境中对其进行修复，然后将其重新部署到测试环境中，以进行测试和验证。</p>
<p>​     测试完成后，将修补程序推送给生产环境，就像将更新的镜像推送到生产环境一样简单。</p>
<ul>
<li><strong>响应式部署和扩展</strong></li>
</ul>
<p>​        Docker 是基于容器的平台，允许高度可移植的工作负载。Docker 容器可以在开发人员的本机上，数据中心的物理或虚拟机上，云服务上或混合环境中运行。</p>
<p>​        Docker 的可移植性和轻量级的特性，还可以使您轻松地完成动态管理的工作负担，并根据业务需求指示，实时扩展或拆除应用程序和服务。</p>
<ul>
<li><strong>在同一硬件上运行更多工作负载</strong></li>
</ul>
<p>​        Docker 轻巧快速。它为基于虚拟机管理程序的虚拟机提供了可行、经济、高效的替代方案，因此您可以利用更多的计算能力来实现业务目标。Docker 非常适合于高密度环境以及中小型部署，而您可以用更少的资源做更多的事情。</p>
<h4 id="1-3-2-docker局限"><a href="#1-3-2-docker局限" class="headerlink" title="1.3.2 docker局限"></a>1.3.2 docker局限</h4><p>Docker并不是全能的，设计之初也不是KVM之类虚拟化手段的替代品，简单总结几点：</p>
<ul>
<li><p>Docker是基于Linux 64bit的，无法在32bit的linux/Windows/unix环境下使用</p>
</li>
<li><p>LXC是基于cgroup等linux kernel功能的，因此container的guest系统只能是linux base的</p>
</li>
<li><p>隔离性相比KVM之类的虚拟化方案还是有些欠缺，所有container公用一部分的运行库</p>
</li>
<li><p>网络管理相对简单，主要是基于namespace隔离</p>
</li>
<li><p>cgroup的cpu和cpuset提供的cpu功能相比KVM的等虚拟化方案相比难以度量(所以dotcloud主要是按内存收费)</p>
</li>
<li><p>Docker对disk的管理比较有限</p>
</li>
<li><p>container随着用户进程的停止而销毁，container中的log等用户数据不便收集</p>
</li>
</ul>
<p>​       针对1-2，有windows base应用的需求的基本可以pass了; 3-5主要是看用户的需求，到底是需要一个container还是一个VM, 同时也决定了docker作为 IaaS 不太可行。</p>
<p>​       针对6,7虽然是docker本身不支持的功能，但是可以通过其他手段解决(disk quota, mount –bind)。总之，选用container还是vm, 就是在隔离性和资源复用性上做权衡。</p>
<p>​      <strong>Docker在本质上是一个附加系统</strong>。使用文件系统的不同层构建一个应用是有可能的。每个组件被添加到之前已经创建的组件之上，可以比作为一个文件系统更明智。分层架构带来另一方面的效率提升，当你重建存在变化的Docker镜像时，不需要重建整个Docker镜像，只需要重建变化的部分。</p>
<p>​        可能更为重要的是，Docker旨在用于弹性计算。每个Docker实例的运营生命周期有限，实例数量根据需求增减。在一个管理适度的系统中，这些实例生而平等，不再需要时便各自消亡了。</p>
<p>​        针对Docker环境存在的不足，意味着在开始部署Docker前需要考虑如下几个问题。首先，Docker实例是无状态的。这意味着它们不应该承载任何交易数据，所有数据应该保存在数据库服务器中。</p>
<p>​        其次，开发Docker实例并不像创建一台虚拟机、添加应用然后克隆那样简单。为成功创建并使用Docker基础设施，管理员需要对系统管理的各个方面有一个全面的理解，包括Linux管理、编排及配置工具比如Puppet、Chef以及Salt。这些工具生来就基于命令行以及脚本。</p>
<h3 id="1-4-docker应用场景"><a href="#1-4-docker应用场景" class="headerlink" title="1.4 docker应用场景"></a>1.4 docker应用场景</h3><p>​        在docker的网站上提到了docker的典型场景：</p>
<ul>
<li><p>Automating the packaging and deployment of applications（使应用的打包与部署自动化）</p>
</li>
<li><p>Creation of lightweight, private PAAS environments（创建轻量、私密的PAAS环境）</p>
</li>
<li><p>Automated testing and continuous integration/deployment（实现自动化测试和持续的集成/部署）</p>
</li>
<li><p>Deploying and scaling web apps, databases and backend services（部署与扩展webapp、数据库和后台服务）</p>
</li>
</ul>
<h2 id="二-安装及使用docker"><a href="#二-安装及使用docker" class="headerlink" title="二. 安装及使用docker"></a>二. 安装及使用docker</h2><ul>
<li>依赖的基础环境：</li>
</ul>
<p>64 bits CPU</p>
<p>Linux Kernel 3.10+</p>
<p>Linux Kernel cgroups and namespaces</p>
<ul>
<li>CentOS7</li>
</ul>
<p>“Extras” repositoru</p>
<ul>
<li>Docker Daemon</li>
</ul>
<p>Systemcrl start dorcker</p>
<ul>
<li>Docker Clinet</li>
</ul>
<p>Docker [OPTIONS] CONMMAND [ARG…]</p>
<h3 id="2-1-docker的安装："><a href="#2-1-docker的安装：" class="headerlink" title="2.1 docker的安装："></a>2.1 docker的安装：</h3><p>​       Linux系统自带了docker软件包，但该软件包版本较低，一般不直接安装系统自带的docker。</p>
<img src="/image-20200715151851920.png" alt="image-20200715151851920" style="zoom: 67%;" />

<p>​       我们可以在虚拟机中使用yum repolist命令，同步系统自带的软件包，发现结果都是1.13.1版本的docker，如下图：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# yum info docker  # 查看服务器上的docker信息</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">Available Packages</span><br><span class="line">Name        : docker   # 软件包名称</span><br><span class="line">Arch        : x86_64   # 适用平台</span><br><span class="line">Epoch       : 2</span><br><span class="line">Version     : 1.13.1   # docker版本信息</span><br><span class="line">Release     : 162.git64e9980.el7.centos</span><br><span class="line">Size        : 18 M     # 软件包大小</span><br><span class="line">Repo        : extras/7/x86_64   # 软件包仓库</span><br><span class="line">Summary     : Automates deployment of containerized applications</span><br><span class="line">URL         : https://github.com/docker/docker   # 软件包的url地址</span><br><span class="line">License     : ASL 2.0</span><br><span class="line">Description : Docker is an open-source engine that automates the deployment of any</span><br><span class="line">描述信息     : application as a lightweight, portable, self-sufficient container that will</span><br><span class="line">            : run virtually anywhere.</span><br><span class="line">            : </span><br><span class="line">            : Docker containers can encapsulate any payload, and will run consistently on</span><br><span class="line">            : and between virtually any server. The same container that a developer builds</span><br><span class="line">            : and tests on a laptop will run at scale, in production*, on VMs, bare-metal</span><br><span class="line">            : servers, OpenStack clusters, public instances, or combinations of the above.</span><br></pre></td></tr></table></figure>

<p>接下来，我们来查看阿里镜像网站上的docker的版本信息：</p>
<p>输入网址<a target="_blank" rel="noopener" href="https://mirrors.aliyun.com/%E8%BF%9B%E5%85%A5%E9%98%BF%E9%87%8C%E9%95%9C%E5%83%8F%E7%BD%91%E7%AB%99%EF%BC%8C%E9%80%89%E6%8B%A9docker-ce%E8%BF%9B%E5%85%A5%E5%AD%90%E9%A1%B5%E9%9D%A2(%E5%AD%90%E9%A1%B5%E9%9D%A2%E4%B8%AD%E6%9C%89Linux%E3%80%81mac%E3%80%81win%E4%B8%89%E4%B8%AA%E5%AD%90%E7%9B%AE%E5%BD%95)%EF%BC%8C%E9%80%89%E6%8B%A9%E5%AF%B9%E5%BA%94%E7%9A%84Linux%E5%AD%90%E7%9B%AE%E5%BD%95%E8%BF%9B%E5%85%A5Linux%E7%89%88%E6%9C%AC%E7%9A%84docker%E7%9B%AE%E5%BD%95%EF%BC%8C%E6%8E%A5%E4%B8%8B%E6%9D%A5%E9%80%89%E6%8B%A9%E7%B3%BB%E7%BB%9F%E7%89%88%E6%9C%AC(%E8%AF%A5%E9%A1%B5%E9%9D%A2%E6%98%BE%E7%A4%BA%E4%B8%BB%E8%A6%81%E7%9A%84Linux%E5%8F%91%E8%A1%8C%E7%89%88)%EF%BC%8C%E6%AD%A4%E5%A4%84%E6%A0%B9%E6%8D%AELinux%E7%B3%BB%E7%BB%9F%E7%89%88%E6%9C%AC%E8%BF%9B%E8%A1%8C%E9%80%89%E6%8B%A9%EF%BC%8C%E7%82%B9%E5%87%BB%E8%BF%9B%E5%85%A5centos%E5%AD%90%E7%9B%AE%E5%BD%95%EF%BC%8C%E5%A6%82%E4%B8%8B%E5%9B%BE%EF%BC%9A">https://mirrors.aliyun.com/进入阿里镜像网站，选择docker-ce进入子页面(子页面中有Linux、mac、win三个子目录)，选择对应的Linux子目录进入Linux版本的docker目录，接下来选择系统版本(该页面显示主要的Linux发行版)，此处根据Linux系统版本进行选择，点击进入centos子目录，如下图：</a></p>
<img src="/image-20200715151930491.png" alt="image-20200715151930491" style="zoom:67%;" />

<p>​        我们可以直接配置并使用该仓库进行docker的安装，如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装前关闭firewalld和selinux</span></span><br><span class="line">[root@docker ~]# yum install -y yum-utils device-mapper-persistent-data lvm2  # 安装必要的软件</span><br><span class="line">[root@docker ~]# yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo  # 添加docker仓库，添加完成后就是国内阿里源仓库了，如果下载了国外的docker镜像仓库，可将网址替换成国内源</span><br><span class="line">[root@docker ~]# yum clean all &amp;&amp; yum repolist</span><br><span class="line">repo id             repo name                             status</span><br><span class="line">base/7/x86_64       CentOS-7 - Base - mirrors.aliyun.com  10,070</span><br><span class="line">docker-ce-stable/x86_64    Docker CE Stable - x86_64      79</span><br><span class="line">epel/x86_64    Extra Packages for Enterprise Linux 7 - x86_64 13,376</span><br><span class="line">extras/7/x86_64    CentOS-7 - Extras - mirrors.aliyun.com   412</span><br><span class="line">updates/7/x86_64   CentOS-7 - Updates - mirrors.aliyun.com  890</span><br><span class="line">repolist: 24,827  # 配置完成后如上所示</span><br></pre></td></tr></table></figure>

<p>​        较旧的Docker版本称为docker或docker-engine。如果已安装这些程序，请卸载它们以及相关的依赖项。在进行安装之前先卸载系统自带的docker。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# rpm -qi docker-ce   # 查看docker是否已经安装，如果安装需卸载</span><br><span class="line">package docker-ce is not installed</span><br><span class="line">[root@docker ~]# rpm -qi docker</span><br><span class="line">package docker is not installed</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果显示已经安装了docker，需要使用下面的命令卸载docker，再安装新版本的docker</span></span><br><span class="line">[root@docker ~]# yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine</span><br></pre></td></tr></table></figure>

<p>安装docker</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# yum -y install docker-ce   # 主要安装了如下的软件</span><br><span class="line"><span class="meta">#</span><span class="bash"> 也可以安装指定版本的docker，使用yum时指定版本即可</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看docker版本信息</span></span><br><span class="line">[root@docker ~]# docker version  </span><br><span class="line">Client: Docker Engine - Community  # docker客户端信息</span><br><span class="line"> Version:           19.03.12</span><br><span class="line"> API version:       1.40</span><br><span class="line"> Go version:        go1.13.10</span><br><span class="line"> Git commit:        48a66213fe</span><br><span class="line"> Built:             Mon Jun 22 15:46:54 2020   # 安装时间</span><br><span class="line"> OS/Arch:           linux/amd64   # 系统类型</span><br><span class="line"> Experimental:      false</span><br><span class="line">Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</span><br><span class="line"><span class="meta">#</span><span class="bash"> 提示docker daemon未运行，运行后会显示docker daemon的信息</span></span><br><span class="line"></span><br><span class="line">[root@docker ~]# rpm -qi docker-ce  # 查看安装的docker-ce信息</span><br><span class="line">Name        : docker-ce</span><br><span class="line">Epoch       : 3</span><br><span class="line">Version     : 19.03.12</span><br><span class="line">Release     : 3.el7</span><br><span class="line">Architecture: x86_64</span><br><span class="line">Install Date: Wed 15 Jul 2020 03:32:29 PM CST</span><br><span class="line">Group       : Tools/Docker</span><br><span class="line">Size        : 106714688</span><br><span class="line">License     : ASL 2.0</span><br><span class="line">Signature   : RSA/SHA512, Tue 23 Jun 2020 05:21:51 AM CST, Key ID c52feb6b621e9f35</span><br><span class="line">Source RPM  : docker-ce-19.03.12-3.el7.src.rpm</span><br><span class="line">Build Date  : Mon 22 Jun 2020 11:46:41 PM CST</span><br><span class="line">Build Host  : 7d52e4e2ee0b</span><br><span class="line">Relocations : (not relocatable)</span><br><span class="line">Packager    : Docker &lt;support@docker.com&gt;</span><br><span class="line">Vendor      : Docker   # vendor [ˈvendər]  小贩，这里指软件提供厂商</span><br><span class="line">URL         : https://www.docker.com   # 官方url地址</span><br><span class="line">Summary     : The open-source application container engine</span><br><span class="line">Description :  # 描述信息</span><br><span class="line">Docker is a product for you to build, ship and run any application as a</span><br><span class="line">lightweight container.</span><br><span class="line"></span><br><span class="line">Docker containers are both hardware-agnostic and platform-agnostic. This means</span><br><span class="line">they can run anywhere, from your laptop to the largest cloud compute instance and</span><br><span class="line">everything in between - and they don&#x27;t require you to use a particular</span><br><span class="line">language, framework or packaging system. That makes them great building blocks</span><br><span class="line">for deploying and scaling web apps, databases, and backend services without</span><br><span class="line">depending on a particular stack or provider.</span><br></pre></td></tr></table></figure>

<p>​        到此，dockers就安装完成了。</p>
<p>​        给docker镜像加速，我们在创建容器的时候，是需要到官网上下载指定版本的软件的，因此下载镜像的快慢是我们必须关注的话题，一般可以使用官网的docker cn、阿里云加速器、中国科技大学加速器、163加速器等。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# ls /etc/docker</span><br><span class="line">ls: cannot access /etc/docker: No such file or directory</span><br><span class="line">[root@docker ~]# mkdir /etc/docker</span><br><span class="line">[root@docker ~]# vim /etc/docker/daemon.json # 镜像加速，自建该文件</span><br><span class="line">&#123;</span><br><span class="line">    &quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;,&quot;http://hub-mirror.c.163.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动docker</span></span><br><span class="line">[root@docker ~]# systemctl start docker  &amp;&amp; systemctl enable docker</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker version</span><br><span class="line">Client: Docker Engine - Community   # docker客户端信息</span><br><span class="line"> Version:           19.03.12</span><br><span class="line"> API version:       1.40</span><br><span class="line"> Go version:        go1.13.10</span><br><span class="line"> Git commit:        48a66213fe</span><br><span class="line"> Built:             Mon Jun 22 15:46:54 2020</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      false</span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community   # docker服务端信息</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          19.03.12</span><br><span class="line">  API version:      1.40 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.13.10</span><br><span class="line">  Git commit:       48a66213fe</span><br><span class="line">  Built:            Mon Jun 22 15:45:28 2020</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     false</span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.2.13</span><br><span class="line">  GitCommit:        7ad184331fa3e55e52b890ea95e65ba581ae3429</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.0-rc10</span><br><span class="line">  GitCommit:        dc9208a3303feef5b3839f4323d9beb36df0a9dd</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.18.0</span><br><span class="line">  GitCommit:        fec3683</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker info  # docker容器信息</span><br><span class="line">Client:</span><br><span class="line"> Debug Mode: false</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Containers: 0  # 容器</span><br><span class="line">  Running: 0    # 运行的容器个数</span><br><span class="line">  Paused: 0     # 暂停的容器个数</span><br><span class="line">  Stopped: 0    # 停止的容器个数</span><br><span class="line"> Images: 0      # docker镜像个数</span><br><span class="line"> Server Version: 19.03.12   # docker服务端版本</span><br><span class="line"> Storage Driver: overlay2   # 存储</span><br><span class="line">  Backing Filesystem: xfs   # 文件系统</span><br><span class="line">  Supports d_type: true</span><br><span class="line">  Native Overlay Diff: true</span><br><span class="line"> Logging Driver: json-file</span><br><span class="line"> Cgroup Driver: cgroupfs</span><br><span class="line"> Plugins:          # 插件</span><br><span class="line">  Volume: local</span><br><span class="line">  Network: bridge host ipvlan macvlan null overlay</span><br><span class="line">  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog</span><br><span class="line"> Swarm: inactive</span><br><span class="line"> Runtimes: runc</span><br><span class="line"> Default Runtime: runc</span><br><span class="line"> Init Binary: docker-init</span><br><span class="line"> containerd version: 7ad184331fa3e55e52b890ea95e65ba581ae3429</span><br><span class="line"> runc version: dc9208a3303feef5b3839f4323d9beb36df0a9dd</span><br><span class="line"> init version: fec3683</span><br><span class="line"> Security Options:    # 安全选项</span><br><span class="line">  seccomp</span><br><span class="line">   Profile: default</span><br><span class="line"> Kernel Version: 3.10.0-957.el7.x86_64   # 本地服务器内核版本</span><br><span class="line"> Operating System: CentOS Linux 7 (Core)  # 本地服务器操作系统</span><br><span class="line"> OSType: linux       # 操作系统类型</span><br><span class="line"> Architecture: x86_64    # 本地服务器架构</span><br><span class="line"> CPUs: 4     # cpu个数</span><br><span class="line"> Total Memory: 7.62GiB   # 本地服务器内存大小</span><br><span class="line"> Name: docker     # 本地服务器主机名</span><br><span class="line"> ID: CTSU:SHD4:IUXR:4NUI:BC2G:D2JO:OVS2:2VNN:3OP5:GOV5:EUO7:NI2A</span><br><span class="line"> Docker Root Dir: /var/lib/docker   # docker根目录</span><br><span class="line"> Debug Mode: false</span><br><span class="line"> Registry: https://index.docker.io/v1/   # 默认docker仓库地址</span><br><span class="line"> Labels:</span><br><span class="line"> Experimental: false</span><br><span class="line"> Insecure Registries:</span><br><span class="line">  127.0.0.0/8</span><br><span class="line"> Registry Mirrors:     # 加速镜像地址</span><br><span class="line">  https://registry.docker-cn.com/    # 在/etc/docker/daemon.json定义</span><br><span class="line">  http://hub-mirror.c.163.com/</span><br><span class="line"> Live Restore Enabled: false</span><br><span class="line"></span><br><span class="line">[root@docker ~]# ll  /var/lib/docker    # docker根目录下的文件夹</span><br><span class="line">total 4</span><br><span class="line">drwx--x--x  4 root root  120 Feb 15 10:49 buildkit</span><br><span class="line">drwx-----x  5 root root  222 Mar 31 19:51 containers   # 容器</span><br><span class="line">drwx------  3 root root   22 Feb 15 10:49 image        # 镜像</span><br><span class="line">drwxr-x---  3 root root   19 Feb 15 10:49 network      # 网络</span><br><span class="line">drwx-----x 19 root root 4096 Mar 31 19:51 overlay2</span><br><span class="line">drwx------  4 root root   32 Feb 15 10:49 plugins</span><br><span class="line">drwx------  2 root root    6 Mar 31 19:46 runtimes</span><br><span class="line">drwx------  2 root root    6 Feb 15 10:49 swarm</span><br><span class="line">drwx------  2 root root    6 Mar 31 19:46 tmp</span><br><span class="line">drwx------  2 root root    6 Feb 15 10:49 trust</span><br><span class="line">drwx-----x  2 root root   50 Mar 31 19:46 volumes     # 存储</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="meta"> #</span><span class="bash"> 安装完成后系统上将会多出一个docker0的网络</span></span><br><span class="line">[root@docker ~]# ifconfig  docker0  </span><br><span class="line"><span class="meta"> #</span><span class="bash"> 该网卡随着容器的运行而运行，如果没用容器运行该网卡状态为down</span></span><br><span class="line">docker0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        inet6 fe80::42:c0ff:febc:f72a  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 02:42:c0:bc:f7:2a  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 2  bytes 180 (180.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行容器后，会多出容器的IP信息，网络将后后面的章节详细讲解，这里不赘述</span></span><br></pre></td></tr></table></figure>

<p> Docker程序环境：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# rpm -ql docker-ce  # 默认安装的文件如下</span><br><span class="line">/usr/bin/docker-init</span><br><span class="line">/usr/bin/docker-proxy</span><br><span class="line">/usr/bin/dockerd</span><br><span class="line">/usr/lib/systemd/system/docker.service</span><br><span class="line">/usr/lib/systemd/system/docker.socket</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker的配置文件可手动新建</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># docker网络文件--/etc/sysconfig/docker-network</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># docker存储文件--/etc/sysconfig/docker-storage</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># docker主配置文件--/etc/sysconfig/docker</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Docker registry配置文件--/etc/conftainers/registries.conf</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Docker镜像加速文件--/etc/docker/daemon.json</span></span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-运行容器"><a href="#2-2-运行容器" class="headerlink" title="2.2 运行容器"></a>2.2 运行容器</h3><p>​        容器通过镜像启动。镜像出现在Docker生命周期中的<strong>构建和打包阶段</strong>，容器存在于<strong>启动和执行</strong>阶段。</p>
<p><img src="/v2-e1dfe4005b07181a1d5c5a7ae0fa32b8_720w.jpg" alt="img"></p>
<p>​        当一个容器启动时，Docker会在镜像的<strong>最顶层</strong>加载一个<strong>读写文件系统</strong>。程序就在这一层执行，第一个启动时，这一层是空的，当文件系统变化时，都会应用到这一层。</p>
<p>​        <strong>写时复制</strong>。如果想要修改一文件，就会先将它复制到可写层。</p>
<p><strong>Docker容器的能力 ：</strong></p>
<ul>
<li>文件系统隔离：每个容器都有自己的root文件系统。</li>
<li>进程隔离：每个容器都运行在自己的进程环境中。</li>
<li>网络隔离：容器间的虚拟网络接口和IP地址都是分开的。</li>
<li>资源隔离和分组：使用cgroups将CPU和内存之间的资源独立分配给每个Docker容器。</li>
</ul>
<h4 id="2-2-1-运行一次性容器"><a href="#2-2-1-运行一次性容器" class="headerlink" title="2.2.1 运行一次性容器"></a>2.2.1 运行一次性容器</h4><p>​        <strong>该类型的容器，执行完任务后就自动销毁。</strong></p>
<p>​        Docker 允许你在容器内运行应用程序， 使用 <strong>docker run</strong> 命令来在容器内运行一个应用程序。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 我们将分析运行过程</span></span><br><span class="line">[root@docker ~]# docker container run ubuntu:15.10 /bin/echo &quot;Hello world&quot;</span><br><span class="line">Unable to find image &#x27;ubuntu:15.10&#x27; locally # 提示本地没有ubuntu:15.10镜像</span><br><span class="line">15.10: Pulling from library/ubuntu  # 然后从仓库中下载指定镜像</span><br><span class="line">7dcf5a444392: Pull complete </span><br><span class="line">759aa75f3cee: Pull complete </span><br><span class="line">3fa871dc8a2b: Pull complete </span><br><span class="line">224c42ae46e7: Pull complete </span><br><span class="line">Digest: sha256:02521a2d079595241c6793b2044f02eecf294034f31d6e235ac4b2b54ffc41f3</span><br><span class="line">Status: Downloaded newer image for ubuntu:15.10  # 下载镜像完成</span><br><span class="line">Hello world  # 输出运行结果</span><br></pre></td></tr></table></figure>

<p>各个参数解析：</p>
<ul>
<li><strong>docker:</strong> Docker 的二进制执行文件。</li>
<li><strong>run:</strong> 与前面的 docker 组合来运行一个容器。</li>
<li><strong>ubuntu:15.10</strong> 指定要运行的镜像，Docker 首先从本地主机上查找镜像是否存在，如果不存在，Docker 就会从镜像仓库 Docker Hub 下载公共镜像。</li>
<li><strong>/bin/echo “Hello world”:</strong> 在启动的容器里执行的命令</li>
</ul>
<p>以上命令完整的意思可以解释为：Docker 以 ubuntu15.10 镜像创建一个新容器，然后在容器里执行 bin/echo “Hello world”，然后输出结果。</p>
<p>运行完成后docker自动停止，因为我们没有让该container一直运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker image ls </span><br><span class="line"><span class="meta">#</span><span class="bash"> 镜像        镜像标签        镜像的id         镜像创建时间          镜像大小</span></span><br><span class="line">REPOSITORY    TAG           IMAGE ID        CREATED             SIZE</span><br><span class="line">ubuntu        15.10         9b9cb95443b5    3 years ago         137MB</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker container ls   # 查看在运行的容器</span><br><span class="line"><span class="meta">#</span><span class="bash"> 容器id       镜像    运行的命令    创建时间   状态    端口    容器名称</span></span><br><span class="line">CONTAINER ID  IMAGE   COMMAND    CREATED   STATUS  PORTS  NAMES</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash">[root@docker ~]<span class="comment"># docker container ls  -a</span></span></span><br><span class="line">CONTAINER ID     IMAGE     COMMAND            CREATED    STATUS    PORTS  NAMES</span><br><span class="line">fa95ac9f0d3d     ubuntu:15.10  &quot;/bin/echo &#x27;Hello wo…&quot;   About a minute ago   Exited (0) About a minute ago    crazy_lehmann</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注意这里的两个About a minute ago，容器启动并执行了任务后就立马终止，要想不立马启动执行任务完成后就停止，那么就需要使用交互式模式或后台模式启动容器</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-运行交互式的容器"><a href="#2-2-2-运行交互式的容器" class="headerlink" title="2.2.2 运行交互式的容器"></a>2.2.2 运行交互式的容器</h4><p>​        <strong>该类型的容器，用户退出容器后，容器自动销毁，只要不退出窗口，容器会一直运行。</strong></p>
<p>​        我们通过 docker 的两个参数 -i -t，让 docker 运行的容器实现**”对话”**的能力：</p>
<p>常用参数解析：</p>
<ul>
<li><strong>-t:</strong> 在新容器内指定一个伪终端或终端</li>
<li><strong>-i:</strong> 允许你对容器内的标准输入 (STDIN) 进行交互，一般与-t一起使用</li>
<li><strong>-d</strong>：运行容器到后台</li>
<li><strong>-e</strong>：设置环境变量，可使用多个-e设置多个环境变量</li>
<li><strong>-p</strong>：发布容器端口到主机</li>
<li><strong>-P</strong>：发布容器的所有EXPOSE端口到宿主机的随机端口</li>
<li><strong>–name</strong>：设置运行容器的名称，唯一标识</li>
<li><strong>-h</strong>：设置容器的主机名，不设置的话，默认使用容器id前几位作为主机名，并写入hostname文件中</li>
<li><strong>–ip</strong>：指定容器的IP，只能用于自定义网络</li>
<li><strong>–dns</strong>：设置容器的DNS，容器默认会加载宿主机的resolv.conf文件</li>
<li><strong>–network</strong>：连接容器到一个网络，指定的网络(容器的网络)必须已经存在</li>
<li><strong>–mount</strong>：将文件系统附加到容器</li>
<li><strong>-v</strong>：绑定挂载一个卷</li>
<li><strong>–restart</strong>：容器退出时重启策略，默认为no，可选值为always，no-failure</li>
<li>资源限制参数，如果不限制容器使用的资源，容器默认使用宿主机的所有资源<ul>
<li>-m：设置容器能使用的最大内存量</li>
<li>–memory-swap=xxm：运行交换到磁盘的内存量</li>
<li>–memory-swappiness=&lt;0-100&gt;：rongqi 使用swap分区交换百分比，默认为-1</li>
<li>–oom-kill-disable：禁用OOM killer</li>
<li>–cpus：容器能够使用的cpu数量</li>
<li>–cpuset-cpus==0-3：限制容器使用特点的cpu核心，如0-3，0，2，注意cpu从0开始计算</li>
<li>–cpu-shares：cpu共享(相对权重)</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker run -i -t ubuntu:15.10 /bin/bash</span><br><span class="line">root@0e2bcf007d3e:/# ls  # 该容器的内部文件，显示root@0e2bcf007d3e:/后表示进入到容器内部</span><br><span class="line">bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"></span><br><span class="line">root@0e2bcf007d3e:/# uname  -a</span><br><span class="line">Linux 0e2bcf007d3e 3.10.0-957.el7.x86_64 #1 SMP Thu Nov 8 23:39:32 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@0e2bcf007d3e:/# echo &quot;hello docker!&quot;  # 在容器中执行Linux命令</span><br><span class="line">hello docker!</span><br><span class="line"></span><br><span class="line">root@0e2bcf007d3e:/# exit   # 退出后，容器就被销毁了</span><br><span class="line">exit</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果我们又想退出窗口，又不想终止该容器，怎么办呢？</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在容器内部，按住crl键+p+q三个键，先按住ctl键(不松开)，再按p键，最后按q键</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果还想回到上面的窗口，使用docker container attach +容器id/容器名</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用docker <span class="built_in">exec</span>将不能进入之前的窗口，而是打开了一个新窗口</span></span><br></pre></td></tr></table></figure>

<p>在未退出容器之前，我们重新开一个shell，查看docker的信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker info  # 显示有一个容器运行，一个停止，有一个镜像</span><br><span class="line">Client:</span><br><span class="line"> Debug Mode: false</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Containers: 2</span><br><span class="line">  Running: 1</span><br><span class="line">  Paused: 0</span><br><span class="line">  Stopped: 1</span><br><span class="line"> Images: 1</span><br><span class="line">·····</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看再运行的容器信息如下</span></span><br><span class="line">[root@docker ~]# docker container ls </span><br><span class="line">CONTAINER ID     IMAGE     COMMAND            CREATED    STATUS    PORTS  NAMES</span><br><span class="line">0e2bcf007d3e     ubuntu:15.10  &quot;/bin/bash&quot; 16 seconds ago  Up 15 seconds  epic_newton</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看所有容器(运行和未运行)信息</span></span><br><span class="line">[root@docker ~]# docker container ls  -a</span><br><span class="line">CONTAINER ID     IMAGE     COMMAND            CREATED    STATUS    PORTS  NAMES</span><br><span class="line">0e2bcf007d3e     ubuntu:15.10  &quot;/bin/bash&quot; 16 seconds ago  Up 15 seconds  epic_newton</span><br><span class="line">fa95ac9f0d3d     ubuntu:15.10  &quot;/bin/echo &#x27;Hello wo…&quot;  11 minutes ago  Exited (0) 11 minutes ago      crazy_lehmann</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 此时查看ip信息，省略lo和ens33两张网卡的信息：</span></span><br><span class="line">[root@docker ~]# ip a</span><br><span class="line">·····</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:c0:bc:f7:2a brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:c0ff:febc:f72a/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">9: vethec18bf2@if8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether aa:5f:ae:2b:63:d6 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::a85f:aeff:fe2b:63d6/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器的详细信息</span></span><br><span class="line">[root@docker ~]# docker inspect 0e2bcf007d3e  </span><br><span class="line"><span class="meta">#</span><span class="bash"> 此处的容器id为docker container ls查询出的id，关闭后重启容器，该id值将发生变化</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;0e2bcf007d3e250473914f2214ace1f6d5417357e8f7598cb525ff2f453d3abf&quot;, # 容器id</span><br><span class="line">        &quot;Created&quot;: &quot;2020-07-15T08:28:12.797341308Z&quot;,  # 新建容器时间</span><br><span class="line">        &quot;Path&quot;: &quot;/bin/bash&quot;,  </span><br><span class="line">        &quot;Args&quot;: [],</span><br><span class="line">        &quot;State&quot;: &#123;   # 容器的状态</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,  # 运行</span><br><span class="line">            &quot;Running&quot;: true,    # 正在运行</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 35071,   # 进行的pid，通过ps -ef | grep 35071 可以查看到该pid的进行信息</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2020-07-15T08:28:13.017085499Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;   </span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;:  # 容器使用的镜像信息和运行的绝对路径信息</span><br><span class="line">        &quot;sha256:9b9cb95443b5f846cd3c8cfa3f64e63b6ba68de2618a08875a119c81a8f96698&quot;,</span><br><span class="line">        &quot;ResolvConfPath&quot;:# 容器的绝对路径</span><br><span class="line">  &quot;/var/lib/docker/containers/0e2bcf007d3e250473914f2214ace1f6d5417357e8f7598cb525ff2f453d3abf/resolv.conf&quot;,</span><br><span class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/0e2bcf007d3e250473914f2214ace1f6d5417357e8f7598cb525ff2f453d3abf/hostname&quot;,</span><br><span class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/0e2bcf007d3e250473914f2214ace1f6d5417357e8f7598cb525ff2f453d3abf/hosts&quot;,</span><br><span class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/0e2bcf007d3e250473914f2214ace1f6d5417357e8f7598cb525ff2f453d3abf/0e2bcf007d3e250473914f2214ace1f6d5417357e8f7598cb525ff2f453d3abf-json.log&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;/heuristic_booth&quot;,</span><br><span class="line">        &quot;RestartCount&quot;: 0,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay2&quot;,</span><br><span class="line">        &quot;Platform&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;MountLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AppArmorProfile&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ExecIDs&quot;: null,</span><br><span class="line">        &quot;HostConfig&quot;: &#123;</span><br><span class="line">            &quot;Binds&quot;: null,</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;PortBindings&quot;: &#123;&#125;,</span><br><span class="line">            &quot;RestartPolicy&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;no&quot;,</span><br><span class="line">                &quot;MaximumRetryCount&quot;: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;AutoRemove&quot;: false,</span><br><span class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</span><br><span class="line">            &quot;VolumesFrom&quot;: null,</span><br><span class="line">            &quot;CapAdd&quot;: null,</span><br><span class="line">            &quot;CapDrop&quot;: null,</span><br><span class="line">            &quot;Capabilities&quot;: null,</span><br><span class="line">            &quot;Dns&quot;: [],</span><br><span class="line">            &quot;DnsOptions&quot;: [],</span><br><span class="line">            &quot;DnsSearch&quot;: [],</span><br><span class="line">            &quot;ExtraHosts&quot;: null,</span><br><span class="line">            &quot;GroupAdd&quot;: null,</span><br><span class="line">            &quot;IpcMode&quot;: &quot;private&quot;,</span><br><span class="line">            &quot;Cgroup&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Links&quot;: null,</span><br><span class="line">            &quot;OomScoreAdj&quot;: 0,</span><br><span class="line">            &quot;PidMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Privileged&quot;: false,</span><br><span class="line">            &quot;PublishAllPorts&quot;: false,</span><br><span class="line">            &quot;ReadonlyRootfs&quot;: false,</span><br><span class="line">            &quot;SecurityOpt&quot;: null,</span><br><span class="line">            &quot;UTSMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;ShmSize&quot;: 67108864,</span><br><span class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</span><br><span class="line">            &quot;ConsoleSize&quot;: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            &quot;Isolation&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpuShares&quot;: 0,</span><br><span class="line">            &quot;Memory&quot;: 0,</span><br><span class="line">            &quot;NanoCpus&quot;: 0,</span><br><span class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</span><br><span class="line">            &quot;BlkioWeight&quot;: 0,</span><br><span class="line">            &quot;BlkioWeightDevice&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceReadIOps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteIOps&quot;: null,</span><br><span class="line">            &quot;CpuPeriod&quot;: 0,</span><br><span class="line">            &quot;CpuQuota&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimePeriod&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</span><br><span class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Devices&quot;: [],</span><br><span class="line">            &quot;DeviceCgroupRules&quot;: null,</span><br><span class="line">            &quot;DeviceRequests&quot;: null,</span><br><span class="line">            &quot;KernelMemory&quot;: 0,</span><br><span class="line">            &quot;KernelMemoryTCP&quot;: 0,</span><br><span class="line">            &quot;MemoryReservation&quot;: 0,</span><br><span class="line">            &quot;MemorySwap&quot;: 0,</span><br><span class="line">            &quot;MemorySwappiness&quot;: null,</span><br><span class="line">            &quot;OomKillDisable&quot;: false,</span><br><span class="line">            &quot;PidsLimit&quot;: null,</span><br><span class="line">            &quot;Ulimits&quot;: null,</span><br><span class="line">            &quot;CpuCount&quot;: 0,</span><br><span class="line">            &quot;CpuPercent&quot;: 0,</span><br><span class="line">            &quot;IOMaximumIOps&quot;: 0,</span><br><span class="line">            &quot;IOMaximumBandwidth&quot;: 0,</span><br><span class="line">            &quot;MaskedPaths&quot;: [</span><br><span class="line">                &quot;/proc/asound&quot;,</span><br><span class="line">                &quot;/proc/acpi&quot;,</span><br><span class="line">                &quot;/proc/kcore&quot;,</span><br><span class="line">                &quot;/proc/keys&quot;,</span><br><span class="line">                &quot;/proc/latency_stats&quot;,</span><br><span class="line">                &quot;/proc/timer_list&quot;,</span><br><span class="line">                &quot;/proc/timer_stats&quot;,</span><br><span class="line">                &quot;/proc/sched_debug&quot;,</span><br><span class="line">                &quot;/proc/scsi&quot;,</span><br><span class="line">                &quot;/sys/firmware&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ReadonlyPaths&quot;: [</span><br><span class="line">                &quot;/proc/bus&quot;,</span><br><span class="line">                &quot;/proc/fs&quot;,</span><br><span class="line">                &quot;/proc/irq&quot;,</span><br><span class="line">                &quot;/proc/sys&quot;,</span><br><span class="line">                &quot;/proc/sysrq-trigger&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/ff16a32c0b96e85d19c86a809ffd62d63ad853f11518bdfa6e07b1b30b911c0e-init/diff:/var/lib/docker/overlay2/7b0037a8aafcf18688d9c17601dd4ecc75b6339e7f73a17ab83f26f2922ca9e7/diff:/var/lib/docker/overlay2/eb78645b5c86e6c9dded5eaf9fd15f2007da65e730663deb6b17d455320be3f2/diff:/var/lib/docker/overlay2/ac39c7f3c1f4701de1c3898fa26186579ee523463d88a52857dbe899ae258afe/diff:/var/lib/docker/overlay2/9f19d7f0e3016023666d32dcbd8592355b84ff1056aa1e95085e1e651ee19102/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/ff16a32c0b96e85d19c86a809ffd62d63ad853f11518bdfa6e07b1b30b911c0e/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/ff16a32c0b96e85d19c86a809ffd62d63ad853f11518bdfa6e07b1b30b911c0e/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/ff16a32c0b96e85d19c86a809ffd62d63ad853f11518bdfa6e07b1b30b911c0e/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Mounts&quot;: [],</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;0e2bcf007d3e&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: true,</span><br><span class="line">            &quot;AttachStdout&quot;: true,</span><br><span class="line">            &quot;AttachStderr&quot;: true,</span><br><span class="line">            &quot;Tty&quot;: true,</span><br><span class="line">            &quot;OpenStdin&quot;: true,</span><br><span class="line">            &quot;StdinOnce&quot;: true,</span><br><span class="line">            &quot;Env&quot;: [  # 环境变量</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [   # 默认允许的命令</span><br><span class="line">                &quot;/bin/bash&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;ubuntu:15.10&quot;,  # 使用的镜像名称</span><br><span class="line">            &quot;Volumes&quot;: null,  # 使用卷(存储)信息</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,  # 默认工作目录</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;NetworkSettings&quot;: &#123;  # 容器网络设置信息</span><br><span class="line">            &quot;Bridge&quot;: &quot;&quot;,  # 桥接信息</span><br><span class="line">            &quot;SandboxID&quot;: &quot;d1da8aaf46c12ec574ae824e3696bb1a020dda849b720e1673287464aacc2090&quot;,</span><br><span class="line">            &quot;HairpinMode&quot;: false,</span><br><span class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;Ports&quot;: &#123;&#125;,  # 使用的端口</span><br><span class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/d1da8aaf46c1&quot;,</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</span><br><span class="line">            &quot;EndpointID&quot;: &quot;a9a0746dbcafb0de315968d6b0ed61709584db5b0d3a1325ae4ccef56f799181&quot;,</span><br><span class="line">            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">            &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">            &quot;Networks&quot;: &#123;   # 网络详细信息</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;:   # 网络id信息</span><br><span class="line">                    &quot;b474a443cb3eed5a8e5915f61a4be93553de4f17d468d524525d801f1382ccd3&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: </span><br><span class="line">                    &quot;a9a0746dbcafb0de315968d6b0ed61709584db5b0d3a1325ae4ccef56f799181&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,  # 网关地址，即docker0的地址</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,  # 该容器的IP地址</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,  # 容器的mac地址</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="2-2-3-守护式-后台运行-容器"><a href="#2-2-3-守护式-后台运行-容器" class="headerlink" title="2.2.3 守护式(后台运行)容器"></a>2.2.3 守护式(后台运行)容器</h4><p>​        <strong>该模式下，容器会一直处于运行状态，除非我们手动终止或设置了终止时间</strong></p>
<ul>
<li>-d 表示将容器运行于后台，在这个过程中，可以进入容器，也可以停止容器</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker run -d ubuntu:15.10 /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot;  # 以后台模式启动一个容器，让容器一直输出&quot;hello world&quot;</span><br><span class="line">a67eafc7e2d056b52adebaeabe968746782efacaa9a2709f1fa8cf002df60448  # 输出了容器的id信息</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker ps  # 查看正在运行的容器进行信息</span><br><span class="line"><span class="meta">#</span><span class="bash"> 容器 ID        镜像    启动时运行的命令 创建时间   状态          端口或连接类型    容器名称</span></span><br><span class="line">CONTAINER ID     IMAGE    COMMAND    CREATED        STATUS       PORTS         NAMES</span><br><span class="line">a67eafc7e2d0     ubuntu:15.10   &quot;/bin/sh -c &#x27;while t…&quot;   About a minute ago   Up About a minute   charming_leavitt</span><br><span class="line">[root@docker ~]# docker logs a67eafc7e2d0  | wc -l  # 查看容器的日志信息</span><br><span class="line">109</span><br><span class="line">[root@docker ~]# docker logs a67eafc7e2d0  | wc -l  # 隔1分钟左右后再次查看</span><br><span class="line">200</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入容器内部查看，此处可以用容器id或容器名称，推荐使用<span class="built_in">exec</span>进入(退出后容器不终止)，而不是attach</span></span><br><span class="line">[root@docker ~]# docker exec -it a67eafc7e2d0 /bin/bash </span><br><span class="line">root@a67eafc7e2d0:/# ps -ef  # 此时等于是重新开了一个连接终端，查看该容器内的程序</span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 09:14 ?        00:00:00 /bin/sh -c while true; do echo hello world; sleep 1; done  # pid为1进程</span><br><span class="line">root         33      0  0 09:15 pts/0    00:00:00 /bin/bash  # 这是刚执行进入时打开的shell</span><br><span class="line">root         58      1  0 09:15 ?        00:00:00 sleep 1</span><br><span class="line">root         59     33  0 09:15 pts/0    00:00:00 ps -ef  # 这是在容器内输入的命令</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用attach进入连接的是运行pid为1的命令的shell</span></span><br><span class="line">[root@docker ~]# docker attach a67eafc7e2d0</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world  # 此时一直在输出该信息，退出后容器就终止了</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止容器，此处可以用容器id或容器名称</span></span><br><span class="line">[root@docker ~]# docker stop a67eafc7e2d0</span><br></pre></td></tr></table></figure>

<p><code>docker ps</code> 命令中的<strong>STATUS:</strong> 容器状态解释</p>
<p>状态有7种：</p>
<ul>
<li>created（已创建）</li>
<li>restarting（重启中）</li>
<li>running（运行中）</li>
<li>removing（迁移中）</li>
<li>paused（暂停）</li>
<li>exited（停止）</li>
<li>dead（死亡）</li>
</ul>
<h4 id="2-2-4-三种容器运行方式的总结"><a href="#2-2-4-三种容器运行方式的总结" class="headerlink" title="2.2.4 三种容器运行方式的总结"></a>2.2.4 三种容器运行方式的总结</h4><ul>
<li><p>容器(镜像)是为了完成特定的任务而制作的，任务完成后，容器就应该被停止，基于这种思想，上面三种容器实质上都是一次性容器，只是工作时间长短的区别</p>
</li>
<li><p>如何让一个容器成为一个长时间(永久)运行的容器</p>
<ul>
<li>以交互式方式启动容器，然后永远不退出当前shell或使用ctrl +p,q退出当前shell</li>
<li>启动容器时给容器执行死循环任务</li>
<li>启动容器时加入后台运行</li>
</ul>
</li>
<li><p>交互式容器跟后台容器的关系：其实简单来说，后台容器是在交互式容器的基础上加了一个<code>-d参数</code>罢了</p>
</li>
</ul>
<p><img src="/image-20200717002403131.png" alt="image-20200717002403131"></p>
<p>值得注意的是，我们仍然可以通过其他的shell通过命令<code>docker attach + 容器id/容器名</code>进入当前容器运行的shell或使用<code>docker exec</code>进入当前shell的子进程，并不是说我们就不能管理该容器</p>
<p>限制容器使用资源的举例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@docker20 ~]# docker run -d -m 512m --cpus=&#x27;.5&#x27; nginx</span><br><span class="line">dc6d2297d670ff91bc2dc1fe0e1f7c38563d6f0279a26e4664d7c87ec96ea86b</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker stats + 容器id：显示容器资源的使用率</span></span><br><span class="line">[root@docker20 ~]# docker stats dc6d2297d670ff91bc2dc1fe0e1f7c38563d6f0279a26e4664d7c87ec96ea86b</span><br><span class="line">CONTAINER ID   NAME              CPU %     MEM USAGE / LIMIT   MEM %     NET I/O   BLOCK I/O         PIDS</span><br><span class="line">dc6d2297d670   vibrant_hawking   0.00%     1.945MiB / 512MiB   0.38%     656B / 0B   18.7MB / 21.5kB   2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改容器资源限制</span></span><br><span class="line">[root@docker20 ~]# docker update --help</span><br><span class="line"></span><br><span class="line">Usage:  docker update [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line"></span><br><span class="line">Update configuration of one or more containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --blkio-weight uint16        Block IO (relative weight), between 10 and 1000, or 0 to disable (default 0)</span><br><span class="line">      --cpu-period int             Limit CPU CFS (Completely Fair Scheduler) period</span><br><span class="line">      --cpu-quota int              Limit CPU CFS (Completely Fair Scheduler) quota</span><br><span class="line">      --cpu-rt-period int          Limit the CPU real-time period in microseconds</span><br><span class="line">      --cpu-rt-runtime int         Limit the CPU real-time runtime in microseconds</span><br><span class="line">  -c, --cpu-shares int             CPU shares (relative weight)</span><br><span class="line">      --cpus decimal               Number of CPUs</span><br><span class="line">      --cpuset-cpus string         CPUs in which to allow execution (0-3, 0,1)</span><br><span class="line">      --cpuset-mems string         MEMs in which to allow execution (0-3, 0,1)</span><br><span class="line">      --kernel-memory bytes        Kernel memory limit</span><br><span class="line">  -m, --memory bytes               Memory limit</span><br><span class="line">      --memory-reservation bytes   Memory soft limit</span><br><span class="line">      --memory-swap bytes          Swap limit equal to memory plus swap: &#x27;-1&#x27; to enable unlimited swap</span><br><span class="line">      --pids-limit int             Tune container pids limit (set -1 for unlimited)</span><br><span class="line">      --restart string             Restart policy to apply when a container exits</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# docker update -m 1G dc6d2297d670ff91bc2dc1fe0e1f7c38563d6f0279a26e4664d7c87ec96ea86b</span><br><span class="line">dc6d2297d670ff91bc2dc1fe0e1f7c38563d6f0279a26e4664d7c87ec96ea86b</span><br><span class="line">[root@docker20 ~]# docker stats dc6d2297d670ff91bc2dc1fe0e1f7c38563d6f0279a26e4664d7c87ec96ea86b</span><br><span class="line"><span class="meta">#</span><span class="bash"> 内存值从512M变成了1G</span></span><br><span class="line">CONTAINER ID   NAME              CPU %     MEM USAGE / LIMIT   MEM %   NET I/O   BLOCK I/O         PIDS</span><br><span class="line">dc6d2297d670   vibrant_hawking   0.00%     1.945MiB / 1GiB     0.19%   656B / 0B 18.7MB / 21.5kB   2</span><br></pre></td></tr></table></figure>



<h3 id="2-3-docker生命周期"><a href="#2-3-docker生命周期" class="headerlink" title="2.3 docker生命周期"></a>2.3 docker生命周期</h3><p>​        Docker采用C/S架构，<code>Docker daemon </code>作为服务端接受来自客户的请求，并处理这些请求（创建、运行、分发容器）。 客户端和服务端既可以运行在一个机器上，也可通过 socket 或者RESTful API 来进行通信。</p>
<p>​        此处docker生命周期不包含镜像制作，镜像制作请参考后续章节。</p>
<p><img src="/image-20200717180651705.png" alt="image-20200717180651705"></p>
<center>docker生命周期全景图</center>

<h4 id="2-3-1-docker客户端命令"><a href="#2-3-1-docker客户端命令" class="headerlink" title="2.3.1 docker客户端命令"></a>2.3.1 docker客户端命令</h4><p>​        docker 客户端非常简单 ,我们可以直接输入 docker 命令来查看到 Docker 客户端的所有命令选项。</p>
<ul>
<li>docker命令解析，下面展示通过三个命令查看docker的命令方法<ul>
<li>命令格式：<code>docker [OPTIONS] COMMAND</code></li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_16_8_centos ~]# docker [--help]</span><br><span class="line"></span><br><span class="line">Usage:	docker [OPTIONS] COMMAND</span><br><span class="line"></span><br><span class="line">A self-sufficient runtime for containers</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --config string      Location of client config files (default &quot;/root/.docker&quot;)</span><br><span class="line">  -c, --context string     Name of the context to use to connect to the daemon (overrides DOCKER_HOST env var and default context</span><br><span class="line">                           set with &quot;docker context use&quot;)</span><br><span class="line">  -D, --debug              Enable debug mode</span><br><span class="line">  -H, --host list          Daemon socket(s) to connect to</span><br><span class="line">  -l, --log-level string   Set the logging level (&quot;debug&quot;|&quot;info&quot;|&quot;warn&quot;|&quot;error&quot;|&quot;fatal&quot;) (default &quot;info&quot;)</span><br><span class="line">      --tls                Use TLS; implied by --tlsverify</span><br><span class="line">      --tlscacert string   Trust certs signed only by this CA (default &quot;/root/.docker/ca.pem&quot;)</span><br><span class="line">      --tlscert string     Path to TLS certificate file (default &quot;/root/.docker/cert.pem&quot;)</span><br><span class="line">      --tlskey string      Path to TLS key file (default &quot;/root/.docker/key.pem&quot;)</span><br><span class="line">      --tlsverify          Use TLS and verify the remote</span><br><span class="line">  -v, --version            Print version information and quit</span><br><span class="line"></span><br><span class="line">Management Commands:  # 管理命令</span><br><span class="line">  builder     Manage builds</span><br><span class="line">  config      Manage Docker configs</span><br><span class="line">  container   Manage containers  # 管理容器</span><br><span class="line">  context     Manage contexts</span><br><span class="line">  engine      Manage the docker engine  # 管理docker引擎</span><br><span class="line">  image       Manage images     # 管理镜像</span><br><span class="line">  network     Manage networks   # 管理网络</span><br><span class="line">  node        Manage Swarm nodes</span><br><span class="line">  plugin      Manage plugins    # 管理插件</span><br><span class="line">  secret      Manage Docker secrets</span><br><span class="line">  service     Manage services   # 管理服务</span><br><span class="line">  stack       Manage Docker stacks</span><br><span class="line">  swarm       Manage Swarm</span><br><span class="line">  system      Manage Docker    # 管理docker的启停</span><br><span class="line">  trust       Manage trust on Docker images</span><br><span class="line">  volume      Manage volumes   # 管理存储卷</span><br><span class="line"></span><br><span class="line">Commands: # 这下面的所有命令都可以通过docker COMMAND --help查看更详细命令</span><br><span class="line">  attach      Attach local standard input, output, and error streams to a running container  # 进入本地一个运行的容器</span><br><span class="line">  build       Build an image from a Dockerfile  # 新家一个docker镜像</span><br><span class="line">  commit      Create a new image from a container&#x27;s changes</span><br><span class="line">  cp          Copy files/folders between a container and the local filesystem</span><br><span class="line">  create      Create a new container  # 创建一个容器</span><br><span class="line">  diff        Inspect changes to files or directories on a container&#x27;s filesystem</span><br><span class="line">  events      Get real time events from the server</span><br><span class="line">  exec        Run a command in a running container  # 进入一个运行的容器</span><br><span class="line">  export      Export a container&#x27;s filesystem as a tar archive</span><br><span class="line">  history     Show the history of an image  # 查看docker镜像历史命令</span><br><span class="line">  images      List images  # 列出当前系统上的docker镜像</span><br><span class="line">  import      Import the contents from a tarball to create a filesystem image</span><br><span class="line">  info        Display system-wide information</span><br><span class="line">  inspect     Return low-level information on Docker objects</span><br><span class="line">  kill        Kill one or more running containers  # 杀掉运行中的容器</span><br><span class="line">  load        Load an image from a tar archive or STDIN </span><br><span class="line"><span class="meta">  #</span><span class="bash"> 从tar文件laod一个镜像</span></span><br><span class="line">  login       Log in to a Docker registry  # 登录docker hub仓库</span><br><span class="line">  logout      Log out from a Docker registry  # 登出docker hub仓库</span><br><span class="line">  logs        Fetch the logs of a container  # 查看容器日志</span><br><span class="line">  pause       Pause all processes within one or more containers</span><br><span class="line">  port        List port mappings or a specific mapping for the container</span><br><span class="line">  ps          List containers   # 查看容器进程信息</span><br><span class="line">  pull        Pull an image or a repository from a registry </span><br><span class="line"><span class="meta">  #</span><span class="bash"> 从仓库中下载镜像</span></span><br><span class="line">  push        Push an image or a repository to a registry</span><br><span class="line"><span class="meta">  #</span><span class="bash"> 将本地镜像推送到仓库，需要先登录，进行认证后才能推送镜像到仓库</span></span><br><span class="line">  rename      Rename a container  # 重命名容器</span><br><span class="line">  restart     Restart one or more containers  # 重启容器</span><br><span class="line">  rm          Remove one or more containers   # 删除容器</span><br><span class="line">  rmi         Remove one or more images       # 删除镜像</span><br><span class="line">  run         Run a command in a new container  # 运行容器</span><br><span class="line">  save        Save one or more images to a tar archive (streamed to STDOUT by default)  # 将镜像文件保存为tar文件</span><br><span class="line">  search      Search the Docker Hub for images</span><br><span class="line">  start       Start one or more stopped containers</span><br><span class="line">  stats       Display a live stream of container(s) resource usage statistics</span><br><span class="line">  stop        Stop one or more running containers</span><br><span class="line">  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span><br><span class="line">  top         Display the running processes of a container</span><br><span class="line">  unpause     Unpause all processes within one or more containers</span><br><span class="line">  update      Update configuration of one or more containers</span><br><span class="line">  version     Show the Docker version information</span><br><span class="line">  wait        Block until one or more containers stop, then print their exit codes</span><br><span class="line"></span><br><span class="line">Run &#x27;docker COMMAND --help&#x27; for more information on a command.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>查看<code>docker container</code>命令的帮助信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_16_8_centos ~]# docker container --help</span><br><span class="line"></span><br><span class="line">Usage:	docker container COMMAND</span><br><span class="line"></span><br><span class="line">Manage containers</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  attach      Attach local standard input, output, and error streams to a running container</span><br><span class="line">  commit      Create a new image from a container&#x27;s changes</span><br><span class="line">  cp          Copy files/folders between a container and the local filesystem</span><br><span class="line">  create      Create a new container</span><br><span class="line">  diff        Inspect changes to files or directories on a container&#x27;s filesystem</span><br><span class="line">  exec        Run a command in a running container</span><br><span class="line">  export      Export a container&#x27;s filesystem as a tar archive</span><br><span class="line">  inspect     Display detailed information on one or more containers</span><br><span class="line">  kill        Kill one or more running containers</span><br><span class="line">  logs        Fetch the logs of a container</span><br><span class="line">  ls          List containers</span><br><span class="line">  pause       Pause all processes within one or more containers</span><br><span class="line">  port        List port mappings or a specific mapping for the container</span><br><span class="line">  prune       Remove all stopped containers</span><br><span class="line">  rename      Rename a container</span><br><span class="line">  restart     Restart one or more containers</span><br><span class="line">  rm          Remove one or more containers</span><br><span class="line">  run         Run a command in a new container</span><br><span class="line">  start       Start one or more stopped containers</span><br><span class="line">  stats       Display a live stream of container(s) resource usage statistics</span><br><span class="line">  stop        Stop one or more running containers</span><br><span class="line">  top         Display the running processes of a container</span><br><span class="line">  unpause     Unpause all processes within one or more containers</span><br><span class="line">  update      Update configuration of one or more containers</span><br><span class="line">  wait        Block until one or more containers stop, then print their exit codes</span><br><span class="line"></span><br><span class="line">Run &#x27;docker container COMMAND --help&#x27; for more information on a command.</span><br></pre></td></tr></table></figure>

<p>详细解释如下：</p>
<table>
<thead>
<tr>
<th>attach</th>
<th>将本地标准输入、输出和错误流附加到正在运行的容器</th>
</tr>
</thead>
<tbody><tr>
<td><strong>commit</strong></td>
<td>根据容器的更改创建新图像</td>
</tr>
<tr>
<td><strong>cp</strong></td>
<td>在容器和本地文件系统之间复制文件/文件夹</td>
</tr>
<tr>
<td><strong>create</strong></td>
<td>创建新容器</td>
</tr>
<tr>
<td><strong>diff</strong></td>
<td>检查对容器文件系统上的文件或目录的更改</td>
</tr>
<tr>
<td><strong>exec</strong></td>
<td>在正在运行的容器中运行命令</td>
</tr>
<tr>
<td><strong>export</strong></td>
<td>将一个容器的文件系统导出为tar存档，跟save有本质区别</td>
</tr>
<tr>
<td><strong>inspect</strong></td>
<td>显示一个或多个容器上的详细信息</td>
</tr>
<tr>
<td><strong>kill</strong></td>
<td>杀死一个或多个正在运行的容</td>
</tr>
<tr>
<td><strong>logs</strong></td>
<td>获取容器的日志</td>
</tr>
<tr>
<td><strong>ls</strong></td>
<td>列表容器</td>
</tr>
<tr>
<td><strong>pause</strong></td>
<td>暂停一个或多个容器中的所有进程</td>
</tr>
<tr>
<td><strong>port</strong></td>
<td>列表端口映射或容器的特定映射</td>
</tr>
<tr>
<td><strong>prune</strong></td>
<td>删除所有停止的容器</td>
</tr>
<tr>
<td><strong>rename</strong></td>
<td>重命名容器</td>
</tr>
<tr>
<td><strong>restart</strong></td>
<td>重新启动一个或多个容器</td>
</tr>
<tr>
<td><strong>rm</strong></td>
<td>移除一个或多个容器</td>
</tr>
<tr>
<td><strong>run</strong></td>
<td>运行新容器中命令</td>
</tr>
<tr>
<td><strong>start</strong></td>
<td>启动一个或多个停止的容器(容器已存在)</td>
</tr>
<tr>
<td><strong>stats</strong></td>
<td>显示容器资源使用统计的实时流</td>
</tr>
<tr>
<td><strong>stop</strong></td>
<td>停止一个或多个正在运行的容器</td>
</tr>
<tr>
<td><strong>top</strong></td>
<td>显示容器的运行进程</td>
</tr>
<tr>
<td><strong>unpause</strong></td>
<td>取消暂停一个或多个容器中的所有进程</td>
</tr>
<tr>
<td><strong>update</strong></td>
<td>更新一个或多个容器的更新配置</td>
</tr>
<tr>
<td><strong>wait</strong></td>
<td>等待块，直到一个或多个容器停止，然后打印它们的退出代码</td>
</tr>
</tbody></table>
<p>查看<code>docker container ls</code>命令的帮助信息，通过<code>docker container ls</code>可以查看系统上正在运行的容器，加上选项<code>-a</code>可以查看本机上所有容器(状态为运行中和停止中的容器)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_16_8_centos ~]# docker container ls --help</span><br><span class="line"></span><br><span class="line">Usage:	docker container ls [OPTIONS]  # 命令格式</span><br><span class="line">List containers   # 列出容器</span><br><span class="line">Aliases:</span><br><span class="line">  ls, ps, list</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -a, --all             Show all containers (default shows just running)  # 显示说有容器，包括运行和未运行的</span><br><span class="line">  -f, --filter filter   Filter output based on conditions provided</span><br><span class="line">      --format string   Pretty-print containers using a Go template</span><br><span class="line">  -n, --last int        Show n last created containers (includes all states) (default -1)  # 指定显示n个最近创建的容器</span><br><span class="line">  -l, --latest          Show the latest created container (includes all states)  # 显示最近创建的容器</span><br><span class="line">      --no-trunc        Don&#x27;t truncate output</span><br><span class="line">  -q, --quiet           Only display numeric IDs  # 只显示容器id</span><br><span class="line">  -s, --size            Display total file sizes  # 显示文件大小</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-3-2-获取镜像"><a href="#2-3-2-获取镜像" class="headerlink" title="2.3.2 获取镜像"></a>2.3.2 获取镜像</h4><p>​        镜像是容器运行的根本，<code>docker daemon</code>收到用户<code>docker run</code>的命令后，首先检查本地是否存在运行容器的镜像，如果不存在则先向仓库请求下载镜像，下载完成后再运行</p>
<ul>
<li>下载镜像(由于本地下载半天未下载下来，因此这里选择在腾讯云上下载，下载完成后通过<code>docker save</code>命令将镜像文件保存为tar文件并下载到本地docker测试机上，再通过<code>docker load</code>命令还原成镜像文件)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_16_8_centos ~]# docker search nginx   # 搜索指定名称镜像</span><br><span class="line">[root@VM_16_8_centos ~]# docker search nginx  --filter=stars=1000  # 搜索星星数大于1000的nginx镜像</span><br><span class="line"></span><br><span class="line">[root@VM_16_8_centos ~]# docker pull nginx     # 从仓库下载镜像</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">8559a31e96f4: Pull complete </span><br><span class="line">1cf27aa8120b: Pull complete </span><br><span class="line">67d252a8c1e1: Pull complete </span><br><span class="line">9c2b660fcff6: Pull complete </span><br><span class="line">4584011f2cd1: Pull complete </span><br><span class="line">Digest: sha256:a93c8a0b0974c967aebe868a186e5c205f4d3bcb5423a56559f2f9599074bbcd</span><br><span class="line">Status: Downloaded newer image for nginx:latest</span><br><span class="line">docker.io/library/nginx:latest</span><br><span class="line"></span><br><span class="line">[root@VM_16_8_centos ~]# docker image ls </span><br><span class="line">REPOSITORY    TAG           IMAGE ID        CREATED         SIZE</span><br><span class="line">nginx         latest        0901fa9da894    4 days ago      132MB</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# docker image history nginx   # 查看容器制作的历史命令(过程)</span><br><span class="line">IMAGE          CREATED        CREATED BY                                      SIZE      COMMENT</span><br><span class="line">0901fa9da894   8 months ago   /bin/sh -c #(nop)  CMD [&quot;nginx&quot; &quot;-g&quot; &quot;daemon…   0B        </span><br><span class="line">&lt;missing&gt;      8 months ago   /bin/sh -c #(nop)  STOPSIGNAL SIGTERM           0B        </span><br><span class="line">&lt;missing&gt;      8 months ago   /bin/sh -c #(nop)  EXPOSE 80                    0B        </span><br><span class="line">&lt;missing&gt;      8 months ago   /bin/sh -c #(nop)  ENTRYPOINT [&quot;/docker-entr…   0B        </span><br><span class="line">&lt;missing&gt;      8 months ago   /bin/sh -c #(nop) COPY file:0fd5fca330dcd6a7…   1.04kB    </span><br><span class="line">&lt;missing&gt;      8 months ago   /bin/sh -c #(nop) COPY file:1d0a4127e78a26c1…   1.96kB    </span><br><span class="line">&lt;missing&gt;      8 months ago   /bin/sh -c #(nop) COPY file:e7e183879c35719c…   1.2kB     </span><br><span class="line">&lt;missing&gt;      8 months ago   /bin/sh -c set -x     &amp;&amp; addgroup --system -…   63.3MB    </span><br><span class="line">&lt;missing&gt;      8 months ago   /bin/sh -c #(nop)  ENV PKG_RELEASE=1~buster     0B        </span><br><span class="line">&lt;missing&gt;      8 months ago   /bin/sh -c #(nop)  ENV NJS_VERSION=0.4.2        0B        </span><br><span class="line">&lt;missing&gt;      8 months ago   /bin/sh -c #(nop)  ENV NGINX_VERSION=1.19.1     0B        </span><br><span class="line">&lt;missing&gt;      9 months ago   /bin/sh -c #(nop)  LABEL maintainer=NGINX Do…   0B        </span><br><span class="line">&lt;missing&gt;      9 months ago   /bin/sh -c #(nop)  CMD [&quot;bash&quot;]                 0B        </span><br><span class="line">&lt;missing&gt;      9 months ago   /bin/sh -c #(nop) ADD file:4d35f6c8bbbe6801c…   69.2MB  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将该镜像保存为tar文件，并上传到本地服务器使用</span></span><br><span class="line">[root@VM_16_8_centos ~]# docker save  -o nginx.tar nginx    # save和load是针对镜像导出(入)</span><br><span class="line"><span class="meta">#</span><span class="bash"> -o 表示输出的tar文件名称，后面的nginx表示镜像名称，如果是多个镜像，可继续写镜像名称</span></span><br></pre></td></tr></table></figure>

<p>导入本地docker测试机后</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker load --help  # docker load的用法</span><br><span class="line">Usage:	docker load [OPTIONS]</span><br><span class="line">Load an image from a tar archive or STDIN</span><br><span class="line">Options:</span><br><span class="line">  -i, --input string   Read from tar archive file, instead of STDIN</span><br><span class="line">  -q, --quiet          Suppress the load output</span><br><span class="line"></span><br><span class="line">[root@docker ~]# ll nginx.tar  -h </span><br><span class="line">-rw-r--r-- 1 root root 131M Jul 15 21:09 nginx.tar</span><br><span class="line">[root@docker ~]# ll nginx.tar  -h </span><br><span class="line">-rw-r--r-- 1 root root 131M Jul 15 21:09 nginx.tar</span><br><span class="line">[root@docker ~]# docker load -i nginx.tar </span><br><span class="line">2808ec4a8ea7: Loading layer [==================================================&gt;]  3.584kB/3.584kB</span><br><span class="line">Loaded image: nginx:latest</span><br><span class="line">[root@docker ~]# docker image ls </span><br><span class="line">REPOSITORY    TAG           IMAGE ID        CREATED         SIZE</span><br><span class="line">nginx         latest        0901fa9da894    4 days ago      132MB</span><br><span class="line">ubuntu        15.10         9b9cb95443b5    3 years ago     137MB</span><br></pre></td></tr></table></figure>

<h4 id="2-3-3-启动容器"><a href="#2-3-3-启动容器" class="headerlink" title="2.3.3 启动容器"></a>2.3.3 启动容器</h4><p>以下命令使用 nginx镜像启动一个容器，参数为以命令行模式进入该容器：</p>
<ul>
<li><p>常用命令参数</p>
<ul>
<li><code>-i -t</code> 运行容器后打开交互式终端，进入容器</li>
<li><code>-d</code> 在后台运行容器，即使用<code>exit</code>命令退出容易也不终止容器的运行</li>
<li><code>--name </code> 指定容器的名称</li>
<li><code>-P</code> 暴露随机端口，让外部网络访问，如果不暴露端口，则只有本地主机能访问，外部网络不能访问</li>
<li><code>-p 8080:80</code>  暴露指定端口，即将主机的8080端口映射给容器的80端口，外露网络通过访问主机ip:8080就可以访问到容器的80端口</li>
</ul>
<blockquote>
<p>容器启动后，默认是可以访问外部网络和本地主机上的其他容器，只是不能被外部访问而已</p>
</blockquote>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker run -d -P --name webapp nginx:latest /bin/bash </span><br></pre></td></tr></table></figure>

<p>启动容器后，我们可以通过<code>docker ps</code>或<code>docker container ls</code>获取容器的<code>CONTAINER ID</code>或<code>NAMES</code>对容器进行管理</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 只启动容器，不立马进入容器</span></span><br><span class="line">[root@docker ~]# docker container start 79a9b0e8c074</span><br><span class="line">79a9b0e8c074</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 我们可以在启动容器时，就立马进入容器</span></span><br><span class="line">[root@docker ~]# docker container start -i 79a9b0e8c074</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker ps</span><br><span class="line">CONTAINER ID  IMAGE   COMMAND   CREATED    STATUS     PORTS    NAMES</span><br><span class="line">79a9b0e8c074  0901fa9da894 &quot;/docker-entrypoint.…&quot;   26 hours ago        Up 5 seconds     0.0.0.0:32769-&gt;80/tcp   webapp</span><br><span class="line">[root@docker ~]# docker container ls </span><br><span class="line">CONTAINER ID  IMAGE   COMMAND   CREATED    STATUS     PORTS    NAMES</span><br><span class="line">79a9b0e8c074  0901fa9da894  &quot;/docker-entrypoint.…&quot;   26 hours ago        Up 14 seconds       0.0.0.0:32769-&gt;80/tcp   webapp</span><br></pre></td></tr></table></figure>

<h4 id="2-3-4-获取容器的详细信息"><a href="#2-3-4-获取容器的详细信息" class="headerlink" title="2.3.4 获取容器的详细信息"></a>2.3.4 获取容器的详细信息</h4><blockquote>
<p>可以获取容器的网络(IP地址)，端口信息(容器端口和主机端口映射关系)，存储，启动容器后运行的脚本等信息</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker container inspect 79a9b0e8c074</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;79a9b0e8c0745bff1f4b4333e53dc738bbb3bf2015591220069fffe010e0024c&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2020-07-15T13:17:36.663642734Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/docker-entrypoint.sh&quot;,</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;/bin/bash&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 12148,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2020-07-16T14:51:07.597037016Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;2020-07-16T08:29:53.611158447Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:0901fa9da894a8e9de5cb26d6749eaffb67b373dc1ff8a26c46b23b1175c913a&quot;,</span><br><span class="line">        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/79a9b0e8c0745bff1f4b4333e53dc738bbb3bf2015591220069fffe010e0024c/resolv.conf&quot;,</span><br><span class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/79a9b0e8c0745bff1f4b4333e53dc738bbb3bf2015591220069fffe010e0024c/hostname&quot;,</span><br><span class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/79a9b0e8c0745bff1f4b4333e53dc738bbb3bf2015591220069fffe010e0024c/hosts&quot;,</span><br><span class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/79a9b0e8c0745bff1f4b4333e53dc738bbb3bf2015591220069fffe010e0024c/79a9b0e8c0745bff1f4b4333e53dc738bbb3bf2015591220069fffe010e0024c-json.log&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;/webapp&quot;,</span><br><span class="line">        &quot;RestartCount&quot;: 0,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay2&quot;,</span><br><span class="line">        &quot;Platform&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;MountLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AppArmorProfile&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ExecIDs&quot;: null,</span><br><span class="line">        &quot;HostConfig&quot;: &#123;</span><br><span class="line">            &quot;Binds&quot;: null,</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;PortBindings&quot;: &#123;&#125;,</span><br><span class="line">            &quot;RestartPolicy&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;no&quot;,</span><br><span class="line">                &quot;MaximumRetryCount&quot;: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;AutoRemove&quot;: false,</span><br><span class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</span><br><span class="line">            &quot;VolumesFrom&quot;: null,</span><br><span class="line">            &quot;CapAdd&quot;: null,</span><br><span class="line">            &quot;CapDrop&quot;: null,</span><br><span class="line">            &quot;Capabilities&quot;: null,</span><br><span class="line">            &quot;Dns&quot;: [],</span><br><span class="line">            &quot;DnsOptions&quot;: [],</span><br><span class="line">            &quot;DnsSearch&quot;: [],</span><br><span class="line">            &quot;ExtraHosts&quot;: null,</span><br><span class="line">            &quot;GroupAdd&quot;: null,</span><br><span class="line">            &quot;IpcMode&quot;: &quot;private&quot;,</span><br><span class="line">            &quot;Cgroup&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Links&quot;: null,</span><br><span class="line">            &quot;OomScoreAdj&quot;: 0,</span><br><span class="line">            &quot;PidMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Privileged&quot;: false,</span><br><span class="line">            &quot;PublishAllPorts&quot;: true,</span><br><span class="line">            &quot;ReadonlyRootfs&quot;: false,</span><br><span class="line">            &quot;SecurityOpt&quot;: null,</span><br><span class="line">            &quot;UTSMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;ShmSize&quot;: 67108864,</span><br><span class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</span><br><span class="line">            &quot;ConsoleSize&quot;: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            &quot;Isolation&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpuShares&quot;: 0,</span><br><span class="line">            &quot;Memory&quot;: 0,</span><br><span class="line">            &quot;NanoCpus&quot;: 0,</span><br><span class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</span><br><span class="line">            &quot;BlkioWeight&quot;: 0,</span><br><span class="line">            &quot;BlkioWeightDevice&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceReadIOps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteIOps&quot;: null,</span><br><span class="line">            &quot;CpuPeriod&quot;: 0,</span><br><span class="line">            &quot;CpuQuota&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimePeriod&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</span><br><span class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Devices&quot;: [],</span><br><span class="line">            &quot;DeviceCgroupRules&quot;: null,</span><br><span class="line">            &quot;DeviceRequests&quot;: null,</span><br><span class="line">            &quot;KernelMemory&quot;: 0,</span><br><span class="line">            &quot;KernelMemoryTCP&quot;: 0,</span><br><span class="line">            &quot;MemoryReservation&quot;: 0,</span><br><span class="line">            &quot;MemorySwap&quot;: 0,</span><br><span class="line">            &quot;MemorySwappiness&quot;: null,</span><br><span class="line">            &quot;OomKillDisable&quot;: false,</span><br><span class="line">            &quot;PidsLimit&quot;: null,</span><br><span class="line">            &quot;Ulimits&quot;: null,</span><br><span class="line">            &quot;CpuCount&quot;: 0,</span><br><span class="line">            &quot;CpuPercent&quot;: 0,</span><br><span class="line">            &quot;IOMaximumIOps&quot;: 0,</span><br><span class="line">            &quot;IOMaximumBandwidth&quot;: 0,</span><br><span class="line">            &quot;MaskedPaths&quot;: [</span><br><span class="line">                &quot;/proc/asound&quot;,</span><br><span class="line">                &quot;/proc/acpi&quot;,</span><br><span class="line">                &quot;/proc/kcore&quot;,</span><br><span class="line">                &quot;/proc/keys&quot;,</span><br><span class="line">                &quot;/proc/latency_stats&quot;,</span><br><span class="line">                &quot;/proc/timer_list&quot;,</span><br><span class="line">                &quot;/proc/timer_stats&quot;,</span><br><span class="line">                &quot;/proc/sched_debug&quot;,</span><br><span class="line">                &quot;/proc/scsi&quot;,</span><br><span class="line">                &quot;/sys/firmware&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ReadonlyPaths&quot;: [</span><br><span class="line">                &quot;/proc/bus&quot;,</span><br><span class="line">                &quot;/proc/fs&quot;,</span><br><span class="line">                &quot;/proc/irq&quot;,</span><br><span class="line">                &quot;/proc/sys&quot;,</span><br><span class="line">                &quot;/proc/sysrq-trigger&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/c2bd00f63da5353bd7378d8cc61428825a6912df7d4915ddd1ccbb1e64c4bcd5-init/diff:/var/lib/docker/overlay2/78476f806a7f8215910d9d6f1a55aa7f432562dc3dca97d28e69f6e2e6d17149/diff:/var/lib/docker/overlay2/9167e98f0c6eedbce79f55ad73db84fdbdc65a80dd0ff8b57e6d068aa8828c8d/diff:/var/lib/docker/overlay2/5908a0b08cecf7d93c0bfc6822ee52af619a872a4196c3091fffa2eb82588b0f/diff:/var/lib/docker/overlay2/dc038e093dc9db0c8996635b1d6cf79dae163ed7cd93922824fef535668fb84e/diff:/var/lib/docker/overlay2/93c919ef9bab4ad8c9b570275d0d8abcc1c530aea546e70630a9d14060b61195/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/c2bd00f63da5353bd7378d8cc61428825a6912df7d4915ddd1ccbb1e64c4bcd5/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/c2bd00f63da5353bd7378d8cc61428825a6912df7d4915ddd1ccbb1e64c4bcd5/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/c2bd00f63da5353bd7378d8cc61428825a6912df7d4915ddd1ccbb1e64c4bcd5/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Mounts&quot;: [],</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;79a9b0e8c074&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;ExposedPorts&quot;: &#123;</span><br><span class="line">                &quot;80/tcp&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Tty&quot;: true,</span><br><span class="line">            &quot;OpenStdin&quot;: true,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,</span><br><span class="line">                &quot;NGINX_VERSION=1.19.1&quot;,</span><br><span class="line">                &quot;NJS_VERSION=0.4.2&quot;,</span><br><span class="line">                &quot;PKG_RELEASE=1~buster&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/bash&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;nginx:latest&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: [</span><br><span class="line">                &quot;/docker-entrypoint.sh&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;maintainer&quot;: &quot;NGINX Docker Maintainers &lt;docker-maint@nginx.com&gt;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;StopSignal&quot;: &quot;SIGTERM&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;NetworkSettings&quot;: &#123;</span><br><span class="line">            &quot;Bridge&quot;: &quot;&quot;,</span><br><span class="line">            &quot;SandboxID&quot;: &quot;96cf346aca900378933b0b005e8bffdd160b730d5e82121b66202f98d89496b0&quot;,</span><br><span class="line">            &quot;HairpinMode&quot;: false,</span><br><span class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;Ports&quot;: &#123;</span><br><span class="line">                &quot;80/tcp&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;HostIp&quot;: &quot;0.0.0.0&quot;,</span><br><span class="line">                        &quot;HostPort&quot;: &quot;32769&quot;   # 主机映射的端口</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/96cf346aca90&quot;,</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</span><br><span class="line">            &quot;EndpointID&quot;: &quot;450ac478bd79a67255d97466ad6eaefbaaecce13ebcb5681d06d334caf9fb4e9&quot;,</span><br><span class="line">            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">            &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">            &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;f7bbc1dcbfdba55eb6081ac3571fcc6cb9cb5aa03d6e583e564b8901da45ea91&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;450ac478bd79a67255d97466ad6eaefbaaecce13ebcb5681d06d334caf9fb4e9&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,  # 容器使用的IP地址</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看端口映射信息</span></span><br><span class="line">[root@docker ~]# docker port 79a9b0e8c074</span><br><span class="line">80/tcp -&gt; 0.0.0.0:32769  # 标识127.17.0.2:80端口映射到主机的32769端口</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 我们可以在本机上(如果不使用-p或-P参数，将只能在本机访问)访问nginx，如下：</span></span><br><span class="line">[root@docker ~]# curl -I 172.17.0.2</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx/1.19.1</span><br><span class="line">Date: Thu, 16 Jul 2020 15:04:03 GMT</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 612</span><br><span class="line">Last-Modified: Tue, 07 Jul 2020 15:52:25 GMT</span><br><span class="line">Connection: keep-alive</span><br><span class="line">ETag: &quot;5f049a39-264&quot;</span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>外部访问nginx访问：</p>
<p><img src="/image-20200716232426521.png" alt="image-20200716232426521"></p>
<h4 id="2-3-5-停止容器"><a href="#2-3-5-停止容器" class="headerlink" title="2.3.5 停止容器"></a>2.3.5 停止容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker container stop 79a9b0e8c074</span><br><span class="line">79a9b0e8c074  # 命令中的container可以忽略不写</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用Kill命令暴力终止容器</span></span><br><span class="line">[root@docker ~]# docker container kill 79a9b0e8c074</span><br></pre></td></tr></table></figure>



<h4 id="2-3-6-重启容器或启动停止的容器"><a href="#2-3-6-重启容器或启动停止的容器" class="headerlink" title="2.3.6 重启容器或启动停止的容器"></a>2.3.6 重启容器或启动停止的容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动停止的容器</span></span><br><span class="line">[root@docker ~]# docker container start  79a9b0e8c074</span><br><span class="line">79a9b0e8c074</span><br><span class="line">[root@docker ~]# docker ps</span><br><span class="line">CONTAINER ID  IMAGE   COMMAND  CREATED  STATUS   PORTS     NAMES</span><br><span class="line">79a9b0e8c074  nginx:latest   &quot;/docker-entrypoint.…&quot;   5 minutes ago       Up 2 seconds        0.0.0.0:32771-&gt;80/tcp   webapp</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 此时可以查看本地服务器32771端口使用情况</span></span><br><span class="line">[root@docker ~]# ps -ef | grep 32771</span><br><span class="line"><span class="meta">#</span><span class="bash"> 此处表明本地端口跟容器端口做了映射</span></span><br><span class="line">root      20003   9219  0 21:23 ?        00:00:00 /usr/bin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 32771 -container-ip 172.17.0.2 -container-port 80</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 我们也可以使用下面的命令查看指定容器端口映射情况</span></span><br><span class="line">[root@docker ~]# docker container  port 79a9b0e8c074</span><br><span class="line">80/tcp -&gt; 0.0.0.0:32771  # 上面命令中的container可省略不写</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启一个容器</span></span><br><span class="line">[root@docker ~]# docker container restart 79a9b0e8c074</span><br><span class="line">79a9b0e8c074  # 上面命令中的container可省略不写</span><br></pre></td></tr></table></figure>



<h4 id="2-3-7-进入容器"><a href="#2-3-7-进入容器" class="headerlink" title="2.3.7 进入容器"></a>2.3.7 进入容器</h4><p>​        在使用 <strong>-d</strong> 参数时，容器启动后会进入后台。此时想要进入容器，可以通过以下指令进入：</p>
<ul>
<li><strong>docker attach + 容器id</strong></li>
<li><strong>docker exec</strong>：推荐大家使用 docker exec 命令，因为此退出容器终端，不会导致容器的停止。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker attach 79a9b0e8c074</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注意：如果从这个容器退出，会导致容器的停止</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果多个用户使用该方式进入容器，其实进入的是同一个shell，可以看到的是同一个屏幕</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用<span class="built_in">exec</span>进入容器，需要使用-it和/bin/bash重新分配一个终端，</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 该方式等于是以子进程的方式进入容器，常用于容器的管理</span></span><br><span class="line">[root@docker ~]# docker exec -it  79a9b0e8c074 /bin/bash</span><br></pre></td></tr></table></figure>

<h4 id="2-3-8-导入和导出容器"><a href="#2-3-8-导入和导出容器" class="headerlink" title="2.3.8 导入和导出容器"></a>2.3.8 导入和导出容器</h4><p>​        这种方式常用于由于网络原因，在两台服务器之间的镜像导入和导出，亦或将外网镜像导入到内网环境中。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将docker镜像导出为tar文件，这里涉及了一个问题如何准确找到指定镜像</span></span><br><span class="line">[root@VM_16_8_centos ~]# docker save  -o nginx.tar nginx:latest</span><br><span class="line"><span class="meta">#</span><span class="bash"> 上述命令等同于docker image save 0901fa9da894 &gt; /tmp/nginx.tar</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将tar文件导出为docker镜像</span></span><br><span class="line">[root@docker ~]# docker load -i nginx.tar</span><br></pre></td></tr></table></figure>

<h4 id="2-3-9-删除容器"><a href="#2-3-9-删除容器" class="headerlink" title="2.3.9 删除容器"></a>2.3.9 删除容器</h4><blockquote>
<p>值得注意的是，无论我们使用哪种方式启动容器，然后停止容器后，容器都存在于本机中，后续我们可以继续启动某个容器，即<strong>只要我们不执行删除操作，容器会一直存在于本地服务器上，长期占用本地磁盘空间</strong></p>
</blockquote>
<ul>
<li>执行删除指定容器的命令</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker container rm 79a9b0e8c074</span><br><span class="line">79a9b0e8c074  # 直接将运行的容器杀掉，container可省略不写</span><br></pre></td></tr></table></figure>

<ul>
<li>启动容器时，指定容器运行完成后删除容器</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker image ls</span><br><span class="line">REPOSITORY      TAG     IMAGE ID      CREATED           SIZE</span><br><span class="line">scaven/nginx    1.2     0901fa9da894  5 days ago        132MB</span><br><span class="line">ubuntu          15.10   9b9cb95443b5  3 years ago       137MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在执行完任务后，退出容器就直接删除容器，常用于开发、测试、临时性任务等</span></span><br><span class="line">[root@docker ~]# docker container run -it --name ubuntu --rm  9b9cb95443b5</span><br><span class="line">root@6eff441bf994:/# echo $HOSTNAME  </span><br><span class="line">6eff441bf994</span><br><span class="line">root@6eff441bf994:/# exit</span><br><span class="line">exit</span><br><span class="line"><span class="meta">#</span><span class="bash"> 此时通过docker container ls -a查看将查询不到一个名叫ubuntu的容器</span></span><br></pre></td></tr></table></figure>

<ul>
<li>删除本机上的所有容器</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker container rm `docker container ls -a -q`</span><br></pre></td></tr></table></figure>





<h2 id="三-docker镜像"><a href="#三-docker镜像" class="headerlink" title="三. docker镜像"></a>三. docker镜像</h2><p>​        镜像是容器的<strong>基石</strong>，容器基于镜像启动和运行。镜像保存的<strong>容器启动的各种条件</strong>。Docker Image是一个<strong>层叠的只读文件系统</strong>。</p>
<p><img src="/v2-5b6bf4c2cf1196e5949d674a7018e64b_720w.jpg" alt="img"></p>
<p>​        如上图所示，容器启动时，从下而上<strong>加载需要的镜像</strong>，镜像被依次<strong>移到内存</strong>中，最后，bootfs（引导文件系统）会被<strong>卸载</strong>。</p>
<p>​        在Docker中，rootfs（root文件系统）<strong>永远只读</strong>，利用<strong>联合加载技术</strong>，在root文件系统的基础上加载更多的只读文件系统。将这样的文件系统称之为镜像，对，没错，镜像就是一堆<strong>文件系统的集合</strong>。</p>
<blockquote>
<p>​        联合加载技术是<strong>一次加载多个文件系统</strong>，但是在外面看来好像只有一个文件系统。最终将各层文件<strong>叠加到一起</strong>，最终的文件系统包含所有的底层文件和目录。  </p>
<p>​        一个镜像可以放到另一个镜像的顶部，称为下一个镜像的<strong>父镜像</strong>。最底部的镜像称为<strong>基础镜像</strong>。</p>
</blockquote>
<h3 id="3-1-docker镜像仓库"><a href="#3-1-docker镜像仓库" class="headerlink" title="3.1 docker镜像仓库"></a>3.1 docker镜像仓库</h3><p>​        镜像仓库(用于镜像存放)官网：<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<p>官网的使用和简介：</p>
<ul>
<li>搜索指定镜像，任何人都可以注册使用docker镜像仓库，上传下载和使用镜像</li>
</ul>
<p><img src="/image-20200716151141854.png" alt="image-20200716151141854"></p>
<p>点击进入官方nginx镜像仓库：</p>
<p><img src="/image-20200716151648043.png" alt="image-20200716151648043"></p>
<p>查看”Reviews”–展示用户对镜像的评价信息</p>
<p><img src="/image-20200716153928518.png" alt="image-20200716153928518"></p>
<p>选择‘Tags’查看–展示镜像的所有标签信息</p>
<p><img src="/image-20200716151921503.png" alt="image-20200716151921503"></p>
<p>唯一标识一个镜像的方法：</p>
<ul>
<li>镜像id：sha256:64位，默认只截取12位</li>
<li>镜像仓库:tag</li>
</ul>
<h3 id="3-2-docker镜像相关命令"><a href="#3-2-docker镜像相关命令" class="headerlink" title="3.2 docker镜像相关命令"></a>3.2 docker镜像相关命令</h3><p>有关镜像的相关命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker image --help</span><br><span class="line"></span><br><span class="line">Usage:	docker image COMMAND</span><br><span class="line"></span><br><span class="line">Manage images</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  build       Build an image from a Dockerfile</span><br><span class="line">  history     Show the history of an image</span><br><span class="line">  import      Import the contents from a tarball to create a filesystem image</span><br><span class="line">  inspect     Display detailed information on one or more images</span><br><span class="line">  load        Load an image from a tar archive or STDIN</span><br><span class="line">  ls          List images</span><br><span class="line">  prune       Remove unused images</span><br><span class="line">  pull        Pull an image or a repository from a registry</span><br><span class="line">  push        Push an image or a repository to a registry</span><br><span class="line">  rm          Remove one or more images</span><br><span class="line">  save        Save one or more images to a tar archive (streamed to STDOUT by default)</span><br><span class="line">  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span><br><span class="line"></span><br><span class="line">Run &#x27;docker image COMMAND --help&#x27; for more information on a command.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>详细解释如下</p>
<table>
<thead>
<tr>
<th>build   Build an image from a Dockerfile</th>
<th>从Dockerfile生成图像</th>
</tr>
</thead>
<tbody><tr>
<td><strong>history</strong>   Show the history of an image</td>
<td>历史展示一个镜像的历史</td>
</tr>
<tr>
<td><strong>import</strong>   Import the contents from a tarball to create a filesystem image</td>
<td>导入从tarball导入内容以创建文件系统镜像</td>
</tr>
<tr>
<td><strong>inspect</strong>   Display detailed information on one or more images</td>
<td>检查显示一个或多个镜像的详细信息</td>
</tr>
<tr>
<td><strong>load</strong>   Load an image from a tar archive or STDIN</td>
<td>从tar存档或stdin加载镜像</td>
</tr>
<tr>
<td><strong>ls</strong>    List images</td>
<td>列出系统上现有的镜像</td>
</tr>
<tr>
<td><strong>prune</strong>   Remove unused images</td>
<td>删除未使用的镜像</td>
</tr>
<tr>
<td><strong>pull</strong>   Pull an image or a repository from a registry</td>
<td>从仓库中拉取镜像</td>
</tr>
<tr>
<td><strong>push</strong>   Push an image or a repository to a registry</td>
<td>将镜像推送到远端仓库中</td>
</tr>
<tr>
<td><strong>rm</strong>    Remove one or more images</td>
<td>rm删除一个或多个镜像</td>
</tr>
<tr>
<td><strong>save</strong>   Save one or more images to a tar archive (streamed to STDOUT by  default)</td>
<td>将一个或多个镜像保存到tar存档（默认情况下流式传输到stdout）</td>
</tr>
<tr>
<td><strong>tag</strong>   Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</td>
<td>给镜像打标签</td>
</tr>
</tbody></table>
<p>docker 镜像常用操作：</p>
<h4 id="3-2-1-下载镜像"><a href="#3-2-1-下载镜像" class="headerlink" title="3.2.1 下载镜像"></a>3.2.1 下载镜像</h4><p>首先，我们可以去docker hub官网进行查找指定镜像，如我们查找centos 7.6的镜像，找到后就可以直接复制红框中的命令进行下载</p>
<p><img src="/image-20200716214404996.png" alt="image-20200716214404996"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 当然，我们也可以在测试机上进行简单的搜索，如下，不过不指定版本，就是下载最新版</span></span><br><span class="line">[root@VM_16_8_centos ~]# docker search  centos</span><br><span class="line">NAME   DESCRIPTION                   STARS     OFFICIAL   AUTOMATED   </span><br><span class="line">centos  The official build of CentOS.  6090     [OK]                </span><br><span class="line">ansible/centos7-ansible   Ansible on Centos7    132        [OK]</span><br><span class="line">····</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载centos官方镜像</span></span><br><span class="line">[root@VM_16_8_centos ~]# docker pull centos  # 下载最新版</span><br><span class="line">latest: Pulling from library/centos</span><br><span class="line">6910e5a164f7: Pull complete </span><br><span class="line">Digest: sha256:4062bbdd1bb0801b0aa38e0f83dece70fb7a5e9bce223423a68de2d8b784b43b</span><br><span class="line">Status: Downloaded newer image for centos:latest</span><br><span class="line">docker.io/library/centos:latest</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载后的镜像一般存储在/var/lib/docker中</span></span><br><span class="line">[root@VM_16_8_centos ~]# ls /var/lib/docker</span><br><span class="line">builder  buildkit  containers  image  network  overlay2  plugins  runtimes  swarm  tmp  trust  volumes</span><br><span class="line"></span><br><span class="line">[root@VM_16_8_centos ~]# docker pull centos:centos7.6.1810 # 下载指定版本</span><br><span class="line">centos7.6.1810: Pulling from library/centos</span><br><span class="line">ac9208207ada: Pull complete </span><br><span class="line">Digest: sha256:62d9e1c2daa91166139b51577fe4f4f6b4cc41a3a2c7fc36bd895e2a17a3e4e6</span><br><span class="line">Status: Downloaded newer image for centos:centos7.6.1810</span><br><span class="line">docker.io/library/centos:centos7.6.1810</span><br><span class="line"></span><br><span class="line">[root@VM_16_8_centos ~]# docker image ls </span><br><span class="line">REPOSITORY      TAG     IMAGE ID       CREATED             SIZE</span><br><span class="line">nginx           latest  0901fa9da894        5 days ago          132MB</span><br><span class="line">centos          latest  831691599b88        4 weeks ago         215MB</span><br><span class="line">centos          centos7.6.1810  f1cb7c7d58b7 16 months ago      202MB</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-打标签"><a href="#3-2-2-打标签" class="headerlink" title="3.2.2 打标签"></a>3.2.2 <strong>打标签</strong></h4><ul>
<li>命令格式：docker image tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]</li>
<li>等同于：docker image tag SOURCE_IMAGE_ID TARGET_IMAGE[:TAG]</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker image tag --help</span><br><span class="line">Usage:	docker image tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]</span><br><span class="line">Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker image ls</span><br><span class="line">REPOSITORY   TAG        IMAGE ID      CREATED      SIZE</span><br><span class="line">nginx        latest     0901fa9da894  5 days ago   132MB</span><br><span class="line">ubuntu       15.10      9b9cb95443b5  3 years ago  137MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line">[root@docker ~]# docker image tag 0901fa9da894 scaven/nginx:1.1.1</span><br><span class="line">[root@docker ~]# docker image ls</span><br><span class="line">REPOSITORY   TAG        IMAGE ID      CREATED      SIZE</span><br><span class="line">nginx        latest     0901fa9da894  5 days ago   132MB</span><br><span class="line">scaven/nginx 1.1.1      0901fa9da894  5 days ago   132MB</span><br><span class="line">ubuntu       15.10      9b9cb95443b5  3 years ago  137MB</span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-删除镜像"><a href="#3-2-3-删除镜像" class="headerlink" title="3.2.3 删除镜像"></a>3.2.3 <strong>删除镜像</strong></h4><blockquote>
<p>建议使用<code>镜像:标签</code>或者<code>镜像ID</code>来删除镜像，因为这样才是唯一标识了一个镜像</p>
</blockquote>
<ul>
<li>格式：docker image rm [OPTIONS] IMAGE [IMAGE…]</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用镜像ID删除镜像</span></span><br><span class="line">[root@docker ~]# docker image rm 0901fa9da894</span><br><span class="line">Error response from daemon: conflict: unable to delete 0901fa9da894 (must be forced) - image is referenced in multiple repositories</span><br><span class="line"><span class="meta">#</span><span class="bash"> 报错的意思是该镜像id标识了两个仓库的镜像，因此不能使用该方法删除，由此可知要删除两个镜像id一样的镜像，只能使用`镜像仓库:标签`的方法</span></span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker image rm scaven/nginx:1.1.1</span><br><span class="line">Untagged: scaven/nginx:1.1.1</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker image ls</span><br><span class="line">REPOSITORY   TAG        IMAGE ID      CREATED      SIZE</span><br><span class="line">nginx        latest     0901fa9da894  5 days ago   132MB</span><br><span class="line">ubuntu       15.10      9b9cb95443b5  3 years ago  137MB</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker image rm 0901fa9da894</span><br><span class="line">Error response from daemon: conflict: unable to delete 0901fa9da894 (must be forced) - image is being used by stopped container 2a2bbb830211</span><br><span class="line"><span class="meta">#</span><span class="bash"> 报错是指，该镜像关联了一个停止中的容器，需要使用-f参数才能强制删除，如果是一个运行中的容器，不能强制删除</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用-f参数，强制删除容器镜像</span></span><br><span class="line">[root@docker ~]# docker image rm -f 0901fa9da894</span><br><span class="line">Untagged: nginx:latest</span><br><span class="line">Deleted: sha256:0901fa9da894a8e9de5cb26d6749eaffb67b373dc1ff8a26c46b23b1175c913a</span><br><span class="line">[root@docker ~]# docker image ls </span><br><span class="line">REPOSITORY   TAG        IMAGE ID      CREATED      SIZE</span><br><span class="line">ubuntu       15.10      9b9cb95443b5  3 years ago  137MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启被删除镜像的容器，容器运行正常</span></span><br><span class="line">[root@docker ~]# docker container start 79a9b0e8c074</span><br><span class="line">79a9b0e8c074</span><br><span class="line">[root@docker ~]# docker ps </span><br><span class="line">CONTAINER ID  IMAGE   COMMAND CREATED   STATUS   PORTS    NAMES</span><br><span class="line">79a9b0e8c074        0901fa9da894        &quot;/docker-entrypoint.…&quot;   19 hours ago        Up 39 seconds       0.0.0.0:32768-&gt;80/tcp   webapp</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除全部镜像</span></span><br><span class="line">[root@docker ~]# docker image rm -f `docker image ls -q`</span><br><span class="line"><span class="meta">#</span><span class="bash"> `docker image ls -q`命令是显示所有镜像的镜像ID</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-4-导入和导出镜像"><a href="#3-2-4-导入和导出镜像" class="headerlink" title="3.2.4 导入和导出镜像"></a>3.2.4 <strong>导入和导出镜像</strong></h4><ul>
<li>导出镜像：docker image save -o IMAGE.tar IMAGE [IMAGE…]</li>
<li>导入镜像：docker image load -i IMAGE.tar</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在删除nginx镜像之前做了导出镜像，如下</span></span><br><span class="line">[root@docker ~]# docker image save 0901fa9da894 &gt; /tmp/nginx.tar</span><br><span class="line">[root@docker ~]# ls /tmp/nginx.tar </span><br><span class="line">/tmp/nginx.tar</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 导入镜像</span></span><br><span class="line">[root@docker ~]# docker load -i /tmp/nginx.tar</span><br><span class="line">Loaded image ID: sha256:0901fa9da894a8e9de5cb26d6749eaffb67b373dc1ff8a26c46b23b1175c913a</span><br><span class="line">[root@docker ~]# docker image ls</span><br><span class="line">REPOSITORY   TAG        IMAGE ID      CREATED      SIZE</span><br><span class="line">&lt;none&gt;        &lt;none&gt;    0901fa9da894  5 days ago   132MB</span><br><span class="line">ubuntu       15.10      9b9cb95443b5  3 years ago  137MB</span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用docker image save 0901fa9da894 &gt; /tmp/nginx.tar这个命令导出的镜像文件在导入时，不能继承源镜像的仓库和标签，需要收到打标签</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 给没有指定仓库和标签的镜像打标签，此处只能使用镜像ID来标识该镜像</span></span><br><span class="line">[root@docker ~]# docker image tag 0901fa9da894 scaven/nginx:1.2 </span><br><span class="line">[root@docker ~]# docker image ls</span><br><span class="line">REPOSITORY   TAG        IMAGE ID      CREATED      SIZE</span><br><span class="line">scaven/nginx 1.2        0901fa9da894  5 days ago   132MB</span><br><span class="line">ubuntu       15.10      9b9cb95443b5  3 years ago  137MB</span><br></pre></td></tr></table></figure>

<h4 id="3-2-5-上传自制镜像到docker官方仓库"><a href="#3-2-5-上传自制镜像到docker官方仓库" class="headerlink" title="3.2.5 上传自制镜像到docker官方仓库"></a>3.2.5 上传自制镜像到docker官方仓库</h4><blockquote>
<p>此处以centos镜像为例，首先创建镜像仓库</p>
</blockquote>
<p><img src="/image-20200716221423032.png" alt="image-20200716221423032"></p>
<p>创建完成后，如下：</p>
<p><img src="/image-20200716221551532.png" alt="image-20200716221551532"></p>
<p>接下来我们上传镜像到scaven/os仓库中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 首先登录docker官方仓库</span></span><br><span class="line">[root@VM_16_8_centos ~]# docker login</span><br><span class="line">Login with your Docker ID to push and pull images from Docker Hub. If you don&#x27;t have a Docker ID, head over to https://hub.docker.com to create one.</span><br><span class="line">Username: scaven  # 输入用户名</span><br><span class="line">Password:         # 输入密码</span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded   # 提示登录成功</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 登录成功后，就可以推送镜像到docker hub中</span></span><br><span class="line">[root@VM_16_8_centos ~]# docker image tag centos:centos7.6.1810 scvaen/os:centos7.6.1810</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将本地镜像中的仓库名称修改成镜像仓库中的仓库名称</span></span><br><span class="line"></span><br><span class="line">[root@VM_16_8_centos ~]# docker image ls</span><br><span class="line">REPOSITORY    TAG       IMAGE ID        CREATED             SIZE</span><br><span class="line">nginx         latest    0901fa9da894    5 days ago          132MB</span><br><span class="line">centos        latest    831691599b88        4 weeks ago     215MB</span><br><span class="line">centos        centos7.6.1810  f1cb7c7d58b7  16 months ago   202MB</span><br><span class="line">scaven/os     centos7.6.1810  f1cb7c7d58b7  16 months ago   202MB</span><br><span class="line"></span><br><span class="line">[root@VM_16_8_centos ~]# docker push scaven/os:centos7.6.1810</span><br><span class="line">The push refers to repository [docker.io/scaven/os]</span><br><span class="line">89169d87dbe2: Mounted from library/centos </span><br><span class="line">centos7.6.1810: digest: sha256:747b2de199b6197a26eb1a24d69740d25483995842b2d2f75824095e9d1d19eb size: 529</span><br></pre></td></tr></table></figure>

<p>命令执行成功后，我们可以在镜像仓库中查看到已经上传的镜像信息，如下</p>
<p><img src="/image-20200716223356907.png" alt="image-20200716223356907"></p>
<h4 id="3-2-6-查看下载镜像的详细信息"><a href="#3-2-6-查看下载镜像的详细信息" class="headerlink" title="3.2.6 查看下载镜像的详细信息"></a>3.2.6 查看下载镜像的详细信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker image ls</span><br><span class="line">REPOSITORY   TAG        IMAGE ID      CREATED      SIZE</span><br><span class="line">scaven/nginx 1.2        0901fa9da894  5 days ago   132MB</span><br><span class="line">ubuntu       15.10      9b9cb95443b5  3 years ago  137MB</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker image inspect 0901fa9da894  </span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;sha256:0901fa9da894a8e9de5cb26d6749eaffb67b373dc1ff8a26c46b23b1175c913a&quot;,</span><br><span class="line">        &quot;RepoTags&quot;: [  # 镜像标签新信息</span><br><span class="line">            &quot;scaven/nginx:1.2&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;RepoDigests&quot;: [],</span><br><span class="line">        &quot;Parent&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Comment&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2020-07-10T20:26:44.624785651Z&quot;,  # 创建时间</span><br><span class="line">        &quot;Container&quot;: &quot;348c3ade7f4bdc0366f3f390ea4cfaebfb355ad7d621547eaf73728136d3bd2d&quot;,</span><br><span class="line">        &quot;ContainerConfig&quot;: &#123;  # 容器配置信息</span><br><span class="line">            &quot;Hostname&quot;: &quot;348c3ade7f4b&quot;,  # 启动后的主机名--镜像ID前12位</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;ExposedPorts&quot;: &#123;</span><br><span class="line">                &quot;80/tcp&quot;: &#123;&#125;   # 启动的端口</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [  # 容器环境变量信息</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,</span><br><span class="line">                &quot;NGINX_VERSION=1.19.1&quot;,</span><br><span class="line">                &quot;NJS_VERSION=0.4.2&quot;,</span><br><span class="line">                &quot;PKG_RELEASE=1~buster&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [  # 启动后指定的指定命令</span><br><span class="line">                &quot;/bin/sh&quot;,</span><br><span class="line">                &quot;-c&quot;,</span><br><span class="line">                &quot;#(nop) &quot;,</span><br><span class="line">                &quot;CMD [\&quot;nginx\&quot; \&quot;-g\&quot; \&quot;daemon off;\&quot;]&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ArgsEscaped&quot;: true,</span><br><span class="line">            &quot;Image&quot;: &quot;sha256:8a6dfc8c21a1b3f3679b7755fc7869a22b5f8583778cf7835b5ee5387a73ae5e&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,   # 存储卷信息</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,  # 工作目录</span><br><span class="line">            &quot;Entrypoint&quot;: [</span><br><span class="line">                &quot;/docker-entrypoint.sh&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;maintainer&quot;: &quot;NGINX Docker Maintainers &lt;docker-maint@nginx.com&gt;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;StopSignal&quot;: &quot;SIGTERM&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;DockerVersion&quot;: &quot;18.09.7&quot;,  # docker版本信息</span><br><span class="line">        &quot;Author&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Config&quot;: &#123;    # 配置信息</span><br><span class="line">            &quot;Hostname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;ExposedPorts&quot;: &#123;</span><br><span class="line">                &quot;80/tcp&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,</span><br><span class="line">                &quot;NGINX_VERSION=1.19.1&quot;,</span><br><span class="line">                &quot;NJS_VERSION=0.4.2&quot;,</span><br><span class="line">                &quot;PKG_RELEASE=1~buster&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;nginx&quot;,</span><br><span class="line">                &quot;-g&quot;,</span><br><span class="line">                &quot;daemon off;&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ArgsEscaped&quot;: true,</span><br><span class="line">            &quot;Image&quot;: &quot;sha256:8a6dfc8c21a1b3f3679b7755fc7869a22b5f8583778cf7835b5ee5387a73ae5e&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: [</span><br><span class="line">                &quot;/docker-entrypoint.sh&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;maintainer&quot;: &quot;NGINX Docker Maintainers &lt;docker-maint@nginx.com&gt;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;StopSignal&quot;: &quot;SIGTERM&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Architecture&quot;: &quot;amd64&quot;,   # 架构</span><br><span class="line">        &quot;Os&quot;: &quot;linux&quot;,   # 操作系统 </span><br><span class="line">        &quot;Size&quot;: 132484492,  # 镜像大小</span><br><span class="line">        &quot;VirtualSize&quot;: 132484492,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/9167e98f0c6eedbce79f55ad73db84fdbdc65a80dd0ff8b57e6d068aa8828c8d/diff:/var/lib/docker/overlay2/5908a0b08cecf7d93c0bfc6822ee52af619a872a4196c3091fffa2eb82588b0f/diff:/var/lib/docker/overlay2/dc038e093dc9db0c8996635b1d6cf79dae163ed7cd93922824fef535668fb84e/diff:/var/lib/docker/overlay2/93c919ef9bab4ad8c9b570275d0d8abcc1c530aea546e70630a9d14060b61195/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/78476f806a7f8215910d9d6f1a55aa7f432562dc3dca97d28e69f6e2e6d17149/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/78476f806a7f8215910d9d6f1a55aa7f432562dc3dca97d28e69f6e2e6d17149/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/78476f806a7f8215910d9d6f1a55aa7f432562dc3dca97d28e69f6e2e6d17149/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;RootFS&quot;: &#123;</span><br><span class="line">            &quot;Type&quot;: &quot;layers&quot;,</span><br><span class="line">            &quot;Layers&quot;: [</span><br><span class="line">                &quot;sha256:13cb14c2acd34e45446a50af25cb05095a17624678dbafbcc9e26086547c1d74&quot;,</span><br><span class="line">                &quot;sha256:0e32546a8af0cd04ad451d6a9d22e650e500e5da3636a32648c9f5aca96a0ff7&quot;,</span><br><span class="line">                &quot;sha256:7ef35766ef7d5d3d958022405b308d5c105b41190e1b63b2037c4055c6950c9e&quot;,</span><br><span class="line">                &quot;sha256:4856db5e4f59384c413c20c46cd5403a860e1b07c8fdbad24df1ffd9209d44e7&quot;,</span><br><span class="line">                &quot;sha256:2808ec4a8ea71c2660284d06cf7e25354b70b58504edb46ac3e705fb7e6ea519&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Metadata&quot;: &#123;   # 元数据</span><br><span class="line">            &quot;LastTagTime&quot;: &quot;2020-07-16T16:30:36.781611539+08:00&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="四-docker容器网络"><a href="#四-docker容器网络" class="headerlink" title="四. docker容器网络"></a>四. docker容器网络</h2><p>​        Docker使用Linux桥接（参考<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f86d4b88777d">《Linux虚拟网络技术》</a>），在宿主机虚拟一个<strong>Docker容器网桥(docker0)<strong>，</strong>Docker启动一个容器时会根据Docker网桥的网段分配给容器一个IP地址，称为Container-IP，同时Docker网桥是每个容器的默认网关</strong>。因为在同一宿主机内的容器都接入同一个网桥，这样容器之间就能够通过容器的Container-IP直接通信。</p>
<p>​        <strong>Docker网桥是宿主机虚拟出来的，并不是真实存在的网络设备，外部网络是无法寻址到的，这也意味着外部网络无法通过直接Container-IP访问到容器</strong>。如果容器希望外部访问能够访问到，可以通过映射容器端口到宿主主机（端口映射），即docker run创建容器时候通过 -p 或 -P 参数来启用，访问容器的时候就通过[宿主机IP]:[容器端口]访问容器。</p>
<p><img src="/image-20200717153037880.png" alt="image-20200717153037880"></p>
<p>​        查看<code>docker network</code>相关命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">ad1f746530ad        bridge              bridge              local  # 桥接模式，默认</span><br><span class="line">86c30ec76685        host                host                local  # 开放式容器模式</span><br><span class="line">c2385d5ccbf9        none                null                local  # 封闭式容器模式</span><br><span class="line">[root@docker ~]# docker network --help</span><br><span class="line">Usage:	docker network COMMAND</span><br><span class="line">Manage networks</span><br><span class="line">Commands:</span><br><span class="line">  connect     Connect a container to a network</span><br><span class="line">  create      Create a network</span><br><span class="line">  disconnect  Disconnect a container from a network</span><br><span class="line">  inspect     Display detailed information on one or more networks</span><br><span class="line">  ls          List networks</span><br><span class="line">  prune       Remove all unused networks</span><br><span class="line">  rm          Remove one or more networks</span><br><span class="line"></span><br><span class="line">Run &#x27;docker network COMMAND --help&#x27; for more information on a command.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker network inspect bridge   <span class="comment"># 查看容器网络的详细信息</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-1-四类网络模式"><a href="#4-1-四类网络模式" class="headerlink" title="4.1 四类网络模式"></a>4.1 四类网络模式</h3><table>
<thead>
<tr>
<th>Docker网络模式</th>
<th>配置</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>host模式(开放式容器)</td>
<td>–net=host</td>
<td>容器和宿主机共享Network namespace。</td>
</tr>
<tr>
<td>container模式(联盟式容器)</td>
<td>–net=container:NAME_or_ID</td>
<td>如上图所示，容器和另外一个容器共享Network namespace，使用同一块网卡，各容器相互间可以使用lo进行同信。 kubernetes中的pod就是多个容器共享一个Network namespace。</td>
</tr>
<tr>
<td>none模式(封闭式容器)</td>
<td>–net=none</td>
<td>容器有独立的Network namespace，但并没有对其进行任何网络设置，如分配veth pair 和网桥连接，配置IP等，即网络孤岛，没有网络流量进出。</td>
</tr>
<tr>
<td>bridge模式(桥接式容器)</td>
<td>–net=bridge</td>
<td>拥有一个lo回环网卡和私有网络接口，默认模式</td>
</tr>
</tbody></table>
<h4 id="4-1-1-host模式"><a href="#4-1-1-host模式" class="headerlink" title="4.1.1 host模式"></a>4.1.1 host模式</h4><p>​        如果启动容器的时候使用<strong>host模式</strong>，那么这个容器将不会获得一个独立的Network Namespace，而是<strong>和宿主机共用一个Network Namespace</strong>。容器将不会虚拟出自己的网卡，配置自己的IP等，而是<strong>使用宿主机的IP、端口和主机名等</strong>。但是，容器的其他方面，如文件系统、进程列表等还是和宿主机隔离的。</p>
<p>​        使用host模式的容器可以直接使用宿主机的IP地址与外界通信，容器内部的服务端口也可以使用宿主机的端口，不需要进行NAT，<strong>host最大的优势就是网络性能比较好，但是docker host上已经使用的端口就不能再用了，网络的隔离性不好</strong>。</p>
<p>Host模式如下图所示：</p>
<img src="/image-20200717140502390.png" alt="image-20200717140502390" style="zoom:67%;" />

<center>Host模式</center>

<p>我们以host模式启动一个容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker image ls </span><br><span class="line">REPOSITORY     TAG       IMAGE ID        CREATED       SIZE</span><br><span class="line">scaven/nginx   1.2       0901fa9da894    6 days ago    132MB</span><br><span class="line">ubuntu         15.10     9b9cb95443b5    3 years ago   137MB</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker  run -d -it --name web_n1 --net=host 0901fa9da894</span><br><span class="line">06b4c8ad24f39b5e5ca1595b66eaf2227eb4fb994460f5697fa35d876fae5576</span><br><span class="line"><span class="meta">#</span><span class="bash"> 容器内部跟宿主机很像，可以通过敲docker命令区分，宿主机有该命令，容器无该命令</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 宿主机的当前目录为/root--[root@docker ~]<span class="comment">#，而容器的当前目录是/--[root@docker /]#</span></span></span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker container inspect 06b4c8ad24f3</span><br><span class="line">····</span><br><span class="line">            &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;host&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;86c30ec766859f24472ff5508cf08cbd5924a38b954e823f4e46da6c41fb2cb8&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;d21e11627b5a1bd4a7e96ba8c0b4bcbd01aa1fce8517742464e6e96545a019bc&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;&quot;,    # 未显示网关地址</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;&quot;,  # 未显示IP地址</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 0,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker port 06b4c8ad24f3  # 没有端口映射，即容器将使用宿主机的端口</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看本地端口使用情况</span></span><br><span class="line">[root@docker ~]# netstat  -lntp   # 本地的80端口被使用，如下</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address  Foreign Address  State    PID/Program name </span><br><span class="line">tcp      0      0   0.0.0.0:80     0.0.0.0:*        LISTEN   19590/nginx: master # 占用宿主机端口80</span><br><span class="line">tcp      0      0   127.0.0.1:25   0.0.0.0:*        LISTEN   9446/master         </span><br><span class="line">tcp      0      0  0.0.0.0:10022   0.0.0.0:*        LISTEN   9191/sshd           </span><br><span class="line">tcp6     0      0  :::80           :::*             LISTEN   19590/nginx: master </span><br><span class="line">tcp6     0      0  ::1:25          :::*             LISTEN   9446/master         </span><br><span class="line">tcp6     0      0  :::10022        :::*             LISTEN   9191/sshd </span><br><span class="line"></span><br><span class="line">[root@docker ~]# ip a  # 此处没有多出容器的IP地址，若此时进入容器06b4c8ad24f3内，看到的信息跟此处的信息一样</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:64:2a:59 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.138.3.15/24 brd 10.138.3.255 scope global noprefixroute ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::b6e4:fced:d3d3:35ee/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:36:01:0b:3f brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入容器查看ip a的输出</span></span><br><span class="line">[root@docker /]#  ip a  # 跟在宿主机里面执行ip a得到的结果一样，-- 容器内的当前目录是根</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:64:2a:59 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.138.3.15/24 brd 10.138.3.255 scope global noprefixroute ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::b6e4:fced:d3d3:35ee/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:36:01:0b:3f brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 我们直接访问nginx</span></span><br><span class="line">[root@docker ~]# curl -I 10.138.3.15:80  # 使用宿主机IP地址和端口访问nginx</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx/1.19.1</span><br><span class="line">Date: Fri, 17 Jul 2020 06:18:20 GMT</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 612</span><br><span class="line">Last-Modified: Tue, 07 Jul 2020 15:52:25 GMT</span><br><span class="line">Connection: keep-alive</span><br><span class="line">ETag: &quot;5f049a39-264&quot;</span><br><span class="line">Accept-Ranges: bytes</span><br></pre></td></tr></table></figure>

<p>下面，我们通过浏览器直接访问nginx访问：</p>
<p><img src="/image-20200717142321013.png" alt="image-20200717142321013"></p>
<p>​        由此，我们就印证了容器以<strong>host模式</strong>运行时，容器将不会获得一个独立的<code>Network Namespace</code>，而是<strong>和宿主机共用一个<code>Network Namespace</code><strong>。容器将不会虚拟出自己的网卡，配置自己的IP等，而是</strong>使用宿主机的IP和端口</strong>。但是，容器的其他方面，如文件系统、进程列表等还是和宿主机隔离的。</p>
<h4 id="4-1-2-container模式–常用于k8s中"><a href="#4-1-2-container模式–常用于k8s中" class="headerlink" title="4.1.2 container模式–常用于k8s中"></a>4.1.2 container模式–常用于k8s中</h4><p>​        <strong>这个模式指定新创建的容器和已经存在的一个容器共享一个 <code>Network Namespace</code>，而不是和宿主机共享</strong>。<strong>新创建的容器不会创建自己的网卡，配置自己的 IP，而是和一个指定的容器共享 IP、主机名、端口范围等</strong>。同样，两个容器除了网络方面，其他的如文件系统、进程列表等还是隔离的。<strong>两个容器的进程可以通过 lo 网卡设备通信</strong>。</p>
<p>Container模式示意图：</p>
<img src="/image-20200717142956583.png" alt="image-20200717142956583" style="zoom:67%;" />

<center>Container网络模式</center>

<p>案例展示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker run -it --name centos7.6 --net=container:web_n1 f1cb7c7d58b7</span><br><span class="line">[root@docker /]# ip a    # 请注意，这里我们已经进入了容器内，工作目录发生了变化</span><br><span class="line">bash: ip: command not found</span><br><span class="line"></span><br><span class="line">[root@docker /]# ifconfig    </span><br><span class="line">bash: ifconfig: command not found</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 由于查看不到IP地址，因此我们先安装软件包</span></span><br><span class="line">[root@docker /]# yum -y install net-tools  </span><br><span class="line"></span><br><span class="line">[root@docker /]# ifconfig   # 由下可知，使用的仍然是主机的网络名称空间</span><br><span class="line">docker0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:36:01:0b:3f  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)A</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 10.138.3.15  netmask 255.255.255.0  broadcast 10.138.3.255</span><br><span class="line">        inet6 fe80::b6e4:fced:d3d3:35ee  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:64:2a:59  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 171689  bytes 239863139 (228.7 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 44482  bytes 3775713 (3.6 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 20  bytes 1700 (1.6 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 20  bytes 1700 (1.6 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>

<p>​        宿主机网络和centos7.6容器网络截图比较如下(容器web_n1由于只有nginx的最小运行环境，因此没有yum命令，也没有网络相关命令，因此此处就直接跟宿主机网络做比较了)：</p>
<p><img src="/image-20200717145845698.png" alt="image-20200717145845698"></p>
<h4 id="4-1-3-none模式"><a href="#4-1-3-none模式" class="headerlink" title="4.1.3 none模式"></a>4.1.3 none模式</h4><p>​        使用none模式，Docker容器拥有自己的Network Namespace，但是，并不为Docker容器进行任何网络配置。也就是说，这个Docker容器没有网卡、IP、路由等信息。需要我们自己为Docker容器添加网卡、配置IP等。</p>
<p>​        <strong>这种网络模式下容器只有lo回环网络，没有其他网卡</strong>。none模式可以在容器创建时通过–network=none来指定。<strong>这种类型的网络没有办法联网，封闭的网络能很好的保证容器的安全性，因此常用于不需要网络的情况下</strong>。</p>
<p>None模式示意图:</p>
<p><img src="/image-20200717151140261.png" alt="image-20200717151140261"></p>
<center>None网络模式</center>

<h4 id="4-1-4-bridge模式-默认模式"><a href="#4-1-4-bridge模式-默认模式" class="headerlink" title="4.1.4 bridge模式(默认模式)"></a>4.1.4 bridge模式(默认模式)</h4><p>​        当Docker进程启动时，会在主机上创建一个名为docker0的虚拟网桥，此主机上启动的Docker容器会连接到这个虚拟网桥上。虚拟网桥的工作方式和物理交换机类似，这样主机上的所有容器就通过交换机连在了一个二层网络中。</p>
<p>​        <strong>从docker0子网中分配一个IP给容器使用，并设置docker0的IP地址为容器的默认网关。在主机上创建一对虚拟网卡veth pair设备，Docker将veth pair设备的一端放在新创建的容器中，并命名为eth0（容器的网卡），另一端放在主机中，以vethxxx这样类似的名字命名，并将这个网络设备加入到docker0网桥中。可以通过brctl show命令查看</strong>。</p>
<p>​       bridge模式是docker的默认网络模式，不写–net参数，就是bridge模式。使用docker run -p时，docker实际是在iptables做了DNAT规则，实现端口转发功能。可以使用iptables -t nat -vnL查看。</p>
<p>bridge模式如下图所示：</p>
<img src="/image-20200717152228588.png" alt="image-20200717152228588" style="zoom:67%;" />

<center>Docker的网络实现</center>

<p>案例展示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker container rm `docker container ls -a -q`  # 删除本地服务器上的所有容器</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动桥接式容器前宿主机上的网络信息如下</span></span><br><span class="line">[root@docker ~]# ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:64:2a:59 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.138.3.15/24 brd 10.138.3.255 scope global noprefixroute ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::b6e4:fced:d3d3:35ee/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:36:01:0b:3f brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 以默认网络模式启动容器</span></span><br><span class="line">[root@docker ~]# docker run -d  --name web_n1 0901fa9da894  </span><br><span class="line">fd963117694015a936e5cb3068b99642460c000f01e0a69b2715af5995700c1d</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 以默认网络模式启动容器后，会多出一个网卡</span></span><br><span class="line">[root@docker ~]# ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:64:2a:59 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.138.3.15/24 brd 10.138.3.255 scope global noprefixroute ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::b6e4:fced:d3d3:35ee/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:36:01:0b:3f brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:36ff:fe01:b3f/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">7: vethadf4fe6@if6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether ba:76:a8:62:25:f5 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::b876:a8ff:fe62:25f5/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 此时容器对外网络是连通的，宿主机以外的外部网络不能访问容器，除非暴露端口，该宿主机上的容器可以相互访问</span></span><br><span class="line">[root@docker ~]# ping 127.17.0.2</span><br><span class="line">PING 127.17.0.2 (127.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 127.17.0.2: icmp_seq=1 ttl=64 time=0.033 ms</span><br><span class="line">64 bytes from 127.17.0.2: icmp_seq=2 ttl=64 time=0.055 ms</span><br><span class="line">^C</span><br><span class="line">--- 127.17.0.2 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 1001ms</span><br><span class="line">rtt min/avg/max/mdev = 0.033/0.044/0.055/0.011 ms</span><br><span class="line"></span><br><span class="line">[root@docker ~]# iptables -t nat -vnL</span><br><span class="line">Chain PREROUTING (policy ACCEPT 47 packets, 6015 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source          destination         </span><br><span class="line">    9   468 DOCKER     all  --  *      *       0.0.0.0/0       0.0.0.0/0      ADDRTYPE match dst-type LOCAL</span><br><span class="line"></span><br><span class="line">Chain INPUT (policy ACCEPT 47 packets, 6015 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination   </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT 84 packets, 5287 bytes)</span><br><span class="line"> pkts bytes target     prot opt in     out     source         destination         </span><br><span class="line">    2   120 DOCKER     all  --  *      *       0.0.0.0/0      !127.0.0.0/8   ADDRTYPE match dst-type LOCAL</span><br><span class="line"></span><br><span class="line">Chain POSTROUTING (policy ACCEPT 84 packets, 5287 bytes)  # 该命令展示结果如下图所示</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination         </span><br><span class="line">    0     0 MASQUERADE  all  --  *      !docker0  172.17.0.0/16        0.0.0.0/0   </span><br><span class="line"></span><br><span class="line">Chain DOCKER (2 references)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination   </span><br><span class="line">    0     0 RETURN     all  --  docker0 *       0.0.0.0/0            0.0.0.0/0    </span><br></pre></td></tr></table></figure>

<p>​       上文iptables转发如下图所示：</p>
 <img src="/image-20200717164244473.png" alt="image-20200717164244473" style="zoom:67%;" />

<ul>
<li>外网如何访问容器？通过端口映射以及选项指定映射端口</li>
<li>外网访问容器用到了<code>docker-proxy</code>和<code>iptables DNAT </code>宿主机访问本机容器使用的是<code>iptables DNAT</code>外部主机访问容器或容器之间的访问是<code>docker-proxy</code>实现</li>
</ul>
<h3 id="4-2-桥接模式下暴露端口"><a href="#4-2-桥接模式下暴露端口" class="headerlink" title="4.2 桥接模式下暴露端口"></a>4.2 桥接模式下暴露端口</h3><p>docker run [-p/-P] ：为容器暴露的所有端口进行映射。</p>
<p>-P：<strong>将容器内部开放的网络端口随机映射到宿主机的一个端口上</strong>。</p>
<p>-p：指定要映射的端口，可以指定宿主机上的端口，容器的端口或两者都指定。</p>
<p>有四种方式：</p>
<ul>
<li><strong>ContainerPort</strong><br><code>docker run -p 80 -i -t IMAGE /bin/bash</code><br>指定容器端口，宿主机端口随机映射</li>
<li><strong>hostPort:Container:Port</strong><br><code>docker run -p 8080:80 -i -t IMAGE /bin/bash</code><br>同时指定宿主机和容器的端口</li>
<li><strong>ip::containerPort</strong><br><code>docker run -p 0.0.0.0:80 -i -t IMAGE /bin/bash</code></li>
<li><strong>ip:hostPort:containerPort</strong><br><code>docker run -p 0.0.0.0:8080:80 -i -t IMAGE /bin/bash</code><br>指定ip，宿主机端口，容器的端口</li>
</ul>
<h4 id="4-2-1-暴露随机端口"><a href="#4-2-1-暴露随机端口" class="headerlink" title="4.2.1 暴露随机端口"></a>4.2.1 暴露随机端口</h4><ul>
<li>-P的使用方法：将容器内开放的端口随机映射到宿主机的高位端口上，通过访问宿主机的该端口就能访问到容器中的相应的服务。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">scaven/nginx        1.2                 0901fa9da894        6 days ago          132MB</span><br><span class="line">centos              centos7.6.1810      f1cb7c7d58b7        16 months ago       202MB</span><br><span class="line">ubuntu              15.10               9b9cb95443b5        3 years ago         137MB</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker run -d -P --name web01  0901fa9da894   # 启动容器</span><br><span class="line">3f1cbb448709d5d7a22e56c5b505ca1fcce972e7daf14e33a23a58125ae7bb18</span><br><span class="line"><span class="meta">#</span><span class="bash"> 为了方便解释，下面将进行截图展示结果</span></span><br></pre></td></tr></table></figure>

<p>此时查看防火墙转发规则如下：</p>
<p><img src="/image-20200717173433753.png" alt="image-20200717173433753"></p>
<p>由于已经暴露了端口，因此可以进行远程访问nginx服务：</p>
<p><img src="/image-20200717173637134.png" alt="image-20200717173637134"></p>
<ul>
<li>-p：使用<code>-p 容器端口</code>进行随机端口映射</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker run -d -p 80 --name web03  0901fa9da894</span><br><span class="line">6cdfd996b45cdddf670666f0697db57b500cbfa189646ab4910cdf485bf826e2</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker port 6cdfd996b45c</span><br><span class="line">80/tcp -&gt; 0.0.0.0:32769</span><br><span class="line">[root@docker ~]# iptables -t nat -vnL</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>此时查看防火墙转发规则如下：</p>
<p><img src="/image-20200717174757495.png" alt="image-20200717174757495"></p>
<p>主机上端口的使用情况：</p>
<p><img src="/image-20200717175052992.png" alt="image-20200717175052992"></p>
<ul>
<li>-p：使用<code>-p ip::容器端口</code>进行随机端口映射</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker run -d -p 127.0.0.1::80 --name web04  0901fa9da894</span><br><span class="line">5a1d7105ef29a9ad9e4b31e05f2487427564beed1de185f378ad3223c53eeff9</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker port 5a1d7105ef29</span><br><span class="line">80/tcp -&gt; 127.0.0.1:32770</span><br><span class="line">[root@docker ~]# iptables -t nat -vnL</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 由于是暴露了127.0.0.1:32700端口，因此只能本机访问</span></span><br></pre></td></tr></table></figure>

<p>此时查看防火墙转发规则和主机端口映射情况如下：</p>
<p><img src="/image-20200717175511320.png" alt="image-20200717175511320"></p>
<h4 id="4-2-3-暴露指定端口"><a href="#4-2-3-暴露指定端口" class="headerlink" title="4.2.3 暴露指定端口"></a>4.2.3 暴露指定端口</h4><ul>
<li>-p：使用<code>-p 宿主机端口:容器端口</code>进行指定端口映射</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker run -d -p 8080:80 --name web02  0901fa9da894</span><br><span class="line">3a51900386cb2962e8bc52ba19e64fe8554bd29965b00170c426cfe87b6eab07</span><br><span class="line">[root@docker ~]# docker port 3a51900386cb</span><br><span class="line">80/tcp -&gt; 0.0.0.0:8080</span><br></pre></td></tr></table></figure>

<p>端口映射情况如下图所示：</p>
<p><img src="/image-20200717174102237.png" alt="image-20200717174102237"></p>
<p>主机上端口的使用情况：</p>
<p><img src="/image-20200717174304064.png" alt="image-20200717174304064"></p>
<ul>
<li>p：使用<code>-p 宿主机IP:宿主机端口:容器端口</code>进行指定端口映射</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker run -d -p 10.138.3.15:9999:80 --name web06  0901fa9da894</span><br><span class="line">95b7279dbe9d046b98e59c37ba222c76b727842c71bcb75b9dfca78f2852cd2f</span><br><span class="line">[root@docker ~]# docker port 95b7279dbe9d</span><br><span class="line">80/tcp -&gt; 10.138.3.15:9999</span><br></pre></td></tr></table></figure>

<p>防火墙转发规则如下：</p>
<p><img src="/image-20200717180410967.png" alt="image-20200717180410967"></p>
<p>外部访问：</p>
<p><img src="/image-20200717180202403.png" alt="image-20200717180202403"></p>
<h3 id="4-3-跨主机间的docker网络–macvlan"><a href="#4-3-跨主机间的docker网络–macvlan" class="headerlink" title="4.3 跨主机间的docker网络–macvlan"></a>4.3 跨主机间的docker网络–macvlan</h3><p>​        macvlan可以实现两台主机上的容器相互访问，做法是在两台宿主机上都新建macvlan类型的网络，macvlan等同于将在两台宿主机之间新建了一个用于容器通信的交换机。</p>
<p>步骤： </p>
<ul>
<li>新建网络类型</li>
<li>创建新容器时指定该类型的网络</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在两台宿主机上分别执行以下的命令</span></span><br><span class="line">[root@harbor ~]# docker network create --driver macvlan --subnet=10.0.0.0/24 --gateway=10.0.0.254 -o parent=ens33 macvlan_1</span><br><span class="line">4e2b6de803cc06d2cbed2823f46175c6f2fd82fd758e0fb862872359a6e17420</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker network create --driver macvlan --subnet=10.0.0.0/24 --gateway=10.0.0.254 -o parent=ens33 macvlan_1</span><br><span class="line">c44710c51f5fb2abdeec89920df103b4aac71b5986ca478e9d118818d09f614f</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建成功后，可以看到多了一个网络类型</span></span><br><span class="line">[root@docker ~]# docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">b7becea03c6a        bridge              bridge              local</span><br><span class="line">86c30ec76685        host                host                local</span><br><span class="line">c44710c51f5f        macvlan_1           macvlan             local</span><br><span class="line">c2385d5ccbf9        none                null                local</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建容器</span></span><br><span class="line">[root@docker ~]# docker run -it --network macvlan_1 centos:centos6.10 /bin/bash</span><br><span class="line">[root@4017011864b7 /]# ifconfig </span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 02:42:0A:00:00:01  </span><br><span class="line">          inet addr:10.0.0.1  Bcast:10.0.0.255  Mask:255.255.255.0</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</span><br><span class="line">          RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在另一台主机上新建容器</span></span><br><span class="line">[root@harbor ~]# docker run -it --network macvlan_1 centos:centos6.10 /bin/bash</span><br><span class="line">[root@f1486558f4e7 /]# ifconfig </span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 02:42:0A:00:00:01  </span><br><span class="line">          inet addr:10.0.0.1  Bcast:10.0.0.255  Mask:255.255.255.0</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</span><br><span class="line">          RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​        此时，我们可以看到，如果不手动指定容器的IP地址，将都分配10.0.0.1的IP地址(没有统一的网络管理，需人工手动指定IP地址，因此使用较少)，因此下面我们在启动容器时，指定容器的IPi地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动容器时通过--ip=xx.xx.xx.xx指定IP地址</span></span><br><span class="line">[root@docker ~]# docker run -it --network macvlan_1 --ip=10.0.0.11 centos:centos6.10 /bin/bash</span><br><span class="line">[root@e74abdd244aa /]# ifconfig </span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 02:42:0A:00:00:0B  </span><br><span class="line">          inet addr:10.0.0.11  Bcast:10.0.0.255  Mask:255.255.255.0</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</span><br><span class="line">          RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下面启动一个centos7.6的镜像，7.6有ping命令，可以用于测试网络</span></span><br><span class="line">[root@docker ~]# docker run -it --network macvlan_1 --ip=10.0.0.12 centos:centos7.6.1810 /bin/bash       </span><br><span class="line">[root@9ce61bc01548 /]# ping 10.0.0.11  # 可以ping通另一台主机上的容器</span><br><span class="line">PING 10.0.0.11 (10.0.0.11) 56(84) bytes of data.</span><br><span class="line">64 bytes from 10.0.0.11: icmp_seq=1 ttl=64 time=0.178 ms</span><br><span class="line">64 bytes from 10.0.0.11: icmp_seq=2 ttl=64 time=0.090 ms</span><br><span class="line">^C</span><br><span class="line">--- 10.0.0.11 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 1001ms</span><br><span class="line">rtt min/avg/max/mdev = 0.090/0.134/0.178/0.044 ms</span><br><span class="line">[root@9ce61bc01548 /]# ping baidu.com  # 不能访问外网</span><br><span class="line">ping: baidu.com: Name or service not known</span><br><span class="line"></span><br><span class="line">[root@9ce61bc01548 /]# ping 10.138.3.13  # 不能访问宿主机</span><br><span class="line">PING 10.138.3.13 (10.138.3.13) 56(84) bytes of data.</span><br><span class="line">From 10.0.0.12 icmp_seq=1 Destination Host Unreachable</span><br></pre></td></tr></table></figure>





<h3 id="4-4-docker容器的一般性管理"><a href="#4-4-docker容器的一般性管理" class="headerlink" title="4.4 docker容器的一般性管理"></a>4.4 docker容器的一般性管理</h3><p>​        docker容器由于只有程序运行的最小环境，因此我们进入容器后，很难使用管理命令进行查询(命令未安装)，因此，一般情况下我们对容器的管理都是在宿主机上直接管理，而不是进入容器内。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker ps  # 查看主机上的容器进程</span><br><span class="line">CONTAINER ID    IMAGE     COMMAND      CREATED       STATUS        PORTS               NAMES</span><br><span class="line">95b7279dbe9d    0901fa9da894  &quot;/docker-entrypoint.…&quot;  12 minutes ago   Up 12 minutes       10.138.3.15:9999-&gt;80/tcp   web06</span><br><span class="line">5a1d7105ef29    0901fa9da894  &quot;/docker-entrypoint.…&quot;   21 minutes ago  Up 21 minutes       127.0.0.1:32770-&gt;80/tcp   web04</span><br><span class="line">6cdfd996b45c    0901fa9da894  &quot;/docker-entrypoint.…&quot;   28 minutes ago  Up 28 minutes       0.0.0.0:32769-&gt;80/tcp   web03</span><br><span class="line">3f1cbb448709    0901fa9da894  &quot;/docker-entrypoint.…&quot;   44 minutes ago  Up 44 minutes       0.0.0.0:32768-&gt;80/tcp   web01</span><br><span class="line">[root@docker ~]# docker container top 95b7279dbe9d  # 查看指定容器内的进程</span><br><span class="line">UID      PID        PPID        C     STIME      TTY    TIME         CMD</span><br><span class="line">root     21685      21667       0     18:01      ?    00:00:00   nginx: master process nginx -g daemon off;</span><br><span class="line">101      21739      21685       0     18:01      ?    00:00:00   nginx: worker process</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器运行日志</span></span><br><span class="line">[root@docker ~]# docker container logs --help </span><br><span class="line">Usage:	docker container logs [OPTIONS] CONTAINER</span><br><span class="line">Fetch the logs of a container</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --details        Show extra details provided to logs</span><br><span class="line">  -f, --follow         Follow log output</span><br><span class="line">      --since string   Show logs since timestamp (e.g. 2013-01-02T13:23:37) or relative (e.g. 42m for 42 minutes)</span><br><span class="line">      --tail string    Number of lines to show from the end of the logs (default &quot;all&quot;)</span><br><span class="line">  -t, --timestamps     Show timestamps  # 显示时间</span><br><span class="line">      --until string   Show logs before a timestamp (e.g. 2013-01-02T13:23:37) or relative (e.g. 42m for 42 minutes)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看指定容器的日志信息</span></span><br><span class="line">[root@docker ~]# docker container logs 95b7279dbe9d</span><br><span class="line">/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration</span><br><span class="line">/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</span><br><span class="line">10-listen-on-ipv6-by-default.sh: Getting the checksum of /etc/nginx/conf.d/default.conf</span><br><span class="line">10-listen-on-ipv6-by-default.sh: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</span><br><span class="line">/docker-entrypoint.sh: Configuration complete; ready for start up</span><br><span class="line">10.138.3.1 - - [17/Jul/2020:10:01:50 +0000] &quot;GET / HTTP/1.1&quot; 200 612 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36&quot; &quot;-&quot;</span><br><span class="line">2020/07/17 10:01:50 [error] 28#28: *1 open() &quot;/usr/share/nginx/html/favicon.ico&quot; failed (2: No such file or directory), client: 10.138.3.1, server: localhost, request: &quot;GET /favicon.ico HTTP/1.1&quot;, host: &quot;10.138.3.15:9999&quot;, referrer: &quot;http://10.138.3.15:9999/&quot;</span><br><span class="line">10.138.3.1 - - [17/Jul/2020:10:01:50 +0000] &quot;GET /favicon.ico HTTP/1.1&quot; 404 555 &quot;http://10.138.3.15:9999/&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36&quot; &quot;-&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看指定容器的最近5条日志信息</span></span><br><span class="line">[root@docker ~]# docker container logs -tf --tail 5  95b7279dbe9d</span><br><span class="line"><span class="meta">#</span><span class="bash"> -t 显示日志时间； -f ；--tail 动态显示日志</span></span><br><span class="line">2020-07-17T10:01:05.405618181Z /docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</span><br><span class="line">2020-07-17T10:01:05.407662304Z /docker-entrypoint.sh: Configuration complete; ready for start up</span><br><span class="line">2020-07-17T10:01:50.787156188Z 10.138.3.1 - - [17/Jul/2020:10:01:50 +0000] &quot;GET / HTTP/1.1&quot; 200 612 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36&quot; &quot;-&quot;</span><br><span class="line">2020-07-17T10:01:50.885303440Z 2020/07/17 10:01:50 [error] 28#28: *1 open() &quot;/usr/share/nginx/html/favicon.ico&quot; failed (2: No such file or directory), client: 10.138.3.1, server: localhost, request: &quot;GET /favicon.ico HTTP/1.1&quot;, host: &quot;10.138.3.15:9999&quot;, referrer: &quot;http://10.138.3.15:9999/&quot;</span><br><span class="line">2020-07-17T10:01:50.885398127Z 10.138.3.1 - - [17/Jul/2020:10:01:50 +0000] &quot;GET /favicon.ico HTTP/1.1&quot; 404 555 &quot;http://10.138.3.15:9999/&quot; &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36&quot; &quot;-&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h2 id="五-docker容器存储"><a href="#五-docker容器存储" class="headerlink" title="五. docker容器存储"></a>五. docker容器存储</h2><p>​        将数据从宿主机挂载到容器中的三种方式：</p>
<ul>
<li>volumes：Docker管理宿主机文件系统的一部分(/var/lib/docker/volumes)，保存数据的最佳方法</li>
<li>bind mounts：将宿主机上的任意位置的文件或者目录挂载到容器中。</li>
<li>tmpfs：挂载存储在主机系统的内存中，而不会写入主机的文件系统。如果不希望将数据持久化存储在任何位置，可以使用tmpfs，同时避免写入容器可写层提高性能。</li>
</ul>
<img src="/image-20210401154508985.png" alt="image-20210401154508985" style="zoom:67%;" />

<h3 id="添加–5-1-volumes："><a href="#添加–5-1-volumes：" class="headerlink" title="添加–5.1 volumes："></a>添加–5.1 volumes：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker volume ls</span></span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line"><span class="meta">#</span><span class="bash"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker volume --<span class="built_in">help</span></span></span><br><span class="line"></span><br><span class="line">Usage:  docker volume COMMAND</span><br><span class="line"></span><br><span class="line">Manage volumes</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  create      Create a volume   # 新建卷</span><br><span class="line">  inspect     Display detailed information on one or more volumes  # 查看卷信息</span><br><span class="line">  ls          List volumes     # 列出当前系统上的容器卷</span><br><span class="line">  prune       Remove all unused local volumes   # 移除所有未使用的本地卷</span><br><span class="line">  rm          Remove one or more volumes        # 删除卷</span><br><span class="line"></span><br><span class="line">Run &#x27;docker volume COMMAND --help&#x27; for more information on a command.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker volume create nginx-vol</span></span><br><span class="line">nginx-vol</span><br><span class="line"><span class="meta">#</span><span class="bash"> docker volume ls</span></span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     nginx-vol</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker volume inspect  nginx-vol</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2021-04-01T16:01:18+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/nginx-vol/_data&quot;,   # 挂载点</span><br><span class="line">        &quot;Name&quot;: &quot;nginx-vol&quot;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ll  /var/lib/docker/volumes/</span></span><br><span class="line">total 24</span><br><span class="line">brw------- 1 root root 253, 0 Apr  1 10:59 backingFsBlockDev</span><br><span class="line">-rw------- 1 root root  32768 Apr  1 15:49 metadata.db </span><br><span class="line">drwx-----x 3 root root     19 Apr  1 15:49 nginx-vol   # 刚刚新建的容器卷</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建容器并挂载容器挂</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker run -d --name nginx-web01 --mount src=nginx-vol,dst=/usr/share/nginx/html nginx</span></span><br><span class="line">5b001e1b7aa012f677b733bba3186cee072b89d0f2845e3dbdc99c46e93b6674</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 上面的写法也可以使用-v，如下</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker run -d --name nginx-web01 -v nginx-vol:/usr/share/nginx/html nginx</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls /var/lib/docker/volumes/nginx-vol/_data/</span></span><br><span class="line">50x.html  index.html   # 使用volume后，把nginx根目录中的文件保留了下来</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker <span class="built_in">exec</span> -it nginx-web01 bash   <span class="comment"># 进入到容器中查看nginx的根目录</span></span></span><br><span class="line">root@5b001e1b7aa0:/# ls /usr/share/nginx/html/</span><br><span class="line">50x.html  index.html</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在容器中nginx根目录或者容器卷中新建文件/目录，容器内和宿主机上的容器卷都是一样的显示内容</span></span><br><span class="line">root@5b001e1b7aa0:/usr/share/nginx/html# echo `date` &gt; date.html  # 在容器内新建文件</span><br><span class="line">root@5b001e1b7aa0:/usr/share/nginx/html# cat date.html </span><br><span class="line">Thu Apr 1 07:58:05 UTC 2021</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> curl 172.17.0.4/date.html  <span class="comment"># 在宿主机上访问date.html文件</span></span></span><br><span class="line">Thu Apr 1 07:58:05 UTC 2021</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看宿主机上的容器卷目录</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls /var/lib/docker/volumes/nginx-vol/_data/</span></span><br><span class="line">50x.html  date.html  index.html</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在宿主机容器卷nginx-vol内新建文件，查看容器内nginx根目录的变化</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> mkdir /var/lib/docker/volumes/nginx-vol/_data/data</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls /var/lib/docker/volumes/nginx-vol/_data/</span></span><br><span class="line">50x.html  data  date.html  index.html</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 容器内nginx根目录显示内容：</span></span><br><span class="line">root@5b001e1b7aa0:/usr/share/nginx/html# ls </span><br><span class="line">50x.html  data	date.html  index.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 我们在不创建容器卷，直接使用-v选项时，默认自动创建容器卷，如下</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker run -d --name nginx-web02 -v nginx-vol2:/usr/share/nginx/html nginx</span></span><br><span class="line">50b894e5d6889fcc276f1f200491365b0dc9f7a0e865cd8616c1759436e2dfce</span><br><span class="line"><span class="meta">#</span><span class="bash"> ls /var/lib/docker/volumes/</span></span><br><span class="line">backingFsBlockDev  metadata.db        nginx-vol/         nginx-vol2/        </span><br><span class="line"><span class="meta">#</span><span class="bash"> ls /var/lib/docker/volumes/nginx-vol2/</span></span><br><span class="line">_data</span><br><span class="line"><span class="meta">#</span><span class="bash"> docker volume ls</span> </span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     nginx-vol</span><br><span class="line">local     nginx-vol2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 此时删除容器，容器卷中的数据依旧存在，并且将该容器卷挂载给下一个新建的容器，也没有问题</span></span><br></pre></td></tr></table></figure>

<h3 id="添加–5-2-bind-mounts："><a href="#添加–5-2-bind-mounts：" class="headerlink" title="添加–5.2 bind mounts："></a>添加–5.2 bind mounts：</h3><p>​        将宿主机上的任一个目录挂载到容器中，若该目录不存在，将自动新建，会覆盖掉容器内的指定目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ls /data_docker/</span></span><br><span class="line">share</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker run -d --name nginx-web03 -v /data_docker/wwwroot/:/usr/share/nginx/html nginx</span></span><br><span class="line">8d3cc664a13e87b6da052f2812ac0fe471e3e7c77959e1bc74eb3d916a3153e5  # 宿主机的路径必须是绝对路径</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls /data_docker/</span></span><br><span class="line">share  wwwroot</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls /data_docker/wwwroot/</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                            <span class="comment">#使用bind mounts后，宿主机目录将容器内目录覆盖掉了</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker volume ls    <span class="comment"># 容器卷不包含bind mounts挂载的目录</span></span></span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     nginx-vol</span><br><span class="line">local     nginx-vol2</span><br></pre></td></tr></table></figure>











 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 批量停止并删除宿主机上容器</span></span><br><span class="line">[root@docker ~]# docker container stop  `docker container ls -a -q`</span><br><span class="line">[root@docker ~]# docker container rm `docker container ls -a -q`</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动一个对外访问的nginx服务</span></span><br><span class="line">[root@docker ~]# docker run -d -p 10.138.3.15:80:80 --name web01  0901fa9da894</span><br><span class="line">b203bce1e8cf658e50207fe143a27a5b8992c2c02961386fc58529a73d1f51c2</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker exec -it web01 /bin/bash  # 进入容器</span><br><span class="line">root@b203bce1e8cf:/# cd /usr/share/nginx/html/</span><br><span class="line">root@b203bce1e8cf:/usr/share/nginx/html# ls </span><br><span class="line">50x.html  index.html</span><br><span class="line">root@b203bce1e8cf:/usr/share/nginx/html# vim index.html   # 没有安装vim命令</span><br><span class="line">bash: vim: command not found</span><br><span class="line">root@b203bce1e8cf:/usr/share/nginx/html# vi index.html    # 没有安装vi命令</span><br><span class="line">bash: vi: command not found</span><br><span class="line">root@b203bce1e8cf:/usr/share/nginx/html# echo &quot;hello nginx&quot; &gt; index.html</span><br><span class="line">root@b203bce1e8cf:/usr/share/nginx/html# cat index.html </span><br><span class="line">hello nginx</span><br><span class="line"></span><br><span class="line">root@b203bce1e8cf:/usr/share/nginx/html# cat /etc/issue   # 是debian的系统</span><br><span class="line">Debian GNU/Linux 10 \n \l</span><br><span class="line"></span><br><span class="line">root@b203bce1e8cf:/usr/share/nginx/html# apt-get  install vim   # 未配置源安装vim出错</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree       </span><br><span class="line">Reading state information... Done</span><br><span class="line">E: Unable to locate package vim</span><br></pre></td></tr></table></figure>

<p>​        由于容器只是一个最小化的程序运行环境，因此，我们要想登录到容器内进行管理，是一件很麻烦的的事儿，而且</p>
<h3 id="5-1-手工数据交互"><a href="#5-1-手工数据交互" class="headerlink" title="5.1 手工数据交互"></a>5.1 手工数据交互</h3><p>如何手动实现宿主机与容器进行数据交互</p>
<ul>
<li>将容器中的文件拷贝到宿主机中：<code>docker container cp container_name:container_Path host_Path</code></li>
<li>将宿主机文件拷贝到容器中：<code>docker container cp host_Path container_name:container_Path</code></li>
</ul>
<blockquote>
<p>tips：该方法只使用于量小的文件拷贝</p>
</blockquote>
<p><code>docker container cp</code>的用法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker container cp --help</span><br><span class="line"></span><br><span class="line">Usage:	docker container cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH</span><br><span class="line">	    docker cp [OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH</span><br><span class="line"></span><br><span class="line">Copy files/folders between a container and the local filesystem</span><br><span class="line"></span><br><span class="line">Use &#x27;-&#x27; as the source to read a tar archive from stdin</span><br><span class="line">and extract it to a directory destination in a container.</span><br><span class="line">Use &#x27;-&#x27; as the destination to stream a tar archive of a</span><br><span class="line">container source to stdout.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -a, --archive       Archive mode (copy all uid/gid information)</span><br><span class="line">  -L, --follow-link   Always follow symbol link in SRC_PATH</span><br></pre></td></tr></table></figure>

<p>将宿主机上的文件拷贝到容器中：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# echo &quot;today is `date +%F`&quot; &gt; date.html</span><br><span class="line">[root@docker ~]# docker container cp ./date.html  web01:/usr/share/nginx/html/</span><br></pre></td></tr></table></figure>

<p>通过浏览器访问，结果如下：</p>
<p><img src="/image-20200718151059368.png" alt="image-20200718151059368"></p>
<p>将nginx容器中的文件拷贝到宿主机：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker container cp  web01:/usr/share/nginx/html/index.html .</span><br><span class="line">[root@docker ~]# cat index.html </span><br><span class="line">hello nginx</span><br></pre></td></tr></table></figure>

<h3 id="5-2-持久卷–volume"><a href="#5-2-持久卷–volume" class="headerlink" title="5.2 持久卷–volume"></a>5.2 持久卷–volume</h3><p>​        在容器的生命周期中，当用户删除容器后，容器中的数据也被删除，这样就造成了数据的丢失，那么如果将容器中的数据进行持久化存储呢？docker引入了volume的概念。</p>
<ul>
<li>-v： 格式为<code>-v 宿主机目录:容器目录</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 提前准备好nginx将要使用的根目录</span></span><br><span class="line">[root@docker html]# tree ../html/</span><br><span class="line">../html/</span><br><span class="line">├── date.html</span><br><span class="line">└── index.html</span><br><span class="line"></span><br><span class="line">0 directories, 2 files</span><br><span class="line">[root@docker html]# cat date.html  index.html </span><br><span class="line">today is 2020-07-18</span><br><span class="line">welcome to nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动容器，如果容器中原本没有映射的目录，在启动容器时，将自动创建映射目录</span></span><br><span class="line">[root@docker html]# docker run -d --name web02 -p 8080:80 -v /root/html:/usr/share/nginx/html  0901fa9da894</span><br><span class="line">204f493ce2cc29df1d86c408a4cfd5f797cc33f0861da2e0b7f586f9d1deda96</span><br><span class="line">[root@docker html]# docker ps    # 检查启动状态</span><br><span class="line">CONTAINER ID    IMAGE    COMMAND    CREATED    STATUS    PORTS     NAMES</span><br><span class="line">204f493ce2cc    0901fa9da894  &quot;/docker-entrypoint.…&quot;   17 seconds ago      Up 16 seconds  0.0.0.0:8080-&gt;80/tcp     web02</span><br><span class="line">b203bce1e8cf    0901fa9da894   &quot;/docker-entrypoint.…&quot;   21 hours ago        Up 18 minutes  10.138.3.15:80-&gt;80/tcp   web01</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入容器进行查看映射目录</span></span><br><span class="line">[root@docker html]# docker exec -it 204f493ce2cc  /bin/bash</span><br><span class="line">root@204f493ce2cc:/# ls /usr/share/nginx/html/</span><br><span class="line">date.html  index.html</span><br><span class="line">root@204f493ce2cc:/# cat  /usr/share/nginx/html/date.html </span><br><span class="line">today is 2020-07-18</span><br><span class="line">root@204f493ce2cc:/# cat  /usr/share/nginx/html/index.html </span><br><span class="line">welcome to nginx</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>通过浏览器访问：</p>
<p><img src="/image-20200718152847345.png" alt="image-20200718152847345"></p>
<p>​        此时，我们就可以在宿主机上修改nginx根目录中的文件内容，从而不再需要登录到容器内，即使在容器销毁后，宿主机中的nginx根目录也存在，从而达到了数据的持久性存储。</p>
<p>查看主机与容器卷的映射关系</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@docker html]# docker container inspect 204f493ce2cc</span><br><span class="line">···</span><br><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;bind&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/root/html&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/usr/share/nginx/html&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class="line">            &#125;</span><br><span class="line">····</span><br></pre></td></tr></table></figure>

<p>​        我们可以通过启动多个容器，映射同一个目录，从而实现nginx的高可用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker html]# docker run -d --name web03 -p 8000:80 -v /root/html:/usr/share/nginx/html  0901fa9da894</span><br><span class="line">2e5eeb728f82e138ba7fc638e1f168f6dfa2200a3d83f14e34c96edaf2eb8069</span><br></pre></td></tr></table></figure>

<p>​        上面我们启动了两个nginx容器，这两个nginx容器都将宿主机上的目录(等同于共享存储)与nginx容器的nginx服务根目录做了映射，因此我们访问两个nginx容器将得到相同的内容。</p>
<p><img src="/image-20200718155403030.png" alt="image-20200718155403030"></p>
<h3 id="5-3-数据卷容器"><a href="#5-3-数据卷容器" class="headerlink" title="5.3 数据卷容器"></a>5.3 数据卷容器</h3><p>​        通过5.2章节，我们知道，我们可以通过<code>-v</code>参数进行容器与主机磁盘的映射，那么如果有成百上千个容器都需要挂载，那么手动使用<code>-v</code>参数进行挂载将是一件可怕的事情。</p>
<p>​        在集中化管理集群中，大批量的容器都需要挂载相通的多个数据卷时，可以使用数据卷容器进行统一挂载和管理。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 宿主机模拟数据目录</span></span><br><span class="line">[root@docker ~]# tree /opt/Volume/</span><br><span class="line">/opt/Volume/</span><br><span class="line">├── a</span><br><span class="line">│?? └── a.txt</span><br><span class="line">└── b</span><br><span class="line">    └── b.txt</span><br><span class="line"></span><br><span class="line">2 directories, 2 files</span><br><span class="line">[root@docker ~]# cat /opt/Volume/a/a.txt  /opt/Volume/b/b.txt </span><br><span class="line">a  # /opt/Volume/a/a.txt中的内容</span><br><span class="line">b  # /opt/Volume/b/b.txt中的内容</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建并启动数据卷容器</span></span><br><span class="line">[root@docker ~]# docker run -it --name nginx_volumes -v /opt/Volume/a:/opt/a -v /opt/Volume/b:/opt/b f1cb7c7d58b7 /bin/bash </span><br><span class="line">[root@26d2c849bc9b /]# ls /opt/a/</span><br><span class="line">a.txt</span><br><span class="line">[root@26d2c849bc9b /]# ls /opt/b/</span><br><span class="line">b.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ctrl + p,q退出终端，以达到容器不停止</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 其他容器使用数据卷容器</span></span><br><span class="line">[root@docker ~]# docker run -d -p 8001:80 --volumes-from nginx_volumes --name web04   0901fa9da894</span><br><span class="line">0e7af67dafde5175aa4c0492e1e28f47e90c311ffffd11cd45adcb9763c139a8</span><br><span class="line">[root@docker ~]# docker run -d -p 8002:80 --volumes-from nginx_volumes --name web05   0901fa9da894</span><br><span class="line">608d643b5142c0a49314ec8d0a67e00ee8d4f2974b005fd5af8b5ea63b2a8169</span><br><span class="line"><span class="meta">#</span><span class="bash"> 上述中，即使nginx_volumes容器挂掉，也不会影响引用nginx_volumes容器卷的容器web04和web05</span></span><br></pre></td></tr></table></figure>

<p>验证：</p>
<ul>
<li>通过<code>docker exec</code>登录到容器内进行检查</li>
<li>通过<code>docker container inspect</code>查看容器详细信息进行检查</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker container inspect web04</span><br><span class="line">···</span><br><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;bind&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/opt/Volume/a&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/opt/a&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;bind&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/opt/Volume/b&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/opt/b&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class="line">            &#125;</span><br><span class="line">···</span><br></pre></td></tr></table></figure>

<p>​        这样的好处是，即使数据卷容器宕掉后，也不影响使用数据卷的其他容器。</p>
<p>案例：停止数据卷容器，查看web04和web05中是否还存在挂载的目录文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker container stop nginx_volumes </span><br><span class="line">nginx_volumes    # 停止数据卷容器</span><br><span class="line">[root@docker ~]# docker exec -it  web04 /bin/bash  # 进入web04容器</span><br><span class="line">root@0e7af67dafde:/# ls /opt/   # 该容器中仍然存在数据卷容器挂载的目录</span><br><span class="line">a  b</span><br><span class="line">root@0e7af67dafde:/# ls /opt/a/a.txt </span><br><span class="line">/opt/a/a.txt</span><br><span class="line">root@0e7af67dafde:/# ls /opt/b/b.txt </span><br><span class="line">/opt/b/b.txt</span><br></pre></td></tr></table></figure>

<blockquote>
<p>tips：数据卷容器简化了容器目录映射的方式，即使数据卷容器宕机，也不影响其他容器对挂载文件的使用。</p>
</blockquote>
<h2 id="六-自制docker镜像和docker仓库进阶"><a href="#六-自制docker镜像和docker仓库进阶" class="headerlink" title="六. 自制docker镜像和docker仓库进阶"></a>六. 自制docker镜像和docker仓库进阶</h2><h3 id="6-1准备工作："><a href="#6-1准备工作：" class="headerlink" title="6.1准备工作："></a>6.1准备工作：</h3><p>制作本地局域网yum源</p>
<ol>
<li>安装并启动vsftpd</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# yum -y install vsftpd</span><br><span class="line">[root@docker ~]# systemctl enable vsftpd &amp;&amp; systemctl start vsftpd</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>上传镜像到虚拟机</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# ls /mnt/iso/</span><br><span class="line">CentOS-6.10-x86_64-bin-DVD1.iso  CentOS-7.6-x86_64-DVD-1810.iso</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>配置yum仓库</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建ftp镜像挂载目录</span></span><br><span class="line">[root@docker ~]# mkdir -p /var/ftp/centos7.6</span><br><span class="line">[root@docker ~]# mkdir -p /var/ftp/centos6.10</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 挂载光盘文件到ftp镜像挂载目录</span></span><br><span class="line">[root@docker ~]# mount -o loop /mnt/iso/CentOS-6.10-x86_64-bin-DVD1.iso  /var/ftp/centos6.10/</span><br><span class="line">mount -o loop /mnt/iso/CentOS-7.6-x86_64-DVD-1810.iso  [root@docker ~]# /var/ftp/centos7.6/</span><br><span class="line"></span><br><span class="line">[root@docker ~]# cat &gt; /etc/yum.repos.d/ftp6.repo &lt;&lt; EOF</span><br><span class="line">[ftp6_10]</span><br><span class="line">name=ftp6_10</span><br><span class="line">baseurl=ftp://10.138.3.15/centos6.10</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">EOF</span><br><span class="line"><span class="meta">#</span><span class="bash"> 注意，如果用上述IP地址访问不到，就用docker0的地址，默认是172.17.0.1</span></span><br><span class="line"></span><br><span class="line">[root@docker ~]# cat &gt; /etc/yum.repos.d/ftp7.repo &lt;&lt; EOF</span><br><span class="line">[ftp7.6]</span><br><span class="line">name=ftp7.6</span><br><span class="line">baseurl=ftp://10.138.3.15/centos7.6</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>浏览器访问如下所示：</p>
<p><img src="/image-20200718181236918.png" alt="image-20200718181236918"></p>
<h3 id="6-2-docker镜像进阶"><a href="#6-2-docker镜像进阶" class="headerlink" title="6.2 docker镜像进阶"></a>6.2 docker镜像进阶</h3><p>Docker镜像含有启动容器所需要的文件系统及其内容，因此，其用于创建并启动docker容器。</p>
<ul>
<li><p>Docker镜像采用分层构建机制，最底层是bootfs（引导文件系统）、其次是tootfs（用户文件系统）：</p>
</li>
<li><p>bootfs用于系统引导的文件系统，包括boot loader和kernel，容器启动完成后会卸载以节约内存空间；</p>
</li>
<li><p>rootfs位于bootfs之上，表现为docker容器的根文件系统：传统模式中，系统启动之时，内核挂载rootfs时会首先将其挂载为“只读”模式，完整性自检完成后将其重新挂载为读写模式（Linux系统启动模式）；docker中，rootfs由内核挂载为“只读”模式，而后通过“联合挂载”技术额外挂载一个“可写”层；</p>
</li>
<li><p>下图中，位于下层的镜像为父镜像（parent image），最底层成为基础镜像（base image），最上层我“可读写”层，其下的均为“只读”层。</p>
</li>
</ul>
<p><img src="/clip_image052.jpg" alt="img"></p>
<p>​        Aufs（advanced multi-layered unification filesystem）：高级多层联合文件系统</p>
<p>​        用于Linux文件系统实现“联合挂载”，docker最初使用aufs作为容器文件系统层，它目前仍作为存储后端之一来支持；aufs的竞争产品overlayfs，后者自从3.18版本开始被合并到Linux内核，docker的分层镜像，除了aufs，还支持btrfs，devicemapper(dm)和vfs等（在Ubuntu系统中，aufs合并到了Ubuntu系统中；但CentOS系统未合并，因此使用aufs系统需打补丁，CentOS默认使用的是overlayfs）</p>
<p><img src="/clip_image054.jpg" alt="img"></p>
<h4 id="6-2-1-基于容器制作镜像："><a href="#6-2-1-基于容器制作镜像：" class="headerlink" title="6.2.1 基于容器制作镜像："></a>6.2.1 基于容器制作镜像：</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 删除之前的docker容器</span></span><br><span class="line">[root@docker ~]# docker container stop `docker container ls -a -q`</span><br><span class="line">[root@docker ~]# docker container rm  `docker container ls -a -q`</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker image ls | grep centos</span><br><span class="line">centos    centos6.10     48650444e419     16 months ago    194MB</span><br><span class="line">centos    centos7.6.1810 f1cb7c7d58b7     16 months ago    202MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动容器</span></span><br><span class="line">[root@docker ~]# docker run -it -d --name centos6.10 48650444e419 /bin/bash</span><br><span class="line">625565a2013b5ec622764991d24161e45d580287e58397463c54801a26377483</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker run -it -d --name centos7.6 f1cb7c7d58b7  /bin/bash</span><br><span class="line">9d064f7416ec58a303df244018588d936942460ab55bc50ada9f4a70b9869e7d</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 分别进入centos7.6和centos6.10容器配置各自版本的yum源</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将6的yum源配置到centos6.10容器中</span></span><br><span class="line">[root@625565a2013b /]# cat &gt; /etc/yum.repos.d/ftp6.repo &lt;&lt; EOF</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> [ftp6_10]</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> name=ftp6_10</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> baseurl=ftp://172.17.0.1/centos6.10</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> enabled=1</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> gpgcheck=0</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> EOF</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将7的yum源配置到centos7.6容器中</span></span><br><span class="line">[root@9d064f7416ec /]# cat &gt; /etc/yum.repos.d/ftp7.repo &lt;&lt; EOF</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> [ftp7.6]</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> name=ftp7.6</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> baseurl=ftp://172.17.0.1/centos7.6</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> enabled=1</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> gpgcheck=0</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> EOF</span></span><br><span class="line"></span><br><span class="line">[root@9d064f7416ec /]# yum clean all &amp;&amp; yum repolist</span><br><span class="line">···</span><br><span class="line">repo id               repo name                status</span><br><span class="line">base/7/x86_64         CentOS-7 - Base          10070</span><br><span class="line">extras/7/x86_64       CentOS-7 - Extras        412</span><br><span class="line">ftp7.6                ftp7.6                   4021</span><br><span class="line">updates/7/x86_64      CentOS-7 - Updates       900</span><br><span class="line">repolist: 22116</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装ssh服务并启动，以便通过ssh服务进行登录容器</span></span><br><span class="line">[root@9d064f7416ec /]# yum -y install openssh* net-tools</span><br><span class="line">[root@9d064f7416ec ~]# ifconfig  | grep 172.17</span><br><span class="line">    inet 172.17.0.3  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">[root@9d064f7416ec ~]# echo &quot;root:123456&quot; | chpasswd </span><br><span class="line">[root@9d064f7416ec ~]# systemctl start sshd</span><br><span class="line">[root@9d064f7416ec ~]# systemctl enable sshd</span><br><span class="line"></span><br><span class="line">[root@625565a2013b /]# yum -y install openssh* net-tools</span><br><span class="line">[root@625565a2013b ~]# echo &quot;root:123456&quot; | chpasswd </span><br><span class="line">[root@625565a2013b ~]# ifconfig  | grep 172.17</span><br><span class="line">    inet addr:172.17.0.2  Bcast:172.17.255.255  Mask:255.255.0.0</span><br><span class="line">[root@625565a2013b ~]# service  sshd start</span><br><span class="line">Generating SSH2 RSA host key:                              [  OK  ]  # 生成了某些文件</span><br><span class="line">Generating SSH1 RSA host key:                              [  OK  ]  # 生成了某些文件</span><br><span class="line">Generating SSH2 DSA host key:                              [  OK  ]  # 生成了某些文件</span><br><span class="line">Starting sshd:                                             [  OK  ]</span><br><span class="line">[root@625565a2013b ~]# chkconfig  --add sshd</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里我们配置本地yum源的目的只是为了展示本地yum源的配置方法，而且一般情况下，公司使用的都是内网环境，因此配置本地yum源是必须的。</span></span><br></pre></td></tr></table></figure>

<p>​        上面的容器就是再原有容器的基础上，添加了ssh服务，因此我们可以将该容器进行保存为镜像，以便后期使用，而不是每次都进行指定软件包的安装。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker ps</span><br><span class="line">CONTAINER ID     IMAGE       COMMAND     CREATED        STATUS   PORTS     NAMES</span><br><span class="line">9d064f7416ec     f1cb7c7d58b7 &quot;/bin/bash&quot; 54 minutes ago  Up 38 minutes   centos7.6</span><br><span class="line">625565a2013b     48650444e419  &quot;/bin/bash&quot; 55 minutes ago  Up 42 minutes   centos6.10</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker commit --help  # docker commit的用法</span><br><span class="line">Usage:	docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</span><br><span class="line">Create a new image from a container&#x27;s changes</span><br><span class="line">Options:</span><br><span class="line">  -a, --author string    Author (e.g., &quot;John Hannibal Smith &lt;hannibal@a-team.com&gt;&quot;)</span><br><span class="line">  -c, --change list      Apply Dockerfile instruction to the created image</span><br><span class="line">  -m, --message string   Commit message</span><br><span class="line">  -p, --pause            Pause container during commit (default true)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker  commit centos7.6 scaven:cnetos7.6</span><br><span class="line">sha256:0668a0538f149667fcaab1950f942bfbbdfd57db01b7674c2b4e3b0a11c0c291</span><br><span class="line">[root@docker ~]# docker  commit centos6.10 scaven:cnetos6.10</span><br><span class="line">sha256:f1b33ecfb10763152ed80217b3a729b505983fecda4d22c19163c0a6bd2a9eb3</span><br><span class="line">[root@docker ~]# docker image ls</span><br><span class="line">REPOSITORY   TAG      IMAGE ID      CREATED             SIZE</span><br><span class="line">scaven       cnetos6.10 f1b33ecfb107  7 seconds ago     485MB</span><br><span class="line">scaven       cnetos7.6  0668a0538f14  20 seconds ago    424MB</span><br><span class="line">scaven/nginx 1.2        0901fa9da894  8 days ago        132MB</span><br><span class="line">centos       centos6.10 48650444e419  16 months ago     194MB</span><br><span class="line">centos       centos7.6.1810  f1cb7c7d58b7  16 months ago  202MB</span><br><span class="line">ubuntu       15.10      9b9cb95443b5   3 years ago      137MB</span><br></pre></td></tr></table></figure>

<p>​        此时我们可以通过保存下来的镜像(保存了容器中的各种文件)，启动容器，但是值得注意的是，启动该容器并不会有启动ssh服务(保存了容器中的各种文件，ssh服务的启动并没有在容器的文件中，因为我们是在命令行启动的ssh服务)，因为我们保存镜像时，保存的是当前的文件系统，并不能保存容器中的进程，因此，ssh服务是没有启动的，要么我们手动指定启动ssh服务(进入容器内启动或启动容器时在命令行指定)，要么我们将ssh添加到容器启动时的默认执行命令。</p>
<ul>
<li>进入容器内启动</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker run -it -d  --name centos6_sshd f1b33ecfb107  /bin/bash </span><br><span class="line">d6f755ad89cfaadae10fd92cd2ee1aaedebee00fd79c6b6673bf03ddc80e9428</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker exec -it d6f755ad89cf /bin/bash</span><br><span class="line">[root@d6f755ad89cf /]# netstat  -lntp</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address   Foreign Address  State  PID/Program name   </span><br><span class="line">[root@d6f755ad89cf /]# service sshd start</span><br><span class="line">Starting sshd:                                             [  OK  ]</span><br><span class="line">[root@d6f755ad89cf /]# netstat  -lntp</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name </span><br><span class="line">tcp   0      0      0.0.0.0:22    0.0.0.0:*       LISTEN   49/sshd       </span><br><span class="line">tcp   0      0      :::22         :::*            LISTEN   49/sshd  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ctrl p,q 退出</span></span><br></pre></td></tr></table></figure>

<ul>
<li>启动容器时命令行指定启动</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE      COMMAND    CREATED    STATUS   PORTS  NAMES</span><br><span class="line">d6f755ad89cf   f1b33ecfb107  &quot;/bin/bash&quot;  7 minutes ago  Up 7 minutes         centos6_sshd</span><br><span class="line">9d064f7416ec   f1cb7c7d58b7  &quot;/bin/bash&quot;  About an hour ago Up About an hour  centos7.6</span><br><span class="line">625565a2013b   48650444e419  &quot;/bin/bash&quot;  About an hour ago  Up About an hour  centos6.10</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker run -it -d  --name centos6_ssh f1b33ecfb107 service sshd start</span><br><span class="line">a2a0ce8779e6724aeb861c5b667799c66e7e4cdf85c0ebed8eeebb77057ff3bf</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE      COMMAND    CREATED    STATUS   PORTS  NAMES</span><br><span class="line">d6f755ad89cf   f1b33ecfb107  &quot;/bin/bash&quot;  7 minutes ago  Up 7 minutes         centos6_sshd</span><br><span class="line">9d064f7416ec   f1cb7c7d58b7  &quot;/bin/bash&quot;  About an hour ago Up About an hour  centos7.6</span><br><span class="line">625565a2013b   48650444e419  &quot;/bin/bash&quot;  About an hour ago  Up About an hour  centos6.10</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​        从上我们可以看出，容器执行完<code>service sshd start</code>命令后就直接停止运行了(执行命令<code>service sshd start</code>的窗口退出，容器就停止运行)，那么我们是否可以将ssh服务放在前台启动，即启动ssh服务的窗口永远不关闭</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用/usr/sbin/sshd -D命令可以将ssh服务前台启动，即窗口一直不退出，夯在前台，因此容器也不会执行完命令就退出</span></span><br><span class="line">[root@docker ~]# docker run -it -d  --name centos6_ssh_d f1b33ecfb107 /usr/sbin/sshd -D</span><br><span class="line">38990dc22fec4efd91d477f08869c7f87681663ee668b68394fc58860ecc5ecd</span><br><span class="line"><span class="meta">#</span><span class="bash"> 加上-p 22参数就能暴露端口，实现宿主机之外的网络访问</span></span><br><span class="line">[root@docker ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE        COMMAND           CREATED             STATUS       PORTS     NAMES</span><br><span class="line">38990dc22fec   f1b33ecfb107  &quot;/usr/sbin/sshd -D&quot; 6 seconds ago    Up 5 seconds           centos6_ssh_d</span><br><span class="line">d6f755ad89cf   f1b33ecfb107   &quot;/bin/bash&quot;        13 minutes ago   Up 13 minutes          centos6_sshd</span><br><span class="line">9d064f7416ec   f1cb7c7d58b7   &quot;/bin/bash&quot;        About an hour ago   Up About an hour    centos7.6</span><br><span class="line">625565a2013b   48650444e419   &quot;/bin/bash&quot;        About an hour ago   Up About an hour    centos6.10</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li>将ssh服务加入容器启动时的第一命令中</li>
</ul>
<h4 id="6-2-2-构建企业网站定制镜像–BBS"><a href="#6-2-2-构建企业网站定制镜像–BBS" class="headerlink" title="6.2.2 构建企业网站定制镜像–BBS"></a>6.2.2 构建企业网站定制镜像–BBS</h4><h5 id="6-2-2-1-第一版镜像的制作–lamp环境"><a href="#6-2-2-1-第一版镜像的制作–lamp环境" class="headerlink" title="6.2.2.1 第一版镜像的制作–lamp环境"></a>6.2.2.1 第一版镜像的制作–lamp环境</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 新建目录存放MySQL和web网页目录，以便做持久化存储</span></span><br><span class="line">[root@docker ~]# mkdir -p /opt/Volume/bbs/mysql /opt/Volume/bbs/html</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动容器</span></span><br><span class="line">[root@docker ~]# docker run -it -d --name centos6_bbs -v /opt/Volume/bbs/mysql/:/var/lib/mysql -v /opt/Volume/bbs/html/:/var/www/html  48650444e419</span><br><span class="line">b8d9eb05d4ed43a192a850c0c0792d1e0b0cb1c0d95c3d084f1785fd2e5ac0a3</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置yum源</span></span><br><span class="line">[root@b8d9eb05d4ed /]# cat &gt; /etc/yum.repos.d/ftp6.repo &lt;&lt; EOF</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> [ftp6_10]</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> name=ftp6_10</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> baseurl=ftp://172.17.0.1/centos6.10</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> enabled=1</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> gpgcheck=0</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> EOF</span></span><br><span class="line"></span><br><span class="line">[root@b8d9eb05d4ed /]# yum clean all &amp;&amp; yum repolist</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装lamp</span></span><br><span class="line">[root@b8d9eb05d4ed /]# yum -y install openssh* httpd mysql php php-mysql mysql-server</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 软件初始化</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ssh服务初始化</span></span></span><br><span class="line">[root@b8d9eb05d4ed /]# /etc/init.d/sshd start</span><br><span class="line">Generating SSH2 RSA host key:                              [  OK  ]</span><br><span class="line">Generating SSH1 RSA host key:                              [  OK  ]</span><br><span class="line">Generating SSH2 DSA host key:                              [  OK  ]</span><br><span class="line">Starting sshd:                                             [  OK  ]</span><br><span class="line">[root@b8d9eb05d4ed /]# echo &quot;root:123456&quot; | chpasswd </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># mysql初始化</span></span></span><br><span class="line">[root@b8d9eb05d4ed /]# /etc/init.d/mysqld  start</span><br><span class="line">Initializing MySQL database:  Installing MySQL system tables...</span><br><span class="line">OK</span><br><span class="line">Filling help tables...</span><br><span class="line">OK</span><br><span class="line">···</span><br><span class="line">Please report any problems with the /usr/bin/mysqlbug script!  [  OK  ]</span><br><span class="line">Starting mysqld:                                               [  OK  ]</span><br><span class="line"></span><br><span class="line">[root@b8d9eb05d4ed /]# cd /var/lib/mysql/</span><br><span class="line">[root@b8d9eb05d4ed mysql]# ll </span><br><span class="line">total 20484</span><br><span class="line">-rw-rw---- 1 mysql mysql  5242880 Jul 19 14:59 ib_logfile0</span><br><span class="line">-rw-rw---- 1 mysql mysql  5242880 Jul 19 14:59 ib_logfile1</span><br><span class="line">-rw-rw---- 1 mysql mysql 10485760 Jul 19 14:59 ibdata1</span><br><span class="line">drwx------ 2 mysql mysql     4096 Jul 19 14:59 mysql</span><br><span class="line">srwxrwxrwx 1 mysql mysql        0 Jul 19 14:59 mysql.sock</span><br><span class="line">drwx------ 2 mysql mysql        6 Jul 19 14:59 test</span><br><span class="line"></span><br><span class="line">[root@b8d9eb05d4ed mysql]# mysql  # 启动mysql</span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建数据库、用户和授权</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> grant all on *.* to  root@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;123456&#x27;</span>;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> grant all on *.* to  discuz@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123456&#x27;</span>;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> grant all on *.* to  discuz@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;123456&#x27;</span>;</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> create database discuz charset utf8;</span>  </span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查宿主机上文件持久化存储结果</span></span><br><span class="line">[root@docker ~]# ls /opt/Volume/bbs/mysql/</span><br><span class="line">ibdata1  ib_logfile0  ib_logfile1  mysql  mysql.sock  test</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 初始化http服务</span></span><br><span class="line">[root@b8d9eb05d4ed mysql]# /etc/init.d/httpd  start</span><br><span class="line">Starting httpd: httpd: Could not reliably determine the server&#x27;s fully qualified domain name, using 172.17.0.6 for ServerName</span><br><span class="line">                                                           [  OK  ]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过宿主机访问，结果正常</span></span><br><span class="line">[root@docker ~]# curl -I 172.17.0.6</span><br><span class="line">HTTP/1.1 403 Forbidden</span><br><span class="line">Date: Sun, 19 Jul 2020 15:09:08 GMT</span><br><span class="line">Server: Apache/2.2.15 (CentOS)</span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line">Content-Length: 4961</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 制作lamp第一版基础镜像</span></span><br><span class="line">[root@docker ~]# docker commit b8d9eb05d4ed centos6_lamp:v1</span><br><span class="line">sha256:f022bb774837bd1f28646ca0222005e6962e98a39f7d7ce50ffedd5dbb82a758</span><br><span class="line">[root@docker ~]# docker image ls # grep lamp</span><br><span class="line">REPOSITORY    TAG     IMAGE ID        CREATED            SIZE</span><br><span class="line">centos6_lamp   v1     f022bb774837   6 seconds ago       476MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止第一版容器</span></span><br><span class="line">[root@docker ~]# docker container stop centos6_bbs</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用lamp第一版镜像启动容器，并暴露80端口</span></span><br><span class="line">[root@docker ~]# docker run -it --name centos6_lamp -p 8080:80 -v /opt/Volume/bbs/mysql/:/var/lib/mysql -v /opt/Volume/bbs/html/:/var/www/html f022bb774837</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动MySQL和阿帕奇服务</span></span><br><span class="line">[root@e6551f8c73eb /]# /etc/init.d/mysqld start</span><br><span class="line">Starting mysqld:                                           [  OK  ]</span><br><span class="line">[root@e6551f8c73eb /]# /etc/init.d/httpd start</span><br><span class="line">Starting httpd: httpd: Could not reliably determine the server&#x27;s fully qualified domain name, using 172.17.0.6 for ServerName</span><br><span class="line">                                                           [  OK  ]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 编辑简单的php页面php和http访问情况</span></span><br><span class="line">[root@docker ~]# cat  /opt/Volume/bbs/html/index.php  # 在宿主机上编写即可</span><br><span class="line">&lt;?php</span><br><span class="line">    phpinfo();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>​        此时，可通过浏览器测试php的访问状态：</p>
<p><img src="/image-20200719232205533.png" alt="image-20200719232205533"></p>
<h5 id="6-2-2-2-第二版镜像的制作–安装bbs"><a href="#6-2-2-2-第二版镜像的制作–安装bbs" class="headerlink" title="6.2.2.2 第二版镜像的制作–安装bbs"></a>6.2.2.2 第二版镜像的制作–安装bbs</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载bbs软件包</span></span><br><span class="line">[root@docker ~]# git clone https://gitee.com/ComsenzDiscuz/DiscuzX.git</span><br><span class="line">Cloning into &#x27;DiscuzX&#x27;...</span><br><span class="line">remote: Enumerating objects: 3493, done.</span><br><span class="line">remote: Counting objects: 100% (3493/3493), done.</span><br><span class="line">remote: Compressing objects: 100% (905/905), done.</span><br><span class="line">remote: Total 11627 (delta 2935), reused 2670 (delta 2588), pack-reused 8134</span><br><span class="line">Receiving objects: 100% (11627/11627), 14.85 MiB | 5.71 MiB/s, done.</span><br><span class="line">Resolving deltas: 100% (5734/5734), done.</span><br><span class="line">[root@docker ~]# cd DiscuzX/</span><br><span class="line">[root@docker DiscuzX]# ls </span><br><span class="line">readme  README.md  upload  utility</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将upload目录下的所有文件拷贝到http服务根目录下，并给与777的权限</span></span><br><span class="line">[root@docker DiscuzX]# cp -r  upload/*  /opt/Volume/bbs/html/</span><br><span class="line">cp: overwrite ‘/opt/Volume/bbs/html/index.php’? yes</span><br><span class="line">[root@docker DiscuzX]# chmod -R 777 /opt/Volume/bbs/html/</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>接下来就是页面化操作了</p>
<img src="/image-20200719233021172.png" alt="image-20200719233021172" style="zoom:50%;" />

<p>检查状态是否符合要求</p>
<img src="/image-20200719233137145.png" alt="image-20200719233137145" style="zoom:50%;" />

<p>设置运行环境</p>
<img src="/image-20200719233215227.png" alt="image-20200719233215227" style="zoom:50%;" />

<p>安装数据库，设置数据库信息</p>
<img src="/image-20200719233803196.png" alt="image-20200719233803196" style="zoom:50%;" />

<p>安装完成，点击右下角进入论坛</p>
<img src="/image-20200719233927216.png" alt="image-20200719233927216" style="zoom:50%;" />

<p>进入论坛，结果正常</p>
<p><img src="/image-20200719233956493.png" alt="image-20200719233956493"></p>
<p>保存第二版镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# docker commit -m &quot;welcom to bbs&quot;  e6551f8c73eb scaven/centos6_bbs:v1</span><br><span class="line">sha256:5259a77d042b9f0a2ca73f385603733d025b22c1ce3e549e1c25f95cd7c8bdcb</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker image ls</span><br><span class="line">REPOSITORY           TAG      IMAGE ID     CREATED        SIZE</span><br><span class="line">scaven/centos6_bbs   v1       5259a77d042b 10 seconds ago 477MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止容器</span></span><br><span class="line">[root@docker ~]# docker container stop e6551f8c73eb</span><br></pre></td></tr></table></figure>



<h5 id="6-2-2-3-第三版镜像的制作–创建启动脚本"><a href="#6-2-2-3-第三版镜像的制作–创建启动脚本" class="headerlink" title="6.2.2.3 第三版镜像的制作–创建启动脚本"></a>6.2.2.3 第三版镜像的制作–创建启动脚本</h5><p>​        docker容器只能启动时只能指定启动一个进程，那么，我们可以编写一个启动脚本，只要把需要启动的访问，放在该脚本中，并最后保持运行该脚本的窗口不退出即可。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# cat  /opt/Volume/bbs/html/init.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">/etc/init.d/mysqld start   # 启动MySQL</span><br><span class="line">/etc/init.d/httpd start    # 启动http</span><br><span class="line">/usr/sbin/sshd -D          # 启动ssh，该命令是前端运行，即端口不退出</span><br><span class="line">[root@docker ~]# chmod +x  /opt/Volume/bbs/html/init.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 基于第二版镜像，启动容器，暴露http端口，MySQL端口，ssh端口，并执行上面创建的脚本</span></span><br><span class="line">[root@docker ~]# docker run -d --name centos6_bbs_v1 -p 8000:80 -p 2222:22 -p 13306:3306 -v /opt/Volume/bbs/mysql/:/var/lib/mysql -v /opt/Volume/bbs/html/:/var/www/html 5259a77d042b /var/www/html/init.sh</span><br><span class="line">97bf03282d31439ed03201e95aaba52443c86718fc9f5fd0772b2884c00af7c3</span><br></pre></td></tr></table></figure>

<p>检查验证–ssh服务</p>
<ul>
<li>宿主机连接ssh服务，通过ip地址直接连接就可以，不需要使用端口</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker ~]# ssh 172.17.0.6</span><br><span class="line">root@172.17.0.6&#x27;s password:  # 123456 </span><br><span class="line">Last login: Sun Jul 19 16:12:52 2020 from 10.138.3.1</span><br><span class="line">[root@97bf03282d31 ~] # </span><br></pre></td></tr></table></figure>

<ul>
<li>外部网络通过xshell连接容器</li>
</ul>
<p><img src="/image-20200720001324660.png" alt="image-20200720001324660"></p>
<p>检查验证–bbs论坛</p>
<p><img src="/image-20200720000946358.png" alt="image-20200720000946358"></p>
<p>检查验证–mysql服务</p>
<img src="/image-20200720001520071.png" alt="image-20200720001520071" style="zoom:50%;" />

<h4 id="6-2-3-制作centos7的sshd服务镜像"><a href="#6-2-3-制作centos7的sshd服务镜像" class="headerlink" title="6.2.3 制作centos7的sshd服务镜像"></a>6.2.3 制作centos7的sshd服务镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动centos7.6基础镜像</span></span><br><span class="line">[root@docker ~]# docker run -it --name centos7_sshd f1cb7c7d58b7</span><br><span class="line">[root@d4b3c4402094 /]# yum -y install openssh*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@d4b3c4402094 /]# systemctl start sshd  # 使用该命令启动不了ssh服务</span><br><span class="line">Failed to get D-Bus connection: Operation not permitted</span><br><span class="line">[root@d4b3c4402094 /]# /etc/init.d/sshd start  # 该脚本启动也有很多命令没有</span><br><span class="line">/etc/init.d/sshd: line 30: /etc/rc.d/init.d/functions: No such file or directory</span><br><span class="line">/usr/sbin/sshd-keygen: line 10: /etc/rc.d/init.d/functions: No such file or directory</span><br><span class="line">Generating SSH2 RSA host key: /usr/sbin/sshd-keygen: line 63: success: command not found</span><br><span class="line"></span><br><span class="line">Generating SSH2 ECDSA host key: /usr/sbin/sshd-keygen: line 105: success: command not found</span><br><span class="line"></span><br><span class="line">Generating SSH2 ED25519 host key: /usr/sbin/sshd-keygen: line 126: success: command not found</span><br><span class="line"></span><br><span class="line">Starting sshd: /etc/init.d/sshd: line 64: success: command not found</span><br><span class="line">/etc/init.d/sshd: line 64: failure: command not found</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 手动初始化sshd服务</span></span><br><span class="line">[root@d4b3c4402094 /]# mkdir /var/run/sshd</span><br><span class="line">[root@d4b3c4402094 /]# echo &#x27;UseDNS no&#x27; &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line">[root@d4b3c4402094 /]# sed -i -e &#x27;/pam_loginuid.so/d&#x27; /etc/pam.d/sshd</span><br><span class="line">[root@d4b3c4402094 /]# echo &#x27;root:123456&#x27; | chpasswd</span><br><span class="line"></span><br><span class="line">[root@d4b3c4402094 /]# /usr/bin/ssh-keygen -A  # 初始化成功</span><br><span class="line">ssh-keygen: generating new host keys: RSA1 DSA </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 保存含有ssh服务的镜像</span></span><br><span class="line">[root@docker ~]# docker container ls |grep centos7_sshd</span><br><span class="line">CONTAINER ID   IMAGE   COMMAND    CREATED    STATUS    PORTS   NAMES</span><br><span class="line">d4b3c4402094   f1cb7c7d58b7  &quot;/bin/bash&quot;  7 minutes ago   Up 7 minutes    centos7_sshd</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker commit -m &quot;centos7 add sshd&quot; d4b3c4402094 scaven/centos:sshd_v1</span><br><span class="line">sha256:40b6e896f747f9ea5757ff36f1803e1d8e7a16189a53838b2258e36ff0da3ce4</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动含有ssh服务的镜像</span></span><br><span class="line">[root@docker ~]# docker run -d --name testsshd  -p 222:22 40b6e896f747 /usr/sbin/sshd -D</span><br><span class="line">03a9e7608154a856877fa13479b0dace6eb8c02bc14a3a2654e4a5c62d72c18f</span><br></pre></td></tr></table></figure>

<p>通过xshell连接</p>
<p><img src="/image-20200720004135508.png" alt="image-20200720004135508"></p>
<h3 id="6-3-通过dockerfile制作docker镜像"><a href="#6-3-通过dockerfile制作docker镜像" class="headerlink" title="6.3 通过dockerfile制作docker镜像"></a>6.3 通过dockerfile制作docker镜像</h3><h4 id="6-3-1-制作ssh服务的centos7镜像"><a href="#6-3-1-制作ssh服务的centos7镜像" class="headerlink" title="6.3.1 制作ssh服务的centos7镜像"></a>6.3.1 制作ssh服务的centos7镜像</h4><p>格式：</p>
<ol>
<li>FROM–指定该镜像基于的基础镜像<ul>
<li>格式1：FROM centos:centos6.10  指定从那个仓库中的那个镜像，不建议使用，tag是很容易进行人为修改的，因此不安全</li>
<li>格式2： FROM centos@镜像id    建议使用该种方法</li>
</ul>
</li>
<li>RUN–指定需要运行的命令<ul>
<li>格式1：常规shell命令–RUN +shell命令，值得注意的是，命令必须存在</li>
<li>格式2：非shell命令–RUN [“命令”,”参数或选项1”,”参数或选项2”,”····”]，如 <code>RUN [&quot;mysqld&quot;,&quot;--datadir=xx&quot;,&quot;--basedir=xx&quot;,&quot;--user=mysql&quot;]</code></li>
</ul>
</li>
<li>CMD–容器启动时执行的命令，一般是需要能夯住在前端的，不退出窗口的命令<ul>
<li>格式：CMD [“命令”,”参数或选项1”,”参数或选项2”,”····”]</li>
</ul>
</li>
<li>EXPOSE–指定该容器暴露的端口</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 删除上面实验的所有容器</span></span><br><span class="line">[root@docker ~]# docker container rm -f `docker container ls -a -q`</span><br><span class="line"></span><br><span class="line">[root@docker ~]# mkdir -p /data/dockerfile  # 创建制作镜像目录</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 开始制作镜像</span></span><br><span class="line">[root@docker dockerfile]# vim Dockerfile  # 新建该文件，名称可以是小写</span><br><span class="line"><span class="meta">#</span><span class="bash"> 备注信息：Centos6.10_SSHDv1.0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1 设置基础镜像，建议使用下面的写法，而不是使用tag标签</span></span><br><span class="line">FROM centos:centos6.10</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2 添加制作镜像的相关命令，建议多个命令一起写，不然层级太多</span></span><br><span class="line">RUN mv /etc/yum.repos.d/*.repo /tmp &amp;&amp; echo -e &quot;[ftp6]\nname=ftp6\nbaseurl=ftp://172.17.0.1/centos6.10\nenabled=1\ngpgcheck=0&quot; &gt; /etc/yum.repos.d/ftp6.repo  &amp;&amp; yum clean all &amp;&amp; yum repolist &amp;&amp; yum -y install openssh-server </span><br><span class="line"></span><br><span class="line">RUN /etc/init.d/sshd start &amp;&amp; /etc/init.d/stop &amp;&amp; echo &quot;root:123456&quot; | chpasswd</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3 容器启动时指定的命令</span></span><br><span class="line">CMD [&quot;/usr/sbin/sshd&quot;,&quot;-D&quot;]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4 暴露端口</span></span><br><span class="line">EXPOSE 22</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 制作镜像，默认就会使用当前目录中的Dockerfile文件</span></span><br><span class="line">[root@docker dockerfile]# docker image build -t &quot;centos6_10_add_sshd&quot; ./</span><br><span class="line">Sending build context to Docker daemon   2.56kB</span><br><span class="line">Step 1/5 : FROM centos:centos6.10  # 第一步完成后生成的镜像</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 48650444e419</span></span><br><span class="line">Step 2/5 : RUN mv /etc/yum.repos.d/*.repo /tmp &amp;&amp; echo -e &quot;[ftp6]\nname=ftp6\nbaseurl=ftp://172.17.0.1/centos6.10\nenabled=1\ngpgcheck=0&quot; &gt; /etc/yum.repos.d/ftp6.repo  &amp;&amp; yum clean all &amp;&amp; yum repolist &amp;&amp; yum -y install openssh-server</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Using cache</span></span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 4402742653b8   <span class="comment"># 第二步完成后生成的镜像</span></span></span><br><span class="line">Step 3/5 : RUN /etc/init.d/sshd start &amp;&amp; /etc/init.d/sshd stop &amp;&amp; echo &quot;root:123456&quot; | chpasswd</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 41576869d2c5</span></span><br><span class="line">Generating SSH2 RSA host key: [  OK  ]</span><br><span class="line">Generating SSH1 RSA host key: [  OK  ]</span><br><span class="line">Generating SSH2 DSA host key: [  OK  ]</span><br><span class="line">Starting sshd: [  OK  ]</span><br><span class="line">Stopping sshd: [  OK  ]</span><br><span class="line">Removing intermediate container 41576869d2c5</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> f84b609cb2a8  <span class="comment"># 第三步完成后生成的镜像</span></span></span><br><span class="line">Step 4/5 : CMD [&quot;/usr/sbin/sshd&quot;,&quot;-D&quot;]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 453a0196b369</span></span><br><span class="line">Removing intermediate container 453a0196b369</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> fd7d7bdbd6eb   <span class="comment"># 第四步完成后生成的镜像</span></span></span><br><span class="line">Step 5/5 : EXPOSE 22</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 029d6942a429</span></span><br><span class="line">Removing intermediate container 029d6942a429</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 0545dad565d5   <span class="comment"># 第五步完成后生成的镜像</span></span></span><br><span class="line">Successfully built 0545dad565d5</span><br><span class="line">Successfully tagged centos6_10_add_sshd:latest</span><br><span class="line"><span class="meta">#</span><span class="bash"> 上面的每一步都可以使用<span class="string">&quot;docker run -it --rm 镜像id /bin/bash&quot;</span>进入容器内进行检查和调试</span></span><br><span class="line"></span><br><span class="line">[root@docker dockerfile]# docker image ls | grep centos6_10_add_sshd</span><br><span class="line">centos6_10_add_sshd  latest  0545dad565d5   About a minute ago   281MB</span><br></pre></td></tr></table></figure>

<p>功能测试：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用刚制作的镜像启动容器，检查ssh服务和是否后端运行</span></span><br><span class="line">[root@docker dockerfile]# docker run -it -d  --name ssh -p 222:22 0545dad565d5 </span><br><span class="line">e14f92e87ef27406e95001b66c2cd0736fcb181d3ec586bcebee62f24c43ce57</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器ip地址</span></span><br><span class="line">[root@docker ~]# docker container inspect e14f92e87ef2 | grep IPAddress</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br></pre></td></tr></table></figure>

<p>使用xshell远程登录</p>
<p><img src="/image-20200720013745449.png" alt="image-20200720013745449"></p>
<h4 id="6-3-2-制作lamp镜像"><a href="#6-3-2-制作lamp镜像" class="headerlink" title="6.3.2 制作lamp镜像"></a>6.3.2 制作lamp镜像</h4><p>其他常用命令格式：</p>
<ol>
<li>COPY–复制本地文件到容器指定目录下，支持通配符；如果拷贝的是一个目录，则只拷贝目录下的文件(将需要拷贝的文件放在dockefile同目录中)<ul>
<li>格式：COPY  &lt;src1,src2,·····&gt; <dest></li>
</ul>
</li>
<li>ADD–跟COPY一样，多了一个功能是能自动解压.tar*的文件，并且还可以指定源文件为url地址，即可以进行网络下载</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">[root@docker bbs]# ls </span><br><span class="line">DiscuzX.tar  dockerfile  init.sh</span><br><span class="line">[root@docker bbs]# cat dockerfile </span><br><span class="line"><span class="meta">#</span><span class="bash"> Centos6.10_SSHD_LAMP</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1 设置基础镜像，建议使用下面的写法，而不是使用tag</span></span><br><span class="line">FROM centos:centos6.10</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2 添加需要执行的程序等</span></span><br><span class="line">RUN mv /etc/yum.repos.d/*.repo /tmp &amp;&amp; echo -e &quot;[ftp6]\nname=ftp6\nbaseurl=ftp://172.17.0.1/centos6.10\nenabled=1\ngpgcheck=0&quot; &gt; /etc/yum.repos.d/ftp6.repo  &amp;&amp; yum clean all &amp;&amp; yum repolist &amp;&amp; yum -y install openssh-server mysql mysql-server php php-mysql httpd</span><br><span class="line"></span><br><span class="line">RUN /etc/init.d/sshd start &amp;&amp; /etc/init.d/sshd stop &amp;&amp; echo &quot;root:123456&quot; | chpasswd &amp;&amp; /etc/init.d/mysqld start &amp;&amp; /etc/init.d/httpd start</span><br><span class="line"></span><br><span class="line">RUN mysql -e &quot;grant all on *.* to root@&#x27;%&#x27; identified by &#x27;123456&#x27;;grant all on *.* to root@&#x27;localhost&#x27; identified by &#x27;123456&#x27;;grant all on *.* to discuz@&#x27;%&#x27; identified by &#x27;123456&#x27;;grant all on *.* to discuz@&#x27;localhost&#x27; identified by &#x27;123456&#x27;;create database discuz charset utf8;&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3 添加脚本启动文件到容器内</span></span><br><span class="line">COPY init.sh  /</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4 添加bbs文件到http服务根目录下，并测试下载功能</span></span><br><span class="line">ADD DiscuzX.tar /var/wwww/html</span><br><span class="line">ADD /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-6.repo /tmp</span><br><span class="line">RUN chmod -R 777 /var/www/html/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5 暴露端口</span></span><br><span class="line">EXPOSE 22</span><br><span class="line">EXPOSE 80</span><br><span class="line">EXPOSE 3306</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6 容器启动时指定的命令</span></span><br><span class="line">CMD [&quot;/bin/bash&quot;,&quot;/init.sh&quot;]</span><br><span class="line"></span><br><span class="line">[root@docker bbs]# docker  build -t &quot;centos6_bbs&quot; ./</span><br><span class="line">···</span><br><span class="line">ERROR 2002 (HY000): Can&#x27;t connect to local MySQL server through socket &#x27;/var/lib/mysql/mysql.sock&#x27; (2)</span><br><span class="line">The command &#x27;/bin/sh -c mysql -e &quot;grant all on *.* to root@&#x27;%&#x27; identified by &#x27;123456&#x27;;grant all on *.* to root@&#x27;localhost&#x27; identified by &#x27;123456&#x27;;grant all on *.* to discuz@&#x27;%&#x27; identified by &#x27;123456&#x27;;grant all on *.* to discuz@&#x27;localhost&#x27; identified by &#x27;123456&#x27;;create database discuz charset utf8;&quot;&#x27; returned a non-zero code: 1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 报错信息/bin/sh -c mysql是因为调用了/bin/sh下的MySQL命令，但MySQL不是默认的shell命令，因此失败</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 我们将MySQL执行命令放在init.sh脚本中</span></span><br><span class="line">[root@docker bbs]# cat init.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">/etc/init.d/mysqld start</span><br><span class="line">mysql -e &quot;grant all on *.* to root@&#x27;%&#x27; identified by &#x27;123456&#x27;;grant all on *.* to root@&#x27;localhost&#x27; identified by &#x27;123456&#x27;;grant all on *.* to discuz@&#x27;%&#x27; identified by &#x27;123456&#x27;;grant all on *.* to discuz@&#x27;localhost&#x27; identified by &#x27;123456&#x27;;create database discuz charset utf8;&quot;</span><br><span class="line">/etc/init.d/httpd start</span><br><span class="line">/usr/sbin/sshd -D</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改完成后重新执行制作命令</span></span><br><span class="line">[root@docker bbs]# docker build -t &quot;centos6_bbs&quot; ./</span><br><span class="line">Sending build context to Docker daemon  49.31MB</span><br><span class="line">Step 1/11 : FROM centos:centos6.10</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 48650444e419</span></span><br><span class="line">Step 2/11 : RUN mv /etc/yum.repos.d/*.repo /tmp &amp;&amp; echo -e &quot;[ftp6]\nname=ftp6\nbaseurl=ftp://172.17.0.1/centos6.10\nenabled=1\ngpgcheck=0&quot; &gt; /etc/yum.repos.d/ftp6.repo  &amp;&amp; yum clean all &amp;&amp; yum repolist &amp;&amp; yum -y install openssh-server mysql mysql-server php php-mysql httpd</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Using cache</span></span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 163443b96f08</span></span><br><span class="line">Step 3/11 : RUN /etc/init.d/sshd start &amp;&amp; /etc/init.d/sshd stop &amp;&amp; echo &quot;root:123456&quot; | chpasswd &amp;&amp; /etc/init.d/mysqld start &amp;&amp; /etc/init.d/httpd start</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Using cache</span></span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 71532a0cbbda</span></span><br><span class="line">Step 4/11 : COPY init.sh  /</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Using cache</span></span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 011557e246cf</span></span><br><span class="line">Step 5/11 : ADD DiscuzX.tar /var/wwww/html</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Using cache</span></span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 8ae2ce18a6ff</span></span><br><span class="line">Step 6/11 : ADD http://mirrors.aliyun.com/repo/epel-6.repo /tmp</span><br><span class="line">Downloading [==================================================&gt;]     664B/664B</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> dc80368ca4c2</span></span><br><span class="line">Step 7/11 : RUN chmod -R 777 /var/www/html/</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 13d05bf9d33b</span></span><br><span class="line">Removing intermediate container 13d05bf9d33b</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> e998a08aa223</span></span><br><span class="line">Step 8/11 : EXPOSE 22</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> a5bf69187121</span></span><br><span class="line">Removing intermediate container a5bf69187121</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 18c5b2acc666</span></span><br><span class="line">Step 9/11 : EXPOSE 80</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 66764f22d9f6</span></span><br><span class="line">Removing intermediate container 66764f22d9f6</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 3ac56c1cb679</span></span><br><span class="line">Step 10/11 : EXPOSE 3306</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> b4553364173c</span></span><br><span class="line">Removing intermediate container b4553364173c</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 3df29b4dafc9</span></span><br><span class="line">Step 11/11 : CMD [&quot;/bin/bash&quot;,&quot;/init.sh&quot;]</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> Running <span class="keyword">in</span> 6ae503afeed2</span></span><br><span class="line">Removing intermediate container 6ae503afeed2</span><br><span class="line"><span class="meta"> ---&gt;</span><span class="bash"> 73c23cdfae10</span></span><br><span class="line">Successfully built 1a47917b0eb0</span><br><span class="line">Successfully tagged centos6_bbs:latest  # 制作成功</span><br><span class="line"></span><br><span class="line">[root@docker bbs]# docker image ls | grep centos6_bbs</span><br><span class="line">REPOSITORY       TAG         IMAGE ID      CREATED        SIZE</span><br><span class="line">centos6_bbs      latest       1a47917b0eb0 About a minute ago 433MB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@docker bbs]# docker run -d --name centos_bbs -p 8080:80 -p 222:22 -p 13306:3306  1a47917b0eb0</span><br><span class="line">1d4302e50b3a283eba4fb480634969e4e23745eafa42981b0e8b8b639a250c36</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker exec -it 1d4302e50b3a  /bin/bash</span><br><span class="line">[root@1d4302e50b3a /]# ls /var/www/html/</span><br><span class="line">readme/    README.md  upload/    utility/   </span><br><span class="line">[root@1d4302e50b3a /]# ls /var/www/html/</span><br><span class="line">readme  README.md  upload  utility   </span><br><span class="line"><span class="meta">#</span><span class="bash"> 打包的bbs文件，应该只包含repload目录即可，其他文件可不打包传递</span></span><br></pre></td></tr></table></figure>

<p>浏览器安装(这里只做测试，不截屏)：</p>
<p><img src="/image-20200720142958094.png" alt="image-20200720142958094"></p>
<p>安装完成后，如下：</p>
<p><img src="/image-20200720143113667.png" alt="image-20200720143113667"></p>
<h4 id="6-3-3-其他镜像制作命令"><a href="#6-3-3-其他镜像制作命令" class="headerlink" title="6.3.3 其他镜像制作命令"></a>6.3.3 其他镜像制作命令</h4><ol>
<li>WORKDIR–指定工作目录<ul>
<li>格式： WORKDIR /data/</li>
</ul>
</li>
<li>ENV–设置环境变量</li>
</ol>
<ol start="3">
<li>VOLUME–设置数据卷</li>
</ol>
<ol start="4">
<li>ENTRYPOINT–跟CMD命令类似，但是CMD执行的命令可以在启动容器时被命令行命令取代，但ENTRYPOINT后面的命令不能被替换掉，即永远会执行镜像中指定的第一命令</li>
</ol>
<blockquote>
<p>可以通过<code>doker image inspect 镜像名</code>查看镜像制作的向下命令参数</p>
</blockquote>
<h4 id="–补充-6-3-4-环境镜像–java环境镜像"><a href="#–补充-6-3-4-环境镜像–java环境镜像" class="headerlink" title="–补充-6.3.4 环境镜像–java环境镜像"></a>–补充-6.3.4 环境镜像–java环境镜像</h4><p>镜像分类：</p>
<ul>
<li>基础镜像，如centos、Ubuntu等</li>
<li>环境镜像，如java环境、python环境</li>
<li>项目镜像，将项目与环境镜像一起打包，等同于是从环境镜像而来</li>
</ul>
<p>构建docker镜像实战</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker20 ~]# mkdir /Dockerfile/ &amp;&amp; cd /Dockerfile/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="6-4-docker镜像仓库"><a href="#6-4-docker镜像仓库" class="headerlink" title="6.4 docker镜像仓库"></a>6.4 docker镜像仓库</h3><p>Docker Registry：</p>
<p>​        启动容器时，docker daemon会试图从本地获取相关镜像，本地镜像不存在时，其将从Registry中下载该镜像并保存到本地</p>
<p><img src="/clip_image056.jpg" alt="img"></p>
<p>Docker Registry分类：</p>
<p>Registry用于保存docker镜像，包括镜像的层次结构和元数据，用户可自建Registry，也可以使用官方的Docker Hub仓库，分类如下：</p>
<p>Sponsor Registry：第三方仓库，供客户和docker社区使用</p>
<p>Mirror Registry：第三方仓库，只供客户使用</p>
<p>Vendor Registry：由发布docker镜像的供应商提供的Registry</p>
<p>Private Registry：通过设有防火墙和额外的安全层的私有实体提供的Registry，如VMware的harbor</p>
<p>Docker Registry的构成—repository和index</p>
<p>l Repository</p>
<p>n 由特定的docker镜像的所有迭代版本组成的镜像仓库，一个Registry中包含多个Repository</p>
<p>n Repository可分为“顶级仓库”和“用户仓库“，用户仓库的格式为“用户名/仓库名”</p>
<p>n 每个镜像可以包含多个Tag(标签)，每个镜像内的Tag唯一</p>
<p>l Index</p>
<p>n 维护用户账号、镜像的校验已经公共命名空间的信息</p>
<p>n 相当于为Registry提供了一个完成用户认证等功能的索引接口</p>
<p>Docker Registry的来源：</p>
<p>Docker Registry中的镜像通常由开发人员制作（一般是基于基础镜像制作，基础镜像由专业人士制作，如docker官方人员），而后推送至“公共”或“私有”Registry上保存，供其他人员使用，例如“部署”到生产环境中。</p>
<p><img src="/clip_image058.jpg" alt="img"></p>
<p>镜像的生成途径：</p>
<p>l Dockerfile</p>
<p>l 基于容器制作</p>
<p>l Docker Hub automated builds</p>
<p><img src="/clip_image060.jpg" alt="img"></p>
<h4 id="6-4-1-制作本地镜像仓库"><a href="#6-4-1-制作本地镜像仓库" class="headerlink" title="6.4.1 制作本地镜像仓库"></a>6.4.1 制作本地镜像仓库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_16_8_centos ~]# docker pull  registry</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/registry</span><br><span class="line">cbdbe7a5bc2a: Pull complete </span><br><span class="line">47112e65547d: Pull complete </span><br><span class="line">46bcb632e506: Pull complete </span><br><span class="line">c1cc712bcecd: Pull complete </span><br><span class="line">3db6272dcbfa: Pull complete </span><br><span class="line">Digest: sha256:8be26f81ffea54106bae012c6f349df70f4d5e7e2ec01b143c46e2c03b9e551d</span><br><span class="line">Status: Downloaded newer image for registry:latest</span><br><span class="line">docker.io/library/registry:latest</span><br><span class="line"></span><br><span class="line">[root@VM_16_8_centos ~]# docker image save -o registry.tar  </span><br><span class="line">8be26f81ffe</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将镜像上传到docker测试服务器并导入镜像</span></span><br><span class="line">[root@docker ~]# docker image load -i registry.tar </span><br><span class="line">3e207b409db3: Loading layer [==================================================&gt;]  5.879MB/5.879MB</span><br><span class="line">f5b9430e0e42: Loading layer [==================================================&gt;]  817.2kB/817.2kB</span><br><span class="line">239a096513b5: Loading layer [==================================================&gt;]  20.08MB/20.08MB</span><br><span class="line">a5f27630cdd9: Loading layer [==================================================&gt;]  3.584kB/3.584kB</span><br><span class="line">b3f465d7c4d1: Loading layer [==================================================&gt;]  2.048kB/2.048kB</span><br><span class="line">Loaded image ID: sha256:2d4f4b5309b1e41b4f83ae59b44df6d673ef44433c734b14c1c103ebca82c116</span><br><span class="line"></span><br><span class="line">[root@docker bbs]# docker image ls | grep registry</span><br><span class="line">registry     latest     2d4f4b5309b1   4 weeks ago   26.2MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动该镜像容器，--restart=always表示无论时服务器重启或者是docker服务重启之后都自动重启该容器，即该容器会自启</span></span><br><span class="line">[root@docker ~]# docker run -d -p 5000:5000 --restart=always --name registry -v /opt/registry:/var/lib/registry registry</span><br><span class="line">07da1db7effae881bc22570542efc2065a98d863e08b0a109e71087a9c9615ac</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置仓库地址为本机地址，默认是docker hub，这里设置成本机(刚刚启动的容器)</span></span><br><span class="line">[root@docker ~]# vim /etc/docker/daemon.json   # 注意格式</span><br><span class="line">&#123;</span><br><span class="line">    &quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;,&quot;http://hub-mirror.c.163.com&quot;],  # 多行内容以逗号结尾，json格式</span><br><span class="line">    &quot;insecure-registries&quot;: [&quot;10.138.3.15:5000&quot;] # 最后一行无逗号</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启docker，重读配置文件</span></span><br><span class="line">[root@docker ~]# systemctl restart docker </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查容器，发现也自动重启了</span></span><br><span class="line">[root@docker ~]# docker container ls</span><br><span class="line">CONTAINER ID  IMAGE    COMMAND    CREATED    STATUS    PORTS NAMES</span><br><span class="line">07da1db7effa  registry  &quot;/entrypoint.sh /etc…&quot;   4 minutes ago Up 9 seconds   0.0.0.0:5000-&gt;5000/tcp  registry</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重新给镜像打标签</span></span><br><span class="line">[root@docker ~]# docker image tag 5259a77d042b 10.138.3.15:5000/scaven/centos6_bbs:v1</span><br><span class="line">[root@docker ~]# docker image ls | grep 10.138</span><br><span class="line">10.138.3.15:5000/scaven/centos6_bbs v1 5259a77d042b  17 hours ago 477MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 上传镜像</span></span><br><span class="line">[root@docker ~]# docker image ls | grep 10.138</span><br><span class="line">10.138.3.15:5000/scaven/centos6_bbs   v1                  5259a77d042b        17 hours ago        477MB</span><br><span class="line">[root@docker ~]# docker push 10.138.3.15:5000/scaven/centos6_bbs:v1</span><br><span class="line">The push refers to repository [10.138.3.15:5000/scaven/centos6_bbs]</span><br><span class="line">8028f132d224: Pushed </span><br><span class="line">b01adbd9e75d: Pushed </span><br><span class="line">8088cb617267: Pushed </span><br><span class="line">v1: digest: sha256:57b830b668ca8de9f1eca19ecd1d84d9ca1892dbed4c67a10306ae9e556166e4 size: 950</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试，下面是目录映射中的文件</span></span><br><span class="line">[root@docker ~]# ls /opt/registry/</span><br><span class="line">docker</span><br><span class="line">[root@docker ~]# ls /opt/registry/docker/registry/</span><br><span class="line">v2</span><br><span class="line">[root@docker ~]# ls /opt/registry/docker/registry/v2/</span><br><span class="line">blobs  repositories</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试，删除本机上的10.138.3.15:5000/scaven/centos6_bbs:v1镜像，然后从仓库中下载，先做备份再删除</span></span><br><span class="line">[root@docker ~]# docker  image save -o registry_bbs.tar  5259a77d042b</span><br><span class="line">[root@docker ~]# docker image rm  -f 5259a77d042b   # 删除</span><br><span class="line">Untagged: 10.138.3.15:5000/scaven/centos6_bbs:v1</span><br><span class="line">Untagged: 10.138.3.15:5000/scaven/centos6_bbs@sha256:57b830b668ca8de9f1eca19ecd1d84d9ca1892dbed4c67a10306ae9e556166e4</span><br><span class="line">Untagged: scaven/centos6_bbs:v1</span><br><span class="line">Deleted: sha256:5259a77d042b9f0a2ca73f385603733d025b22c1ce3e549e1c25f95cd7c8bdcb</span><br><span class="line">Deleted: sha256:aa0085e1bee996bbffafae209a85ad2e7ee3e767cf43c9117728b761341efcc0</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker image ls | grep 5259a77d042b  # 已删除成功</span><br><span class="line">[root@docker ~]# </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重新下载5259a77d042b镜像</span></span><br><span class="line">[root@docker ~]# docker pull 10.138.3.15:5000/scaven/centos6_bbs:v1</span><br><span class="line">v1: Pulling from scaven/centos6_bbs</span><br><span class="line">06a11a3d840d: Already exists </span><br><span class="line">0bc80ff48944: Already exists </span><br><span class="line">c33df8f494cd: Pull complete </span><br><span class="line">Digest: sha256:57b830b668ca8de9f1eca19ecd1d84d9ca1892dbed4c67a10306ae9e556166e4</span><br><span class="line">Status: Downloaded newer image for 10.138.3.15:5000/scaven/centos6_bbs:v1</span><br><span class="line">10.138.3.15:5000/scaven/centos6_bbs:v1</span><br><span class="line">[root@docker ~]# docker image ls | grep 5259a77d042b</span><br><span class="line">10.138.3.15:5000/scaven/centos6_bbs v1 5259a77d042b 17 hours ago 477MB</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="6-4-2-本地镜像仓库加密"><a href="#6-4-2-本地镜像仓库加密" class="headerlink" title="6.4.2 本地镜像仓库加密"></a>6.4.2 本地镜像仓库加密</h4><p>​        上文6.4.1章节中的实现了镜像仓库的功能，但是任何人都能访问和上传镜像到仓库中，是十分不安全的，因此，我们应该给镜像仓库做加密，只有有密码的用户才能进行访问仓库。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在宿主机上执行</span></span><br><span class="line">[root@docker ~]# yum -y install httpd-tools</span><br><span class="line">[root@docker ~]# mkdir /opt/registry-auth</span><br><span class="line">[root@docker ~]# htpasswd  -Bbn scaven 123456 &gt; /opt/registry-auth/htpasswd</span><br><span class="line">[root@docker ~]# cat /opt/registry-auth/htpasswd </span><br><span class="line"><span class="meta">#</span><span class="bash"> 用户名：加密后的密码</span></span><br><span class="line">scaven:$2y$05$LAE/znxZd6RAXVgNrP6rJ.T5wv/JnmWL2D2QYfdUcCT9KSJfJKepS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除之前启动的仓库镜像，释放镜像，释放宿主机5000端口</span></span><br><span class="line">[root@docker ~]# docker container stop 07da1db7effa</span><br><span class="line">07da1db7effa</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 按照下面的方式从新启动容器</span></span><br><span class="line">[root@docker ~]# docker run -d -p 5000:5000 -v /opt/registry-auth/:/auth/ -v /opt/registry:/var/lib/registry --name registry-auth -e &quot;REGISTRY_AUTH=htpasswd&quot; -e &quot;REGISTRY_AUTH_HTPASSWD_REALM=Regisry Realm&quot; -e &quot;REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd&quot; 2d4f4b5309b1</span><br><span class="line">c39b88dd0d44dc77529cb697a962c973e1543bf431270d222284cb2605701501</span><br><span class="line">[root@docker ~]# docker container ls</span><br><span class="line">CONTAINER ID   IMAGE   COMMAND    CREATED    STATUS   PORTS   NAMES</span><br><span class="line">c39b88dd0d44   2d4f4b5309b1 &quot;/entrypoint.sh /etc…&quot;   8 seconds ago       Up 7 seconds  0.0.0.0:5000-&gt;5000/tcp registry-auth</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 现在直接推送就会失败</span></span><br><span class="line">[root@docker ~]# docker pull 10.138.3.15:5000/scaven/centos6_bbs:v1</span><br><span class="line">Error response from daemon: Get http://10.138.3.15:5000/v2/scaven/centos6_bbs/manifests/v1: no basic auth credential</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用用户名和密码登录，登录后再推送镜像</span></span><br><span class="line">[root@docker ~]# docker login 10.138.3.15:5000</span><br><span class="line">Username: scaven</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line">[root@docker ~]# docker pull 10.138.3.15:5000/scaven/centos6_bbs:v1</span><br><span class="line">v1: Pulling from scaven/centos6_bbs</span><br><span class="line">Digest: sha256:57b830b668ca8de9f1eca19ecd1d84d9ca1892dbed4c67a10306ae9e556166e4</span><br><span class="line">Status: Image is up to date for 10.138.3.15:5000/scaven/centos6_bbs:v1</span><br><span class="line">10.138.3.15:5000/scaven/centos6_bbs:v1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除本地镜像进行下载验证</span></span><br><span class="line">[root@docker ~]# docker image ls | grep 10.138.3.15:5000/scaven/centos6_bbs</span><br><span class="line">10.138.3.15:5000/scaven/centos6_bbs v15259a77d042b  18 hours ago 477MB</span><br><span class="line">[root@docker ~]# docker image rm -f 10.138.3.15:5000/scaven/centos6_bbs:v1  # 从本地服务器上删除指定镜像</span><br><span class="line">Untagged: 10.138.3.15:5000/scaven/centos6_bbs:v1</span><br><span class="line">Untagged: 10.138.3.15:5000/scaven/centos6_bbs@sha256:57b830b668ca8de9f1eca19ecd1d84d9ca1892dbed4c67a10306ae9e556166e4</span><br><span class="line">Deleted: sha256:5259a77d042b9f0a2ca73f385603733d025b22c1ce3e549e1c25f95cd7c8bdcb</span><br><span class="line">Deleted: sha256:aa0085e1bee996bbffafae209a85ad2e7ee3e767cf43c9117728b761341efcc0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从10.138.3.15:5000中下载镜像</span></span><br><span class="line">[root@docker ~]# docker pull 10.138.3.15:5000/scaven/centos6_bbs:v1</span><br><span class="line">v1: Pulling from scaven/centos6_bbs</span><br><span class="line">06a11a3d840d: Already exists </span><br><span class="line">0bc80ff48944: Already exists </span><br><span class="line">c33df8f494cd: Pull complete </span><br><span class="line">Digest: sha256:57b830b668ca8de9f1eca19ecd1d84d9ca1892dbed4c67a10306ae9e556166e4</span><br><span class="line">Status: Downloaded newer image for 10.138.3.15:5000/scaven/centos6_bbs:v1</span><br><span class="line">10.138.3.15:5000/scaven/centos6_bbs:v1</span><br><span class="line">[root@docker ~]# docker image ls | grep 10.138.3.15:5000/scaven/centos6_bbs  # 下载成功</span><br><span class="line">10.138.3.15:5000/scaven/centos6_bbs v1 5259a77d042b  18 hours ago 477MB</span><br></pre></td></tr></table></figure>

<h3 id="6-5-harbor镜像仓库安装和使用"><a href="#6-5-harbor镜像仓库安装和使用" class="headerlink" title="6.5 harbor镜像仓库安装和使用"></a>6.5 harbor镜像仓库安装和使用</h3><p>​        Harbor是一个用于存储和分发Docker镜像的企业级Registry服务器，通过添加一些企业必需的功能特性，例如安全、标识和管理等，扩展了开源Docker Distribution。作为一个企业级私有Registry服务器，Harbor提供了更好的性能和安全。提升用户使用Registry构建和运行环境传输镜像的效率。Harbor支持安装在多个Registry节点的镜像资源复制，镜像全部保存在私有Registry中， 确保数据和知识产权在公司内部网络中管控。另外，Harbor也提供了高级的安全特性，诸如用户管理，访问控制和活动审计等</p>
<p>特征：</p>
<ol>
<li>云本机注册表：Harbour 支持容器映像和Helm图表，可用作云本机环境（如容器运行时和业务流程平台）的注册表。</li>
<li>基于角色的访问控制：用户和存储库通过“项目”进行组织，用户可以对项目下的图像拥有不同的权限。</li>
<li>基于策略的映像复制：可以基于具有多个过滤器（存储库，标记和标签）的策略在多个注册表实例之间复制（同步）映像。如果遇到任何错误，Harbor将自动重试进行复制。非常适合负载平衡，高可用性，多数据中心，混合和多云场景。</li>
<li>漏洞扫描：Harbor定期扫描图像并警告用户漏洞。</li>
<li>LDAP / AD支持：Harbor与现有企业LDAP / AD集成以进行用户身份验证和管理，并支持将LDAP组导入Harbor并为其分配适当的项目角色。</li>
<li>图像删除和垃圾收集：可以删除图像，并可以回收它们的空间。</li>
<li>公证：可以确保图像的真实性。</li>
<li>图形用户门户：用户可以轻松浏览，搜索存储库和管理项目。</li>
<li>审计：跟踪存储库的所有操作。</li>
<li>RESTful API：适用于大多数管理操作的RESTful API，易于与外部系统集成。</li>
<li>易于部署：提供在线和离线安装程序。　</li>
</ol>
<p>官方文档：<a target="_blank" rel="noopener" href="https://goharbor.io/docs/">https://goharbor.io/docs/</a></p>
<p>github用户手册：<a target="_blank" rel="noopener" href="https://github.com/goharbor/harbor/blob/master/docs/user_guide.md">https://github.com/goharbor/harbor/blob/master/docs/user_guide.md</a></p>
<h4 id="6-5-1安装步骤："><a href="#6-5-1安装步骤：" class="headerlink" title="6.5.1安装步骤："></a>6.5.1安装步骤：</h4><h5 id="6-5-1-1-安装docker"><a href="#6-5-1-1-安装docker" class="headerlink" title="6.5.1.1 安装docker"></a>6.5.1.1 安装docker</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装docker</span></span><br><span class="line">[root@harbor ~]# wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -P /etc/yum.repos.d/</span><br><span class="line">[root@harbor ~]# yum clean all &amp;&amp; yum repolist</span><br><span class="line">[root@harbor ~]# yum -y install docker-ce</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定镜像加速器和docker仓库</span></span><br><span class="line">[root@harbor harbor]# vim /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;,&quot;http://hub-mirror.c.163.com&quot;],</span><br><span class="line">    &quot;insecure-registries&quot;: [&quot;10.138.3.33&quot;],</span><br><span class="line">    &quot;live-restore&quot;: true</span><br><span class="line">&#125;</span><br><span class="line">[root@harbor ~]# systemctl enable docker &amp;&amp; systemctl restart docker</span><br></pre></td></tr></table></figure>

<h5 id="6-5-1-2安装docker-compose"><a href="#6-5-1-2安装docker-compose" class="headerlink" title="6.5.1.2安装docker-compose"></a>6.5.1.2安装docker-compose</h5><p>​        harbor依赖编排工具docker-compose，安装docker-compose有源码安装和pip安装两种安装方式，这里采用源码安装</p>
<p><strong>下载源码安装(可以指定版本)：</strong></p>
<p>网址：<a target="_blank" rel="noopener" href="https://github.com/docker/compose/releases">https://github.com/docker/compose/releases</a></p>
<img src="/image-20210405103956410.png" alt="image-20210405103956410" style="zoom:67%;" />

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1、下载指定版本的docker-compose</span></span><br><span class="line">[root@harbor ~]# curl -L https://github.com/docker/compose/releases/download/1.23.2/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载较慢,注意上面的版本信息由于版本更改可能访问不到，因此可访问https://github.com/docker/compose/releases</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2、对二进制文件赋可执行权限</span></span><br><span class="line">[root@harbor ~]# chmod +x /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3、测试下docker-compose是否安装成功</span></span><br><span class="line">[root@harbor ~]# docker-compose --version</span><br><span class="line">docker-compose version 1.23.2, build 1110ad01</span><br></pre></td></tr></table></figure>

<p><strong>pip安装：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor ~]#  yum install python-pip -y</span><br><span class="line">[root@harbor ~]#  pip install --upgrade pip</span><br><span class="line">[root@harbor ~]#  pip install docker-compose </span><br><span class="line">#默认最新版本，可以使用 docker-compose&#x3D;&#x3D;version指定安装版本</span><br><span class="line">[root@harbor ~]#  docker-compose --version </span><br><span class="line">docker-compose version 1.23.2, build 1110ad0</span><br></pre></td></tr></table></figure>

<h5 id="6-5-1-3-下载并安装harbor"><a href="#6-5-1-3-下载并安装harbor" class="headerlink" title="6.5.1.3 下载并安装harbor"></a>6.5.1.3 下载并安装harbor</h5><p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/goharbor/harbor/releases">https://github.com/goharbor/harbor/releases</a></p>
<p>服务器配置要求：2C/4G/40G，推荐4C/8G/160G</p>
<p>网址上提供了三种安装方式–离线安装、在线安装和源码安装，软件包较大，建议使用离线安装，这里采用离线安装，手动下载harbor安装包并上传到服务器</p>
<p><img src="/image-20200720183221885.png" alt="image-20200720183221885"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor ~]# ls harbor-offline-installer-v1.10.4.tgz </span><br><span class="line">harbor-offline-installer-v1.10.4.tgz</span><br><span class="line">[root@harbor ~]# tar xf harbor-offline-installer-v1.10.4.tgz </span><br><span class="line">[root@harbor ~]# cd harbor</span><br><span class="line">[root@harbor harbor]# ls </span><br><span class="line">common.sh  harbor.v1.10.4.tar.gz  harbor.yml  install.sh  LICENSE  prepare</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改harbor配置文件</span></span><br><span class="line">hostname: 10.138.3.33 # IP地址或主机名</span><br><span class="line">http:</span><br><span class="line"><span class="meta">  #</span><span class="bash"> port <span class="keyword">for</span> http, default is 80. If https enabled, this port will redirect to https port</span></span><br><span class="line">  port: 80 # 默认是80端口，不修改</span><br><span class="line">harbor_admin_password: Harbor@2020   #Harbor超级管理员密码</span><br><span class="line">database:</span><br><span class="line"><span class="meta">  #</span><span class="bash"> The password <span class="keyword">for</span> the root user of Harbor DB. Change this before any production use.</span></span><br><span class="line">  password: root@123  #数据库管理员密码</span><br><span class="line"></span><br><span class="line">data_volume: /data   #配置harbor数据文件，也就是未来镜像文件的存储位置，建议修改，不然直接占用系统盘空间。</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">同时注释如下内容，默认启用http，而不是https证书除非你有配置https证书</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> https related config</span></span><br><span class="line"><span class="meta">#</span><span class="bash">https:</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> https port <span class="keyword">for</span> harbor, default is 443</span></span><br><span class="line"><span class="meta">  #</span><span class="bash">port: 443</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> The path of cert and key files <span class="keyword">for</span> nginx</span></span><br><span class="line"><span class="meta">  #</span><span class="bash">certificate: /your/certificate/path</span></span><br><span class="line"><span class="meta">  #</span><span class="bash">private_key: /your/private/key/path</span></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 执行安装harbor脚步</span></span><br><span class="line">[root@harbor harbor]# ./install.sh</span><br><span class="line"></span><br><span class="line">[Step 0]: checking if docker is installed ...</span><br><span class="line">Note: docker version: 19.03.12</span><br><span class="line"></span><br><span class="line">[Step 1]: checking docker-compose is installed ...</span><br><span class="line">Note: docker-compose version: 1.23.2</span><br><span class="line"></span><br><span class="line">[Step 2]: loading Harbor images ...</span><br><span class="line">···</span><br><span class="line">[Step 5]: starting Harbor ...  # 步骤5：启动harbor镜像容器</span><br><span class="line">Creating network &quot;harbor_harbor&quot; with the default driver</span><br><span class="line">Creating harbor-log ... done     # 启动harbor-log</span><br><span class="line">Creating harbor-portal ... done  # 启动harbor-portal</span><br><span class="line">Creating registryctl   ... done  # 启动registryctl</span><br><span class="line">Creating harbor-db     ... done  # 启动harbor-db</span><br><span class="line">Creating registry      ... done  # 启动registry</span><br><span class="line">Creating redis         ... done  # 启动redis</span><br><span class="line">Creating harbor-core   ... done  # 启动harbor-core</span><br><span class="line">Creating harbor-jobservice ... done  # 启动harbor-jobservice</span><br><span class="line">Creating nginx             ... done  # 启动nginx</span><br><span class="line">✔ ----Harbor has been installed and started successfully.----</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装完成后，会在该目录下生成一个docker-compose.yml文件，这也是基于harbor.yml生成的供docker-compose调用创建容器的服务编排文件</span></span><br><span class="line">[root@harbor harbor]# ls</span><br><span class="line">common  common.sh  docker-compose.yml  harbor.v1.10.4.tar.gz  harbor.yml  install.sh  LICENSE  prepare</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 此时，我们可以查看安装harbor时下载的镜像和启动的容器，如下图所示</span></span><br><span class="line">[root@harbor harbor]# docker image ls</span><br><span class="line">[root@harbor harbor]# docker container ls</span><br></pre></td></tr></table></figure>

<p><img src="/image-20200720193925780.png" alt="image-20200720193925780"></p>
<p>浏览器登录：</p>
<p><img src="/image-20200720190141888.png" alt="image-20200720190141888"></p>
<p>首页如下：</p>
<p><img src="/image-20200720190425088.png" alt="image-20200720190425088"></p>
<p>新建项目，点击上图中’’新建项目’’：</p>
<img src="/image-20200720190539321.png" alt="image-20200720190539321" style="zoom:50%;" />

<p>点击项目名称scaven，进入该项目：</p>
<p><img src="/image-20200720190803656.png" alt="image-20200720190803656"></p>
<p>接下来，我们推送镜像到harbor仓库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 给docker测试机执行镜像仓库</span></span><br><span class="line">[root@docker ~]# cat /etc/docker/daemon.json </span><br><span class="line">&#123;</span><br><span class="line">    &quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;,&quot;http://hub-mirror.c.163.com&quot;],</span><br><span class="line">    &quot;insecure-registries&quot;: [&quot;10.138.3.15:5000&quot;,&quot;10.138.3.33:80&quot;]</span><br><span class="line">&#125;  # 多个镜像仓库用逗号隔开即可，harbor默认使用的https协议，如果不加入insecure-registries则访问不了</span><br><span class="line">[root@docker ~]# systemctl daemon-reload</span><br><span class="line">[root@docker ~]# systemctl restart docker</span><br><span class="line">[root@docker ~]# docker-compose up -d  # 如果有些harbor容器没有启动，则使用该命令重新启动下容器</span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果还是有问题，则使用docker-compose down停止所有harbor容器，然后再重启docker-compose up -d</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 打标签</span></span><br><span class="line">[root@docker ~]# docker image ls | grep centos7.6</span><br><span class="line">centos  centos7.6.1810   f1cb7c7d58b7  16 months ago   202MB</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker tag f1cb7c7d58b7 10.138.3.33/scaven/centos:centos7.6.1810</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 打完标签后，如下</span></span><br><span class="line">[root@docker ~]# docker image ls | grep centos7.6</span><br><span class="line">10.138.3.33/scaven/centos centos7.6.1810 f1cb7c7d58b7 16 months ago 202MB</span><br><span class="line">centos  centos7.6.1810   f1cb7c7d58b7  16 months ago   202MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 上传，先登录，再上传</span></span><br><span class="line">[root@docker ~]# docker login 10.138.3.33:80</span><br><span class="line">Username: admin</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line"></span><br><span class="line">[root@docker ~]# docker push 10.138.3.33:80/scaven/centos:centos7.6.1810</span><br><span class="line">The push refers to repository [10.138.3.33:80/scaven/centos]</span><br><span class="line">89169d87dbe2: Pushed </span><br><span class="line">centos7.6.1810: digest: sha256:747b2de199b6197a26eb1a24d69740d25483995842b2d2f75824095e9d1d19eb size: 529</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>完成后，可在web界面查看</p>
<p><img src="/image-20200720194606072.png" alt="image-20200720194606072"></p>
<p>点击上图中的镜像仓库<code>scaven</code>，进入仓库后，点击镜像名称<code>scaven/centos</code>，如下：</p>
<p><img src="/image-20200720194709838.png" alt="image-20200720194709838"></p>
<p>点击上图中的tag，进入镜像详情页面</p>
<p><img src="/image-20200720194943752.png" alt="image-20200720194943752"></p>
<h2 id="七-补充"><a href="#七-补充" class="headerlink" title="七.补充"></a>七.补充</h2><h3 id="7-1-docker网络详解"><a href="#7-1-docker网络详解" class="headerlink" title="7.1 docker网络详解"></a>7.1 docker网络详解</h3><p>思路：1.安装和启动docker前后，查看宿主机上网络的变化</p>
<p>​            2.启动一个容器后，查看容器内发收数据包与网桥docker0上新增的端口收发数据包的情况</p>
<h4 id="7-1-1-安装和启动docker前后"><a href="#7-1-1-安装和启动docker前后" class="headerlink" title="7.1.1 安装和启动docker前后"></a>7.1.1 安装和启动docker前后</h4><p>在未安装docker软件包之前，使用<code>ip a</code>查看宿主机网络信息如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@docker20 ~]# ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:46:24:04 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.138.3.130/24 brd 10.138.3.255 scope global noprefixroute ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::9ecf:f41f:ee57:9f86/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">[root@docker20 ~]# iptables-save   # iptables规则为空</span><br><span class="line">[root@docker20 ~]#</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# yum  -y install bridge-utils   # 网桥管理工具</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# brctl show</span><br><span class="line">bridge name	     bridge id		 STP enabled	  interfaces    # 无数据信息</span><br><span class="line">[root@docker20 ~]# </span><br></pre></td></tr></table></figure>

<p>安装docker软件包并启动docker(<code>systemctl start docker</code>)后，使用<code>ip a</code>查看宿主机网络信息如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">[root@docker20 ~]# systemctl start docker</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:46:24:04 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.138.3.130/24 brd 10.138.3.255 scope global noprefixroute ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::9ecf:f41f:ee57:9f86/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:d9:02:ec:81 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">            </span><br><span class="line">[root@docker20 ~]# brctl  show</span><br><span class="line">bridge name	  bridge id		       STP enabled	  interfaces</span><br><span class="line">docker0		  8000.0242d902ec81	   no	</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# iptables-save </span><br><span class="line"><span class="meta">#</span><span class="bash"> Generated by iptables-save v1.4.21 on Tue Feb 16 14:11:28 2021</span></span><br><span class="line">*nat</span><br><span class="line">:PREROUTING ACCEPT [0:0]</span><br><span class="line">:INPUT ACCEPT [0:0]</span><br><span class="line">:OUTPUT ACCEPT [1:124]</span><br><span class="line">:POSTROUTING ACCEPT [1:124]</span><br><span class="line">:DOCKER - [0:0]</span><br><span class="line">-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE</span><br><span class="line">-A DOCKER -i docker0 -j RETURN</span><br><span class="line">COMMIT</span><br><span class="line"><span class="meta">#</span><span class="bash"> Completed on Tue Feb 16 14:11:28 2021</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Generated by iptables-save v1.4.21 on Tue Feb 16 14:11:28 2021</span></span><br><span class="line">*filter</span><br><span class="line">:INPUT ACCEPT [17:1096]</span><br><span class="line">:FORWARD DROP [0:0]</span><br><span class="line">:OUTPUT ACCEPT [11:2692]</span><br><span class="line">:DOCKER - [0:0]</span><br><span class="line">:DOCKER-ISOLATION-STAGE-1 - [0:0]</span><br><span class="line">:DOCKER-ISOLATION-STAGE-2 - [0:0]</span><br><span class="line">:DOCKER-USER - [0:0]</span><br><span class="line">-A FORWARD -j DOCKER-USER</span><br><span class="line">-A FORWARD -j DOCKER-ISOLATION-STAGE-1</span><br><span class="line">-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">-A FORWARD -o docker0 -j DOCKER</span><br><span class="line">-A FORWARD -i docker0 ! -o docker0 -j ACCEPT</span><br><span class="line">-A FORWARD -i docker0 -o docker0 -j ACCEPT</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-1 -i docker0 ! -o docker0 -j DOCKER-ISOLATION-STAGE-2</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-1 -j RETURN</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-2 -j RETURN</span><br><span class="line">-A DOCKER-USER -j RETURN</span><br><span class="line">COMMIT</span><br><span class="line"><span class="meta">#</span><span class="bash"> Completed on Tue Feb 16 14:11:28 2021</span></span><br></pre></td></tr></table></figure>

<p>有上述可知，在启动docker时，新建了一个名叫docker0的网桥</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@docker20 ~]# ifconfig</span><br><span class="line">docker0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:55:5e:01:6e  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B) # 显示接收的数据包，所有的容器都是通过docker0网桥接收的数据包，这里是汇总</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)  # 显示发送的数据包，所有的容器都是通过docker0网桥发送的数据包，这里是汇总</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 10.138.3.130  netmask 255.255.255.0  broadcast 10.138.3.255</span><br><span class="line">        inet6 fe80::9ecf:f41f:ee57:9f86  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:46:24:04  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 494  bytes 44022 (42.9 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 351  bytes 67796 (66.2 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)   </span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>

<h4 id="7-1-2-启动容器后"><a href="#7-1-2-启动容器后" class="headerlink" title="7.1.2 启动容器后"></a>7.1.2 启动容器后</h4><p>此时我们启动一个容器，查看<strong>网桥docker0上新增端口</strong>数据包的变化</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 上传镜像</span></span><br><span class="line">[root@docker20 ~]# ll -h </span><br><span class="line">total 358M</span><br><span class="line">-rw-------. 1 root root 1.7K Dec 13 18:01 anaconda-ks.cfg</span><br><span class="line">-rw-r--r--  1 root root 1.4M Feb 15 18:33 busybox.tar</span><br><span class="line">-rw-r--r--  1 root root 200M Feb 15 18:33 centos7.6.tar</span><br><span class="line">-rw-r--r--  1 root root 131M Feb 15 18:33 nginx.tar</span><br><span class="line">-rw-r--r--  1 root root  26M Feb 15 18:33 registry.tar</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 导入镜像</span></span><br><span class="line">[root@docker20 ~]# docker image ls     # 查看现有镜像，显示无镜像</span><br><span class="line">REPOSITORY   TAG       IMAGE ID   CREATED   SIZE</span><br><span class="line">[root@docker20 ~]# docker load -i busybox.tar   # 导入busybox镜像</span><br><span class="line">50761fe126b6: Loading layer [==================================================&gt;]  1.442MB/1.442MB</span><br><span class="line">Loaded image: busybox:latest</span><br><span class="line">[root@docker20 ~]# docker load -i nginx.tar </span><br><span class="line">13cb14c2acd3: Loading layer [==================================================&gt;]  72.49MB/72.49MB</span><br><span class="line">0e32546a8af0: Loading layer [==================================================&gt;]  64.16MB/64.16MB</span><br><span class="line">7ef35766ef7d: Loading layer [==================================================&gt;]  3.072kB/3.072kB</span><br><span class="line">4856db5e4f59: Loading layer [==================================================&gt;]  4.096kB/4.096kB</span><br><span class="line">2808ec4a8ea7: Loading layer [==================================================&gt;]  3.584kB/3.584kB</span><br><span class="line">Loaded image: nginx:latest</span><br><span class="line">[root@docker20 ~]# docker load -i centos7.6.tar </span><br><span class="line">89169d87dbe2: Loading layer [==================================================&gt;]  209.5MB/209.5MB</span><br><span class="line">Loaded image: centos:centos7.6.1810</span><br><span class="line">[root@docker20 ~]# docker image ls   # 导入后，查看宿主机上的镜像</span><br><span class="line">REPOSITORY   TAG              IMAGE ID       CREATED         SIZE</span><br><span class="line">nginx        latest           0901fa9da894   7 months ago    132MB</span><br><span class="line">busybox      latest           c7c37e472d31   7 months ago    1.22MB</span><br><span class="line">centos       centos7.6.1810   f1cb7c7d58b7   23 months ago   202MB</span><br></pre></td></tr></table></figure>

<p>启动容器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@docker20 ~]# docker run -d -p 80:80 --name web01 0901fa9da894</span><br><span class="line">ed8ac3e3190d411b5485d9dd58563cb503235c4d3c2b8e4ed0301c163d1c8bc2</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# docker container ls </span><br><span class="line">CONTAINER ID  IMAGE         COMMAND                 CREATED        STATUS        PORTS               NAMES</span><br><span class="line">ed8ac3e3190d  0901fa9da894  &quot;/docker-entrypoint.…&quot;  39 minutes ago Up 39 minutes 0.0.0.0:80-&gt;80/tcp  web01</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# brctl  show</span><br><span class="line">bridge name	  bridge id		      STP enabled	interfaces</span><br><span class="line">docker0		  8000.0242555e016e	  no		    vethb8545fb  # 启动容器后，docker0上新增了一个端口</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# brctl  show</span><br><span class="line">bridge name	bridge id		STP enabled	interfaces</span><br><span class="line">docker0		8000.0242555e016e	no		veth830784a</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# ifconfig veth830784a</span><br><span class="line">veth830784a: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet6 fe80::38dc:e3ff:fe14:a6fc  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 3a:dc:e3:14:a6:fc  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 8  bytes 656 (656.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>

<p>启动完成后，使用windows主机访问nginx网页</p>
<p><img src="/image-20210215184302351.png" alt="image-20210215184302351"></p>
<p>此时查看<strong>docker0中新增端口</strong>的网络流量跟nginx容器的网络流量</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker0中新增端口的网络流量：</span></span><br><span class="line">[root@docker20 ~]# ifconfig veth830784a</span><br><span class="line">veth830784a: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet6 fe80::38dc:e3ff:fe14:a6fc  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 3a:dc:e3:14:a6:fc  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 81  bytes 4314 (4.2 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 89  bytes 5890 (5.7 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看nginx容器的网络流量：首先进入nginx容器中，然后执行ifconfig命令，最后对比数据包的大小</span></span><br><span class="line">[root@docker20 ~]# docker cp /usr/sbin/ifconfig ed8ac3e3190d:/usr/sbin  # 将ifconfig命令导入到容器中</span><br><span class="line">[root@docker20 ~]# docker exec -it ed8ac3e3190d bash  # 进入容器</span><br><span class="line">root@ed8ac3e3190d:/# ifconfig </span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.2  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:ac:11:00:02  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 89  bytes 5890 (5.7 KiB)  # 流出的流量，对应网桥docker0新增端口veth830784a流入的流量</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 81  bytes 4314 (4.2 KiB)  # 流入的流量，对应网桥docker0新增端口veth830784a流出的流量</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>

<p>此时截图如下：</p>
<p><img src="/image-20210215195308307.png" alt="image-20210215195308307"></p>
<h3 id="7-2-同台宿主机上两个容器的数据包走向"><a href="#7-2-同台宿主机上两个容器的数据包走向" class="headerlink" title="7.2 同台宿主机上两个容器的数据包走向"></a>7.2 同台宿主机上两个容器的数据包走向</h3><p>思路：在同台宿主机上开启两个容器，在两个容器中互ping，查看流量走向</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 新建两个容器，并同时通过xshell界面连接进入容器</span></span><br><span class="line">[root@docker20 ~]# docker run -it -d --name Centos7-01 f1cb7c7d58b7  /bin/bash</span><br><span class="line">[root@docker20 ~]# docker run -it -d --name Centos7-02 f1cb7c7d58b7  /bin/bash</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# docker container ls </span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED         STATUS         PORTS     NAMES</span><br><span class="line">b8d07e8812fb   f1cb7c7d58b7   &quot;/bin/bash&quot;   2 minutes ago   Up 2 minutes             Centos7-02</span><br><span class="line">a7495c7a321a   f1cb7c7d58b7   &quot;/bin/bash&quot;   4 minutes ago   Up 4 minutes             Centos7-01</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入容器1，并安装tcpdump</span></span><br><span class="line">[root@docker20 ~]# docker exec -it a7495c7a321a  bash</span><br><span class="line">[root@a7495c7a321a /]# yum -y install tcpdump</span><br><span class="line">[root@a7495c7a321a /]# ifconfig  eth0 </span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.2  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:ac:11:00:02  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 4015  bytes 13691921 (13.0 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 3103  bytes 171543 (167.5 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入容器2，并安装tcpdump</span></span><br><span class="line">[root@docker20 ~]# docker exec -it b8d07e8812fb bash</span><br><span class="line">[root@b8d07e8812fb /]# yum -y install tcpdump</span><br><span class="line">[root@b8d07e8812fb /]# ifconfig  eth0</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.3  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:ac:11:00:03  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 4423  bytes 13712937 (13.0 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 3334  bytes 184083 (179.7 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在容器2中ping容器1(容器2-b8d07e8812fb打开两个xhsell界面，一个用着ping，一个用着抓包)</span></span><br><span class="line">[root@b8d07e8812fb /]# ping 172.17.0.2 -c 1</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.188 ms</span><br><span class="line"></span><br><span class="line">--- 172.17.0.2 ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span><br><span class="line">rtt min/avg/max/mdev = 0.188/0.188/0.188/0.000 ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在ping的同时，在容器1和容器2以及宿主机上执行tcpdump命令，分别查看容器1和容器2中网卡eth0和宿主机上对应容器1和容器2的端口和docker0的icmp流量的情况</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 1. 容器1中eth0的抓包情况</span></span></span><br><span class="line">[root@a7495c7a321a /]# tcpdump -i eth0 icmp</span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv for full protocol decode</span><br><span class="line">listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">13:08:06.501115 IP 172.17.0.3 &gt; a7495c7a321a: ICMP echo request, id 113, seq 1, length 64</span><br><span class="line">13:08:06.501171 IP a7495c7a321a &gt; 172.17.0.3: ICMP echo reply, id 113, seq 1, length 64</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 2. 与容器1中eth0对应的接口veth5526b5c的抓包情况</span></span></span><br><span class="line">[root@docker20 ~]# tcpdump -i veth5526b5c icmp</span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv for full protocol decode</span><br><span class="line">listening on veth5526b5c, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">21:08:06.501112 IP 172.17.0.3 &gt; 172.17.0.2: ICMP echo request, id 113, seq 1, length 64</span><br><span class="line">21:08:06.501173 IP 172.17.0.2 &gt; 172.17.0.3: ICMP echo reply, id 113, seq 1, length 64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 3. 容器2中eth0的抓包情况</span></span></span><br><span class="line">[root@b8d07e8812fb /]# tcpdump -i eth0 icmp</span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv for full protocol decode</span><br><span class="line">listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">13:08:06.501012 IP b8d07e8812fb &gt; 172.17.0.2: ICMP echo request, id 113, seq 1, length 64</span><br><span class="line">13:08:06.501181 IP 172.17.0.2 &gt; b8d07e8812fb: ICMP echo reply, id 113, seq 1, length 64</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 4. 容器2中eth0对应的接口veth1abfdc9的抓包情况</span></span></span><br><span class="line">[root@docker20 ~]# tcpdump -i veth1abfdc9 icmp </span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv for full protocol decode</span><br><span class="line">listening on veth1abfdc9, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">21:08:06.501046 IP 172.17.0.3 &gt; 172.17.0.2: ICMP echo request, id 113, seq 1, length 64</span><br><span class="line">21:08:06.501180 IP 172.17.0.2 &gt; 172.17.0.3: ICMP echo reply, id 113, seq 1, length 64</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 5. 宿主机docker0的抓包情况</span></span></span><br><span class="line">[root@docker20 ~]# tcpdump  -i docker0 icmp</span><br><span class="line">tcpdump: verbose output suppressed, use -v or -vv for full protocol decode</span><br><span class="line">listening on docker0, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">21:08:06.501046 IP 172.17.0.3 &gt; 172.17.0.2: ICMP echo request, id 113, seq 1, length 64</span><br><span class="line">21:08:06.501173 IP 172.17.0.2 &gt; 172.17.0.3: ICMP echo reply, id 113, seq 1, length 64</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 此时，宿主机和容器1和容器2中的路由信息如下：</span></span><br><span class="line">[root@docker20 ~]# route -n </span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         10.138.3.2      0.0.0.0         UG    100    0        0 ens33</span><br><span class="line">10.138.3.0      0.0.0.0         255.255.255.0   U     100    0        0 ens33</span><br><span class="line">172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0</span><br><span class="line"></span><br><span class="line">[root@a7495c7a321a /]# route -n </span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         172.17.0.1      0.0.0.0         UG    0      0        0 eth0</span><br><span class="line">172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 eth0</span><br><span class="line"></span><br><span class="line">[root@b8d07e8812fb /]# route  -n </span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         172.17.0.1      0.0.0.0         UG    0      0        0 eth0</span><br><span class="line">172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 eth0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​        由上述四个网卡和一个网桥的抓包情况可以看出，同一台宿主机上同网段容器之间是通过网桥docker0直接互通，流程图如下：</p>
<p><img src="/image-20210215212140788.png" alt="image-20210215212140788"></p>
<p>网络流量走向总结：</p>
<p>​        我们在容器2中ping容器1，首先在容器2中查询路由表，得到最优路径(目标地址为172.17.0.2，是属于目标地址为172.17.0.0的路由表，因此会使用该路由信息进行数据传递)，此时流量是从容器2的eth0网卡走向容器2对应在docker0上的接口veth1abfdc9，达到网桥docker0后，发现是同网段的ip地址，通过查询mac地址表，找出容器1的IP地址对应的mac地址，将数据包通过docker0上与容器1相连接的veth5526b5c端口将数据发送给容器1的网卡，数据包返回时操作流程也是一样。</p>
<h3 id="7-3-容器连接外网时的数据包走向–源地址转换"><a href="#7-3-容器连接外网时的数据包走向–源地址转换" class="headerlink" title="7.3 容器连接外网时的数据包走向–源地址转换"></a>7.3 容器连接外网时的数据包走向–源地址转换</h3><p><img src="/image-20210402103617452.png" alt="image-20210402103617452"></p>
<p>思路：在容器1(IP地址为172.17.0.3)中ping百度，抓取容器2的网卡、docker0、ens33，查看数据包的走向</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ping百度</span></span><br><span class="line">[root@b8d07e8812fb /]# ping baidu.com -c 2</span><br><span class="line">PING baidu.com (220.181.38.148) 56(84) bytes of data.</span><br><span class="line">64 bytes from baidu.com (220.181.38.148): icmp_seq=1 ttl=127 time=12.2 ms</span><br><span class="line">64 bytes from baidu.com (220.181.38.148): icmp_seq=2 ttl=127 time=9.94 ms</span><br><span class="line"></span><br><span class="line">--- baidu.com ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 1004ms</span><br><span class="line">rtt min/avg/max/mdev = 9.942/11.119/12.296/1.177 ms</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 抓包情况</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 1.容器2中eth0的抓包和路由信息</span></span></span><br><span class="line">[root@b8d07e8812fb /]# tcpdump -i eth0 icmp -w eth0.cap  # 将输出信息保存到eth0.cap中，</span><br><span class="line">tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">^C4 packets captured</span><br><span class="line">4 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br><span class="line"></span><br><span class="line">[root@b8d07e8812fb /]# route -n </span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         172.17.0.1      0.0.0.0         UG    0      0        0 eth0  # 走这一条路由</span><br><span class="line">172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 eth0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 2.宿主机上docker0的抓包</span></span></span><br><span class="line">[root@docker20 ~]# tcpdump  -i docker0 icmp -w docker0.cap</span><br><span class="line">tcpdump: listening on docker0, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">^C14 packets captured</span><br><span class="line">14 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 3.宿主机上ens33的抓包</span></span></span><br><span class="line">[root@docker20 ~]# tcpdump -i ens33  icmp  -w ens33.cap</span><br><span class="line">tcpdump: listening on ens33, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">^C4 packets captured</span><br><span class="line">4 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# docker cp b8d07e8812fb:/eth0.cap .  # 将容器中的eth0.cap拷贝到宿主机上</span><br><span class="line">[root@docker20 ~]# ll -h *.cap  # 导出，通过wireshark打开数据包，进行网络走向分析</span><br><span class="line">-rw-r--r-- 1 tcpdump tcpdump 480 Feb 15 22:55 docker0.cap</span><br><span class="line">-rw-r--r-- 1 tcpdump tcpdump 480 Feb 15 22:55 ens33.cap</span><br><span class="line">-rw-r--r-- 1 root    root    480 Feb 15 22:55 eth0.cap</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 4.宿主机的iptables规则</span></span></span><br><span class="line">[root@docker20 ~]# iptables-save</span><br><span class="line"><span class="meta">#</span><span class="bash"> Generated by iptables-save v1.4.21 on Mon Feb 15 21:39:23 2021</span></span><br><span class="line">*filter</span><br><span class="line">:INPUT ACCEPT [4043:876124]</span><br><span class="line">:FORWARD DROP [0:0]</span><br><span class="line">:OUTPUT ACCEPT [2946:334234]</span><br><span class="line">:DOCKER - [0:0]</span><br><span class="line">:DOCKER-ISOLATION-STAGE-1 - [0:0]</span><br><span class="line">:DOCKER-ISOLATION-STAGE-2 - [0:0]</span><br><span class="line">:DOCKER-USER - [0:0]</span><br><span class="line">-A FORWARD -j DOCKER-USER</span><br><span class="line">-A FORWARD -j DOCKER-ISOLATION-STAGE-1</span><br><span class="line">-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">-A FORWARD -o docker0 -j DOCKER</span><br><span class="line">-A FORWARD -i docker0 ! -o docker0 -j ACCEPT</span><br><span class="line">-A FORWARD -i docker0 -o docker0 -j ACCEPT</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-1 -i docker0 ! -o docker0 -j DOCKER-ISOLATION-STAGE-2</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-1 -j RETURN</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-2 -j RETURN</span><br><span class="line">-A DOCKER-USER -j RETURN</span><br><span class="line">COMMIT</span><br><span class="line"><span class="meta">#</span><span class="bash"> Completed on Mon Feb 15 21:39:23 2021</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Generated by iptables-save v1.4.21 on Mon Feb 15 21:39:23 2021</span></span><br><span class="line">*nat</span><br><span class="line">:PREROUTING ACCEPT [146:9425]</span><br><span class="line">:INPUT ACCEPT [7:474]</span><br><span class="line">:OUTPUT ACCEPT [49:3260]</span><br><span class="line">:POSTROUTING ACCEPT [53:3596]</span><br><span class="line">:DOCKER - [0:0]</span><br><span class="line">-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE</span><br><span class="line">-A DOCKER -i docker0 -j RETURN</span><br><span class="line">COMMIT</span><br><span class="line"><span class="meta">#</span><span class="bash"> Completed on Mon Feb 15 21:39:23 2021</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>详解iptables规则：-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE，这条iptables规则是将源地址为172.17.0.0/16的数据包(也就是docker容器产生的数据包，容器的网关是docker0的地址，因此必然会经过docker0)，而不是docker0网卡直接发出的数据包，进行源地址转换，转换成docker主机网卡的地址，再发送出去</p>
</blockquote>
<p>下面我们通过wireshark打开三个文件，按照<code>容器eth0--&gt;docker0--&gt;ens33</code>查看数据包流出(即请求信息request)情况，再通过<code>ens33--&gt;docker0--&gt;容器eth0</code>查看数据包流入(即回复信息reply)情况</p>
<h4 id="7-3-1-数据包流出-request-情况"><a href="#7-3-1-数据包流出-request-情况" class="headerlink" title="7.3.1 数据包流出(request)情况"></a>7.3.1 数据包流出(request)情况</h4><p>eth0.cap的流量流出走向</p>
<p><img src="/image-20210215230122269.png" alt="image-20210215230122269"></p>
<p>docker0的流量流出走向</p>
<p><img src="/image-20210215230242488.png" alt="image-20210215230242488"></p>
<p>ens33的流量流出走向</p>
<p><img src="/image-20210215230443133.png" alt="image-20210215230443133"></p>
<h4 id="7-3-2-数据包流入-reply-情况"><a href="#7-3-2-数据包流入-reply-情况" class="headerlink" title="7.3.2 数据包流入(reply)情况"></a>7.3.2 数据包流入(reply)情况</h4><p>ens33.cap数据包流入：</p>
<p><img src="/image-20210215231639194.png" alt="image-20210215231639194"></p>
<p>docker0.cap数据包流入：</p>
<p><img src="/image-20210215231850469.png" alt="image-20210215231850469"></p>
<p>eth0.cap的流量流入：</p>
<p><img src="/image-20210215232001560.png" alt="image-20210215232001560"></p>
<p>因此数据流量的走向如下图所示：</p>
<p><img src="/image-20210215215133565.png" alt="image-20210215215133565"></p>
<p>总结：容器2在ping百度的时候，查询路由表，发现要达到百度需要通过目标地址为0.0.0.0 的路由，因此将数据包发送给容器2的网卡eth0，eth0将数据包发送到网桥docker0上的端口veth1abfdc9，此时，由于目标地址不是同网段，因此就不能直接广播了，就需要将数据包通过docker0转发出去，此时Linux的iptables规则就发挥作用了，首先通过snat规则将数据包传输到公网上，待百度服务器响应后，再将数据包传输给容器2的网卡，最后完成数据包的传递。</p>
<h3 id="7-4-容器连接外网时的数据包走向–目标地址转换"><a href="#7-4-容器连接外网时的数据包走向–目标地址转换" class="headerlink" title="7.4 容器连接外网时的数据包走向–目标地址转换"></a>7.4 容器连接外网时的数据包走向–目标地址转换</h3><p><img src="/image-20210402103500231.png" alt="image-20210402103500231"></p>
<p>思路：启动一个CentOS7的容器，通过外网访问(SSH协议)该容器，查看访问过程</p>
<p>启动容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@docker20 ~]# docker run -td -p 10.138.3.130:20022:22 --name Centos7-ssh f1cb7c7d58b7  /bin/bash</span><br><span class="line">40c86bbddc3a9ab53ddd2742f29e5abc7b48796c37fad26b126706bf5d9857ea</span><br><span class="line">[root@docker20 ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED      STATUS          PORTS     NAMES</span><br><span class="line">40c86bbddc3a   f1cb7c7d58b7   &quot;/bin/bash&quot;   5 seconds ago Up 4 seconds   10.138.3.130:20022-&gt;22/tcp   Centos7-ssh</span><br><span class="line">[root@docker20 ~]# docker port 40c86bbddc3a</span><br><span class="line">22/tcp -&gt; 10.138.3.130:20022</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# docker exec -it 40c86bbddc3a bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装并启动openssh服务</span></span><br><span class="line">[root@40c86bbddc3a init.d]# yum -y install openssh*</span><br><span class="line">[root@40c86bbddc3a init.d]# ./sshd start</span><br><span class="line">[root@40c86bbddc3a ~]# netstat -lntp </span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      227/sshd            </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      227/sshd </span><br><span class="line"></span><br><span class="line">[root@40c86bbddc3a ~]# echo &quot;root:root&quot; | chpasswd    # 给root用户设置密码为root</span><br></pre></td></tr></table></figure>

<p>此时就可以通过xshell进行远程连接了</p>
<p><img src="/image-20210216105143956.png" alt="image-20210216105143956"></p>
<p>我们通过抓包，查看数据包流量走向</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 容器的数据包</span></span><br><span class="line">[root@40c86bbddc3a ~]# tcpdump -i eth0 -w eth0.cap</span><br><span class="line">tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">^C36 packets captured</span><br><span class="line">36 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br><span class="line">[root@40c86bbddc3a ~]# ll </span><br><span class="line">total 12</span><br><span class="line">-rw------- 1 root    root    3322 Dec  4  2018 anaconda-ks.cfg</span><br><span class="line">-rw-r--r-- 1 tcpdump tcpdump 7988 Feb 16 02:56 eth0.cap</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 宿主机上docker0的数据包</span></span><br><span class="line">[root@docker20 ~]# tcpdump -i docker0 -w docker0.cap</span><br><span class="line">tcpdump: listening on docker0, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">^C40 packets captured</span><br><span class="line">40 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 宿主机上ens33的数据包</span></span><br><span class="line">[root@docker20 ~]# tcpdump -i ens33 -w ens33.cap</span><br><span class="line">tcpdump: listening on ens33, link-type EN10MB (Ethernet), capture size 262144 bytes</span><br><span class="line">^C74 packets captured</span><br><span class="line">76 packets received by filter</span><br><span class="line">0 packets dropped by kernel</span><br></pre></td></tr></table></figure>

<p>将容器和宿主机上的数据包传输到pc上通过Wireshark打开</p>
<p>ens33.cap的信息</p>
<p><img src="/image-20210216110825122.png" alt="image-20210216110825122"></p>
<p>docker0.cap的信息</p>
<p><img src="/image-20210216111142142.png" alt="image-20210216111142142"></p>
<p>eth0.cap的信息</p>
<p><img src="/image-20210216111332412.png" alt="image-20210216111332412"></p>
<p>通过上述抓包可以知道，ens33到docker0之间进行了目标地址和端口转换</p>
<p>流程图如下所示：</p>
<p><img src="/image-20210216112509074.png" alt="image-20210216112509074"></p>
<p>此时docker主机上的iptables规则如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@docker20 ~]# iptables-save </span><br><span class="line"><span class="meta">#</span><span class="bash"> Generated by iptables-save v1.4.21 on Tue Feb 16 11:25:21 2021</span></span><br><span class="line">*nat</span><br><span class="line">:PREROUTING ACCEPT [119:7629]</span><br><span class="line">:INPUT ACCEPT [21:1394]</span><br><span class="line">:OUTPUT ACCEPT [4:267]</span><br><span class="line">:POSTROUTING ACCEPT [9:527]</span><br><span class="line">:DOCKER - [0:0]</span><br><span class="line">-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER</span><br><span class="line">-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE</span><br><span class="line">-A POSTROUTING -s 172.17.0.2/32 -d 172.17.0.2/32 -p tcp -m tcp --dport 22 -j MASQUERADE</span><br><span class="line">-A DOCKER -i docker0 -j RETURN</span><br><span class="line">-A DOCKER -d 10.138.3.130/32 ! -i docker0 -p tcp -m tcp --dport 20022 -j DNAT --to-destination 172.17.0.2:22</span><br><span class="line">COMMIT</span><br><span class="line"><span class="meta">#</span><span class="bash"> Completed on Tue Feb 16 11:25:21 2021</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Generated by iptables-save v1.4.21 on Tue Feb 16 11:25:21 2021</span></span><br><span class="line">*filter</span><br><span class="line">:INPUT ACCEPT [2761:180272]</span><br><span class="line">:FORWARD DROP [0:0]</span><br><span class="line">:OUTPUT ACCEPT [2414:539236]</span><br><span class="line">:DOCKER - [0:0]</span><br><span class="line">:DOCKER-ISOLATION-STAGE-1 - [0:0]</span><br><span class="line">:DOCKER-ISOLATION-STAGE-2 - [0:0]</span><br><span class="line">:DOCKER-USER - [0:0]</span><br><span class="line">-A FORWARD -j DOCKER-USER</span><br><span class="line">-A FORWARD -j DOCKER-ISOLATION-STAGE-1</span><br><span class="line">-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">-A FORWARD -o docker0 -j DOCKER</span><br><span class="line">-A FORWARD -i docker0 ! -o docker0 -j ACCEPT</span><br><span class="line">-A FORWARD -i docker0 -o docker0 -j ACCEPT</span><br><span class="line">-A DOCKER -d 172.17.0.2/32 ! -i docker0 -o docker0 -p tcp -m tcp --dport 22 -j ACCEPT</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-1 -i docker0 ! -o docker0 -j DOCKER-ISOLATION-STAGE-2</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-1 -j RETURN</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP</span><br><span class="line">-A DOCKER-ISOLATION-STAGE-2 -j RETURN</span><br><span class="line">-A DOCKER-USER -j RETURN</span><br><span class="line">COMMIT</span><br><span class="line"><span class="meta">#</span><span class="bash"> Completed on Tue Feb 16 11:25:21 2021</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>解析DNAT规则：-A DOCKER -d 10.138.3.130/32 ! -i docker0 -p tcp -m tcp –dport 20022 -j DNAT –to-destination 172.17.0.2:22，意思是源地址是10.138.3.130，目标端口是20022，并且不是发送给docker0的数据包(在系统看来docker0和ens33是同一个网卡)，通过DNAT转换，将数据包发送给172.17.0.2的22号端口</p>
</blockquote>
<img src="/image-20210402104606695.png" alt="image-20210402104606695" style="zoom:67%;" />

<h3 id="7-5-几个常见的容器问题"><a href="#7-5-几个常见的容器问题" class="headerlink" title="7.5 几个常见的容器问题"></a>7.5 几个常见的容器问题</h3><h4 id="7-5-1-容器2引用容器1的网络，当容器1宕掉后，容器2的网络还能正常工作吗？"><a href="#7-5-1-容器2引用容器1的网络，当容器1宕掉后，容器2的网络还能正常工作吗？" class="headerlink" title="7.5.1 容器2引用容器1的网络，当容器1宕掉后，容器2的网络还能正常工作吗？"></a>7.5.1 容器2引用容器1的网络，当容器1宕掉后，容器2的网络还能正常工作吗？</h4><p>答：不能。容器1宕掉后会销毁网络，因此容器2此时只有lo网络了，不再拥有与容器1共享的网络。</p>
<p>实验如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 清除掉所有容器</span></span><br><span class="line">[root@docker20 log]# docker container rm `docker container ls -a -q`</span><br><span class="line">[root@docker20 log]# docker container ls -a </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[root@docker20 log]# </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1.新建容器1</span></span><br><span class="line">[root@docker20 ~]# docker run -td --name share-net f1cb7c7d58b7 bash</span><br><span class="line">ead309a3e0bc3f769c6e08451bab0a47fb89106bf572d7751a7a0165624cdd69</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.新建容器2，使容器2共享容器1的网络</span></span><br><span class="line">[root@docker20 ~]# docker run -td --name net-son --network container:share-net  f1cb7c7d58b7 bash</span><br><span class="line">825c2559f41e7c5b0999feefd0630d1b4bdbe4e907e82ae94e5b521a84148d81</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.检查两个容器是否同一个网络</span></span><br><span class="line">[root@docker20 ~]# docker container ls -a -q </span><br><span class="line">825c2559f41e</span><br><span class="line">ead309a3e0bc</span><br><span class="line">[root@docker20 ~]# docker cp /usr/sbin/ifconfig 825c2559f41e:/usr/sbin/</span><br><span class="line">[root@docker20 ~]# docker cp /usr/sbin/ifconfig ead309a3e0bc:/usr/sbin/</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# docker exec -it 825c2559f41e bash  # 进入容器1</span><br><span class="line">[root@ead309a3e0bc /]# ifconfig eth0   # 容器1，将要被共享网络的容器</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.2  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:ac:11:00:02  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 8  bytes 656 (656.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line">        </span><br><span class="line">[root@docker20 ~]# docker exec -it 825c2559f41e bash</span><br><span class="line">[root@ead309a3e0bc /]# ifconfig  eth0  #容器2，共享容器1网络的容器</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.2  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:ac:11:00:02  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 8  bytes 656 (656.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.宕掉容器1，查看容器2的网络状况</span></span><br><span class="line">[root@docker20 ~]# docker container stop ead309a3e0bc</span><br><span class="line">ead309a3e0bc</span><br><span class="line">[root@docker20 ~]# docker container ls -a </span><br><span class="line">CONTAINER ID   IMAGE         COMMAND  CREATED      STATUS          PORTS         NAMES</span><br><span class="line">825c2559f41e   f1cb7c7d58b7  &quot;bash&quot;   8 minutes ago  Up 8 minutes                net-son</span><br><span class="line">ead309a3e0bc   f1cb7c7d58b7  &quot;bash&quot;   9 minutes ago  Exited (137) 31 seconds ago share-net</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@ead309a3e0bc /]# ifconfig   # 此时只有一个网络了，容器并没有退出</span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 需要注意的是，如果容器1没有启动，是不能重启容器2的，因此容器2的启动依赖于容器1的网络，即启动的顺序是：容器1启动完成后，才能启动容器2</span></span><br><span class="line">[root@docker20 ~]# docker container restart 825c2559f41e</span><br><span class="line">Error response from daemon: Cannot restart container 825c2559f41e: cannot join network of a non running container: ead309a3e0bc3f769c6e08451bab0a47fb89106bf572d7751a7a0165624cdd69</span><br></pre></td></tr></table></figure>

<h4 id="7-5-2-容器2引用容器1的存储卷-容器1引用宿主机存储卷-，当容器1宕掉后，容器2能继续使用存储卷吗？"><a href="#7-5-2-容器2引用容器1的存储卷-容器1引用宿主机存储卷-，当容器1宕掉后，容器2能继续使用存储卷吗？" class="headerlink" title="7.5.2 容器2引用容器1的存储卷(容器1引用宿主机存储卷)，当容器1宕掉后，容器2能继续使用存储卷吗？"></a>7.5.2 容器2引用容器1的存储卷(容器1引用宿主机存储卷)，当容器1宕掉后，容器2能继续使用存储卷吗？</h4><p>答：能。容器1宕掉并不影响容器2使用存储卷进行IO操作，也不影响容器2的运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 清楚宿主机上的所有容器，并新建挂载目录和文件</span></span><br><span class="line">[root@docker20 ~]# docker container rm `docker container ls -a -q`</span><br><span class="line">825c2559f41e</span><br><span class="line">ead309a3e0bc</span><br><span class="line">[root@docker20 ~]# docker container ls -a </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[root@docker20 ~]# </span><br><span class="line">[root@docker20 ~]# mkdir /data_docker/share</span><br><span class="line">[root@docker20 ~]# echo &quot;this is a  volume test for container &quot; &gt; /data_docker/share/index.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1.新建容器1，使容器1引用宿主机的目录</span></span><br><span class="line">[root@docker20 ~]# docker run -td --name c1 -v /data_docker/share:/tmp/  f1cb7c7d58b7 bash</span><br><span class="line">74e4ce2181ceafa348a06cc0b9d4c8940cd9400c4cb5402db13833b8f047d90d</span><br><span class="line">[root@docker20 ~]# docker container ls -a </span><br><span class="line">CONTAINER ID   IMAGE          COMMAND   CREATED         STATUS         PORTS     NAMES</span><br><span class="line">74e4ce2181ce   f1cb7c7d58b7   &quot;bash&quot;    7 seconds ago   Up 6 seconds             c1</span><br><span class="line">[root@docker20 ~]# docker exec -it 74e4ce2181ce  bash </span><br><span class="line">[root@74e4ce2181ce /]# cat  /tmp/index.txt </span><br><span class="line">this is a  volume test for container </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.新建容器2，使容器2引用容器1的存储卷</span></span><br><span class="line">[root@docker20 ~]# docker run -td --name c2 --volumes-from c1  f1cb7c7d58b7 bash</span><br><span class="line">6ae5346e6b5cffb51a974408300469f9526027a08adf8f3d9997824d499e10d9</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# docker container ls </span><br><span class="line">CONTAINER ID   IMAGE          COMMAND   CREATED         STATUS         PORTS     NAMES</span><br><span class="line">6ae5346e6b5c   f1cb7c7d58b7   &quot;bash&quot;    4 seconds ago   Up 4 seconds             c2</span><br><span class="line">74e4ce2181ce   f1cb7c7d58b7   &quot;bash&quot;    3 minutes ago   Up 3 minutes             c1</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# docker exec -it 6ae5346e6b5c bash   # 进入容器c2</span><br><span class="line">[root@6ae5346e6b5c /]# cat /tmp/index.txt </span><br><span class="line">this is a  volume test for container </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.通过上述实验，我们已经知道c2和c1都能读取到宿主机上/data_docker/share/index.txt文件，此时我们宕掉c1容器</span></span><br><span class="line">[root@docker20 ~]# docker container stop 74e4ce2181ce</span><br><span class="line">74e4ce2181ce</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# docker container ls -a </span><br><span class="line">CONTAINER ID   IMAGE          COMMAND   CREATED         STATUS                        PORTS     NAMES</span><br><span class="line">6ae5346e6b5c   f1cb7c7d58b7   &quot;bash&quot;    2 minutes ago   Up 2 minutes                            c2</span><br><span class="line">74e4ce2181ce   f1cb7c7d58b7   &quot;bash&quot;    6 minutes ago   Exited (137) 10 seconds ago             c1</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# date</span><br><span class="line">Tue Feb 16 13:04:01 CST 2021  # 此时宿主机的时间</span><br><span class="line"></span><br><span class="line"><span class="meta"> #</span><span class="bash"> 此时容器c2中仍旧可以对存储卷进行读写</span></span><br><span class="line">[root@6ae5346e6b5c /]# date </span><br><span class="line">Tue Feb 16 05:04:45 UTC 2021</span><br><span class="line">[root@6ae5346e6b5c /]# echo &quot;`date`&quot; &gt;&gt; tmp/index.txt </span><br><span class="line">[root@6ae5346e6b5c /]# cat /tmp/index.txt </span><br><span class="line">this is a  volume test for container </span><br><span class="line">Tue Feb 16 05:05:55 UTC 2021</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在宿主机上查看index.txt文件，内容如下</span></span><br><span class="line">[root@docker20 ~]# cat /data_docker/share/index.txt </span><br><span class="line">this is a  volume test for container </span><br><span class="line">Tue Feb 16 05:05:55 UTC 2021</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4.如果我们重启c2容器，能成功吗？</span></span><br><span class="line">[root@docker20 ~]# docker container restart 6ae5346e6b5c   # 在容器c1宕机的情况下可以启动容器c2</span><br><span class="line">6ae5346e6b5c</span><br><span class="line">[root@docker20 ~]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@docker20 ~]# docker exec -it 6ae5346e6b5c  bash </span><br><span class="line">[root@6ae5346e6b5c /]# cat /tmp/index.txt </span><br><span class="line">this is a  volume test for container </span><br><span class="line">Tue Feb 16 05:05:55 UTC 2021</span><br></pre></td></tr></table></figure>

<p><strong>结论：容器2引用容器1的存储卷时，当容器1宕机不影响容器2的IO操作和容器2的重启操作</strong></p>
<h4 id="有错？？7-5-3-同台宿主机，不同网桥上的两个容器的互通"><a href="#有错？？7-5-3-同台宿主机，不同网桥上的两个容器的互通" class="headerlink" title="有错？？7.5.3 同台宿主机，不同网桥上的两个容器的互通"></a>有错？？7.5.3 同台宿主机，不同网桥上的两个容器的互通</h4><p>思路：新建一个名称为new_bridge的bridge网桥，分别用new_bridge网桥和默认的bridge网桥运行容器，并使用Linux内核的路由转发功能让这两个容器互通</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.清空宿主机上的所有容器</span></span><br><span class="line">[root@docker20 ~]# docker container rm `docker container ls -a -q`</span><br><span class="line">6ae5346e6b5c</span><br><span class="line">74e4ce2181ce</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.新建docker网桥</span></span><br><span class="line">[root@docker20 ~]# docker network ls     # docker宿主机上的默认网络</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">84b07138ff9e   bridge    bridge    local</span><br><span class="line">bca4b3029dbe   host      host      local</span><br><span class="line">ecd4e3687fb9   none      null      local</span><br><span class="line">[root@docker20 ~]# </span><br><span class="line">[root@docker20 ~]# docker network create new_bridge   # 新建一个bridge网桥，名称为new_bridge</span><br><span class="line">c158263b11a08b4062dc21b5806141b017cf7a02d0eff4f57825a4064dc897eb</span><br><span class="line">[root@docker20 ~]# docker network ls </span><br><span class="line">NETWORK ID     NAME         DRIVER    SCOPE</span><br><span class="line">84b07138ff9e   bridge       bridge    local</span><br><span class="line">bca4b3029dbe   host         host      local</span><br><span class="line">c158263b11a0   new_bridge   bridge    local</span><br><span class="line">ecd4e3687fb9   none         null      local</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.新建两个不同网段的容器</span>  </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 3.1新建容器c1</span></span></span><br><span class="line">[root@docker20 ~]# docker run -td --name c1 f1cb7c7d58b7 bash  </span><br><span class="line">60ffca766bdea3ba772bc8fff9e15a5b569d213d06980f1cb56b0d50a66315cf</span><br><span class="line">[root@docker20 ~]# docker cp /usr/sbin/ifconfig 60ffca766bde:/usr/sbin/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 3.2新建容器c2</span></span></span><br><span class="line">[root@docker20 ~]# docker run --name c2 --network new_bridge -td f1cb7c7d58b7   bash </span><br><span class="line">a2e14957ce3fe92a6b3fba5032039730dcfc5ba89be2ba1723ad9e0ca38c9a51</span><br><span class="line">[root@docker20 ~]# docker cp /usr/sbin/ifconfig a2e14957ce3f:/usr/sbin/</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# docker container ls -a </span><br><span class="line">CONTAINER ID   IMAGE          COMMAND   CREATED          STATUS          PORTS     NAMES</span><br><span class="line">a2e14957ce3f   f1cb7c7d58b7   &quot;bash&quot;    38 seconds ago   Up 37 seconds             c2</span><br><span class="line">60ffca766bde   f1cb7c7d58b7   &quot;bash&quot;    6 minutes ago    Up 6 minutes              c1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 3.3进入容器c1，查看c1的IP地址，并ping容器c2</span></span></span><br><span class="line">[root@docker20 ~]# docker exec -it 60ffca766bde bash   </span><br><span class="line">[root@60ffca766bde /]# ifconfig eth0</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.2  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:ac:11:00:02  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 13  bytes 1102 (1.0 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line">        </span><br><span class="line">[root@60ffca766bde /]# ping 172.18.0.2</span><br><span class="line">PING 172.18.0.2 (172.18.0.2) 56(84) bytes of data.</span><br><span class="line">^C</span><br><span class="line">--- 172.18.0.2 ping statistics ---</span><br><span class="line">2 packets transmitted, 0 received, 100% packet loss, time 1001ms</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 3.4进入容器c2，查看c1的IP地址，并ping容器c1</span></span> </span><br><span class="line">[root@docker20 ~]# docker exec -it a2e14957ce3f bash</span><br><span class="line">[root@a2e14957ce3f /]# ifconfig eth0</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.18.0.2  netmask 255.255.0.0  broadcast 172.18.255.255</span><br><span class="line">        ether 02:42:ac:12:00:02  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 13  bytes 1102 (1.0 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">[root@a2e14957ce3f /]# ping 172.17.0.2  </span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">^C</span><br><span class="line">--- 172.17.0.2 ping statistics ---</span><br><span class="line">3 packets transmitted, 0 received, 100% packet loss, time 2002ms</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4.清空防火墙规则，并开启路由转发功能</span></span><br><span class="line">[root@docker20 ~]# iptables -F</span><br><span class="line">[root@docker20 ~]# echo &quot;net.ipv4.ip_forward = 1&quot; &gt;&gt; /etc/sysctl.conf</span><br><span class="line">[root@docker20 ~]# sysctl  -p</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# route -n  # 此时的路由表信息</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         10.138.3.2      0.0.0.0         UG    100    0        0 ens33</span><br><span class="line">10.138.3.0      0.0.0.0         255.255.255.0   U     100    0        0 ens33</span><br><span class="line">172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0</span><br><span class="line">172.18.0.0      0.0.0.0         255.255.0.0     U     0      0        0 br-c158263b11a0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5.此处两个容器互ping不通？？？奇了怪了</span></span><br></pre></td></tr></table></figure>

<h4 id="7-5-4-新建网桥，默认可以通过主机名通信"><a href="#7-5-4-新建网桥，默认可以通过主机名通信" class="headerlink" title="7.5.4 新建网桥，默认可以通过主机名通信"></a>7.5.4 新建网桥，默认可以通过主机名通信</h4><p>​        默认网桥则不行，下面通过在同一网段(两个不同网桥)下ping另一个容器的主机名进行测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line">[root@docker20 ~]# docker container rm -f `docker container ls -qa`  # 删除该宿主机上的所有容器</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# docker network create new_net</span><br><span class="line">f72b4eaaf552cc24efc467f3b630031c86ab649c2e0318ac26de1f1d72b79f21</span><br><span class="line">[root@docker20 ~]# </span><br><span class="line">[root@docker20 ~]# docker network ls </span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">b3064d19f20d   bridge    bridge    local</span><br><span class="line">bca4b3029dbe   host      host      local</span><br><span class="line">f72b4eaaf552   new_net   bridge    local     # 新建网桥，默认也是桥接</span><br><span class="line">ecd4e3687fb9   none      null      local</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# docker network inspect bridge</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;b3064d19f20d631d2a7f3c298a4ee6583a1544ae15c7966f61941d26954670ef&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-04-01T10:59:13.315953055+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: null,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;172.17.0.0/16&quot;,   # 默认网桥默认网段是172.17.0.0/16</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;</span><br><span class="line">            &quot;com.docker.network.bridge.default_bridge&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.enable_icc&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.enable_ip_masquerade&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.host_binding_ipv4&quot;: &quot;0.0.0.0&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.name&quot;: &quot;docker0&quot;,</span><br><span class="line">            &quot;com.docker.network.driver.mtu&quot;: &quot;1500&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# docker network inspect new_net</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;new_net&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;f72b4eaaf552cc24efc467f3b630031c86ab649c2e0318ac26de1f1d72b79f21&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-04-01T21:36:27.933857446+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;172.18.0.0/16&quot;,    # 网段，默认网段是172.18.0.0/16</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.18.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建4个容器，不同网桥容器两个</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 默认网桥</span></span></span><br><span class="line">[root@docker20 ~]# docker run  -it busybox sh   # 新建容器1</span><br><span class="line">/ # ifconfig eth0 </span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 02:42:AC:11:00:02  </span><br><span class="line">          inet addr:172.17.0.2  Bcast:172.17.255.255  Mask:255.255.0.0</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:7 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:586 (586.0 B)  TX bytes:0 (0.0 B)</span><br><span class="line">/ # hostname </span><br><span class="line">14c9f17fe0fc</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# docker run  -it busybox sh    # 新建容器2</span><br><span class="line">/ # ifconfig eth0 </span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 02:42:AC:11:00:03  </span><br><span class="line">          inet addr:172.17.0.3  Bcast:172.17.255.255  Mask:255.255.0.0</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:6 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:516 (516.0 B)  TX bytes:0 (0.0 B)</span><br><span class="line">/ # hostname </span><br><span class="line">a0532f2f769a</span><br><span class="line"></span><br><span class="line">/ # ping 172.17.0.3 -c 1          # 在容器1中ping容器2的IP地址，没有问题</span><br><span class="line">PING 172.17.0.3 (172.17.0.3): 56 data bytes</span><br><span class="line">64 bytes from 172.17.0.3: seq=0 ttl=64 time=0.049 ms</span><br><span class="line"></span><br><span class="line">--- 172.17.0.3 ping statistics ---</span><br><span class="line">1 packets transmitted, 1 packets received, 0% packet loss</span><br><span class="line">round-trip min/avg/max = 0.049/0.049/0.049 ms</span><br><span class="line"></span><br><span class="line">/ # ping a0532f2f769a    # 在容器1中ping容器2的主机名，失败</span><br><span class="line">ping: bad address &#x27;a0532f2f769a&#x27;</span><br><span class="line"></span><br><span class="line">/ # ping 172.17.0.2 -c 1             # 在容器2中ping容器1的IP地址，没有问题</span><br><span class="line">PING 172.17.0.2 (172.17.0.2): 56 data bytes</span><br><span class="line">64 bytes from 172.17.0.2: seq=0 ttl=64 time=6.461 ms</span><br><span class="line"></span><br><span class="line">--- 172.17.0.2 ping statistics ---</span><br><span class="line">1 packets transmitted, 1 packets received, 0% packet loss</span><br><span class="line">round-trip min/avg/max = 6.461/6.461/6.461 ms</span><br><span class="line"></span><br><span class="line">/ # ping 14c9f17fe0fc              # 在容器2中ping容器1的主机名，失败</span><br><span class="line">ping: bad address &#x27;14c9f17fe0fc&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 下面使用新建网桥new_net做实验</span></span></span><br><span class="line">[root@docker20 ~]# docker run  -it --network new_net  busybox sh  # 新建容器1</span><br><span class="line">/ # ifconfig eth0 </span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 02:42:AC:12:00:02  </span><br><span class="line">          inet addr:172.18.0.2  Bcast:172.18.255.255  Mask:255.255.0.0</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:13 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:1102 (1.0 KiB)  TX bytes:0 (0.0 B)</span><br><span class="line"></span><br><span class="line">/ # hostname </span><br><span class="line">d0999162dce9</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# docker run  -it --network new_net  busybox sh  # 新建容器2</span><br><span class="line">/ # ifconfig eth0 </span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 02:42:AC:12:00:03  </span><br><span class="line">          inet addr:172.18.0.3  Bcast:172.18.255.255  Mask:255.255.0.0</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:7 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:586 (586.0 B)  TX bytes:0 (0.0 B)</span><br><span class="line"></span><br><span class="line">/ # hostname </span><br><span class="line">f4743940a945</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在容器1中通过ping命令ping容器2IP地址和容器2主机名</span></span><br><span class="line">/ # ping 172.18.0.3 -c 1                         # 在容器1中ping容器2IP地址成功</span><br><span class="line">PING 172.18.0.3 (172.18.0.3): 56 data bytes</span><br><span class="line">64 bytes from 172.18.0.3: seq=0 ttl=64 time=0.094 ms</span><br><span class="line"></span><br><span class="line">--- 172.18.0.3 ping statistics ---</span><br><span class="line">1 packets transmitted, 1 packets received, 0% packet loss</span><br><span class="line">round-trip min/avg/max = 0.094/0.094/0.094 ms</span><br><span class="line">/ # </span><br><span class="line">/ # ping f4743940a945 -c 1                      # 在容器1中ping容器2主机名成功，并自动解析出IP地址</span><br><span class="line">PING f4743940a945 (172.18.0.3): 56 data bytes   # 通过主机名f4743940a945解析出IP地址--172.18.0.3</span><br><span class="line">64 bytes from 172.18.0.3: seq=0 ttl=64 time=0.057 ms</span><br><span class="line"></span><br><span class="line">--- f4743940a945 ping statistics ---</span><br><span class="line">1 packets transmitted, 1 packets received, 0% packet loss</span><br><span class="line">round-trip min/avg/max = 0.057/0.057/0.057 ms</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在容器2中通过Ping命令ping容器1的IP地址和主机名</span></span><br><span class="line">/ # ping 172.18.0.2 -c 1                     # 在容器1中ping容器1IP地址成功</span><br><span class="line">PING 172.18.0.2 (172.18.0.2): 56 data bytes</span><br><span class="line">64 bytes from 172.18.0.2: seq=0 ttl=64 time=0.050 ms</span><br><span class="line"></span><br><span class="line">--- 172.18.0.2 ping statistics ---</span><br><span class="line">1 packets transmitted, 1 packets received, 0% packet loss</span><br><span class="line">round-trip min/avg/max = 0.050/0.050/0.050 ms</span><br><span class="line"></span><br><span class="line">/ # ping d0999162dce9 -c 1                    # 在容器2中ping容器1IP地址成功</span><br><span class="line">PING d0999162dce9 (172.18.0.2): 56 data bytes</span><br><span class="line">64 bytes from 172.18.0.2: seq=0 ttl=64 time=0.060 ms</span><br><span class="line"></span><br><span class="line">--- d0999162dce9 ping statistics ---</span><br><span class="line">1 packets transmitted, 1 packets received, 0% packet loss</span><br><span class="line">round-trip min/avg/max = 0.060/0.060/0.060 ms</span><br></pre></td></tr></table></figure>

<p>​        我们知道，容器的IP地址是随着容器的启停会随时变化，那么在项目中通过IP地址定位容器的方式就不可取了，常用的做法是新建网桥，通过主机名相互识别相关联的项目容器。</p>
<h3 id="7-6-联合文件系统"><a href="#7-6-联合文件系统" class="headerlink" title="7.6 联合文件系统"></a>7.6 联合文件系统</h3><p>​        支持将不同位置的目录挂载到同一虚拟文件系统，形成一种分层的模型。</p>
<p><img src="/image-20210401153224811.png" alt="image-20210401153224811"></p>
<p>实际拓扑图如下：</p>
<p><img src="/image-20210402101829939.png" alt="image-20210402101829939"></p>
<p>写时复制(COW:copy on write)：当需要修改文件时，会先从镜像里把需要写的文件复制到自己的文件系统中进行修改</p>
<p><img src="/image-20210402102121522.png" alt="image-20210402102121522"></p>
<p>读写文件的顺序：先找容器层，如果有则复制到读写层进行读写，如果容器层没有，再去镜像层查找</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line">[root@docker20 ~]# docker container ls</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND   CREATED       STATUS       PORTS     NAMES</span><br><span class="line">60ffca766bde   f1cb7c7d58b7   &quot;bash&quot;    6 weeks ago   Up 2 hours             c1</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# docker inspect f1cb7c7d58b7    # 查看镜像f1cb7c7d58b7的信息</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;sha256:f1cb7c7d58b73eac859c395882eec49d50651244e342cd6c68a5c7809785f427&quot;,</span><br><span class="line">        &quot;RepoTags&quot;: [</span><br><span class="line">            &quot;centos:centos7.6.1810&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;RepoDigests&quot;: [],</span><br><span class="line">        &quot;Parent&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Comment&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2019-03-14T21:20:29.635970966Z&quot;,</span><br><span class="line">        &quot;Container&quot;: &quot;cc6043a787f6d1c7ae3e121ebdf1c4478186336aa7274871780a0a7bcc3a061a&quot;,</span><br><span class="line">        &quot;ContainerConfig&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;cc6043a787f6&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/sh&quot;,</span><br><span class="line">                &quot;-c&quot;,</span><br><span class="line">                &quot;#(nop) &quot;,</span><br><span class="line">                &quot;CMD [\&quot;/bin/bash\&quot;]&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ArgsEscaped&quot;: true,</span><br><span class="line">            &quot;Image&quot;: &quot;sha256:698a0848ee35389ab7b98494bdc60f887c54ddb94fc2326a1fb4eff8895aff43&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;org.label-schema.build-date&quot;: &quot;20181204&quot;,</span><br><span class="line">                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,</span><br><span class="line">                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,</span><br><span class="line">                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,</span><br><span class="line">                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;DockerVersion&quot;: &quot;18.06.1-ce&quot;,</span><br><span class="line">        &quot;Author&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/bash&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ArgsEscaped&quot;: true,</span><br><span class="line">            &quot;Image&quot;: &quot;sha256:698a0848ee35389ab7b98494bdc60f887c54ddb94fc2326a1fb4eff8895aff43&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;org.label-schema.build-date&quot;: &quot;20181204&quot;,</span><br><span class="line">                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,</span><br><span class="line">                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,</span><br><span class="line">                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,</span><br><span class="line">                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Architecture&quot;: &quot;amd64&quot;,</span><br><span class="line">        &quot;Os&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;Size&quot;: 201763773,</span><br><span class="line">        &quot;VirtualSize&quot;: 201763773,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">       # 统一视图 &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/dd2431298d13cb0c936f162d2dcbf0868d9457f686ad0d12c7f1d07db28b10d2/merged&quot;,</span><br><span class="line">       # 容器层  &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/dd2431298d13cb0c936f162d2dcbf0868d9457f686ad0d12c7f1d07db28b10d2/diff&quot;,</span><br><span class="line">      # 工作目录 &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/dd2431298d13cb0c936f162d2dcbf0868d9457f686ad0d12c7f1d07db28b10d2/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;RootFS&quot;: &#123;</span><br><span class="line">            &quot;Type&quot;: &quot;layers&quot;,</span><br><span class="line">            &quot;Layers&quot;: [</span><br><span class="line">                &quot;sha256:89169d87dbe2b72ba42bfbb3579c957322baca28e03a1e558076542a1c1b2b4a&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Metadata&quot;: &#123;</span><br><span class="line">            &quot;LastTagTime&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看UpperDir，没有上面新建的日期目录</span></span><br><span class="line">[root@docker20 ~]# ls   /var/lib/docker/overlay2/dd2431298d13cb0c936f162d2dcbf0868d9457f686ad0d12c7f1d07db28b10d2/diff </span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下面查看容器中的三层</span></span><br><span class="line">[root@docker20 ~]# docker container ls </span><br><span class="line">CONTAINER ID   IMAGE          COMMAND   CREATED       STATUS             PORTS     NAMES</span><br><span class="line">60ffca766bde   f1cb7c7d58b7   &quot;bash&quot;    6 weeks ago   Up About an hour             c1</span><br><span class="line">[root@docker20 ~]# docker inspect 60ffca766bde</span><br><span class="line">···</span><br><span class="line">&quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;:    &quot;/var/lib/docker/overlay2/f008794742db7f159b4cf33b581b135e708d1133d729bb676395f92b62d06ba1-init/diff:/var/lib/docker/overlay2/dd2431298d13cb0c936f162d2dcbf0868d9457f686ad0d12c7f1d07db28b10d2/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/f008794742db7f159b4cf33b581b135e708d1133d729bb676395f92b62d06ba1/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/f008794742db7f159b4cf33b581b135e708d1133d729bb676395f92b62d06ba1/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/f008794742db7f159b4cf33b581b135e708d1133d729bb676395f92b62d06ba1/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">···</span><br><span class="line"></span><br><span class="line">[root@docker20 overlay2]# ls /var/lib/docker/overlay2/f008794742db7f159b4cf33b581b135e708d1133d729bb676395f92b62d06ba1-init/diff</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看<span class="string">&quot;LowerDir&quot;</span>中的目录信息，etc下的hostname、hosts、resolv.conf这三个文件是挂载宿主机对应文件</span></span><br><span class="line">dev  etc</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看<span class="string">&quot;LowerDir&quot;</span>中的目录/etc/目录中的信息</span></span><br><span class="line">[root@docker20 overlay2]# ls /var/lib/docker/overlay2/f008794742db7f159b4cf33b581b135e708d1133d729bb676395f92b62d06ba1-init/diff/etc/</span><br><span class="line">hostname  hosts  mtab  resolv.conf    # </span><br><span class="line"></span><br><span class="line">[root@docker20 overlay2]# docker container  ls </span><br><span class="line">CONTAINER ID   IMAGE          COMMAND   CREATED       STATUS             PORTS     NAMES</span><br><span class="line">60ffca766bde   f1cb7c7d58b7   &quot;bash&quot;    6 weeks ago   Up About an hour             c1</span><br><span class="line">[root@docker20 overlay2]# docker exec -it 60ffca766bde bash</span><br><span class="line">[root@60ffca766bde /]# cat /etc/hostname   # 容器的主机名</span><br><span class="line">60ffca766bde</span><br><span class="line">[root@60ffca766bde /]# cat /etc/resolv.conf   # 容器的DNS解析文件，使用的是宿主机的</span><br><span class="line"><span class="meta">#</span><span class="bash"> Generated by NetworkManager</span></span><br><span class="line">nameserver 10.138.3.2</span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">[root@60ffca766bde /]# cat /etc/hosts         # 容器的域名解析文件，使用的是宿主机的，并添加了内容 </span><br><span class="line">127.0.0.1	localhost</span><br><span class="line">::1	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0	ip6-localnet</span><br><span class="line">ff00::0	ip6-mcastprefix</span><br><span class="line">ff02::1	ip6-allnodes</span><br><span class="line">ff02::2	ip6-allrouters</span><br><span class="line">172.17.0.2	60ffca766bde</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# cat /etc/hosts   # 宿主机的域名解析文件</span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">[root@docker20 ~]# cat /etc/resolv.conf    # 宿主机的DNS解析文件</span><br><span class="line"><span class="meta">#</span><span class="bash"> Generated by NetworkManager</span></span><br><span class="line">nameserver 10.138.3.2</span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">[root@docker20 ~]# </span><br><span class="line">docker20</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# ls /var/lib/docker/overlay2/dd2431298d13cb0c936f162d2dcbf0868d9457f686ad0d12c7f1d07db28b10d2/diff/</span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var   # 这个是容器中根文件下的目录</span><br><span class="line"></span><br><span class="line">[root@60ffca766bde /]# ls   # 在容器里面查看/目录下的文件，跟上文一致</span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# ls /   # 查看宿主机的/文件下的目录</span><br><span class="line">bin  boot  data_docker  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"></span><br><span class="line">[root@60ffca766bde /]# mkdir `date +%F`  # 在容器里面新建目录2021-03-31</span><br><span class="line">[root@60ffca766bde /]# ls </span><br><span class="line">2021-03-31  anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# ls /var/lib/docker/overlay2/f008794742db7f159b4cf33b581b135e708d1133d729bb676395f92b62d06ba1/merged</span><br><span class="line">2021-03-31  anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"></span><br><span class="line">[root@docker20 ~]# ls /var/lib/docker/overlay2/f008794742db7f159b4cf33b581b135e708d1133d729bb676395f92b62d06ba1/diff</span><br><span class="line">2021-03-31  root  usr</span><br></pre></td></tr></table></figure>

<p>如下图：</p>
<p><img src="/image-20210331214339426.png" alt="image-20210331214339426"></p>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">kubernets</a>
        		</li>
      		
		</ul>
	</div>

    
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/docker//" class="article-tag-list-link color2">docker</a>
        		</li>
      		
		</ul>
	</div>


    
    <p class="article-more-link">
      <a class="article-more-a" href="/2021-04/20-docker/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-welcome" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2021-04/20-welcome/">welcome</a>
	
    </h1>
  


  
  
<a href="/2021-04/20-welcome/" class="archive-article-date">
        <time datetime="2021-04-20T02:11:08.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-04-20</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <p>welcome to my blog!</p>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">welcome</a>
        		</li>
      		
		</ul>
	</div>

    
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/Home//" class="article-tag-list-link color5">Home</a>
        		</li>
      		
		</ul>
	</div>


    
    <p class="article-more-link">
      <a class="article-more-a" href="/2021-04/20-welcome/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
    </nav>
  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2021 <a href="https://scaven.site/" target="_blank">qingdalf</a>
    	</div>
      	<div class="footer-right">
			
			
      		GitHub:<a href="https://github.com/JoeyBling/hexo-theme-yilia-plus" target="_blank">hexo-theme-yilia-plus</a> by Litten
      	</div>
    </div>
  </div>
  
  
	<script src="/lib/busuanzi.pure.js"></script>
	
  
  
	
	<span id="busuanzi_container_site_pv" style="display:none">
		本站总访问量<span id="busuanzi_value_site_pv"></span>次	
	        <span class="post-meta-divider" >|</span>
	</span>
  	<span id="busuanzi_container_site_uv" style='display:none'>
  		本站访客数<span id="busuanzi_value_site_uv"></span>人
  	</span>
  
</footer>

    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		toc_hide_index: true,
		root: "/",
		innerArchive: false,
		showTags: true
	}
</script>

<script>!function(r){function e(t){if(i[t])return i[t].exports;var n=i[t]={exports:{},id:t,loaded:!1};return r[t].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};e.m=r,e.c=i,e.p="./",e(0)}([function(t,n,r){r(208),t.exports=r(205)},function(t,n,r){var d=r(3),y=r(46),g=r(26),b=r(27),x=r(47),m="prototype",S=function(t,n,r){var e,i,o,u,c=t&S.F,f=t&S.G,a=t&S.S,s=t&S.P,l=t&S.B,h=f?d:a?d[n]||(d[n]={}):(d[n]||{})[m],v=f?y:y[n]||(y[n]={}),p=v[m]||(v[m]={});for(e in f&&(r=n),r)o=((i=!c&&h&&void 0!==h[e])?h:r)[e],u=l&&i?x(o,d):s&&"function"==typeof o?x(Function.call,o):o,h&&b(h,e,o,t&S.U),v[e]!=o&&g(v,e,u),s&&p[e]!=o&&(p[e]=o)};d.core=y,S.F=1,S.G=2,S.S=4,S.P=8,S.B=16,S.W=32,S.U=64,S.R=128,t.exports=S},function(t,n,r){var e=r(5);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n,r){var e=r(118)("wks"),i=r(79),o=r(3).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n,r){var e=r(49),i=Math.min;t.exports=function(t){return 0<t?i(e(t),9007199254740991):0}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n,r){t.exports=!r(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(2),i=r(174),o=r(53),u=Object.defineProperty;n.f=r(10)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){t.exports=!r(20)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(14),i=r(24);t.exports=r(12)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(22),i=r(60),o=r(42),u=Object.defineProperty;n.f=r(12)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){var e=r(96),i=r(34);t.exports=function(t){return e(i(t))}},function(t,n,r){var e=r(40)("wks"),i=r(25),o=r(6).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n,r){var e=r(51);t.exports=function(t){return Object(e(t))}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){var r=t.exports={version:"2.6.9"};"number"==typeof __e&&(__e=r)},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n,r){var e=r(18);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=!0},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){var e=r(11),i=r(75);t.exports=r(10)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var o=r(3),u=r(26),c=r(30),f=r(79)("src"),e=r(219),i="toString",a=(""+e).split(i);r(46).inspectSource=function(t){return e.call(t)},(t.exports=function(t,n,r,e){var i="function"==typeof r;i&&(c(r,"name")||u(r,"name",n)),t[n]!==r&&(i&&(c(r,f)||u(r,f,t[n]?""+t[n]:a.join(String(n)))),t===o?t[n]=r:e?t[n]?t[n]=r:u(t,n,r):(delete t[n],u(t,n,r)))})(Function.prototype,i,function(){return"function"==typeof this&&this[f]||e.call(this)})},function(t,n,r){var e=r(1),i=r(4),u=r(51),c=/"/g,o=function(t,n,r,e){var i=String(u(t)),o="<"+n;return""!==r&&(o+=" "+r+'="'+String(e).replace(c,"&quot;")+'"'),o+">"+i+"</"+n+">"};t.exports=function(n,t){var r={};r[n]=t(o),e(e.P+e.F*i(function(){var t=""[n]('"');return t!==t.toLowerCase()||3<t.split('"').length}),"String",r)}},function(t,n,r){var e=r(65),i=r(35);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n,r){var e=r(117),i=r(75),o=r(33),u=r(53),c=r(30),f=r(174),a=Object.getOwnPropertyDescriptor;n.f=r(10)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(30),i=r(17),o=r(154)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,r){var e=r(116),i=r(51);t.exports=function(t){return e(i(t))}},function(t,n){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(14).f,i=r(9),o=r(16)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(40)("keys"),i=r(25);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(19),i=r(6),o="__core-js_shared__",u=i[o]||(i[o]={});(t.exports=function(t,n){return u[t]||(u[t]=void 0!==n?n:{})})("versions",[]).push({version:e.version,mode:r(23)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(0<t?e:r)(t)}},function(t,n,r){var i=r(18);t.exports=function(t,n){if(!i(t))return t;var r,e;if(n&&"function"==typeof(r=t.toString)&&!i(e=r.call(t)))return e;if("function"==typeof(r=t.valueOf)&&!i(e=r.call(t)))return e;if(!n&&"function"==typeof(r=t.toString)&&!i(e=r.call(t)))return e;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(6),i=r(19),o=r(23),u=r(44),c=r(14).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){n.f=r(16)},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n){var r=t.exports={version:"2.6.9"};"number"==typeof __e&&(__e=r)},function(t,n,r){var o=r(21);t.exports=function(e,i,t){if(o(e),void 0===i)return e;switch(t){case 1:return function(t){return e.call(i,t)};case 2:return function(t,n){return e.call(i,t,n)};case 3:return function(t,n,r){return e.call(i,t,n,r)}}return function(){return e.apply(i,arguments)}}},function(t,n,r){"use strict";var e=r(4);t.exports=function(t,n){return!!t&&e(function(){n?t.call(null,function(){},1):t.call(null)})}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(0<t?e:r)(t)}},function(t,n,r){var x=r(47),m=r(116),S=r(17),w=r(8),e=r(138);t.exports=function(l,t){var h=1==l,v=2==l,p=3==l,d=4==l,y=6==l,g=5==l||y,b=t||e;return function(t,n,r){for(var e,i,o=S(t),u=m(o),c=x(n,r,3),f=w(u.length),a=0,s=h?b(t,f):v?b(t,0):void 0;a<f;a++)if((g||a in u)&&(i=c(e=u[a],a,o),l))if(h)s[a]=i;else if(i)switch(l){case 3:return!0;case 5:return e;case 6:return a;case 2:s.push(e)}else if(d)return!1;return y?-1:p||d?d:s}}},function(t,n){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n,r){var i=r(1),o=r(46),u=r(4);t.exports=function(t,n){var r=(o.Object||{})[t]||Object[t],e={};e[t]=n(r),i(i.S+i.F*u(function(){r(1)}),"Object",e)}},function(t,n,r){var i=r(5);t.exports=function(t,n){if(!i(t))return t;var r,e;if(n&&"function"==typeof(r=t.toString)&&!i(e=r.call(t)))return e;if("function"==typeof(r=t.valueOf)&&!i(e=r.call(t)))return e;if(!n&&"function"==typeof(r=t.toString)&&!i(e=r.call(t)))return e;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var d=r(6),y=r(19),g=r(93),b=r(13),x=r(9),m="prototype",S=function(t,n,r){var e,i,o,u=t&S.F,c=t&S.G,f=t&S.S,a=t&S.P,s=t&S.B,l=t&S.W,h=c?y:y[n]||(y[n]={}),v=h[m],p=c?d:f?d[n]:(d[n]||{})[m];for(e in c&&(r=n),r)(i=!u&&p&&void 0!==p[e])&&x(h,e)||(o=i?p[e]:r[e],h[e]=c&&"function"!=typeof p[e]?r[e]:s&&i?g(o,d):l&&p[e]==o?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t[m]=e[m],t}(o):a&&"function"==typeof o?g(Function.call,o):o,a&&((h.virtual||(h.virtual={}))[e]=o,t&S.R&&v&&!v[e]&&b(v,e,o)))};S.F=1,S.G=2,S.S=4,S.P=8,S.B=16,S.W=32,S.U=64,S.R=128,t.exports=S},function(t,n,r){var e=r(34);t.exports=function(t){return Object(e(t))}},function(t,n,r){var o=r(196),e=r(1),i=r(118)("metadata"),u=i.store||(i.store=new(r(200))),c=function(t,n,r){var e=u.get(t);if(!e){if(!r)return;u.set(t,e=new o)}var i=e.get(n);if(!i){if(!r)return;e.set(n,i=new o)}return i};t.exports={store:u,map:c,has:function(t,n,r){var e=c(n,r,!1);return void 0!==e&&e.has(t)},get:function(t,n,r){var e=c(n,r,!1);return void 0===e?void 0:e.get(t)},set:function(t,n,r,e){c(r,e,!0).set(t,n)},keys:function(t,n){var r=c(t,n,!1),e=[];return r&&r.forEach(function(t,n){e.push(n)}),e},key:function(t){return void 0===t||"symbol"==typeof t?t:String(t)},exp:function(t){e(e.S,"Reflect",t)}}},function(t,n,r){"use strict";if(r(10)){var g=r(68),b=r(3),x=r(4),m=r(1),S=r(132),e=r(159),h=r(47),w=r(70),i=r(75),_=r(26),o=r(76),u=r(49),O=r(8),E=r(194),c=r(78),f=r(53),a=r(30),M=r(81),P=r(5),v=r(17),p=r(145),j=r(72),F=r(32),A=r(73).f,d=r(161),s=r(79),l=r(7),y=r(50),I=r(120),L=r(119),N=r(162),T=r(82),k=r(125),R=r(77),C=r(137),D=r(166),G=r(11),W=r(31),U=G.f,V=W.f,B=b.RangeError,q=b.TypeError,z=b.Uint8Array,K="ArrayBuffer",H="Shared"+K,J="BYTES_PER_ELEMENT",$="prototype",Y=Array[$],X=e.ArrayBuffer,Q=e.DataView,Z=y(0),tt=y(2),nt=y(3),rt=y(4),et=y(5),it=y(6),ot=I(!0),ut=I(!1),ct=N.values,ft=N.keys,at=N.entries,st=Y.lastIndexOf,lt=Y.reduce,ht=Y.reduceRight,vt=Y.join,pt=Y.sort,dt=Y.slice,yt=Y.toString,gt=Y.toLocaleString,bt=l("iterator"),xt=l("toStringTag"),mt=s("typed_constructor"),St=s("def_constructor"),wt=S.CONSTR,_t=S.TYPED,Ot=S.VIEW,Et="Wrong length!",Mt=y(1,function(t,n){return It(L(t,t[St]),n)}),Pt=x(function(){return 1===new z(new Uint16Array([1]).buffer)[0]}),jt=!!z&&!!z[$].set&&x(function(){new z(1).set({})}),Ft=function(t,n){var r=u(t);if(r<0||r%n)throw B("Wrong offset!");return r},At=function(t){if(P(t)&&_t in t)return t;throw q(t+" is not a typed array!")},It=function(t,n){if(!(P(t)&&mt in t))throw q("It is not a typed array constructor!");return new t(n)},Lt=function(t,n){return Nt(L(t,t[St]),n)},Nt=function(t,n){for(var r=0,e=n.length,i=It(t,e);r<e;)i[r]=n[r++];return i},Tt=function(t,n,r){U(t,n,{get:function(){return this._d[r]}})},kt=function(t){var n,r,e,i,o,u,c=v(t),f=arguments.length,a=1<f?arguments[1]:void 0,s=void 0!==a,l=d(c);if(null!=l&&!p(l)){for(u=l.call(c),e=[],n=0;!(o=u.next()).done;n++)e.push(o.value);c=e}for(s&&2<f&&(a=h(a,arguments[2],2)),n=0,r=O(c.length),i=It(this,r);n<r;n++)i[n]=s?a(c[n],n):c[n];return i},Rt=function(){for(var t=0,n=arguments.length,r=It(this,n);t<n;)r[t]=arguments[t++];return r},Ct=!!z&&x(function(){gt.call(new z(1))}),Dt=function(){return gt.apply(Ct?dt.call(At(this)):At(this),arguments)},Gt={copyWithin:function(t,n){return D.call(At(this),t,n,2<arguments.length?arguments[2]:void 0)},every:function(t){return rt(At(this),t,1<arguments.length?arguments[1]:void 0)},fill:function(t){return C.apply(At(this),arguments)},filter:function(t){return Lt(this,tt(At(this),t,1<arguments.length?arguments[1]:void 0))},find:function(t){return et(At(this),t,1<arguments.length?arguments[1]:void 0)},findIndex:function(t){return it(At(this),t,1<arguments.length?arguments[1]:void 0)},forEach:function(t){Z(At(this),t,1<arguments.length?arguments[1]:void 0)},indexOf:function(t){return ut(At(this),t,1<arguments.length?arguments[1]:void 0)},includes:function(t){return ot(At(this),t,1<arguments.length?arguments[1]:void 0)},join:function(t){return vt.apply(At(this),arguments)},lastIndexOf:function(t){return st.apply(At(this),arguments)},map:function(t){return Mt(At(this),t,1<arguments.length?arguments[1]:void 0)},reduce:function(t){return lt.apply(At(this),arguments)},reduceRight:function(t){return ht.apply(At(this),arguments)},reverse:function(){for(var t,n=this,r=At(n).length,e=Math.floor(r/2),i=0;i<e;)t=n[i],n[i++]=n[--r],n[r]=t;return n},some:function(t){return nt(At(this),t,1<arguments.length?arguments[1]:void 0)},sort:function(t){return pt.call(At(this),t)},subarray:function(t,n){var r=At(this),e=r.length,i=c(t,e);return new(L(r,r[St]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,O((void 0===n?e:c(n,e))-i))}},Wt=function(t,n){return Lt(this,dt.call(At(this),t,n))},Ut=function(t){At(this);var n=Ft(arguments[1],1),r=this.length,e=v(t),i=O(e.length),o=0;if(r<i+n)throw B(Et);for(;o<i;)this[n+o]=e[o++]},Vt={entries:function(){return at.call(At(this))},keys:function(){return ft.call(At(this))},values:function(){return ct.call(At(this))}},Bt=function(t,n){return P(t)&&t[_t]&&"symbol"!=typeof n&&n in t&&String(+n)==String(n)},qt=function(t,n){return Bt(t,n=f(n,!0))?i(2,t[n]):V(t,n)},zt=function(t,n,r){return!(Bt(t,n=f(n,!0))&&P(r)&&a(r,"value"))||a(r,"get")||a(r,"set")||r.configurable||a(r,"writable")&&!r.writable||a(r,"enumerable")&&!r.enumerable?U(t,n,r):(t[n]=r.value,t)};wt||(W.f=qt,G.f=zt),m(m.S+m.F*!wt,"Object",{getOwnPropertyDescriptor:qt,defineProperty:zt}),x(function(){yt.call({})})&&(yt=gt=function(){return vt.call(this)});var Kt=o({},Gt);o(Kt,Vt),_(Kt,bt,Vt.values),o(Kt,{slice:Wt,set:Ut,constructor:function(){},toString:yt,toLocaleString:Dt}),Tt(Kt,"buffer","b"),Tt(Kt,"byteOffset","o"),Tt(Kt,"byteLength","l"),Tt(Kt,"length","e"),U(Kt,xt,{get:function(){return this[_t]}}),t.exports=function(t,l,n,o){var h=t+((o=!!o)?"Clamped":"")+"Array",r="get"+t,u="set"+t,v=b[h],c=v||{},e=v&&F(v),i=!v||!S.ABV,f={},a=v&&v[$],p=function(t,i){U(t,i,{get:function(){return t=i,(n=this._d).v[r](t*l+n.o,Pt);var t,n},set:function(t){return n=i,r=t,e=this._d,o&&(r=(r=Math.round(r))<0?0:255<r?255:255&r),void e.v[u](n*l+e.o,r,Pt);var n,r,e},enumerable:!0})};i?(v=n(function(t,n,r,e){w(t,v,h,"_d");var i,o,u,c,f=0,a=0;if(P(n)){if(!(n instanceof X||(c=M(n))==K||c==H))return _t in n?Nt(v,n):kt.call(v,n);i=n,a=Ft(r,l);var s=n.byteLength;if(void 0===e){if(s%l)throw B(Et);if((o=s-a)<0)throw B(Et)}else if(s<(o=O(e)*l)+a)throw B(Et);u=o/l}else u=E(n),i=new X(o=u*l);for(_(t,"_d",{b:i,o:a,l:o,e:u,v:new Q(i)});f<u;)p(t,f++)}),a=v[$]=j(Kt),_(a,"constructor",v)):x(function(){v(1)})&&x(function(){new v(-1)})&&k(function(t){new v,new v(null),new v(1.5),new v(t)},!0)||(v=n(function(t,n,r,e){var i;return w(t,v,h),P(n)?n instanceof X||(i=M(n))==K||i==H?void 0!==e?new c(n,Ft(r,l),e):void 0!==r?new c(n,Ft(r,l)):new c(n):_t in n?Nt(v,n):kt.call(v,n):new c(E(n))}),Z(e!==Function.prototype?A(c).concat(A(e)):A(c),function(t){t in v||_(v,t,c[t])}),v[$]=a,g||(a.constructor=v));var s=a[bt],d=!!s&&("values"==s.name||null==s.name),y=Vt.values;_(v,mt,!0),_(a,_t,h),_(a,Ot,!0),_(a,St,v),(o?new v(1)[xt]==h:xt in a)||U(a,xt,{get:function(){return h}}),f[h]=v,m(m.G+m.W+m.F*(v!=c),f),m(m.S,h,{BYTES_PER_ELEMENT:l}),m(m.S+m.F*x(function(){c.of.call(v,1)}),h,{from:kt,of:Rt}),J in a||_(a,J,l),m(m.P,h,Gt),R(h),m(m.P+m.F*jt,h,{set:Ut}),m(m.P+m.F*!d,h,Vt),g||a.toString==yt||(a.toString=yt),m(m.P+m.F*x(function(){new v(1).slice()}),h,{slice:Wt}),m(m.P+m.F*(x(function(){return[1,2].toLocaleString()!=new v([1,2]).toLocaleString()})||!x(function(){a.toLocaleString.call([1,2])})),h,{toLocaleString:Dt}),T[h]=d?s:y,g||d||_(a,bt,y)}}else t.exports=function(){}},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n,r){var e=r(18),i=r(6).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n,r){t.exports=!r(12)&&!r(20)(function(){return 7!=Object.defineProperty(r(59)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){"use strict";var x=r(23),m=r(54),S=r(66),w=r(13),_=r(36),O=r(98),E=r(38),M=r(104),P=r(16)("iterator"),j=!([].keys&&"next"in[].keys()),F="values",A=function(){return this};t.exports=function(t,n,r,e,i,o,u){O(r,n,e);var c,f,a,s=function(t){if(!j&&t in p)return p[t];switch(t){case"keys":case F:return function(){return new r(this,t)}}return function(){return new r(this,t)}},l=n+" Iterator",h=i==F,v=!1,p=t.prototype,d=p[P]||p["@@iterator"]||i&&p[i],y=d||s(i),g=i?h?s("entries"):y:void 0,b="Array"==n&&p.entries||d;if(b&&((a=M(b.call(new t)))!==Object.prototype&&a.next&&(E(a,l,!0),x||"function"==typeof a[P]||w(a,P,A))),h&&d&&d.name!==F&&(v=!0,y=function(){return d.call(this)}),x&&!u||!j&&!v&&p[P]||w(p,P,y),_[n]=y,_[l]=A,i)if(c={values:h?y:s(F),keys:o?y:s("keys"),entries:g},u)for(f in c)f in p||S(p,f,c[f]);else m(m.P+m.F*(j||v),n,c);return c}},function(t,n,e){var i=e(22),o=e(101),u=e(35),c=e(39)("IE_PROTO"),f=function(){},a="prototype",s=function(){var t,n=e(59)("iframe"),r=u.length;for(n.style.display="none",e(95).appendChild(n),n.src="javascript:",(t=n.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),s=t.F;r--;)delete s[a][u[r]];return s()};t.exports=Object.create||function(t,n){var r;return null!==t?(f[a]=i(t),r=new f,f[a]=null,r[c]=t):r=s(),void 0===n?r:o(r,n)}},function(t,n,r){var e=r(65),i=r(35).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var u=r(9),c=r(15),f=r(92)(!1),a=r(39)("IE_PROTO");t.exports=function(t,n){var r,e=c(t),i=0,o=[];for(r in e)r!=a&&u(e,r)&&o.push(r);for(;n.length>i;)u(e,r=n[i++])&&(~f(o,r)||o.push(r));return o}},function(t,n,r){t.exports=r(13)},function(t,n,r){var e=r(7)("unscopables"),i=Array.prototype;null==i[e]&&r(26)(i,e,{}),t.exports=function(t){i[e][t]=!0}},function(t,n){t.exports=!1},function(t,n,r){var e=r(79)("meta"),i=r(5),o=r(30),u=r(11).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(4)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},getWeak:function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},onFreeze:function(t){return a&&l.NEED&&f(t)&&!o(t,e)&&s(t),t}}},function(t,n){t.exports=function(t,n,r,e){if(!(t instanceof n)||void 0!==e&&e in t)throw TypeError(r+": incorrect invocation!");return t}},function(t,n,r){var h=r(47),v=r(177),p=r(145),d=r(2),y=r(8),g=r(161),b={},x={};(n=t.exports=function(t,n,r,e,i){var o,u,c,f,a=i?function(){return t}:g(t),s=h(r,e,n?2:1),l=0;if("function"!=typeof a)throw TypeError(t+" is not iterable!");if(p(a)){for(o=y(t.length);l<o;l++)if((f=n?s(d(u=t[l])[0],u[1]):s(t[l]))===b||f===x)return f}else for(c=a.call(t);!(u=c.next()).done;)if((f=v(c,s,u.value,n))===b||f===x)return f}).BREAK=b,n.RETURN=x},function(t,n,e){var i=e(2),o=e(183),u=e(141),c=e(154)("IE_PROTO"),f=function(){},a="prototype",s=function(){var t,n=e(140)("iframe"),r=u.length;for(n.style.display="none",e(143).appendChild(n),n.src="javascript:",(t=n.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),s=t.F;r--;)delete s[a][u[r]];return s()};t.exports=Object.create||function(t,n){var r;return null!==t?(f[a]=i(t),r=new f,f[a]=null,r[c]=t):r=s(),void 0===n?r:o(r,n)}},function(t,n,r){var e=r(185),i=r(141).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n,r){var e=r(185),i=r(141);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n,r){var i=r(27);t.exports=function(t,n,r){for(var e in n)i(t,e,n[e],r);return t}},function(t,n,r){"use strict";var e=r(3),i=r(11),o=r(10),u=r(7)("species");t.exports=function(t){var n=e[t];o&&n&&!n[u]&&i.f(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,r){var e=r(49),i=Math.max,o=Math.min;t.exports=function(t,n){return(t=e(t))<0?i(t+n,0):o(t,n)}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){var e=r(5);t.exports=function(t,n){if(!e(t)||t._t!==n)throw TypeError("Incompatible receiver, "+n+" required!");return t}},function(t,n,r){var i=r(45),o=r(7)("toStringTag"),u="Arguments"==i(function(){return arguments}());t.exports=function(t){var n,r,e;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,n){try{return t[n]}catch(t){}}(n=Object(t),o))?r:u?i(n):"Object"==(e=i(n))&&"function"==typeof n.callee?"Arguments":e}},function(t,n){t.exports={}},function(t,n,r){var e=r(11).f,i=r(30),o=r(7)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var u=r(1),e=r(51),c=r(4),f=r(157),i="["+f+"]",o=RegExp("^"+i+i+"*"),a=RegExp(i+i+"*$"),s=function(t,n,r){var e={},i=c(function(){return!!f[t]()||"​"!="​"[t]()}),o=e[t]=i?n(l):f[t];r&&(e[r]=o),u(u.P+u.F*i,"String",e)},l=s.trim=function(t,n){return t=String(e(t)),1&n&&(t=t.replace(o,"")),2&n&&(t=t.replace(a,"")),t};t.exports=s},function(t,n,r){t.exports={default:r(88),__esModule:!0}},function(t,n,r){t.exports={default:r(89),__esModule:!0}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var i=e(r(86)),o=e(r(85)),u="function"==typeof o.default&&"symbol"==typeof i.default?function(t){return typeof t}:function(t){return t&&"function"==typeof o.default&&t.constructor===o.default&&t!==o.default.prototype?"symbol":typeof t};n.default="function"==typeof o.default&&"symbol"===u(i.default)?function(t){return void 0===t?"undefined":u(t)}:function(t){return t&&"function"==typeof o.default&&t.constructor===o.default&&t!==o.default.prototype?"symbol":void 0===t?"undefined":u(t)}},function(t,n,r){r(111),r(109),r(112),r(113),t.exports=r(19).Symbol},function(t,n,r){r(110),r(114),t.exports=r(44).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,r){var f=r(15),a=r(107),s=r(106);t.exports=function(c){return function(t,n,r){var e,i=f(t),o=a(i.length),u=s(r,o);if(c&&n!=n){for(;u<o;)if((e=i[u++])!=e)return!0}else for(;u<o;u++)if((c||u in i)&&i[u]===n)return c||u||0;return!c&&-1}}},function(t,n,r){var o=r(90);t.exports=function(e,i,t){if(o(e),void 0===i)return e;switch(t){case 1:return function(t){return e.call(i,t)};case 2:return function(t,n){return e.call(i,t,n)};case 3:return function(t,n,r){return e.call(i,t,n,r)}}return function(){return e.apply(i,arguments)}}},function(t,n,r){var c=r(29),f=r(64),a=r(37);t.exports=function(t){var n=c(t),r=f.f;if(r)for(var e,i=r(t),o=a.f,u=0;i.length>u;)o.call(t,e=i[u++])&&n.push(e);return n}},function(t,n,r){var e=r(6).document;t.exports=e&&e.documentElement},function(t,n,r){var e=r(58);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n,r){var e=r(58);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(62),i=r(24),o=r(38),u={};r(13)(u,r(16)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var e=r(25)("meta"),i=r(18),o=r(9),u=r(14).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(20)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},getWeak:function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},onFreeze:function(t){return a&&l.NEED&&f(t)&&!o(t,e)&&s(t),t}}},function(t,n,r){var u=r(14),c=r(22),f=r(29);t.exports=r(12)?Object.defineProperties:function(t,n){c(t);for(var r,e=f(n),i=e.length,o=0;o<i;)u.f(t,r=e[o++],n[r]);return t}},function(t,n,r){var e=r(37),i=r(24),o=r(15),u=r(42),c=r(9),f=r(60),a=Object.getOwnPropertyDescriptor;n.f=r(12)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(15),i=r(63).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?function(t){try{return i(t)}catch(t){return u.slice()}}(t):i(e(t))}},function(t,n,r){var e=r(9),i=r(55),o=r(39)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,r){var f=r(41),a=r(34);t.exports=function(c){return function(t,n){var r,e,i=String(a(t)),o=f(n),u=i.length;return o<0||u<=o?c?"":void 0:(r=i.charCodeAt(o))<55296||56319<r||o+1===u||(e=i.charCodeAt(o+1))<56320||57343<e?c?i.charAt(o):r:c?i.slice(o,o+2):e-56320+(r-55296<<10)+65536}}},function(t,n,r){var e=r(41),i=Math.max,o=Math.min;t.exports=function(t,n){return(t=e(t))<0?i(t+n,0):o(t,n)}},function(t,n,r){var e=r(41),i=Math.min;t.exports=function(t){return 0<t?i(e(t),9007199254740991):0}},function(t,n,r){"use strict";var e=r(91),i=r(99),o=r(36),u=r(15);t.exports=r(61)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):i(0,"keys"==n?r:"values"==n?t[r]:[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){},function(t,n,r){"use strict";var e=r(105)(!0);r(61)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";var e=r(6),u=r(9),i=r(12),o=r(54),c=r(66),f=r(100).KEY,a=r(20),s=r(40),l=r(38),h=r(25),v=r(16),p=r(44),d=r(43),y=r(94),g=r(97),b=r(22),x=r(18),m=r(55),S=r(15),w=r(42),_=r(24),O=r(62),E=r(103),M=r(102),P=r(64),j=r(14),F=r(29),A=M.f,I=j.f,L=E.f,N=e.Symbol,T=e.JSON,k=T&&T.stringify,R="prototype",C=v("_hidden"),D=v("toPrimitive"),G={}.propertyIsEnumerable,W=s("symbol-registry"),U=s("symbols"),V=s("op-symbols"),B=Object[R],q="function"==typeof N&&!!P.f,z=e.QObject,K=!z||!z[R]||!z[R].findChild,H=i&&a(function(){return 7!=O(I({},"a",{get:function(){return I(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=A(B,n);e&&delete B[n],I(t,n,r),e&&t!==B&&I(B,n,e)}:I,J=function(t){var n=U[t]=O(N[R]);return n._k=t,n},$=q&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===B&&Y(V,n,r),b(t),n=w(n,!0),b(r),u(U,n)?(r.enumerable?(u(t,C)&&t[C][n]&&(t[C][n]=!1),r=O(r,{enumerable:_(0,!1)})):(u(t,C)||I(t,C,_(1,{})),t[C][n]=!0),H(t,n,r)):I(t,n,r)},X=function(t,n){b(t);for(var r,e=y(n=S(n)),i=0,o=e.length;i<o;)Y(t,r=e[i++],n[r]);return t},Q=function(t){var n=G.call(this,t=w(t,!0));return!(this===B&&u(U,t)&&!u(V,t))&&(!(n||!u(this,t)||!u(U,t)||u(this,C)&&this[C][t])||n)},Z=function(t,n){if(t=S(t),n=w(n,!0),t!==B||!u(U,n)||u(V,n)){var r=A(t,n);return!r||!u(U,n)||u(t,C)&&t[C][n]||(r.enumerable=!0),r}},tt=function(t){for(var n,r=L(S(t)),e=[],i=0;r.length>i;)u(U,n=r[i++])||n==C||n==f||e.push(n);return e},nt=function(t){for(var n,r=t===B,e=L(r?V:S(t)),i=[],o=0;e.length>o;)!u(U,n=e[o++])||r&&!u(B,n)||i.push(U[n]);return i};q||(c((N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var n=h(0<arguments.length?arguments[0]:void 0),r=function(t){this===B&&r.call(V,t),u(this,C)&&u(this[C],n)&&(this[C][n]=!1),H(this,n,_(1,t))};return i&&K&&H(B,n,{configurable:!0,set:r}),J(n)})[R],"toString",function(){return this._k}),M.f=Z,j.f=Y,r(63).f=E.f=tt,r(37).f=Q,P.f=nt,i&&!r(23)&&c(B,"propertyIsEnumerable",Q,!0),p.f=function(t){return J(v(t))}),o(o.G+o.W+o.F*!q,{Symbol:N});for(var rt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),et=0;rt.length>et;)v(rt[et++]);for(var it=F(v.store),ot=0;it.length>ot;)d(it[ot++]);o(o.S+o.F*!q,"Symbol",{for:function(t){return u(W,t+="")?W[t]:W[t]=N(t)},keyFor:function(t){if(!$(t))throw TypeError(t+" is not a symbol!");for(var n in W)if(W[n]===t)return n},useSetter:function(){K=!0},useSimple:function(){K=!1}}),o(o.S+o.F*!q,"Object",{create:function(t,n){return void 0===n?O(t):X(O(t),n)},defineProperty:Y,defineProperties:X,getOwnPropertyDescriptor:Z,getOwnPropertyNames:tt,getOwnPropertySymbols:nt});var ut=a(function(){P.f(1)});o(o.S+o.F*ut,"Object",{getOwnPropertySymbols:function(t){return P.f(m(t))}}),T&&o(o.S+o.F*(!q||a(function(){var t=N();return"[null]"!=k([t])||"{}"!=k({a:t})||"{}"!=k(Object(t))})),"JSON",{stringify:function(t){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);if(r=n=e[1],(x(n)||void 0!==t)&&!$(t))return g(n)||(n=function(t,n){if("function"==typeof r&&(n=r.call(this,t,n)),!$(n))return n}),e[1]=n,k.apply(T,e)}}),N[R][D]||r(13)(N[R],D,N[R].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){r(43)("asyncIterator")},function(t,n,r){r(43)("observable")},function(t,n,r){r(108);for(var e=r(6),i=r(13),o=r(36),u=r(16)("toStringTag"),c="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),f=0;f<c.length;f++){var a=c[f],s=e[a],l=s&&s.prototype;l&&!l[u]&&i(l,u,a),o[a]=o.Array}},function(t,n,r){"use strict";var e=r(2);t.exports=function(){var t=e(this),n="";return t.global&&(n+="g"),t.ignoreCase&&(n+="i"),t.multiline&&(n+="m"),t.unicode&&(n+="u"),t.sticky&&(n+="y"),n}},function(t,n,r){var e=r(45);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(46),i=r(3),o="__core-js_shared__",u=i[o]||(i[o]={});(t.exports=function(t,n){return u[t]||(u[t]=void 0!==n?n:{})})("versions",[]).push({version:e.version,mode:r(68)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(t,n,r){var i=r(2),o=r(21),u=r(7)("species");t.exports=function(t,n){var r,e=i(t).constructor;return void 0===e||null==(r=i(e)[u])?n:o(r)}},function(t,n,r){var f=r(33),a=r(8),s=r(78);t.exports=function(c){return function(t,n,r){var e,i=f(t),o=a(i.length),u=s(r,o);if(c&&n!=n){for(;u<o;)if((e=i[u++])!=e)return!0}else for(;u<o;u++)if((c||u in i)&&i[u]===n)return c||u||0;return!c&&-1}}},function(t,n,r){"use strict";var g=r(3),b=r(1),x=r(27),m=r(76),S=r(69),w=r(71),_=r(70),O=r(5),E=r(4),M=r(125),P=r(83),j=r(144);t.exports=function(e,t,n,r,i,o){var u=g[e],c=u,f=i?"set":"add",a=c&&c.prototype,s={},l=function(t){var r=a[t];x(a,t,"delete"==t?function(t){return!(o&&!O(t))&&r.call(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!O(t))&&r.call(this,0===t?0:t)}:"get"==t?function(t){return o&&!O(t)?void 0:r.call(this,0===t?0:t)}:"add"==t?function(t){return r.call(this,0===t?0:t),this}:function(t,n){return r.call(this,0===t?0:t,n),this})};if("function"==typeof c&&(o||a.forEach&&!E(function(){(new c).entries().next()}))){var h=new c,v=h[f](o?{}:-0,1)!=h,p=E(function(){h.has(1)}),d=M(function(t){new c(t)}),y=!o&&E(function(){for(var t=new c,n=5;n--;)t[f](n,n);return!t.has(-0)});d||(((c=t(function(t,n){_(t,c,e);var r=j(new u,t,c);return null!=n&&w(n,i,r[f],r),r})).prototype=a).constructor=c),(p||y)&&(l("delete"),l("has"),i&&l("get")),(y||v)&&l(f),o&&a.clear&&delete a.clear}else c=r.getConstructor(t,e,i,f),m(c.prototype,n),S.NEED=!0;return P(c,e),s[e]=c,b(b.G+b.W+b.F*(c!=u),s),o||r.setStrong(c,e,i),c}},function(t,n,r){"use strict";r(197);var s=r(27),l=r(26),h=r(4),v=r(51),p=r(7),d=r(152),y=p("species"),g=!h(function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}),b=function(){var t=/(?:)/,n=t.exec;t.exec=function(){return n.apply(this,arguments)};var r="ab".split(t);return 2===r.length&&"a"===r[0]&&"b"===r[1]}();t.exports=function(r,t,n){var e=p(r),o=!h(function(){var t={};return t[e]=function(){return 7},7!=""[r](t)}),i=o?!h(function(){var t=!1,n=/a/;return n.exec=function(){return t=!0,null},"split"===r&&(n.constructor={},n.constructor[y]=function(){return n}),n[e](""),!t}):void 0;if(!o||!i||"replace"===r&&!g||"split"===r&&!b){var u=/./[e],c=n(v,e,""[r],function(t,n,r,e,i){return n.exec===d?o&&!i?{done:!0,value:u.call(n,r,e)}:{done:!0,value:t.call(r,n,e)}:{done:!1}}),f=c[0],a=c[1];s(String.prototype,r,f),l(RegExp.prototype,e,2==t?function(t,n){return a.call(t,this,n)}:function(t){return a.call(t,this)})}}},function(t,n,r){var e=r(45);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){var e=r(5),i=r(45),o=r(7)("match");t.exports=function(t){var n;return e(t)&&(void 0!==(n=t[o])?!!n:"RegExp"==i(t))}},function(t,n,r){var o=r(7)("iterator"),u=!1;try{var e=[7][o]();e.return=function(){u=!0},Array.from(e,function(){throw 2})}catch(t){}t.exports=function(t,n){if(!n&&!u)return!1;var r=!1;try{var e=[7],i=e[o]();i.next=function(){return{done:r=!0}},e[o]=function(){return i},t(e)}catch(t){}return r}},function(t,n,r){"use strict";t.exports=r(68)||!r(4)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete r(3)[t]})},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){"use strict";var i=r(81),o=RegExp.prototype.exec;t.exports=function(t,n){var r=t.exec;if("function"==typeof r){var e=r.call(t,n);if("object"!=typeof e)throw new TypeError("RegExp exec method returned something other than an Object or null");return e}if("RegExp"!==i(t))throw new TypeError("RegExp#exec called on incompatible receiver");return o.call(t,n)}},function(t,n,r){"use strict";var e=r(1),u=r(21),c=r(47),f=r(71);t.exports=function(t){e(e.S,t,{from:function(t){var n,r,e,i,o=arguments[1];return u(this),(n=void 0!==o)&&u(o),null==t?new this:(r=[],n?(e=0,i=c(o,arguments[2],2),f(t,!1,function(t){r.push(i(t,e++))})):f(t,!1,r.push,r),new this(r))}})}},function(t,n,r){"use strict";var e=r(1);t.exports=function(t){e(e.S,t,{of:function(){for(var t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return new this(n)}})}},function(t,n,r){var f=r(49),a=r(51);t.exports=function(c){return function(t,n){var r,e,i=String(a(t)),o=f(n),u=i.length;return o<0||u<=o?c?"":void 0:(r=i.charCodeAt(o))<55296||56319<r||o+1===u||(e=i.charCodeAt(o+1))<56320||57343<e?c?i.charAt(o):r:c?i.slice(o,o+2):e-56320+(r-55296<<10)+65536}}},function(t,n,r){for(var e,i=r(3),o=r(26),u=r(79),c=u("typed_array"),f=u("view"),a=!(!i.ArrayBuffer||!i.DataView),s=a,l=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");l<9;)(e=i[h[l++]])?(o(e.prototype,c,!0),o(e.prototype,f,!0)):s=!1;t.exports={ABV:a,CONSTR:s,TYPED:c,VIEW:f}},function(t,n,r){var e=r(3).navigator;t.exports=e&&e.userAgent||""},function(t,n){"use strict";var r,e={versions:(r=window.navigator.userAgent,{trident:-1<r.indexOf("Trident"),presto:-1<r.indexOf("Presto"),webKit:-1<r.indexOf("AppleWebKit"),gecko:-1<r.indexOf("Gecko")&&-1==r.indexOf("KHTML"),mobile:!!r.match(/AppleWebKit.*Mobile.*/),ios:!!r.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:-1<r.indexOf("Android")||-1<r.indexOf("Linux"),iPhone:-1<r.indexOf("iPhone")||-1<r.indexOf("Mac"),iPad:-1<r.indexOf("iPad"),webApp:-1==r.indexOf("Safari"),weixin:-1==r.indexOf("MicroMessenger")})};t.exports=e},function(t,n,r){"use strict";var e,i=r(87),l=(e=i)&&e.__esModule?e:{default:e},h=function(){function n(t,n,r){return n||r?String.fromCharCode(n||r):o[t]||t}function r(t){return s[t]}var e=/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,i=/['<> "&]/g,o={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},u=/\u00a0/g,c=/<br\s*\/?>/gi,f=/\r?\n/g,a=/\s/g,s={};for(var t in o)s[o[t]]=t;return o["&apos;"]="'",s["'"]="&#39;",{encode:function(t){return t?(""+t).replace(i,r).replace(f,"<br/>").replace(a,"&nbsp;"):""},decode:function(t){return t?(""+t).replace(c,"\n").replace(e,n).replace(u," "):""},encodeBase16:function(t){if(!t)return t;for(var n=[],r=0,e=(t+="").length;r<e;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;for(var n=[],r=0,e=(t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")})).length;r<e;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;for(var n=[],r=0,e=(t+="").length;r<e;r+=2)n.push(String.fromCharCode("0x"+t.slice(r,r+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,r=t.length;n<r;n++)t[n]=h.encodeObject(t[n]);else if("object"==(void 0===t?"undefined":(0,l.default)(t)))for(var e in t)t[e]=h.encodeObject(t[e]);else if("string"==typeof t)return h.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=h},function(t,n,r){"use strict";var e=r(131)(!0);t.exports=function(t,n,r){return n+(r?e(t,n).length:1)}},function(t,n,r){"use strict";var c=r(17),f=r(78),a=r(8);t.exports=function(t){for(var n=c(this),r=a(n.length),e=arguments.length,i=f(1<e?arguments[1]:void 0,r),o=2<e?arguments[2]:void 0,u=void 0===o?r:f(o,r);i<u;)n[i++]=t;return n}},function(t,n,r){var e=r(215);t.exports=function(t,n){return new(e(t))(n)}},function(t,n,r){"use strict";var e=r(11),i=r(75);t.exports=function(t,n,r){n in t?e.f(t,n,i(0,r)):t[n]=r}},function(t,n,r){var e=r(5),i=r(3).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n,r){var e=r(7)("match");t.exports=function(n){var r=/./;try{"/./"[n](r)}catch(t){try{return r[e]=!1,!"/./"[n](r)}catch(n){}}return!0}},function(t,n,r){var e=r(3).document;t.exports=e&&e.documentElement},function(t,n,r){var o=r(5),u=r(153).set;t.exports=function(t,n,r){var e,i=n.constructor;return i!==r&&"function"==typeof i&&(e=i.prototype)!==r.prototype&&o(e)&&u&&u(t,e),t}},function(t,n,r){var e=r(82),i=r(7)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(e.Array===t||o[i]===t)}},function(t,n,r){"use strict";var e=r(72),i=r(75),o=r(83),u={};r(26)(u,r(7)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n,r){"use strict";var x=r(68),m=r(1),S=r(27),w=r(26),_=r(82),O=r(146),E=r(83),M=r(32),P=r(7)("iterator"),j=!([].keys&&"next"in[].keys()),F="values",A=function(){return this};t.exports=function(t,n,r,e,i,o,u){O(r,n,e);var c,f,a,s=function(t){if(!j&&t in p)return p[t];switch(t){case"keys":case F:return function(){return new r(this,t)}}return function(){return new r(this,t)}},l=n+" Iterator",h=i==F,v=!1,p=t.prototype,d=p[P]||p["@@iterator"]||i&&p[i],y=d||s(i),g=i?h?s("entries"):y:void 0,b="Array"==n&&p.entries||d;if(b&&((a=M(b.call(new t)))!==Object.prototype&&a.next&&(E(a,l,!0),x||"function"==typeof a[P]||w(a,P,A))),h&&d&&d.name!==F&&(v=!0,y=function(){return d.call(this)}),x&&!u||!j&&!v&&p[P]||w(p,P,y),_[n]=y,_[l]=A,i)if(c={values:h?y:s(F),keys:o?y:s("keys"),entries:g},u)for(f in c)f in p||S(p,f,c[f]);else m(m.P+m.F*(j||v),n,c);return c}},function(t,n){var r=Math.expm1;t.exports=!r||22025.465794806718<r(10)||r(10)<22025.465794806718||-2e-17!=r(-2e-17)?function(t){return 0==(t=+t)?t:-1e-6<t&&t<1e-6?t+t*t/2:Math.exp(t)-1}:r},function(t,n){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,n,r){var c=r(3),f=r(158).set,a=c.MutationObserver||c.WebKitMutationObserver,s=c.process,l=c.Promise,h="process"==r(45)(s);t.exports=function(){var r,e,i,t=function(){var t,n;for(h&&(t=s.domain)&&t.exit();r;){n=r.fn,r=r.next;try{n()}catch(t){throw r?i():e=void 0,t}}e=void 0,t&&t.enter()};if(h)i=function(){s.nextTick(t)};else if(!a||c.navigator&&c.navigator.standalone)if(l&&l.resolve){var n=l.resolve(void 0);i=function(){n.then(t)}}else i=function(){f.call(c,t)};else{var o=!0,u=document.createTextNode("");new a(t).observe(u,{characterData:!0}),i=function(){u.data=o=!o}}return function(t){var n={fn:t,next:void 0};e&&(e.next=n),r||(r=n,i()),e=n}}},function(t,n,r){"use strict";function e(t){var r,e;this.promise=new t(function(t,n){if(void 0!==r||void 0!==e)throw TypeError("Bad Promise constructor");r=t,e=n}),this.resolve=i(r),this.reject=i(e)}var i=r(21);t.exports.f=function(t){return new e(t)}},function(t,n,r){"use strict";var e,i,u=r(115),c=RegExp.prototype.exec,f=String.prototype.replace,o=c,a="lastIndex",s=(e=/a/,i=/b*/g,c.call(e,"a"),c.call(i,"a"),0!==e[a]||0!==i[a]),l=void 0!==/()??/.exec("")[1];(s||l)&&(o=function(t){var n,r,e,i,o=this;return l&&(r=new RegExp("^"+o.source+"$(?!\\s)",u.call(o))),s&&(n=o[a]),e=c.call(o,t),s&&e&&(o[a]=o.global?e.index+e[0].length:n),l&&e&&1<e.length&&f.call(e[0],r,function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(e[i]=void 0)}),e}),t.exports=o},function(t,n,i){var r=i(5),e=i(2),o=function(t,n){if(e(t),!r(n)&&null!==n)throw TypeError(n+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,r,e){try{(e=i(47)(Function.call,i(31).f(Object.prototype,"__proto__").set,2))(t,[]),r=!(t instanceof Array)}catch(t){r=!0}return function(t,n){return o(t,n),r?t.__proto__=n:e(t,n),t}}({},!1):void 0),check:o}},function(t,n,r){var e=r(118)("keys"),i=r(79);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(124),i=r(51);t.exports=function(t,n,r){if(e(n))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(t))}},function(t,n,r){"use strict";var i=r(49),o=r(51);t.exports=function(t){var n=String(o(this)),r="",e=i(t);if(e<0||e==1/0)throw RangeError("Count can't be negative");for(;0<e;(e>>>=1)&&(n+=n))1&e&&(r+=n);return r}},function(t,n){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(t,n,r){var e,i,o,u=r(47),c=r(175),f=r(143),a=r(140),s=r(3),l=s.process,h=s.setImmediate,v=s.clearImmediate,p=s.MessageChannel,d=s.Dispatch,y=0,g={},b="onreadystatechange",x=function(){var t=+this;if(g.hasOwnProperty(t)){var n=g[t];delete g[t],n()}},m=function(t){x.call(t.data)};h&&v||(h=function(t){for(var n=[],r=1;arguments.length>r;)n.push(arguments[r++]);return g[++y]=function(){c("function"==typeof t?t:Function(t),n)},e(y),y},v=function(t){delete g[t]},"process"==r(45)(l)?e=function(t){l.nextTick(u(x,t,1))}:d&&d.now?e=function(t){d.now(u(x,t,1))}:p?(o=(i=new p).port2,i.port1.onmessage=m,e=u(o.postMessage,o,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts?(e=function(t){s.postMessage(t+"","*")},s.addEventListener("message",m,!1)):e=b in a("script")?function(t){f.appendChild(a("script"))[b]=function(){f.removeChild(this),x.call(t)}}:function(t){setTimeout(u(x,t,1),0)}),t.exports={set:h,clear:v}},function(t,n,r){"use strict";function e(t,n,r){var e,i,o,u=new Array(r),c=8*r-n-1,f=(1<<c)-1,a=f>>1,s=23===n?W(2,-24)-W(2,-77):0,l=0,h=t<0||0===t&&1/t<0?1:0;for((t=G(t))!=t||t===C?(i=t!=t?1:0,e=f):(e=U(V(t)/B),t*(o=W(2,-e))<1&&(e--,o*=2),2<=(t+=1<=e+a?s/o:s*W(2,1-a))*o&&(e++,o/=2),f<=e+a?(i=0,e=f):1<=e+a?(i=(t*o-1)*W(2,n),e+=a):(i=t*W(2,a-1)*W(2,n),e=0));8<=n;u[l++]=255&i,i/=256,n-=8);for(e=e<<n|i,c+=n;0<c;u[l++]=255&e,e/=256,c-=8);return u[--l]|=128*h,u}function i(t,n,r){var e,i=8*r-n-1,o=(1<<i)-1,u=o>>1,c=i-7,f=r-1,a=t[f--],s=127&a;for(a>>=7;0<c;s=256*s+t[f],f--,c-=8);for(e=s&(1<<-c)-1,s>>=-c,c+=n;0<c;e=256*e+t[f],f--,c-=8);if(0===s)s=1-u;else{if(s===o)return e?NaN:a?-C:C;e+=W(2,n),s-=u}return(a?-1:1)*e*W(2,s-n)}function o(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function u(t){return[255&t]}function c(t){return[255&t,t>>8&255]}function f(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function a(t){return e(t,52,8)}function s(t){return e(t,23,4)}function l(t,n,r){M(t[I],n,{get:function(){return this[r]}})}function h(t,n,r,e){var i=O(+r);if(i+n>t[H])throw R(L);var o=t[K]._b,u=i+t[J],c=o.slice(u,u+n);return e?c:c.reverse()}function v(t,n,r,e,i,o){var u=O(+r);if(u+n>t[H])throw R(L);for(var c=t[K]._b,f=u+t[J],a=e(+i),s=0;s<n;s++)c[f+s]=a[o?s:n-s-1]}var p=r(3),d=r(10),y=r(68),g=r(132),b=r(26),x=r(76),m=r(4),S=r(70),w=r(49),_=r(8),O=r(194),E=r(73).f,M=r(11).f,P=r(137),j=r(83),F="ArrayBuffer",A="DataView",I="prototype",L="Wrong index!",N=p[F],T=p[A],k=p.Math,R=p.RangeError,C=p.Infinity,D=N,G=k.abs,W=k.pow,U=k.floor,V=k.log,B=k.LN2,q="byteLength",z="byteOffset",K=d?"_b":"buffer",H=d?"_l":q,J=d?"_o":z;if(g.ABV){if(!m(function(){N(1)})||!m(function(){new N(-1)})||m(function(){return new N,new N(1.5),new N(NaN),N.name!=F})){for(var $,Y=(N=function(t){return S(this,N),new D(O(t))})[I]=D[I],X=E(D),Q=0;X.length>Q;)($=X[Q++])in N||b(N,$,D[$]);y||(Y.constructor=N)}var Z=new T(new N(2)),tt=T[I].setInt8;Z.setInt8(0,2147483648),Z.setInt8(1,2147483649),!Z.getInt8(0)&&Z.getInt8(1)||x(T[I],{setInt8:function(t,n){tt.call(this,t,n<<24>>24)},setUint8:function(t,n){tt.call(this,t,n<<24>>24)}},!0)}else N=function(t){S(this,N,F);var n=O(t);this._b=P.call(new Array(n),0),this[H]=n},T=function(t,n,r){S(this,T,A),S(t,N,A);var e=t[H],i=w(n);if(i<0||e<i)throw R("Wrong offset!");if(e<i+(r=void 0===r?e-i:_(r)))throw R("Wrong length!");this[K]=t,this[J]=i,this[H]=r},d&&(l(N,q,"_l"),l(T,"buffer","_b"),l(T,q,"_l"),l(T,z,"_o")),x(T[I],{getInt8:function(t){return h(this,1,t)[0]<<24>>24},getUint8:function(t){return h(this,1,t)[0]},getInt16:function(t){var n=h(this,2,t,arguments[1]);return(n[1]<<8|n[0])<<16>>16},getUint16:function(t){var n=h(this,2,t,arguments[1]);return n[1]<<8|n[0]},getInt32:function(t){return o(h(this,4,t,arguments[1]))},getUint32:function(t){return o(h(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return i(h(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return i(h(this,8,t,arguments[1]),52,8)},setInt8:function(t,n){v(this,1,t,u,n)},setUint8:function(t,n){v(this,1,t,u,n)},setInt16:function(t,n){v(this,2,t,c,n,arguments[2])},setUint16:function(t,n){v(this,2,t,c,n,arguments[2])},setInt32:function(t,n){v(this,4,t,f,n,arguments[2])},setUint32:function(t,n){v(this,4,t,f,n,arguments[2])},setFloat32:function(t,n){v(this,4,t,s,n,arguments[2])},setFloat64:function(t,n){v(this,8,t,a,n,arguments[2])}});j(N,F),j(T,A),b(T[I],g.VIEW,!0),n[F]=N,n[A]=T},function(t,n,r){var e=r(3),i=r(46),o=r(68),u=r(195),c=r(11).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){var e=r(81),i=r(7)("iterator"),o=r(82);t.exports=r(46).getIteratorMethod=function(t){if(null!=t)return t[i]||t["@@iterator"]||o[e(t)]}},function(t,n,r){"use strict";var e=r(67),i=r(178),o=r(82),u=r(33);t.exports=r(147)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):i(0,"keys"==n?r:"values"==n?t[r]:[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){t.exports=function(t,n){t.classList?t.classList.add(n):t.className+=" "+n}},function(t,n){t.exports=function(t,n){if(t.classList)t.classList.remove(n);else{var r=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(r," ")}}},function(t,n,r){var e=r(45);t.exports=function(t,n){if("number"!=typeof t&&"Number"!=e(t))throw TypeError(n);return+t}},function(t,n,r){"use strict";var a=r(17),s=r(78),l=r(8);t.exports=[].copyWithin||function(t,n){var r=a(this),e=l(r.length),i=s(t,e),o=s(n,e),u=2<arguments.length?arguments[2]:void 0,c=Math.min((void 0===u?e:s(u,e))-o,e-i),f=1;for(o<i&&i<o+c&&(f=-1,o+=c-1,i+=c-1);0<c--;)o in r?r[i]=r[o]:delete r[i],i+=f,o+=f;return r}},function(t,n,r){var e=r(71);t.exports=function(t,n){var r=[];return e(t,!1,r.push,r,n),r}},function(t,n,r){var s=r(21),l=r(17),h=r(116),v=r(8);t.exports=function(t,n,r,e,i){s(n);var o=l(t),u=h(o),c=v(o.length),f=i?c-1:0,a=i?-1:1;if(r<2)for(;;){if(f in u){e=u[f],f+=a;break}if(f+=a,i?f<0:c<=f)throw TypeError("Reduce of empty array with no initial value")}for(;i?0<=f:f<c;f+=a)f in u&&(e=n(e,u[f],f,o));return e}},function(t,n,r){"use strict";var o=r(21),u=r(5),c=r(175),f=[].slice,a={};t.exports=Function.bind||function(n){var r=o(this),e=f.call(arguments,1),i=function(){var t=e.concat(f.call(arguments));return this instanceof i?function(t,n,r){if(!(n in a)){for(var e=[],i=0;i<n;i++)e[i]="a["+i+"]";a[n]=Function("F,a","return new F("+e.join(",")+")")}return a[n](t,r)}(r,t.length,t):c(r,t,n)};return u(r.prototype)&&(i.prototype=r.prototype),i}},function(t,n,r){"use strict";var u=r(11).f,c=r(72),f=r(76),a=r(47),s=r(70),l=r(71),e=r(147),i=r(178),o=r(77),h=r(10),v=r(69).fastKey,p=r(80),d=h?"_s":"size",y=function(t,n){var r,e=v(n);if("F"!==e)return t._i[e];for(r=t._f;r;r=r.n)if(r.k==n)return r};t.exports={getConstructor:function(t,o,r,e){var i=t(function(t,n){s(t,i,o,"_i"),t._t=o,t._i=c(null),t._f=void 0,t._l=void 0,t[d]=0,null!=n&&l(n,r,t[e],t)});return f(i.prototype,{clear:function(){for(var t=p(this,o),n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[d]=0},delete:function(t){var n=p(this,o),r=y(n,t);if(r){var e=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=e),e&&(e.p=i),n._f==r&&(n._f=e),n._l==r&&(n._l=i),n[d]--}return!!r},forEach:function(t){p(this,o);for(var n,r=a(t,1<arguments.length?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!y(p(this,o),t)}}),h&&u(i.prototype,"size",{get:function(){return p(this,o)[d]}}),i},def:function(t,n,r){var e,i,o=y(t,n);return o?o.v=r:(t._l=o={i:i=v(n,!0),k:n,v:r,p:e=t._l,n:void 0,r:!1},t._f||(t._f=o),e&&(e.n=o),t[d]++,"F"!==i&&(t._i[i]=o)),t},getEntry:y,setStrong:function(t,r,n){e(t,r,function(t,n){this._t=p(t,r),this._k=n,this._l=void 0},function(){for(var t=this,n=t._k,r=t._l;r&&r.r;)r=r.p;return t._t&&(t._l=r=r?r.n:t._t._f)?i(0,"keys"==n?r.k:"values"==n?r.v:[r.k,r.v]):(t._t=void 0,i(1))},n?"entries":"values",!n,!0),o(r)}}},function(t,n,r){var e=r(81),i=r(167);t.exports=function(t){return function(){if(e(this)!=t)throw TypeError(t+"#toJSON isn't generic");return i(this)}}},function(t,n,r){"use strict";var u=r(76),c=r(69).getWeak,i=r(2),f=r(5),a=r(70),s=r(71),e=r(50),l=r(30),h=r(80),o=e(5),v=e(6),p=0,d=function(t){return t._l||(t._l=new y)},y=function(){this.a=[]},g=function(t,n){return o(t.a,function(t){return t[0]===n})};y.prototype={get:function(t){var n=g(this,t);if(n)return n[1]},has:function(t){return!!g(this,t)},set:function(t,n){var r=g(this,t);r?r[1]=n:this.a.push([t,n])},delete:function(n){var t=v(this.a,function(t){return t[0]===n});return~t&&this.a.splice(t,1),!!~t}},t.exports={getConstructor:function(t,r,e,i){var o=t(function(t,n){a(t,o,r,"_i"),t._t=r,t._i=p++,t._l=void 0,null!=n&&s(n,e,t[i],t)});return u(o.prototype,{delete:function(t){if(!f(t))return!1;var n=c(t);return!0===n?d(h(this,r)).delete(t):n&&l(n,this._i)&&delete n[this._i]},has:function(t){if(!f(t))return!1;var n=c(t);return!0===n?d(h(this,r)).has(t):n&&l(n,this._i)}}),o},def:function(t,n,r){var e=c(i(n),!0);return!0===e?d(t).set(n,r):e[t._i]=r,t},ufstore:d}},function(t,n,r){"use strict";var p=r(123),d=r(5),y=r(8),g=r(47),b=r(7)("isConcatSpreadable");t.exports=function t(n,r,e,i,o,u,c,f){for(var a,s,l=o,h=0,v=!!c&&g(c,f,3);h<i;){if(h in e){if(a=v?v(e[h],h,r):e[h],s=!1,d(a)&&(s=void 0!==(s=a[b])?!!s:p(a)),s&&0<u)l=t(n,r,a,y(a.length),l,u-1)-1;else{if(9007199254740991<=l)throw TypeError();n[l]=a}l++}h++}return l}},function(t,n,r){t.exports=!r(10)&&!r(4)(function(){return 7!=Object.defineProperty(r(140)("div"),"a",{get:function(){return 7}}).a})},function(t,n){t.exports=function(t,n,r){var e=void 0===r;switch(n.length){case 0:return e?t():t.call(r);case 1:return e?t(n[0]):t.call(r,n[0]);case 2:return e?t(n[0],n[1]):t.call(r,n[0],n[1]);case 3:return e?t(n[0],n[1],n[2]):t.call(r,n[0],n[1],n[2]);case 4:return e?t(n[0],n[1],n[2],n[3]):t.call(r,n[0],n[1],n[2],n[3])}return t.apply(r,n)}},function(t,n,r){var e=r(5),i=Math.floor;t.exports=function(t){return!e(t)&&isFinite(t)&&i(t)===t}},function(t,n,r){var o=r(2);t.exports=function(t,n,r,e){try{return e?n(o(r)[0],r[1]):n(r)}catch(n){var i=t.return;throw void 0!==i&&o(i.call(t)),n}}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var o=r(149),e=Math.pow,u=e(2,-52),c=e(2,-23),f=e(2,127)*(2-c),a=e(2,-126);t.exports=Math.fround||function(t){var n,r,e=Math.abs(t),i=o(t);return e<a?i*(e/a/c+1/u-1/u)*a*c:f<(r=(n=(1+c/u)*e)-(n-e))||r!=r?i*(1/0):i*r}},function(t,n){t.exports=Math.log1p||function(t){return-1e-8<(t=+t)&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,n){t.exports=Math.scale||function(t,n,r,e,i){return 0===arguments.length||t!=t||n!=n||r!=r||e!=e||i!=i?NaN:t===1/0||t===-1/0?t:(t-n)*(i-e)/(r-n)+e}},function(t,n,r){"use strict";var h=r(10),v=r(74),p=r(127),d=r(117),y=r(17),g=r(116),i=Object.assign;t.exports=!i||r(4)(function(){var t={},n={},r=Symbol(),e="abcdefghijklmnopqrst";return t[r]=7,e.split("").forEach(function(t){n[t]=t}),7!=i({},t)[r]||Object.keys(i({},n)).join("")!=e})?function(t,n){for(var r=y(t),e=arguments.length,i=1,o=p.f,u=d.f;i<e;)for(var c,f=g(arguments[i++]),a=o?v(f).concat(o(f)):v(f),s=a.length,l=0;l<s;)c=a[l++],h&&!u.call(f,c)||(r[c]=f[c]);return r}:i},function(t,n,r){var u=r(11),c=r(2),f=r(74);t.exports=r(10)?Object.defineProperties:function(t,n){c(t);for(var r,e=f(n),i=e.length,o=0;o<i;)u.f(t,r=e[o++],n[r]);return t}},function(t,n,r){var e=r(33),i=r(73).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?function(t){try{return i(t)}catch(t){return u.slice()}}(t):i(e(t))}},function(t,n,r){var u=r(30),c=r(33),f=r(120)(!1),a=r(154)("IE_PROTO");t.exports=function(t,n){var r,e=c(t),i=0,o=[];for(r in e)r!=a&&u(e,r)&&o.push(r);for(;n.length>i;)u(e,r=n[i++])&&(~f(o,r)||o.push(r));return o}},function(t,n,r){var f=r(10),a=r(74),s=r(33),l=r(117).f;t.exports=function(c){return function(t){for(var n,r=s(t),e=a(r),i=e.length,o=0,u=[];o<i;)n=e[o++],f&&!l.call(r,n)||u.push(c?[n,r[n]]:r[n]);return u}}},function(t,n,r){var e=r(73),i=r(127),o=r(2),u=r(3).Reflect;t.exports=u&&u.ownKeys||function(t){var n=e.f(o(t)),r=i.f;return r?n.concat(r(t)):n}},function(t,n,r){var e=r(3).parseFloat,i=r(84).trim;t.exports=1/e(r(157)+"-0")!=-1/0?function(t){var n=i(String(t),3),r=e(n);return 0===r&&"-"==n.charAt(0)?-0:r}:e},function(t,n,r){var e=r(3).parseInt,i=r(84).trim,o=r(157),u=/^[-+]?0[xX]/;t.exports=8!==e(o+"08")||22!==e(o+"0x16")?function(t,n){var r=i(String(t),3);return e(r,n>>>0||(u.test(r)?16:10))}:e},function(t,n){t.exports=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}}},function(t,n,r){var e=r(2),i=r(5),o=r(151);t.exports=function(t,n){if(e(t),i(n)&&n.constructor===t)return n;var r=o.f(t);return(0,r.resolve)(n),r.promise}},function(t,n){t.exports=Object.is||function(t,n){return t===n?0!==t||1/t==1/n:t!=t&&n!=n}},function(t,n,r){var s=r(8),l=r(156),h=r(51);t.exports=function(t,n,r,e){var i=String(h(t)),o=i.length,u=void 0===r?" ":String(r),c=s(n);if(c<=o||""==u)return i;var f=c-o,a=l.call(u,Math.ceil(f/u.length));return a.length>f&&(a=a.slice(0,f)),e?a+i:i+a}},function(t,n,r){var e=r(49),i=r(8);t.exports=function(t){if(void 0===t)return 0;var n=e(t),r=i(n);if(n!==r)throw RangeError("Wrong length!");return r}},function(t,n,r){n.f=r(7)},function(t,n,r){"use strict";var e=r(170),i=r(80);t.exports=r(121)("Map",function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},{get:function(t){var n=e.getEntry(i(this,"Map"),t);return n&&n.v},set:function(t,n){return e.def(i(this,"Map"),0===t?0:t,n)}},e,!0)},function(t,n,r){"use strict";var e=r(152);r(1)({target:"RegExp",proto:!0,forced:e!==/./.exec},{exec:e})},function(t,n,r){r(10)&&"g"!=/./g.flags&&r(11).f(RegExp.prototype,"flags",{configurable:!0,get:r(115)})},function(t,n,r){"use strict";var e=r(170),i=r(80);t.exports=r(121)("Set",function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},{add:function(t){return e.def(i(this,"Set"),t=0===t?0:t,t)}},e)},function(t,n,r){"use strict";var o,e=r(3),i=r(50)(0),u=r(27),c=r(69),f=r(182),a=r(172),s=r(5),l=r(80),h=r(80),v=!e.ActiveXObject&&"ActiveXObject"in e,p="WeakMap",d=c.getWeak,y=Object.isExtensible,g=a.ufstore,b=function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},x={get:function(t){if(s(t)){var n=d(t);return!0===n?g(l(this,p)).get(t):n?n[this._i]:void 0}},set:function(t,n){return a.def(l(this,p),t,n)}},m=t.exports=r(121)(p,b,x,a,!0,!0);h&&v&&(f((o=a.getConstructor(b,p)).prototype,x),c.NEED=!0,i(["delete","has","get","set"],function(e){var t=m.prototype,i=t[e];u(t,e,function(t,n){if(!s(t)||y(t))return i.call(this,t,n);this._f||(this._f=new o);var r=this._f[e](t,n);return"set"==e?this:r})}))},,,,function(t,n){"use strict";t.exports={init:function(){var t=document.querySelector("#page-nav");t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new&&document.querySelectorAll(".article-entry a:not(.article-more-a)").forEach(function(t){var n=t.getAttribute("target");n&&""!==n||t.setAttribute("target","_blank")}),yiliaConfig&&yiliaConfig.toc_hide_index&&document.querySelectorAll(".toc-number").forEach(function(t){t.style.display="none"})}}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}function i(t,n,r,e,i){var o=function(t){for(var n=t.offsetLeft,r=t.offsetParent;null!==r;)n+=r.offsetLeft,r=r.offsetParent;return n}(t),u=function(t){for(var n=t.offsetTop,r=t.offsetParent;null!==r;)n+=r.offsetTop,r=r.offsetParent;return n}(t)-n;if(u-r<=i){var c=t.$newDom;c||(c=t.cloneNode(!0),(0,a.default)(t,c),(t.$newDom=c).style.position="fixed",c.style.top=(r||u)+"px",c.style.left=o+"px",c.style.zIndex=e||2,c.style.width="100%",c.style.color="#fff"),c.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var f=t.$newDom;f&&(f.style.visibility="hidden")}}function o(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");i(t,document.body.scrollTop,-63,2,0),i(n,document.body.scrollTop,1,3,0)}var f=e(r(163)),a=e((e(r(164)),r(414))),u=e(r(134)),c=e(r(204)),s=r(135);u.default.versions.mobile&&window.screen.width<800&&(function(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,r=0,e=t.length;r<e;r++){var i=t[r];o=n,u=i.getAttribute("href"),c=/\/|index.html/g,o.replace(c,"")===u.replace(c,"")&&(0,f.default)(i,"active")}var o,u,c}(),document.querySelector("#container").addEventListener("scroll",function(t){o()}),window.addEventListener("scroll",function(t){o()}),o()),(0,s.addLoadEvent)(function(){c.default.init()}),t.exports={}},,,function(t,n,r){(function(t){"use strict";function n(t,n,r){t[n]||Object.defineProperty(t,n,{writable:!0,configurable:!0,value:r})}if(r(413),r(209),r(211),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;n(String.prototype,"padLeft","".padStart),n(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&n(Array,t,Function.call.bind([][t]))})}).call(n,function(){return this}())},function(L,t){(function(t){!function(t){"use strict";function o(t,n,r,e){var o,u,c,f,i=n&&n.prototype instanceof h?n:h,a=Object.create(i.prototype),s=new p(e||[]);return a._invoke=(o=t,u=r,c=s,f=_,function(t,n){if(f===E)throw new Error("Generator is already running");if(f===M){if("throw"===t)throw n;return d()}for(c.method=t,c.arg=n;;){var r=c.delegate;if(r){var e=v(r,c);if(e){if(e===P)continue;return e}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if(f===_)throw f=M,c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);f=E;var i=l(o,u,c);if("normal"===i.type){if(f=c.done?M:O,i.arg===P)continue;return{value:i.arg,done:c.done}}"throw"===i.type&&(f=M,c.method="throw",c.arg=i.arg)}}),a}function l(t,n,r){try{return{type:"normal",arg:t.call(n,r)}}catch(t){return{type:"throw",arg:t}}}function h(){}function r(){}function n(){}function e(t){["next","throw","return"].forEach(function(n){t[n]=function(t){return this._invoke(n,t)}})}function u(c){function f(t,n,r,e){var i=l(c[t],c,n);if("throw"!==i.type){var o=i.arg,u=o.value;return u&&"object"==typeof u&&y.call(u,"__await")?Promise.resolve(u.__await).then(function(t){f("next",t,r,e)},function(t){f("throw",t,r,e)}):Promise.resolve(u).then(function(t){o.value=t,r(o)},e)}e(i.arg)}var n;"object"==typeof t.process&&t.process.domain&&(f=t.process.domain.bind(f)),this._invoke=function(r,e){function t(){return new Promise(function(t,n){f(r,e,t,n)})}return n=n?n.then(t,t):t()}}function v(t,n){var r=t.iterator[n.method];if(r===a){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=a,v(t,n),"throw"===n.method))return P;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return P}var e=l(r,t.iterator,n.arg);if("throw"===e.type)return n.method="throw",n.arg=e.arg,n.delegate=null,P;var i=e.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=a),n.delegate=null,P):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,P)}function i(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function c(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(i,this),this.reset(!0)}function f(n){if(n){var t=n[b];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var r=-1,e=function t(){for(;++r<n.length;)if(y.call(n,r))return t.value=n[r],t.done=!1,t;return t.value=a,t.done=!0,t};return e.next=e}}return{next:d}}function d(){return{value:a,done:!0}}var a,s=Object.prototype,y=s.hasOwnProperty,g="function"==typeof Symbol?Symbol:{},b=g.iterator||"@@iterator",x=g.asyncIterator||"@@asyncIterator",m=g.toStringTag||"@@toStringTag",S="object"==typeof L,w=t.regeneratorRuntime;if(w)S&&(L.exports=w);else{(w=t.regeneratorRuntime=S?L.exports:{}).wrap=o;var _="suspendedStart",O="suspendedYield",E="executing",M="completed",P={},j={};j[b]=function(){return this};var F=Object.getPrototypeOf,A=F&&F(F(f([])));A&&A!==s&&y.call(A,b)&&(j=A);var I=n.prototype=h.prototype=Object.create(j);r.prototype=I.constructor=n,n.constructor=r,n[m]=r.displayName="GeneratorFunction",w.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===r||"GeneratorFunction"===(n.displayName||n.name))},w.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,n):(t.__proto__=n,m in t||(t[m]="GeneratorFunction")),t.prototype=Object.create(I),t},w.awrap=function(t){return{__await:t}},e(u.prototype),u.prototype[x]=function(){return this},w.AsyncIterator=u,w.async=function(t,n,r,e){var i=new u(o(t,n,r,e));return w.isGeneratorFunction(n)?i:i.next().then(function(t){return t.done?t.value:i.next()})},e(I),I[m]="Generator",I[b]=function(){return this},I.toString=function(){return"[object Generator]"},w.keys=function(r){var e=[];for(var t in r)e.push(t);return e.reverse(),function t(){for(;e.length;){var n=e.pop();if(n in r)return t.value=n,t.done=!1,t}return t.done=!0,t}},w.values=f,p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=a,this.done=!1,this.delegate=null,this.method="next",this.arg=a,this.tryEntries.forEach(c),!t)for(var n in this)"t"===n.charAt(0)&&y.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=a)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(r){function t(t,n){return o.type="throw",o.arg=r,e.next=t,n&&(e.method="next",e.arg=a),!!n}if(this.done)throw r;for(var e=this,n=this.tryEntries.length-1;0<=n;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var u=y.call(i,"catchLoc"),c=y.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;0<=r;--r){var e=this.tryEntries[r];if(e.tryLoc<=this.prev&&y.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var i=e;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=n,i?(this.method="next",this.next=i.finallyLoc,P):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),P},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),c(r),P}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var e=r.completion;if("throw"===e.type){var i=e.arg;c(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:f(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=a),P}}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:this)}).call(t,function(){return this}())},,function(t,n,r){r(221),t.exports=r(46).RegExp.escape},,,,function(t,n,r){var e=r(5),i=r(123),o=r(7)("species");t.exports=function(t){var n;return i(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!i(n.prototype)||(n=void 0),e(n)&&(null===(n=n[o])&&(n=void 0))),void 0===n?Array:n}},function(t,n,r){"use strict";var e=r(4),i=Date.prototype.getTime,o=Date.prototype.toISOString,u=function(t){return 9<t?t:"0"+t};t.exports=e(function(){return"0385-07-25T07:06:39.999Z"!=o.call(new Date(-5e13-1))})||!e(function(){o.call(new Date(NaN))})?function(){if(!isFinite(i.call(this)))throw RangeError("Invalid time value");var t=this,n=t.getUTCFullYear(),r=t.getUTCMilliseconds(),e=n<0?"-":9999<n?"+":"";return e+("00000"+Math.abs(n)).slice(e?-6:-4)+"-"+u(t.getUTCMonth()+1)+"-"+u(t.getUTCDate())+"T"+u(t.getUTCHours())+":"+u(t.getUTCMinutes())+":"+u(t.getUTCSeconds())+"."+(99<r?r:"0"+u(r))+"Z"}:o},function(t,n,r){"use strict";var e=r(2),i=r(53);t.exports=function(t){if("string"!==t&&"number"!==t&&"default"!==t)throw TypeError("Incorrect hint");return i(e(this),"number"!=t)}},function(t,n,r){var c=r(74),f=r(127),a=r(117);t.exports=function(t){var n=c(t),r=f.f;if(r)for(var e,i=r(t),o=a.f,u=0;i.length>u;)o.call(t,e=i[u++])&&n.push(e);return n}},function(t,n,r){t.exports=r(118)("native-function-to-string",Function.toString)},function(t,n){t.exports=function(n,r){var e=r===Object(r)?function(t){return r[t]}:r;return function(t){return String(t).replace(n,e)}}},function(t,n,r){var e=r(1),i=r(220)(/[\\^$*+?.()|[\]{}]/g,"\\$&");e(e.S,"RegExp",{escape:function(t){return i(t)}})},function(t,n,r){var e=r(1);e(e.P,"Array",{copyWithin:r(166)}),r(67)("copyWithin")},function(t,n,r){"use strict";var e=r(1),i=r(50)(4);e(e.P+e.F*!r(48)([].every,!0),"Array",{every:function(t){return i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.P,"Array",{fill:r(137)}),r(67)("fill")},function(t,n,r){"use strict";var e=r(1),i=r(50)(2);e(e.P+e.F*!r(48)([].filter,!0),"Array",{filter:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(50)(6),o="findIndex",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{findIndex:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0)}}),r(67)(o)},function(t,n,r){"use strict";var e=r(1),i=r(50)(5),o="find",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{find:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0)}}),r(67)(o)},function(t,n,r){"use strict";var e=r(1),i=r(50)(0),o=r(48)([].forEach,!0);e(e.P+e.F*!o,"Array",{forEach:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var h=r(47),e=r(1),v=r(17),p=r(177),d=r(145),y=r(8),g=r(139),b=r(161);e(e.S+e.F*!r(125)(function(t){Array.from(t)}),"Array",{from:function(t){var n,r,e,i,o=v(t),u="function"==typeof this?this:Array,c=arguments.length,f=1<c?arguments[1]:void 0,a=void 0!==f,s=0,l=b(o);if(a&&(f=h(f,2<c?arguments[2]:void 0,2)),null==l||u==Array&&d(l))for(r=new u(n=y(o.length));s<n;s++)g(r,s,a?f(o[s],s):o[s]);else for(i=l.call(o),r=new u;!(e=i.next()).done;s++)g(r,s,a?p(i,f,[e.value,s],!0):e.value);return r.length=s,r}})},function(t,n,r){"use strict";var e=r(1),i=r(120)(!1),o=[].indexOf,u=!!o&&1/[1].indexOf(1,-0)<0;e(e.P+e.F*(u||!r(48)(o)),"Array",{indexOf:function(t){return u?o.apply(this,arguments)||0:i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.S,"Array",{isArray:r(123)})},function(t,n,r){"use strict";var e=r(1),i=r(33),o=[].join;e(e.P+e.F*(r(116)!=Object||!r(48)(o)),"Array",{join:function(t){return o.call(i(this),void 0===t?",":t)}})},function(t,n,r){"use strict";var e=r(1),i=r(33),o=r(49),u=r(8),c=[].lastIndexOf,f=!!c&&1/[1].lastIndexOf(1,-0)<0;e(e.P+e.F*(f||!r(48)(c)),"Array",{lastIndexOf:function(t){if(f)return c.apply(this,arguments)||0;var n=i(this),r=u(n.length),e=r-1;for(1<arguments.length&&(e=Math.min(e,o(arguments[1]))),e<0&&(e=r+e);0<=e;e--)if(e in n&&n[e]===t)return e||0;return-1}})},function(t,n,r){"use strict";var e=r(1),i=r(50)(1);e(e.P+e.F*!r(48)([].map,!0),"Array",{map:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(139);e(e.S+e.F*r(4)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,n=arguments.length,r=new("function"==typeof this?this:Array)(n);t<n;)i(r,t,arguments[t++]);return r.length=n,r}})},function(t,n,r){"use strict";var e=r(1),i=r(168);e(e.P+e.F*!r(48)([].reduceRight,!0),"Array",{reduceRight:function(t){return i(this,t,arguments.length,arguments[1],!0)}})},function(t,n,r){"use strict";var e=r(1),i=r(168);e(e.P+e.F*!r(48)([].reduce,!0),"Array",{reduce:function(t){return i(this,t,arguments.length,arguments[1],!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(143),a=r(45),s=r(78),l=r(8),h=[].slice;e(e.P+e.F*r(4)(function(){i&&h.call(i)}),"Array",{slice:function(t,n){var r=l(this.length),e=a(this);if(n=void 0===n?r:n,"Array"==e)return h.call(this,t,n);for(var i=s(t,r),o=s(n,r),u=l(o-i),c=new Array(u),f=0;f<u;f++)c[f]="String"==e?this.charAt(i+f):this[i+f];return c}})},function(t,n,r){"use strict";var e=r(1),i=r(50)(3);e(e.P+e.F*!r(48)([].some,!0),"Array",{some:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(21),o=r(17),u=r(4),c=[].sort,f=[1,2,3];e(e.P+e.F*(u(function(){f.sort(void 0)})||!u(function(){f.sort(null)})||!r(48)(c)),"Array",{sort:function(t){return void 0===t?c.call(o(this)):c.call(o(this),i(t))}})},function(t,n,r){r(77)("Array")},function(t,n,r){var e=r(1);e(e.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,n,r){var e=r(1),i=r(216);e(e.P+e.F*(Date.prototype.toISOString!==i),"Date",{toISOString:i})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(53);e(e.P+e.F*r(4)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var n=i(this),r=o(n);return"number"!=typeof r||isFinite(r)?n.toISOString():null}})},function(t,n,r){var e=r(7)("toPrimitive"),i=Date.prototype;e in i||r(26)(i,e,r(217))},function(t,n,r){var e=Date.prototype,i="Invalid Date",o="toString",u=e[o],c=e.getTime;new Date(NaN)+""!=i&&r(27)(e,o,function(){var t=c.call(this);return t==t?u.call(this):i})},function(t,n,r){var e=r(1);e(e.P,"Function",{bind:r(169)})},function(t,n,r){"use strict";var e=r(5),i=r(32),o=r(7)("hasInstance"),u=Function.prototype;o in u||r(11).f(u,o,{value:function(t){if("function"!=typeof this||!e(t))return!1;if(!e(this.prototype))return t instanceof this;for(;t=i(t);)if(this.prototype===t)return!0;return!1}})},function(t,n,r){var e=r(11).f,i=Function.prototype,o=/^\s*function ([^ (]*)/;"name"in i||r(10)&&e(i,"name",{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(t){return""}}})},function(t,n,r){var e=r(1),i=r(180),o=Math.sqrt,u=Math.acosh;e(e.S+e.F*!(u&&710==Math.floor(u(Number.MAX_VALUE))&&u(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:94906265.62425156<t?Math.log(t)+Math.LN2:i(t-1+o(t-1)*o(t+1))}})},function(t,n,r){var e=r(1),i=Math.asinh;e(e.S+e.F*!(i&&0<1/i(0)),"Math",{asinh:function t(n){return isFinite(n=+n)&&0!=n?n<0?-t(-n):Math.log(n+Math.sqrt(n*n+1)):n}})},function(t,n,r){var e=r(1),i=Math.atanh;e(e.S+e.F*!(i&&1/i(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,n,r){var e=r(1),i=r(149);e(e.S,"Math",{cbrt:function(t){return i(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,n,r){var e=r(1),i=Math.exp;e(e.S,"Math",{cosh:function(t){return(i(t=+t)+i(-t))/2}})},function(t,n,r){var e=r(1),i=r(148);e(e.S+e.F*(i!=Math.expm1),"Math",{expm1:i})},function(t,n,r){var e=r(1);e(e.S,"Math",{fround:r(179)})},function(t,n,r){var e=r(1),f=Math.abs;e(e.S,"Math",{hypot:function(t,n){for(var r,e,i=0,o=0,u=arguments.length,c=0;o<u;)c<(r=f(arguments[o++]))?(i=i*(e=c/r)*e+1,c=r):0<r?i+=(e=r/c)*e:i+=r;return c===1/0?1/0:c*Math.sqrt(i)}})},function(t,n,r){var e=r(1),i=Math.imul;e(e.S+e.F*r(4)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(t,n){var r=65535,e=+t,i=+n,o=r&e,u=r&i;return 0|o*u+((r&e>>>16)*u+o*(r&i>>>16)<<16>>>0)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log10:function(t){return Math.log(t)*Math.LOG10E}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log1p:r(180)})},function(t,n,r){var e=r(1);e(e.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,n,r){var e=r(1);e(e.S,"Math",{sign:r(149)})},function(t,n,r){var e=r(1),i=r(148),o=Math.exp;e(e.S+e.F*r(4)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(i(t)-i(-t))/2:(o(t-1)-o(-t-1))*(Math.E/2)}})},function(t,n,r){var e=r(1),i=r(148),o=Math.exp;e(e.S,"Math",{tanh:function(t){var n=i(t=+t),r=i(-t);return n==1/0?1:r==1/0?-1:(n-r)/(o(t)+o(-t))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{trunc:function(t){return(0<t?Math.floor:Math.ceil)(t)}})},function(t,n,r){"use strict";var e=r(3),i=r(30),o=r(45),u=r(144),s=r(53),c=r(4),f=r(73).f,a=r(31).f,l=r(11).f,h=r(84).trim,v="Number",p=e[v],d=p,y=p.prototype,g=o(r(72)(y))==v,b="trim"in String.prototype,x=function(t){var n=s(t,!1);if("string"==typeof n&&2<n.length){var r,e,i,o=(n=b?n.trim():h(n,3)).charCodeAt(0);if(43===o||45===o){if(88===(r=n.charCodeAt(2))||120===r)return NaN}else if(48===o){switch(n.charCodeAt(1)){case 66:case 98:e=2,i=49;break;case 79:case 111:e=8,i=55;break;default:return+n}for(var u,c=n.slice(2),f=0,a=c.length;f<a;f++)if((u=c.charCodeAt(f))<48||i<u)return NaN;return parseInt(c,e)}}return+n};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(t){var n=arguments.length<1?0:t,r=this;return r instanceof p&&(g?c(function(){y.valueOf.call(r)}):o(r)!=v)?u(new d(x(n)),r,p):x(n)};for(var m,S=r(10)?f(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),w=0;S.length>w;w++)i(d,m=S[w])&&!i(p,m)&&l(p,m,a(d,m));(p.prototype=y).constructor=p,r(27)(e,v,p)}},function(t,n,r){var e=r(1);e(e.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,n,r){var e=r(1),i=r(3).isFinite;e(e.S,"Number",{isFinite:function(t){return"number"==typeof t&&i(t)}})},function(t,n,r){var e=r(1);e(e.S,"Number",{isInteger:r(176)})},function(t,n,r){var e=r(1);e(e.S,"Number",{isNaN:function(t){return t!=t}})},function(t,n,r){var e=r(1),i=r(176),o=Math.abs;e(e.S,"Number",{isSafeInteger:function(t){return i(t)&&o(t)<=9007199254740991}})},function(t,n,r){var e=r(1);e(e.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,n,r){var e=r(1);e(e.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,n,r){var e=r(1),i=r(188);e(e.S+e.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(t,n,r){var e=r(1),i=r(189);e(e.S+e.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(t,n,r){"use strict";var e=r(1),a=r(49),s=r(165),l=r(156),i=1..toFixed,o=Math.floor,u=[0,0,0,0,0,0],h="Number.toFixed: incorrect invocation!",v=function(t,n){for(var r=-1,e=n;++r<6;)e+=t*u[r],u[r]=e%1e7,e=o(e/1e7)},p=function(t){for(var n=6,r=0;0<=--n;)r+=u[n],u[n]=o(r/t),r=r%t*1e7},d=function(){for(var t=6,n="";0<=--t;)if(""!==n||0===t||0!==u[t]){var r=String(u[t]);n=""===n?r:n+l.call("0",7-r.length)+r}return n},y=function(t,n,r){return 0===n?r:n%2==1?y(t,n-1,r*t):y(t*t,n/2,r)};e(e.P+e.F*(!!i&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!r(4)(function(){i.call({})})),"Number",{toFixed:function(t){var n,r,e,i,o=s(this,h),u=a(t),c="",f="0";if(u<0||20<u)throw RangeError(h);if(o!=o)return"NaN";if(o<=-1e21||1e21<=o)return String(o);if(o<0&&(c="-",o=-o),1e-21<o)if(r=(n=function(t){for(var n=0,r=t;4096<=r;)n+=12,r/=4096;for(;2<=r;)n+=1,r/=2;return n}(o*y(2,69,1))-69)<0?o*y(2,-n,1):o/y(2,n,1),r*=4503599627370496,0<(n=52-n)){for(v(0,r),e=u;7<=e;)v(1e7,0),e-=7;for(v(y(10,e,1),0),e=n-1;23<=e;)p(1<<23),e-=23;p(1<<e),v(1,1),p(2),f=d()}else v(0,r),v(1<<-n,0),f=d()+l.call("0",u);return f=0<u?c+((i=f.length)<=u?"0."+l.call("0",u-i)+f:f.slice(0,i-u)+"."+f.slice(i-u)):c+f}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=r(165),u=1..toPrecision;e(e.P+e.F*(i(function(){return"1"!==u.call(1,void 0)})||!i(function(){u.call({})})),"Number",{toPrecision:function(t){var n=o(this,"Number#toPrecision: incorrect invocation!");return void 0===t?u.call(n):u.call(n,t)}})},function(t,n,r){var e=r(1);e(e.S+e.F,"Object",{assign:r(182)})},function(t,n,r){var e=r(1);e(e.S,"Object",{create:r(72)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperties:r(183)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperty:r(11).f})},function(t,n,r){var e=r(5),i=r(69).onFreeze;r(52)("freeze",function(n){return function(t){return n&&e(t)?n(i(t)):t}})},function(t,n,r){var e=r(33),i=r(31).f;r(52)("getOwnPropertyDescriptor",function(){return function(t,n){return i(e(t),n)}})},function(t,n,r){r(52)("getOwnPropertyNames",function(){return r(184).f})},function(t,n,r){var e=r(17),i=r(32);r(52)("getPrototypeOf",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(5);r(52)("isExtensible",function(n){return function(t){return!!e(t)&&(!n||n(t))}})},function(t,n,r){var e=r(5);r(52)("isFrozen",function(n){return function(t){return!e(t)||!!n&&n(t)}})},function(t,n,r){var e=r(5);r(52)("isSealed",function(n){return function(t){return!e(t)||!!n&&n(t)}})},function(t,n,r){var e=r(1);e(e.S,"Object",{is:r(192)})},function(t,n,r){var e=r(17),i=r(74);r(52)("keys",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(5),i=r(69).onFreeze;r(52)("preventExtensions",function(n){return function(t){return n&&e(t)?n(i(t)):t}})},function(t,n,r){var e=r(5),i=r(69).onFreeze;r(52)("seal",function(n){return function(t){return n&&e(t)?n(i(t)):t}})},function(t,n,r){var e=r(1);e(e.S,"Object",{setPrototypeOf:r(153).set})},function(t,n,r){"use strict";var e=r(81),i={};i[r(7)("toStringTag")]="z",i+""!="[object z]"&&r(27)(Object.prototype,"toString",function(){return"[object "+e(this)+"]"},!0)},function(t,n,r){var e=r(1),i=r(188);e(e.G+e.F*(parseFloat!=i),{parseFloat:i})},function(t,n,r){var e=r(1),i=r(189);e(e.G+e.F*(parseInt!=i),{parseInt:i})},function(t,n,r){"use strict";var e,i,o,u,c=r(68),f=r(3),a=r(47),s=r(81),l=r(1),h=r(5),v=r(21),p=r(70),d=r(71),y=r(119),g=r(158).set,b=r(150)(),x=r(151),m=r(190),S=r(133),w=r(191),_="Promise",O=f.TypeError,E=f.process,M=E&&E.versions,P=M&&M.v8||"",j=f[_],F="process"==s(E),A=function(){},I=i=x.f,L=!!function(){try{var t=j.resolve(1),n=(t.constructor={})[r(7)("species")]=function(t){t(A,A)};return(F||"function"==typeof PromiseRejectionEvent)&&t.then(A)instanceof n&&0!==P.indexOf("6.6")&&-1===S.indexOf("Chrome/66")}catch(t){}}(),N=function(t){var n;return!(!h(t)||"function"!=typeof(n=t.then))&&n},T=function(s,r){if(!s._n){s._n=!0;var e=s._c;b(function(){for(var f=s._v,a=1==s._s,t=0,n=function(t){var n,r,e,i=a?t.ok:t.fail,o=t.resolve,u=t.reject,c=t.domain;try{i?(a||(2==s._h&&C(s),s._h=1),!0===i?n=f:(c&&c.enter(),n=i(f),c&&(c.exit(),e=!0)),n===t.promise?u(O("Promise-chain cycle")):(r=N(n))?r.call(n,o,u):o(n)):u(f)}catch(t){c&&!e&&c.exit(),u(t)}};e.length>t;)n(e[t++]);s._c=[],s._n=!1,r&&!s._h&&k(s)})}},k=function(o){g.call(f,function(){var t,n,r,e=o._v,i=R(o);if(i&&(t=m(function(){F?E.emit("unhandledRejection",e,o):(n=f.onunhandledrejection)?n({promise:o,reason:e}):(r=f.console)&&r.error&&r.error("Unhandled promise rejection",e)}),o._h=F||R(o)?2:1),o._a=void 0,i&&t.e)throw t.v})},R=function(t){return 1!==t._h&&0===(t._a||t._c).length},C=function(n){g.call(f,function(){var t;F?E.emit("rejectionHandled",n):(t=f.onrejectionhandled)&&t({promise:n,reason:n._v})})},D=function(t){var n=this;n._d||(n._d=!0,(n=n._w||n)._v=t,n._s=2,n._a||(n._a=n._c.slice()),T(n,!0))},G=function(t){var r,e=this;if(!e._d){e._d=!0,e=e._w||e;try{if(e===t)throw O("Promise can't be resolved itself");(r=N(t))?b(function(){var n={_w:e,_d:!1};try{r.call(t,a(G,n,1),a(D,n,1))}catch(t){D.call(n,t)}}):(e._v=t,e._s=1,T(e,!1))}catch(t){D.call({_w:e,_d:!1},t)}}};L||(j=function(t){p(this,j,_,"_h"),v(t),e.call(this);try{t(a(G,this,1),a(D,this,1))}catch(t){D.call(this,t)}},(e=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(76)(j.prototype,{then:function(t,n){var r=I(y(this,j));return r.ok="function"!=typeof t||t,r.fail="function"==typeof n&&n,r.domain=F?E.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&T(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),o=function(){var t=new e;this.promise=t,this.resolve=a(G,t,1),this.reject=a(D,t,1)},x.f=I=function(t){return t===j||t===u?new o(t):i(t)}),l(l.G+l.W+l.F*!L,{Promise:j}),r(83)(j,_),r(77)(_),u=r(46)[_],l(l.S+l.F*!L,_,{reject:function(t){var n=I(this);return(0,n.reject)(t),n.promise}}),l(l.S+l.F*(c||!L),_,{resolve:function(t){return w(c&&this===u?j:this,t)}}),l(l.S+l.F*!(L&&r(125)(function(t){j.all(t).catch(A)})),_,{all:function(t){var u=this,n=I(u),c=n.resolve,f=n.reject,r=m(function(){var e=[],i=0,o=1;d(t,!1,function(t){var n=i++,r=!1;e.push(void 0),o++,u.resolve(t).then(function(t){r||(r=!0,e[n]=t,--o||c(e))},f)}),--o||c(e)});return r.e&&f(r.v),n.promise},race:function(t){var n=this,r=I(n),e=r.reject,i=m(function(){d(t,!1,function(t){n.resolve(t).then(r.resolve,e)})});return i.e&&e(i.v),r.promise}})},function(t,n,r){var e=r(1),o=r(21),u=r(2),c=(r(3).Reflect||{}).apply,f=Function.apply;e(e.S+e.F*!r(4)(function(){c(function(){})}),"Reflect",{apply:function(t,n,r){var e=o(t),i=u(r);return c?c(e,n,i):f.call(e,n,i)}})},function(t,n,r){var e=r(1),c=r(72),f=r(21),a=r(2),s=r(5),i=r(4),l=r(169),h=(r(3).Reflect||{}).construct,v=i(function(){function t(){}return!(h(function(){},[],t)instanceof t)}),p=!i(function(){h(function(){})});e(e.S+e.F*(v||p),"Reflect",{construct:function(t,n){f(t),a(n);var r=arguments.length<3?t:f(arguments[2]);if(p&&!v)return h(t,n,r);if(t==r){switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3])}var e=[null];return e.push.apply(e,n),new(l.apply(t,e))}var i=r.prototype,o=c(s(i)?i:Object.prototype),u=Function.apply.call(t,o,n);return s(u)?u:o}})},function(t,n,r){var e=r(11),i=r(1),o=r(2),u=r(53);i(i.S+i.F*r(4)(function(){Reflect.defineProperty(e.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,n,r){o(t),n=u(n,!0),o(r);try{return e.f(t,n,r),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(31).f,o=r(2);e(e.S,"Reflect",{deleteProperty:function(t,n){var r=i(o(t),n);return!(r&&!r.configurable)&&delete t[n]}})},function(t,n,r){"use strict";var e=r(1),i=r(2),o=function(t){this._t=i(t),this._i=0;var n,r=this._k=[];for(n in t)r.push(n)};r(146)(o,"Object",function(){var t,n=this._k;do{if(this._i>=n.length)return{value:void 0,done:!0}}while(!((t=n[this._i++])in this._t));return{value:t,done:!1}}),e(e.S,"Reflect",{enumerate:function(t){return new o(t)}})},function(t,n,r){var e=r(31),i=r(1),o=r(2);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(t,n){return e.f(o(t),n)}})},function(t,n,r){var e=r(1),i=r(32),o=r(2);e(e.S,"Reflect",{getPrototypeOf:function(t){return i(o(t))}})},function(t,n,r){var u=r(31),c=r(32),f=r(30),e=r(1),a=r(5),s=r(2);e(e.S,"Reflect",{get:function t(n,r){var e,i,o=arguments.length<3?n:arguments[2];return s(n)===o?n[r]:(e=u.f(n,r))?f(e,"value")?e.value:void 0!==e.get?e.get.call(o):void 0:a(i=c(n))?t(i,r,o):void 0}})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{has:function(t,n){return n in t}})},function(t,n,r){var e=r(1),i=r(2),o=Object.isExtensible;e(e.S,"Reflect",{isExtensible:function(t){return i(t),!o||o(t)}})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{ownKeys:r(187)})},function(t,n,r){var e=r(1),i=r(2),o=Object.preventExtensions;e(e.S,"Reflect",{preventExtensions:function(t){i(t);try{return o&&o(t),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(153);i&&e(e.S,"Reflect",{setPrototypeOf:function(t,n){i.check(t,n);try{return i.set(t,n),!0}catch(t){return!1}}})},function(t,n,r){var f=r(11),a=r(31),s=r(32),l=r(30),e=r(1),h=r(75),v=r(2),p=r(5);e(e.S,"Reflect",{set:function t(n,r,e){var i,o,u=arguments.length<4?n:arguments[3],c=a.f(v(n),r);if(!c){if(p(o=s(n)))return t(o,r,e,u);c=h(0)}if(l(c,"value")){if(!1===c.writable||!p(u))return!1;if(i=a.f(u,r)){if(i.get||i.set||!1===i.writable)return!1;i.value=e,f.f(u,r,i)}else f.f(u,r,h(0,e));return!0}return void 0!==c.set&&(c.set.call(u,e),!0)}})},function(t,n,r){var e=r(3),o=r(144),i=r(11).f,u=r(73).f,c=r(124),f=r(115),a=e.RegExp,s=a,l=a.prototype,h=/a/g,v=/a/g,p=new a(h)!==h;if(r(10)&&(!p||r(4)(function(){return v[r(7)("match")]=!1,a(h)!=h||a(v)==v||"/a/i"!=a(h,"i")}))){a=function(t,n){var r=this instanceof a,e=c(t),i=void 0===n;return!r&&e&&t.constructor===a&&i?t:o(p?new s(e&&!i?t.source:t,n):s((e=t instanceof a)?t.source:t,e&&i?f.call(t):n),r?this:l,a)};for(var d=function(n){n in a||i(a,n,{configurable:!0,get:function(){return s[n]},set:function(t){s[n]=t}})},y=u(s),g=0;y.length>g;)d(y[g++]);(l.constructor=a).prototype=l,r(27)(e,"RegExp",a)}r(77)("RegExp")},function(t,n,r){"use strict";var l=r(2),h=r(8),v=r(136),p=r(128);r(122)("match",1,function(e,i,a,s){return[function(t){var n=e(this),r=null==t?void 0:t[i];return void 0!==r?r.call(t,n):new RegExp(t)[i](String(n))},function(t){var n=s(a,t,this);if(n.done)return n.value;var r=l(t),e=String(this);if(!r.global)return p(r,e);for(var i,o=r.unicode,u=[],c=r.lastIndex=0;null!==(i=p(r,e));){var f=String(i[0]);""===(u[c]=f)&&(r.lastIndex=v(e,h(r.lastIndex),o)),c++}return 0===c?null:u}]})},function(t,n,r){"use strict";var O=r(2),e=r(17),E=r(8),M=r(49),P=r(136),j=r(128),F=Math.max,A=Math.min,h=Math.floor,v=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g;r(122)("replace",2,function(i,o,S,w){function _(o,u,c,f,a,t){var s=c+o.length,l=f.length,n=p;return void 0!==a&&(a=e(a),n=v),S.call(t,n,function(t,n){var r;switch(n.charAt(0)){case"$":return"$";case"&":return o;case"`":return u.slice(0,c);case"'":return u.slice(s);case"<":r=a[n.slice(1,-1)];break;default:var e=+n;if(0===e)return t;if(l<e){var i=h(e/10);return 0===i?t:i<=l?void 0===f[i-1]?n.charAt(1):f[i-1]+n.charAt(1):t}r=f[e-1]}return void 0===r?"":r})}return[function(t,n){var r=i(this),e=null==t?void 0:t[o];return void 0!==e?e.call(t,r,n):S.call(String(r),t,n)},function(t,n){var r=w(S,t,this,n);if(r.done)return r.value;var e=O(t),i=String(this),o="function"==typeof n;o||(n=String(n));var u,c=e.global;if(c){var f=e.unicode;e.lastIndex=0}for(var a=[];;){var s=j(e,i);if(null===s)break;if(a.push(s),!c)break;""===String(s[0])&&(e.lastIndex=P(i,E(e.lastIndex),f))}for(var l="",h=0,v=0;v<a.length;v++){s=a[v];for(var p=String(s[0]),d=F(A(M(s.index),i.length),0),y=[],g=1;g<s.length;g++)y.push(void 0===(u=s[g])?u:String(u));var b=s.groups;if(o){var x=[p].concat(y,d,i);void 0!==b&&x.push(b);var m=String(n.apply(void 0,x))}else m=_(p,i,d,y,b,n);h<=d&&(l+=i.slice(h,d)+m,h=d+p.length)}return l+i.slice(h)}]})},function(t,n,r){"use strict";var f=r(2),a=r(192),s=r(128);r(122)("search",1,function(e,i,u,c){return[function(t){var n=e(this),r=null==t?void 0:t[i];return void 0!==r?r.call(t,n):new RegExp(t)[i](String(n))},function(t){var n=c(u,t,this);if(n.done)return n.value;var r=f(t),e=String(this),i=r.lastIndex;a(i,0)||(r.lastIndex=0);var o=s(r,e);return a(r.lastIndex,i)||(r.lastIndex=i),null===o?-1:o.index}]})},function(t,n,r){"use strict";var l=r(124),x=r(2),m=r(119),S=r(136),w=r(8),_=r(128),h=r(152),e=r(4),O=Math.min,v=[].push,u="split",p="length",d="lastIndex",E=4294967295,M=!e(function(){RegExp(E,"y")});r(122)("split",2,function(i,o,y,g){var b;return b="c"=="abbc"[u](/(b)*/)[1]||4!="test"[u](/(?:)/,-1)[p]||2!="ab"[u](/(?:ab)*/)[p]||4!="."[u](/(.?)(.?)/)[p]||1<"."[u](/()()/)[p]||""[u](/.?/)[p]?function(t,n){var r=String(this);if(void 0===t&&0===n)return[];if(!l(t))return y.call(r,t,n);for(var e,i,o,u=[],c=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),f=0,a=void 0===n?E:n>>>0,s=new RegExp(t.source,c+"g");(e=h.call(s,r))&&!(f<(i=s[d])&&(u.push(r.slice(f,e.index)),1<e[p]&&e.index<r[p]&&v.apply(u,e.slice(1)),o=e[0][p],f=i,u[p]>=a));)s[d]===e.index&&s[d]++;return f===r[p]?!o&&s.test("")||u.push(""):u.push(r.slice(f)),u[p]>a?u.slice(0,a):u}:"0"[u](void 0,0)[p]?function(t,n){return void 0===t&&0===n?[]:y.call(this,t,n)}:y,[function(t,n){var r=i(this),e=null==t?void 0:t[o];return void 0!==e?e.call(t,r,n):b.call(String(r),t,n)},function(t,n){var r=g(b,t,this,n,b!==y);if(r.done)return r.value;var e=x(t),i=String(this),o=m(e,RegExp),u=e.unicode,c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(M?"y":"g"),f=new o(M?e:"^(?:"+e.source+")",c),a=void 0===n?E:n>>>0;if(0===a)return[];if(0===i.length)return null===_(f,i)?[i]:[];for(var s=0,l=0,h=[];l<i.length;){f.lastIndex=M?l:0;var v,p=_(f,M?i:i.slice(l));if(null===p||(v=O(w(f.lastIndex+(M?0:l)),i.length))===s)l=S(i,l,u);else{if(h.push(i.slice(s,l)),h.length===a)return h;for(var d=1;d<=p.length-1;d++)if(h.push(p[d]),h.length===a)return h;l=s=v}}return h.push(i.slice(s)),h}]})},function(t,n,r){"use strict";r(198);var e=r(2),i=r(115),o=r(10),u="toString",c=/./[u],f=function(t){r(27)(RegExp.prototype,u,t,!0)};r(4)(function(){return"/a/b"!=c.call({source:"a",flags:"b"})})?f(function(){var t=e(this);return"/".concat(t.source,"/","flags"in t?t.flags:!o&&t instanceof RegExp?i.call(t):void 0)}):c.name!=u&&f(function(){return c.call(this)})},function(t,n,r){"use strict";r(28)("anchor",function(n){return function(t){return n(this,"a","name",t)}})},function(t,n,r){"use strict";r(28)("big",function(t){return function(){return t(this,"big","","")}})},function(t,n,r){"use strict";r(28)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,n,r){"use strict";r(28)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(131)(!1);e(e.P,"String",{codePointAt:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),u=r(8),c=r(155),f="endsWith",a=""[f];e(e.P+e.F*r(142)(f),"String",{endsWith:function(t){var n=c(this,t,f),r=1<arguments.length?arguments[1]:void 0,e=u(n.length),i=void 0===r?e:Math.min(u(r),e),o=String(t);return a?a.call(n,o,i):n.slice(i-o.length,i)===o}})},function(t,n,r){"use strict";r(28)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,n,r){"use strict";r(28)("fontcolor",function(n){return function(t){return n(this,"font","color",t)}})},function(t,n,r){"use strict";r(28)("fontsize",function(n){return function(t){return n(this,"font","size",t)}})},function(t,n,r){var e=r(1),o=r(78),u=String.fromCharCode,i=String.fromCodePoint;e(e.S+e.F*(!!i&&1!=i.length),"String",{fromCodePoint:function(t){for(var n,r=[],e=arguments.length,i=0;i<e;){if(n=+arguments[i++],o(n,1114111)!==n)throw RangeError(n+" is not a valid code point");r.push(n<65536?u(n):u(55296+((n-=65536)>>10),n%1024+56320))}return r.join("")}})},function(t,n,r){"use strict";var e=r(1),i=r(155);e(e.P+e.F*r(142)("includes"),"String",{includes:function(t){return!!~i(this,t,"includes").indexOf(t,1<arguments.length?arguments[1]:void 0)}})},function(t,n,r){"use strict";r(28)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,n,r){"use strict";var e=r(131)(!0);r(147)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";r(28)("link",function(n){return function(t){return n(this,"a","href",t)}})},function(t,n,r){var e=r(1),u=r(33),c=r(8);e(e.S,"String",{raw:function(t){for(var n=u(t.raw),r=c(n.length),e=arguments.length,i=[],o=0;o<r;)i.push(String(n[o++])),o<e&&i.push(String(arguments[o]));return i.join("")}})},function(t,n,r){var e=r(1);e(e.P,"String",{repeat:r(156)})},function(t,n,r){"use strict";r(28)("small",function(t){return function(){return t(this,"small","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(8),o=r(155),u="startsWith",c=""[u];e(e.P+e.F*r(142)(u),"String",{startsWith:function(t){var n=o(this,t,u),r=i(Math.min(1<arguments.length?arguments[1]:void 0,n.length)),e=String(t);return c?c.call(n,e,r):n.slice(r,r+e.length)===e}})},function(t,n,r){"use strict";r(28)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,n,r){"use strict";r(28)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,n,r){"use strict";r(28)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,n,r){"use strict";r(84)("trim",function(t){return function(){return t(this,3)}})},function(t,n,r){"use strict";var e=r(3),u=r(30),i=r(10),o=r(1),c=r(27),f=r(69).KEY,a=r(4),s=r(118),l=r(83),h=r(79),v=r(7),p=r(195),d=r(160),y=r(218),g=r(123),b=r(2),x=r(5),m=r(17),S=r(33),w=r(53),_=r(75),O=r(72),E=r(184),M=r(31),P=r(127),j=r(11),F=r(74),A=M.f,I=j.f,L=E.f,N=e.Symbol,T=e.JSON,k=T&&T.stringify,R="prototype",C=v("_hidden"),D=v("toPrimitive"),G={}.propertyIsEnumerable,W=s("symbol-registry"),U=s("symbols"),V=s("op-symbols"),B=Object[R],q="function"==typeof N&&!!P.f,z=e.QObject,K=!z||!z[R]||!z[R].findChild,H=i&&a(function(){return 7!=O(I({},"a",{get:function(){return I(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=A(B,n);e&&delete B[n],I(t,n,r),e&&t!==B&&I(B,n,e)}:I,J=function(t){var n=U[t]=O(N[R]);return n._k=t,n},$=q&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===B&&Y(V,n,r),b(t),n=w(n,!0),b(r),u(U,n)?(r.enumerable?(u(t,C)&&t[C][n]&&(t[C][n]=!1),r=O(r,{enumerable:_(0,!1)})):(u(t,C)||I(t,C,_(1,{})),t[C][n]=!0),H(t,n,r)):I(t,n,r)},X=function(t,n){b(t);for(var r,e=y(n=S(n)),i=0,o=e.length;i<o;)Y(t,r=e[i++],n[r]);return t},Q=function(t){var n=G.call(this,t=w(t,!0));return!(this===B&&u(U,t)&&!u(V,t))&&(!(n||!u(this,t)||!u(U,t)||u(this,C)&&this[C][t])||n)},Z=function(t,n){if(t=S(t),n=w(n,!0),t!==B||!u(U,n)||u(V,n)){var r=A(t,n);return!r||!u(U,n)||u(t,C)&&t[C][n]||(r.enumerable=!0),r}},tt=function(t){for(var n,r=L(S(t)),e=[],i=0;r.length>i;)u(U,n=r[i++])||n==C||n==f||e.push(n);return e},nt=function(t){for(var n,r=t===B,e=L(r?V:S(t)),i=[],o=0;e.length>o;)!u(U,n=e[o++])||r&&!u(B,n)||i.push(U[n]);return i};q||(c((N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var n=h(0<arguments.length?arguments[0]:void 0),r=function(t){this===B&&r.call(V,t),u(this,C)&&u(this[C],n)&&(this[C][n]=!1),H(this,n,_(1,t))};return i&&K&&H(B,n,{configurable:!0,set:r}),J(n)})[R],"toString",function(){return this._k}),M.f=Z,j.f=Y,r(73).f=E.f=tt,r(117).f=Q,P.f=nt,i&&!r(68)&&c(B,"propertyIsEnumerable",Q,!0),p.f=function(t){return J(v(t))}),o(o.G+o.W+o.F*!q,{Symbol:N});for(var rt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),et=0;rt.length>et;)v(rt[et++]);for(var it=F(v.store),ot=0;it.length>ot;)d(it[ot++]);o(o.S+o.F*!q,"Symbol",{for:function(t){return u(W,t+="")?W[t]:W[t]=N(t)},keyFor:function(t){if(!$(t))throw TypeError(t+" is not a symbol!");for(var n in W)if(W[n]===t)return n},useSetter:function(){K=!0},useSimple:function(){K=!1}}),o(o.S+o.F*!q,"Object",{create:function(t,n){return void 0===n?O(t):X(O(t),n)},defineProperty:Y,defineProperties:X,getOwnPropertyDescriptor:Z,getOwnPropertyNames:tt,getOwnPropertySymbols:nt});var ut=a(function(){P.f(1)});o(o.S+o.F*ut,"Object",{getOwnPropertySymbols:function(t){return P.f(m(t))}}),T&&o(o.S+o.F*(!q||a(function(){var t=N();return"[null]"!=k([t])||"{}"!=k({a:t})||"{}"!=k(Object(t))})),"JSON",{stringify:function(t){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);if(r=n=e[1],(x(n)||void 0!==t)&&!$(t))return g(n)||(n=function(t,n){if("function"==typeof r&&(n=r.call(this,t,n)),!$(n))return n}),e[1]=n,k.apply(T,e)}}),N[R][D]||r(26)(N[R],D,N[R].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){"use strict";var e=r(1),i=r(132),o=r(159),a=r(2),s=r(78),l=r(8),u=r(5),c=r(3).ArrayBuffer,h=r(119),v=o.ArrayBuffer,p=o.DataView,f=i.ABV&&c.isView,d=v.prototype.slice,y=i.VIEW,g="ArrayBuffer";e(e.G+e.W+e.F*(c!==v),{ArrayBuffer:v}),e(e.S+e.F*!i.CONSTR,g,{isView:function(t){return f&&f(t)||u(t)&&y in t}}),e(e.P+e.U+e.F*r(4)(function(){return!new v(2).slice(1,void 0).byteLength}),g,{slice:function(t,n){if(void 0!==d&&void 0===n)return d.call(a(this),t);for(var r=a(this).byteLength,e=s(t,r),i=s(void 0===n?r:n,r),o=new(h(this,v))(l(i-e)),u=new p(this),c=new p(o),f=0;e<i;)c.setUint8(f++,u.getUint8(e++));return o}}),r(77)(g)},function(t,n,r){var e=r(1);e(e.G+e.W+e.F*!r(132).ABV,{DataView:r(159).DataView})},function(t,n,r){r(57)("Float32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Float64",8,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Int16",2,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Int32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Int8",1,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Uint16",2,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Uint32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Uint8",1,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Uint8",1,function(e){return function(t,n,r){return e(this,t,n,r)}},!0)},function(t,n,r){"use strict";var e=r(172),i=r(80);r(121)("WeakSet",function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},{add:function(t){return e.def(i(this,"WeakSet"),t,!0)}},e,!1,!0)},function(t,n,r){"use strict";var e=r(1),i=r(173),o=r(17),u=r(8),c=r(21),f=r(138);e(e.P,"Array",{flatMap:function(t){var n,r,e=o(this);return c(t),n=u(e.length),r=f(e,0),i(r,e,e,n,0,1,t,arguments[1]),r}}),r(67)("flatMap")},function(t,n,r){"use strict";var e=r(1),i=r(173),o=r(17),u=r(8),c=r(49),f=r(138);e(e.P,"Array",{flatten:function(){var t=arguments[0],n=o(this),r=u(n.length),e=f(n,0);return i(e,n,n,r,0,void 0===t?1:c(t)),e}}),r(67)("flatten")},function(t,n,r){"use strict";var e=r(1),i=r(120)(!0);e(e.P,"Array",{includes:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0)}}),r(67)("includes")},function(t,n,r){var e=r(1),i=r(150)(),o=r(3).process,u="process"==r(45)(o);e(e.G,{asap:function(t){var n=u&&o.domain;i(n?n.bind(t):t)}})},function(t,n,r){var e=r(1),i=r(45);e(e.S,"Error",{isError:function(t){return"Error"===i(t)}})},function(t,n,r){var e=r(1);e(e.G,{global:r(3)})},function(t,n,r){r(129)("Map")},function(t,n,r){r(130)("Map")},function(t,n,r){var e=r(1);e(e.P+e.R,"Map",{toJSON:r(171)("Map")})},function(t,n,r){var e=r(1);e(e.S,"Math",{clamp:function(t,n,r){return Math.min(r,Math.max(n,t))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{DEG_PER_RAD:Math.PI/180})},function(t,n,r){var e=r(1),i=180/Math.PI;e(e.S,"Math",{degrees:function(t){return t*i}})},function(t,n,r){var e=r(1),o=r(181),u=r(179);e(e.S,"Math",{fscale:function(t,n,r,e,i){return u(o(t,n,r,e,i))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{iaddh:function(t,n,r,e){var i=t>>>0,o=r>>>0;return(n>>>0)+(e>>>0)+((i&o|(i|o)&~(i+o>>>0))>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{imulh:function(t,n){var r=+t,e=+n,i=65535&r,o=65535&e,u=r>>16,c=e>>16,f=(u*o>>>0)+(i*o>>>16);return u*c+(f>>16)+((i*c>>>0)+(65535&f)>>16)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{isubh:function(t,n,r,e){var i=t>>>0,o=r>>>0;return(n>>>0)-(e>>>0)-((~i&o|~(i^o)&i-o>>>0)>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{RAD_PER_DEG:180/Math.PI})},function(t,n,r){var e=r(1),i=Math.PI/180;e(e.S,"Math",{radians:function(t){return t*i}})},function(t,n,r){var e=r(1);e(e.S,"Math",{scale:r(181)})},function(t,n,r){var e=r(1);e(e.S,"Math",{signbit:function(t){return(t=+t)!=t?t:0==t?1/t==1/0:0<t}})},function(t,n,r){var e=r(1);e(e.S,"Math",{umulh:function(t,n){var r=+t,e=+n,i=65535&r,o=65535&e,u=r>>>16,c=e>>>16,f=(u*o>>>0)+(i*o>>>16);return u*c+(f>>>16)+((i*c>>>0)+(65535&f)>>>16)}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(21),u=r(11);r(10)&&e(e.P+r(126),"Object",{__defineGetter__:function(t,n){u.f(i(this),t,{get:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(21),u=r(11);r(10)&&e(e.P+r(126),"Object",{__defineSetter__:function(t,n){u.f(i(this),t,{set:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){var e=r(1),i=r(186)(!0);e(e.S,"Object",{entries:function(t){return i(t)}})},function(t,n,r){var e=r(1),f=r(187),a=r(33),s=r(31),l=r(139);e(e.S,"Object",{getOwnPropertyDescriptors:function(t){for(var n,r,e=a(t),i=s.f,o=f(e),u={},c=0;o.length>c;)void 0!==(r=i(e,n=o[c++]))&&l(u,n,r);return u}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(53),u=r(32),c=r(31).f;r(10)&&e(e.P+r(126),"Object",{__lookupGetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.get}while(r=u(r))}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(53),u=r(32),c=r(31).f;r(10)&&e(e.P+r(126),"Object",{__lookupSetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.set}while(r=u(r))}})},function(t,n,r){var e=r(1),i=r(186)(!1);e(e.S,"Object",{values:function(t){return i(t)}})},function(t,n,r){"use strict";var e=r(1),o=r(3),u=r(46),i=r(150)(),c=r(7)("observable"),f=r(21),a=r(2),s=r(70),l=r(76),h=r(26),v=r(71),p=v.RETURN,d=function(t){return null==t?void 0:f(t)},y=function(t){var n=t._c;n&&(t._c=void 0,n())},g=function(t){return void 0===t._o},b=function(t){g(t)||(t._o=void 0,y(t))},x=function(t,n){a(t),this._c=void 0,this._o=t,t=new m(this);try{var r=n(t),e=r;null!=r&&("function"==typeof r.unsubscribe?r=function(){e.unsubscribe()}:f(r),this._c=r)}catch(n){return void t.error(n)}g(this)&&y(this)};x.prototype=l({},{unsubscribe:function(){b(this)}});var m=function(t){this._s=t};m.prototype=l({},{next:function(t){var n=this._s;if(!g(n)){var r=n._o;try{var e=d(r.next);if(e)return e.call(r,t)}catch(t){try{b(n)}finally{throw t}}}},error:function(t){var n=this._s;if(g(n))throw t;var r=n._o;n._o=void 0;try{var e=d(r.error);if(!e)throw t;t=e.call(r,t)}catch(t){try{y(n)}finally{throw t}}return y(n),t},complete:function(t){var n=this._s;if(!g(n)){var r=n._o;n._o=void 0;try{var e=d(r.complete);t=e?e.call(r,t):void 0}catch(t){try{y(n)}finally{throw t}}return y(n),t}}});var S=function(t){s(this,S,"Observable","_f")._f=f(t)};l(S.prototype,{subscribe:function(t){return new x(t,this._f)},forEach:function(e){var i=this;return new(u.Promise||o.Promise)(function(t,n){f(e);var r=i.subscribe({next:function(t){try{return e(t)}catch(t){n(t),r.unsubscribe()}},error:n,complete:t})})}}),l(S,{from:function(t){var n="function"==typeof this?this:S,r=d(a(t)[c]);if(r){var e=a(r.call(t));return e.constructor===n?e:new n(function(t){return e.subscribe(t)})}return new n(function(n){var r=!1;return i(function(){if(!r){try{if(v(t,!1,function(t){if(n.next(t),r)return p})===p)return}catch(t){if(r)throw t;return void n.error(t)}n.complete()}}),function(){r=!0}})},of:function(){for(var t=0,n=arguments.length,e=new Array(n);t<n;)e[t]=arguments[t++];return new("function"==typeof this?this:S)(function(n){var r=!1;return i(function(){if(!r){for(var t=0;t<e.length;++t)if(n.next(e[t]),r)return;n.complete()}}),function(){r=!0}})}}),h(S.prototype,c,function(){return this}),e(e.G,{Observable:S}),r(77)("Observable")},function(t,n,r){"use strict";var e=r(1),i=r(46),o=r(3),u=r(119),c=r(191);e(e.P+e.R,"Promise",{finally:function(n){var r=u(this,i.Promise||o.Promise),t="function"==typeof n;return this.then(t?function(t){return c(r,n()).then(function(){return t})}:n,t?function(t){return c(r,n()).then(function(){throw t})}:n)}})},function(t,n,r){"use strict";var e=r(1),i=r(151),o=r(190);e(e.S,"Promise",{try:function(t){var n=i.f(this),r=o(t);return(r.e?n.reject:n.resolve)(r.v),n.promise}})},function(t,n,r){var e=r(56),i=r(2),o=e.key,u=e.set;e.exp({defineMetadata:function(t,n,r,e){u(t,n,i(r),o(e))}})},function(t,n,r){var e=r(56),o=r(2),u=e.key,c=e.map,f=e.store;e.exp({deleteMetadata:function(t,n){var r=arguments.length<3?void 0:u(arguments[2]),e=c(o(n),r,!1);if(void 0===e||!e.delete(t))return!1;if(e.size)return!0;var i=f.get(n);return i.delete(r),!!i.size||f.delete(n)}})},function(t,n,r){var o=r(199),u=r(167),e=r(56),i=r(2),c=r(32),f=e.keys,a=e.key,s=function(t,n){var r=f(t,n),e=c(t);if(null===e)return r;var i=s(e,n);return i.length?r.length?u(new o(r.concat(i))):i:r};e.exp({getMetadataKeys:function(t){return s(i(t),arguments.length<2?void 0:a(arguments[1]))}})},function(t,n,r){var e=r(56),i=r(2),o=r(32),u=e.has,c=e.get,f=e.key,a=function(t,n,r){if(u(t,n,r))return c(t,n,r);var e=o(n);return null!==e?a(t,e,r):void 0};e.exp({getMetadata:function(t,n){return a(t,i(n),arguments.length<3?void 0:f(arguments[2]))}})},function(t,n,r){var e=r(56),i=r(2),o=e.keys,u=e.key;e.exp({getOwnMetadataKeys:function(t){return o(i(t),arguments.length<2?void 0:u(arguments[1]))}})},function(t,n,r){var e=r(56),i=r(2),o=e.get,u=e.key;e.exp({getOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(56),i=r(2),o=r(32),u=e.has,c=e.key,f=function(t,n,r){if(u(t,n,r))return!0;var e=o(n);return null!==e&&f(t,e,r)};e.exp({hasMetadata:function(t,n){return f(t,i(n),arguments.length<3?void 0:c(arguments[2]))}})},function(t,n,r){var e=r(56),i=r(2),o=e.has,u=e.key;e.exp({hasOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(56),i=r(2),o=r(21),u=e.key,c=e.set;e.exp({metadata:function(r,e){return function(t,n){c(r,e,(void 0!==n?i:o)(t),u(n))}}})},function(t,n,r){r(129)("Set")},function(t,n,r){r(130)("Set")},function(t,n,r){var e=r(1);e(e.P+e.R,"Set",{toJSON:r(171)("Set")})},function(t,n,r){"use strict";var e=r(1),i=r(131)(!0);e(e.P,"String",{at:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(51),o=r(8),u=r(124),c=r(115),f=RegExp.prototype,a=function(t,n){this._r=t,this._s=n};r(146)(a,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),e(e.P,"String",{matchAll:function(t){if(i(this),!u(t))throw TypeError(t+" is not a regexp!");var n=String(this),r="flags"in f?String(t.flags):c.call(t),e=new RegExp(t.source,~r.indexOf("g")?r:"g"+r);return e.lastIndex=o(t.lastIndex),new a(e,n)}})},function(t,n,r){"use strict";var e=r(1),i=r(193),o=r(133),u=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);e(e.P+e.F*u,"String",{padEnd:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0,!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(193),o=r(133),u=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);e(e.P+e.F*u,"String",{padStart:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0,!0)}})},function(t,n,r){"use strict";r(84)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,n,r){"use strict";r(84)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,n,r){r(160)("asyncIterator")},function(t,n,r){r(160)("observable")},function(t,n,r){var e=r(1);e(e.S,"System",{global:r(3)})},function(t,n,r){r(129)("WeakMap")},function(t,n,r){r(130)("WeakMap")},function(t,n,r){r(129)("WeakSet")},function(t,n,r){r(130)("WeakSet")},function(t,n,r){for(var e=r(162),i=r(74),o=r(27),u=r(3),c=r(26),f=r(82),a=r(7),s=a("iterator"),l=a("toStringTag"),h=f.Array,v={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=i(v),d=0;d<p.length;d++){var y,g=p[d],b=v[g],x=u[g],m=x&&x.prototype;if(m&&(m[s]||c(m,s,h),m[l]||c(m,l,g),f[g]=h,b))for(y in e)m[y]||o(m,y,e[y],!0)}},function(t,n,r){var e=r(1),i=r(158);e(e.G+e.B,{setImmediate:i.set,clearImmediate:i.clear})},function(t,n,r){var e=r(3),i=r(1),o=r(133),u=[].slice,c=/MSIE .\./.test(o),f=function(i){return function(t,n){var r=2<arguments.length,e=!!r&&u.call(arguments,2);return i(r?function(){("function"==typeof t?t:Function(t)).apply(this,e)}:t,n)}};i(i.G+i.B+i.F*c,{setTimeout:f(e.setTimeout),setInterval:f(e.setInterval)})},function(t,n,r){r(341),r(280),r(282),r(281),r(284),r(286),r(291),r(285),r(283),r(293),r(292),r(288),r(289),r(287),r(279),r(290),r(294),r(295),r(247),r(249),r(248),r(297),r(296),r(267),r(277),r(278),r(268),r(269),r(270),r(271),r(272),r(273),r(274),r(275),r(276),r(250),r(251),r(252),r(253),r(254),r(255),r(256),r(257),r(258),r(259),r(260),r(261),r(262),r(263),r(264),r(265),r(266),r(328),r(333),r(340),r(331),r(323),r(324),r(329),r(334),r(336),r(319),r(320),r(321),r(322),r(325),r(326),r(327),r(330),r(332),r(335),r(337),r(338),r(339),r(242),r(244),r(243),r(246),r(245),r(231),r(229),r(235),r(232),r(238),r(240),r(228),r(234),r(225),r(239),r(223),r(237),r(236),r(230),r(233),r(222),r(224),r(227),r(226),r(241),r(162),r(313),r(197),r(318),r(198),r(314),r(315),r(316),r(317),r(298),r(196),r(199),r(200),r(353),r(342),r(343),r(348),r(351),r(352),r(346),r(349),r(347),r(350),r(344),r(345),r(299),r(300),r(301),r(302),r(303),r(306),r(304),r(305),r(307),r(308),r(309),r(310),r(312),r(311),r(356),r(354),r(355),r(397),r(400),r(399),r(401),r(402),r(398),r(403),r(404),r(378),r(381),r(377),r(375),r(376),r(379),r(380),r(362),r(396),r(361),r(395),r(407),r(409),r(360),r(394),r(406),r(408),r(359),r(405),r(358),r(363),r(364),r(365),r(366),r(367),r(369),r(368),r(370),r(371),r(372),r(374),r(373),r(383),r(384),r(385),r(386),r(388),r(387),r(390),r(389),r(391),r(392),r(393),r(357),r(382),r(412),r(411),r(410),t.exports=r(46)},function(t,n){t.exports=function(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var r=t.nextSibling;return r?t.parentNode.insertBefore(n,r):t.parentNode.appendChild(n)}}])</script><script src="/./main.a5fda8.js"></script><script>!function(){var e,t;e="/slider.27463f.js",t=document.createElement("script"),document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)}()</script>



<!--  -->


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
    
      
    
      
    
    

    <ul style="width: 70%">
    
    
      
        
      
        
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    

    

    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>

  
<script type="text/javascript" src="/plugins/TweenMax/TweenMax.min.js"></script>
<script type="text/javascript" src="/plugins/TweenMax/HoverImg.js"></script>

<script>


  var hoverEffect = {
    "subNav": ".left-col .social a"
  }


  for (var x in hoverEffect) {
    // 初始化data-img属性值
    let $em = document.querySelectorAll(hoverEffect[x]);
    $em.forEach(($a) => {
      //console.log($a.href);
      if (isImageType($a.href)) {
        $a.setAttribute("data-img", $a.href)
      }
    })
    // 实现悬停元素预览图片效果
    let $a = document.querySelectorAll(hoverEffect[x] + "[data-img]");
    $a.forEach(($em) => {
      new HoverImgFx1($em)
    })
  }

</script>

  
<script type="text/javascript" src="/plugins/activate-power-mode/activate-power-mode.js"></script>
<script>
  POWERMODE.colorful = true; // make power mode colorful
  POWERMODE.shake = false; // turn off shake
  document.body.addEventListener('input', POWERMODE);
</script>

  
  <!-- <script async type="text/javascript" size="90" alpha="0.2" zIndex="0" src="/plugins/ribbon.js/ribbon.min.js"></script> -->
  
  
  
</body>

</html>
